![](_page_0_Picture_0.jpeg)

## Technical Guideline BSI TR-03105 Part 5.2

# Test plan for eID and eSign compliant smart card readers with integrated EACv2

| Version: | 2.0        |
|----------|------------|
| Date:    | 2015-05-22 |
|          |            |
|          |            |
|          |            |
|          |            |
|          |            |
|          |            |

Bundesamt für Sicherheit in der Informationstechnik Postfach 20 03 63 53133 Bonn Internet: https://www.bsi.bund.de © Bundesamt für Sicherheit in der Informationstechnik 2014 

| 1                  | Introduction 7                                                         |  |
|--------------------|------------------------------------------------------------------------|--|
| 2                  | Validation Rules 8                                                     |  |
| 2.1                | General Definitions 8                                                  |  |
| 2.1.1              | Verification Task and Scope 8                                          |  |
| 2.1.2              | Test Object 8                                                          |  |
| 2.1.3              | Test Track 8                                                           |  |
| 2.1.4              | Functions, Options and Profiles 9                                      |  |
| 2.1.5              | Description of Verification Requirements10                             |  |
| 2.2                | Verification Requirements 13                                           |  |
| 2.2.1              | Transparent Mode 13                                                    |  |
| 2.2.1.1            | List of Verification Requirements 13                                   |  |
| 2.2.2              | PACE 13                                                                |  |
| 2.2.2.1<br>2.2.2.2 | General Preliminary Remarks 13<br>List of Verification Requirements 13 |  |
| 2.2.3              | Terminal Authentication 15                                             |  |
| 2.2.3.1            | General Preliminary Remarks 15                                         |  |
| 2.2.3.2            | List of Verification Requirements 15                                   |  |
| 2.2.4              | Chip Authentication 17                                                 |  |
| 2.2.4.1            | General Preliminary Remarks 17                                         |  |
| 2.2.4.2            | List of Verification Requirements 17                                   |  |
| 2.2.5              | Access to the eID Application 18                                       |  |
| 2.2.5.1            | General Preliminary Remarks 18                                         |  |
| 2.2.5.2            | List of Verification Requirements 18                                   |  |
| 2.2.6              | Access to Biometric Data 20                                            |  |
| 2.2.6.1            | General Preliminary Remarks 20                                         |  |
| 2.2.6.2            | List of Verification Requirements 20                                   |  |
| 2.2.7              | Use of the Digital Signature Application20                             |  |
| 2.2.7.1            | General Preliminary Remarks 20                                         |  |
| 2.2.7.2            | List of Verification Requirements 21                                   |  |
| 3                  | Implementation Conformance Statement25                                 |  |
| 3.1                | Supported profiles and functions 25                                    |  |
| 3.1.1              | Profiles 25                                                            |  |
| 3.1.2              | Functions 26                                                           |  |
| 3.2                | Cryptographic algorithms 26                                            |  |
| 3.3                | Terminal type 26                                                       |  |
| 3.4                | Passwords 27                                                           |  |
| 4                  | Definition of Configuration Data for the Tests28                       |  |
| 4.1                | Terminal Certificates 28                                               |  |
| 4.2                | Extension of PC/SC Interface 30                                        |  |
| 4.2.1              | InBuffer (for GetReadersPACECapabilities)30                            |  |
| 4.2.2              | OutBuffer (for GetReadersPACECapabilities)30                           |  |
| 4.2.3              | InBuffer (for EstablishPACEChannel)30                                  |  |
| 4.2.4              | OutBuffer (for EstablishPACEChannel)32                                 |  |
| 4.3                | Communication Steps at the Card Interface32                            |  |
| 4.3.1              | PACE 32                                                                |  |
| 4.3.2              | Terminal Authentication 33                                             |  |
| 4.3.3              | Chip Authentication 34                                                 |  |

| 4.3.4   | Select the eSign Application 34                                                    |  |
|---------|------------------------------------------------------------------------------------|--|
| 4.3.5   | Reading Data from the eID Application35                                            |  |
| 4.3.6   | Writing Data into the eID Application35                                            |  |
| 4.3.7   | Restricted Identification 36                                                       |  |
| 4.3.8   | Auxiliary Data Verification 36                                                     |  |
| 4.3.9   | PIN Management 36                                                                  |  |
| 4.3.9.1 | Changing password 36                                                               |  |
| 4.3.9.2 | Unblocking password 36                                                             |  |
| 4.3.9.3 | Activating / Deactivating password37                                               |  |
| 4.3.10  | Reading Data from the ePassport Application37                                      |  |
| 5       | Test Specification 38                                                              |  |
| 5.1     | Transparent Mode 38                                                                |  |
| 5.1.1   | R_Tra_1 – Correct Reading of smart card Data in Transparent Mode38                 |  |
| 5.2     | PACE 39                                                                            |  |
| 5.2.1   | R_PACE_1 – Correct Execution of PACE Protocol39                                    |  |
| 5.2.2   | R_PACE_2 – Abort of PACE Protocol because of Internal LT Error45                   |  |
| 5.2.3   | R_PACE_3 – Abort of PACE Protocol because of Incorrect LT Data49                   |  |
| 5.2.4   | R_PACE_4 – Abort of PACE Protocol because of Incorrect UT Data56                   |  |
| 5.3     | Terminal Authentication 62                                                         |  |
| 5.3.1   | R_TA_1 – Correct Execution of Terminal Authentication Protocol63                   |  |
| 5.3.2   | R_TA_2 – Abort because of Inconsistent Reader Data64                               |  |
| 5.3.3   | R_TA_3 – Abort because of Internal LT Error65                                      |  |
| 5.3.4   | R_TA_4 – Abort because of Secure Messaging Error68                                 |  |
| 5.4     | Chip Authentication 72                                                             |  |
| 5.4.1   | R_CA_1 – Correct Execution of Chip Authentication Protocol73                       |  |
| 5.4.2   | R_CA_2 – Abort because of Internal LT Error76                                      |  |
| 5.4.3   | R_CA_3 – Abort because of Incorrect LT Data78                                      |  |
|         |                                                                                    |  |
| 5.5     | Access to the eID Application 82                                                   |  |
| 5.5.1   | R_eID_1 – Correct Reading Access to eID Data with EAC82                            |  |
| 5.5.2   | R_eID_2 – Correct Writing Access to eID Data with EAC84                            |  |
| 5.5.3   | R_eID_3 – Correct Execution of Internal eID Functions85                            |  |
| 5.5.4   | R_eID_4 – Password Management Functions for Authenticated Terminals86              |  |
| 5.5.5   | R_eID_5 – Password Management Functions for Unauthenticated Terminals after PACE89 |  |
| 5.6     | Access to Biometric Data 94                                                        |  |
| 5.6.1   | R_bio_1 – Correct Reading Access to Biometric Data with EAC94                      |  |
| 5.7     | Use of the Digital Signature Application95                                         |  |
| 5.7.1   | R_Sig_1 – Successful Key Pair Generation95                                         |  |
| 5.7.2   | R_Sig_2 – Abort Key Pair Generation100                                             |  |
| 5.7.3   | R_Sig_3 – Successful Signature Generation107                                       |  |
| 5.7.4   | R_Sig_4 – Abort Signature Generation110                                            |  |
| 5.7.5   | R_Sig_5 – Successful Password Management Functions116                              |  |
| 5.7.6   | R_Sig_6 – Abort Password Management Functions121                                   |  |
| 5.7.7   | R_Sig_7 – Successful Termination of the Signature Function132                      |  |
| 5.7.8   | R_Sig_8 – Abort Termination of the Signature Function135                           |  |
|         | Annex 140                                                                          |  |
|         | Bibliography 140                                                                   |  |
|         |                                                                                    |  |

| Table 1: Functions of the whole system 9                                                     |  |
|----------------------------------------------------------------------------------------------|--|
| Table 2: Options of the whole system 10                                                      |  |
| Table 3: Profiles defined for the test object 10                                             |  |
| Table 4: Test classes for parameters and their selection modes11                             |  |
| Table 5: Structure of a table to define verification requirements12                          |  |
| Table 6: Verification requirements for transparent mode, execution in the DUT13              |  |
| Table 7: Verification requirements for PACE, execution in the DUT15                          |  |
| Table 8: Verification requirements for terminal authentication, execution in the DUT16       |  |
| Table 9: Verification requirements for chip authentication, execution in the DUT18           |  |
| Table 10: Verification requirements for eID application, execution in the DUT20              |  |
| Table 11: Verification requirements for access to biometric data, execution in the DUT20     |  |
| Table 12: Verification Requirements use of the signature application, execution in the DUT24 |  |
| Table 13: Profiles for the DUT 25                                                            |  |
| Table 14: Functions for the DUT 26                                                           |  |
| Table 15: Supported algorithms 26                                                            |  |
| Table 16: Supported terminal roles 26                                                        |  |
| Table 17: Matrix for the supported passwords dependent on the terminal role27                |  |
| Table 18: Structure of a certificate 28                                                      |  |
| Table 19: Choice of access rights for Inspection Systems29                                   |  |
| Table 20: Choice of access rights for Authentication Terminals29                             |  |
| Table 21: Choice of access rights for Signature Terminals29                                  |  |
| Table 22: Choice of access rights for CA certificates (Inspection Systems)29                 |  |
| Table 23: Choice of access rights for CA certificates (Authentication Terminals)30           |  |
| Table 24: Choice of access rights for CA certificates (Signature Terminals)30                |  |
| Table 25: Example for CERT_DESC 31                                                           |  |
| Table 26: Structure of the CHAT data object 31                                               |  |
| Table 27: Bitmap for functions supported by the DUT32                                        |  |
| Table 28: Structure of a test case description 38                                            |  |
| Table 29: Test case R_PACE_1.1 40                                                            |  |
| Table 30: Test case R_PACE_1.2 41                                                            |  |
| Table 31: Test case R_PACE_1.3 42                                                            |  |
| Table 32: Test case R_PACE_1.4 43                                                            |  |
| Table 33: Test case R_PACE_2.1 46                                                            |  |
| Table 34: Test case R_PACE_2.3 48                                                            |  |
| Table 35: Test case R_PACE_2.4 49                                                            |  |
| Table 36: Test case R_PACE_3.1 50                                                            |  |
| Table 37: Test case R_PACE_3.2 51                                                            |  |
| Table 38: Test case R_PACE_3.3 52                                                            |  |
| Table 39: Test case R_PACE_3.4 53                                                            |  |
| Table 40: Test case R_PACE_3.5 54                                                            |  |
| Table 41: Test case R_PACE_3.6 56                                                            |  |
| Table 42: Test case R_PACE_4.1 56                                                            |  |
| Table 43: Test case R_PACE_4.2 57                                                            |  |
| Table 44: Test case R_PACE_4.3 58                                                            |  |
| Table 45: Test case R_eID_1.3 84                                                             |  |
| Table 46: Test case R_Sig_6.3 124                                                            |  |
| Table 47: Test case R_Sig_8.1 136                                                            |  |
| Table 48: Test case R_Sig_8.2 137                                                            |  |
| Table 49: Test case R_Sig_8.3 139                                                            |  |

# 1 Introduction

This Technical Guideline describes conformity criteria for eID and eSign compliant smart card readers. An eID and eSign compliant terminal with EACv2 uses a reader that directly accesses the interface of the smart card. Depending on the architecture, parts of the terminal functions may be implemented outside of the reader, e.g., in software on a host PC. We call this functionality terminal software. In the case all functions are integrated in a single system, we call this an Inspection System. This Technical Guideline primarily focus on readers, which means that all the tested terminal functionalities are implemented within the physical reader. We assume a possibility to access the reader by a PC/SC or CCID interface. For criteria related to terminal software as well as for Inspection Systems, we refer to [TR-03105-5.3].

This Technical Guideline contains the parts validation rules and test specification.

The validation rules comprise the description of the test object reader, its test interfaces and its functions as well as the verification requirements. The test specification contains the general structure of test cases and the test cases themselves together with the necessary steps for test preparation, test execution and evaluation of the test results.

The conformity tests defined in this Technical Guideline are functional tests that shall guarantee the interoperability between eID and eSign compliant smart cards and the reader. They do not address security issues. These topics are treated elsewhere.

The conformity criteria of this Technical Guideline hold for OSI layers 6 and 7 and are based on the EACv2 specification [TR-03110-2] and on the specification of the contactless interface for signature generation [TR-03117].

Specific properties of the readers as the PC/SC or CCID functionality for the PACE protocol follow the Technical Guideline to requirements on smart card readers that support ePA applications [TR-03119].

# 2 Validation Rules

### 2.1 General Definitions

### 2.1.1 Verification Task and Scope

The verification task consists in proving interoperability between readers and host applications that access reader functions. Here conformity to the EACv2 specification [TR-03110-2] and to the specification of the contactless interface for signature generation [TR-03117] must be proven. The scope for the verification task can be outlined as follows:

- prove conformity of interfaces exclusively for OSI layers 6 and 7,
- verify exclusively reader functions, that are needed for access to eID and biometric data as well as for QES over the contactless interface,
- restrict focus to PC/SC or CCID for the interface between host PC and reader, other interfaces as CT-API and SICCT are not relevant in this framework,
- do not examine the behaviour of the reader at other interfaces, especially at the display and at the contact interface.

If a manufacturer does not use a PC/SC or CCID interface, he has to provide an appropriate adapter to perform the tests.

### 2.1.2 Test Object

Due to different hardware and software architectures for the readers, parts of the terminal functions may be implemented outside the reader. These parts of terminal functions are implemented in the host PC and called terminal software in the following. A possible implementation is the eCard API framework as specified in [TR-03112-1].

The decision, whether a function of a test object must be included into a test or not, depends on the relevance of this function for the contactless reader interface. Thus, functions for signature generation are incorporated into the tests, but functions for signature verification are not.

The conformity tests for readers must ensure the correct behaviour at the interfaces for PACE, terminal authentication and chip authentication protocols, for accessing eID and biometric data, as well as for signature generation. The following sections will describe in detail which functionality has to be verified. The Test Object Reader will be referred to as device under test (DUT) in the following.

### 2.1.3 Test Track

In order to access eID and biometric data, as well as to use QES, the DUT supports two technical interfaces:

- 1. the PC/SC (or CCID) interface for access by the host PC,
- 2. the contactless interface (e.g. ISO 14443) for communication with a smart card.

To test the functionality of one interface, an appropriate behaviour at the other interface is necessary. Therefore a test system is needed, where the DUT is situated between an upper tester (UT) and a lower tester (LT). The resulting test track is shown in Figure [1.](#page-8-0)

UT sends commands to the DUT by a call of the PC/SC (or CCID) interface. The DUT generates an expected command sequence that it sends to the smart card. Instead of a physical smart card, the contactless interface at LT uses a smart card simulation. LT analyses a command received by the DUT and generates an answer message for the DUT, with or without incorrect data and/or error code, according to the simulator configuration. The DUT transmits the answer received from LT back to UT which checks it against the expected result. If a card DUT supports the PC/SC interface as well as the CCID interface, the client application should use the PC/SC interface.

![](_page_8_Figure_1.jpeg)

#### <span id="page-8-0"></span>*Figure 1: Test track*

Thus, an appropriate configuration of the LT is necessary for test execution. This configuration may be manually or automatically triggered by UT.

#### 2.1.4 Functions, Options and Profiles

According to the overall hardware and software architecture for DUT and host PC parts of the functionality are provided by the DUT and/or the terminal software.

Such a distinguished functionality will be called function in the following.

The functions of the whole system, whose conformity has to be proved, are listed in table [1.](#page-8-1)

| Function       | Task                                                                                 |
|----------------|--------------------------------------------------------------------------------------|
| Transparent    | Transmission of card commands over the PC/SC reader interface to the smart card      |
| PACE           | Execution of PACE protocol according to [TR-03110-2], 3.2                            |
| TA             | Execution of terminal authentication protocol according to [TR-03110-2], 3.4         |
| CA             | Execution of chip authentication protocol (version 2) according to [TR-03110-2], 3.3 |
| eID            | Access to eID application                                                            |
| Biometric data | Access to biometric data in the smart card                                           |
| QES            | Generation of qualified electronic signatures according to [TR-03117]                |

<span id="page-8-1"></span>Table 1: Functions of the whole system

The functions of the whole system are taken as a basis to structure the verification requirements (see chapter [2.1.5\)](#page-9-0).

A functionality which may be supported optionally by the whole system will be called an option. The options allowed are listed in table [2.](#page-9-2)

| Option          | Task                                                              |
|-----------------|-------------------------------------------------------------------|
| Change_PIN      | Password management function to change the PIN                    |
| Change_CAN      | Password management function to change the CAN                    |
| Unblock_PIN_PUK | Password management function to unblock the PIN after using PUK   |
| PIN_MGT_AT      | PIN management functions for Authentication Terminals             |
| PIN_MGT_uT      | PIN management functions for unauthenticated terminals after PACE |
| Write_eID       | Writing Access to eID data with EAC                               |

<span id="page-9-2"></span>Table 2: Options of the whole system

The profiles allowed for the DUT are listed in table [3.](#page-9-1)

| Profile        | Function       | Option                |
|----------------|----------------|-----------------------|
| R_Tra          | Transparent    |                       |
| R_PACE         | PACE           |                       |
| R_TA           | TA             |                       |
| R_CA           | CA             |                       |
| R_eID          | eID            |                       |
| R_bio          | Biometric data |                       |
| R_Sig          | QES            |                       |
| R_Chg_PIN      |                | Change PIN            |
| R_Chg_CAN      |                | Change CAN            |
| R_UNLK_PIN_PUK |                | Unblock PIN after PUK |
| R_PIN_MGT_AT   |                | PIN_MGT_AT            |
| R_PIN_MGT_uT   |                | PIN_MGT_uT            |

<span id="page-9-1"></span>Table 3: Profiles defined for the test object

#### <span id="page-9-0"></span>2.1.5 Description of Verification Requirements

Special verification requirements are defined for the test object that describe which aspects must be validated with respect to the behaviour of the test object at the relevant interfaces. The verification requirements are structured along the functions in separate sections.

A verification requirement handles a special aspect of the specification (e. g. the special part age verification in the eID application) and assigns to this aspect a test parameter or a defined combination of test parameters resp. preconditions as verification focus.

Moreover a verification requirement determines whether the test is a positive or a negative one and according to which principles the test parameters have to be chosen. Table [4](#page-10-0) lists the test classes that define different selection modes for test parameters.

| Test<br>class | Description   | Selection mode of a<br>positive test                                                                                                                                    | Selection mode of a<br>negative test                                                       |
|---------------|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|
| CT            | Complete test | Check all admitted values of a test<br>parameter                                                                                                                        | Check all forbidden values of a test<br>parameter                                          |
| LM            | Limit test    | Check limits of the admitted value<br>range of a test parameter. Apart<br>from the lower and upper limits LL<br>and UL, the values<br>UL-1 and LL+1 are tested as well. | Check limits of the value range of a<br>test parameter, where UL+1 and<br>LL-1 are tested. |
| SA            | Sample Test   | Check appropriate values within the<br>range of a test parameter                                                                                                        | Check appropriate values outside<br>the range of a test parameter                          |

<span id="page-10-0"></span>Table 4: Test classes for parameters and their selection modes

The test classes LM and SA may be combined if necessary.

The verification requirements of the same section are described in one table. Table [5](#page-11-0) shows the structure of such a table.

| Name in table column | Contents                                                                                                                                                        |  |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| RQ_no                | Identifier for verification requirement built up as follows:<br><code test object>_<code function>_<No. VR>.<No. para><br><code test object>:<br>R (for reader) |  |
|                      | <code function>:                                                                                                                                                |  |
|                      | Tra (for transparent mode)                                                                                                                                      |  |
|                      | PACE (for PACE protocol)                                                                                                                                        |  |
|                      | TA (for terminal authentication protocol)                                                                                                                       |  |
|                      | CA (for chip authentication protocol)                                                                                                                           |  |
|                      | eID (for eID application)                                                                                                                                       |  |
|                      | bio (for biometric data)                                                                                                                                        |  |
|                      | Sig (for eSign application)                                                                                                                                     |  |
|                      | <No. VR> (verification requirement number): 1, 2, 3                                                                                                             |  |
|                      | <No. para> (distinguish parameters within a verification requirement): 1,<br>2, 3                                                                               |  |
| Description          | Short description of the verification requirement                                                                                                               |  |
| Parameter            | Parameter in focus of examination; this also includes combinations of<br>parameters                                                                             |  |
| Reference            | Chapters in the specification which define the verification requirement                                                                                         |  |
| PR                   | Test classes for positive tests ("positive requirement"); if this field is empty,<br>there are no positive tests for the considered parameters                  |  |
| NR                   | Test classes for negative tests ("negative requirement"); if this field is empty,<br>there are no negative tests for the considered parameters                  |  |
| IF                   | Interface of test objects that are in focus of examination:<br>UT – Upper Tester<br>LT – Lower Tester                                                           |  |

<span id="page-11-0"></span>Table 5: Structure of a table to define verification requirements

## 2.2 Verification Requirements

#### 2.2.1 Transparent Mode

#### 2.2.1.1 List of Verification Requirements

| RQ_no<br>R_Tra_ | Description                                                                            | Parameter                                                                                                                                                                                                                                                                             | Reference                | PR | NR | IF       |
|-----------------|----------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|----|----|----------|
| 1.1             | Check correct<br>transmission of card<br>commands to the<br>DUT in transparent<br>mode | UT sends card command to the DUT via<br>PC/SC interface to read data from<br>smart card which are freely accessible.<br>It is checked that the DUT transmits<br>command message to LT and transmits<br>to UT response message received from<br>LT, both without modifications.        | [TR-03110-3],<br>A.1.1.6 | SA |    | UT<br>LT |
| 1.2             |                                                                                        | UT sends card command to the DUT via<br>PC/SC interface to read data from<br>smart card for which access is not<br>allowed.<br>It is checked that the DUT transmits<br>command message to LT and transmits<br>to UT response message received from<br>LT, both without modifications. | [TR-03110-3],<br>A.1.1.6 |    | SA | UT<br>LT |

Table 6: Verification requirements for transparent mode, execution in the DUT

### 2.2.2 PACE

#### 2.2.2.1 General Preliminary Remarks

The PACE protocol is the first part of the EAC protocol that is used to access eID or signature function in the smart card. In order to perform PACE protocol, the PC/SC function GET\_FEATURE\_REQUEST ([PCSC10], 2.2) extended by the feature FEATURE\_EXECUTE\_PACE is called in the DUT. The structure to this feature is named EstablishPACEChannel ([TR-03119], D.3).

InputData of EstablishPACEChannel consist of ([TR-03119], D.1.2):

- Password-ID for user authentication,
- CHAT (Card Holder Authorization Template),
- Password (if transmitted by host PC) and
- complete description of terminal certificate.

#### 2.2.2.2 List of Verification Requirements

| RQ_no<br>R_PACE_ | Description                                               | Parameter                                                                                                   | Reference                                   | PR | NR | IF |
|------------------|-----------------------------------------------------------|-------------------------------------------------------------------------------------------------------------|---------------------------------------------|----|----|----|
| 1.1-1.3          | Check correct<br>execution of PACE<br>protocol in the DUT | Use certificate roles (Inspection<br>System, Authentication Terminal,<br>Signature Terminal) with specified | [TR-03110-2],<br>2.3, 3.2,<br>[TR-03110-4], | SA |    | UT |

| RQ_no<br>R_PACE_ | Description                                                                                                      | Parameter                                                                                                                                                                                                                                                                                                   | Reference                                                              | PR | NR | IF |
|------------------|------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|----|----|----|
|                  |                                                                                                                  | access rights.<br>Use appropriate certificates for<br>Document Verifier<br>Use all possible combinations of<br>certificate role:<br>Inspection System: Password-ID =<br>CAN and MRZ password<br>Authentication Terminal:<br>Password-ID = PIN, CAN<br>Signature Terminal: Password-ID =<br>CAN, PIN and PUK | 2.1.3.2, 2.2.3.2,<br>2.3,<br>[TR-03119],<br>D.3                        |    |    |    |
| 1.4              |                                                                                                                  | Use unauthenticated terminals with<br>CAN, PIN and PUK                                                                                                                                                                                                                                                      | [TR-03110-2],<br>2.4.1, 3.2,<br>[TR-03119],<br>D.3                     | SA |    | UT |
| 1.5, 1.6         |                                                                                                                  | Use of different algorithms                                                                                                                                                                                                                                                                                 | [TR-03110-2],<br>3.2,<br>[TR-03110-3],<br>A.1.1.1, A.1.2,<br>A.3, B.1  | SA |    | LT |
| 2.1, 2.2         | Check that the DUT<br>aborts PACE protocol<br>when detecting<br>internal error or<br>error communicated<br>by LT | LT derives cryptographic key from<br>password (PIN, CAN, MRZ-Password,<br>PUK) incorrectly                                                                                                                                                                                                                  | [TR-03110-2],<br>3.2,<br>[TR-03119],<br>D.3.1                          |    | SA | LT |
| 2.3              |                                                                                                                  | LT returns error code to command<br>MSE: Set AT                                                                                                                                                                                                                                                             | [TR-03119],<br>D.3.1                                                   |    | SA | LT |
| 2.4              |                                                                                                                  | LT transmits incorrect data for<br>mapping function Map in answer to<br>card command General Authenticate<br>(Step 2).                                                                                                                                                                                      | [TR-03110-2],<br>3.2,<br>[TR-03110-3],<br>B.1,<br>[TR-03119],<br>D.3.1 |    | SA | LT |
| 3.1, 3.2         | Check that the DUT<br>aborts PACE protocol<br>when the DUT<br>receives incorrect<br>data from LT                 | Transmission of incorrect PACE<br>parameters from LT                                                                                                                                                                                                                                                        | [TR-03110-2],<br>3.2,<br>[TR-03119],<br>D.3.1                          |    | SA | LT |
| 3.3              |                                                                                                                  | Incorrect cryptogram in response<br>message to card command General<br>Authenticate (Step 1)                                                                                                                                                                                                                | [TR-03110-2],<br>3.2,<br>[TR-03110-3],<br>B.1,<br>[TR-03119],<br>D.3.1 |    | SA | LT |
| 3.4              |                                                                                                                  | Ephemeral public key received from                                                                                                                                                                                                                                                                          | [TR-03110-2],                                                          |    | SA | LT |

| RQ_no<br>R_PACE_ | Description                                                                                     | Parameter                                                                                                                                                                 | Reference                                                             | PR | NR       | IF |
|------------------|-------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------|----|----------|----|
|                  |                                                                                                 | LT is identical to ephemeral public key<br>generated by the DUT                                                                                                           | 3.2                                                                   |    |          |    |
| 3.5              |                                                                                                 | LT transmits incorrect cryptogram<br>that has been generated with derived<br>SM key data                                                                                  | [TR-03110-2],<br>3.2                                                  |    | SA       | LT |
| 3.6              |                                                                                                 | LT transmits authentication token<br>that has been generated with an<br>algorithm that differs from the<br>algorithm used by the DUT                                      | [TR-03110-2],<br>3.2,<br>[TR-03110-3],<br>A.1.1.1, A.1.2,<br>A.3, B.1 |    | SA       | LT |
| 4.1, 4.2         | Check that the DUT<br>aborts PACE protocol<br>when receiving<br>incorrect input data<br>from UT | Incorrect Password-ID in input of<br>PC/SC function                                                                                                                       | [TR-03119],<br>D.1.2                                                  |    | LM<br>SA | UT |
| 4.3-4,5          |                                                                                                 | Incorrect password (PIN, CAN, MRZ<br>password, PUK) in input of PC/SC<br>function or in user input                                                                        | [TR-03110-2],<br>3.2,<br>[TR-03119],<br>D.1.2                         |    | SA       | UT |
| 4.6-4.8          |                                                                                                 | Incorrect combination of Password-ID<br>and CHAT in input of PC/SC function<br>(e. g. Password-ID addresses CAN;<br>Authentication Terminal not<br>authorized to use CAN) | [TR-03110-2],<br>3.2,<br>[TR-03119],<br>D.1.2                         |    | SA       | UT |

Table 7: Verification requirements for PACE, execution in the DUT

### 2.2.3 Terminal Authentication

#### 2.2.3.1 General Preliminary Remarks

The terminal authentication protocol is the second part of the EAC protocol. It is executed only in Signature Terminals. In Authentication Terminals command messages and answer messages for the smart card used in the protocol are transmitted between UT and LT. Here the DUT merely performs SM using the session keys as derived in PACE protocol.

#### 2.2.3.2 List of Verification Requirements

| RQ_no<br>R_TA_ | Description                                                                        | Parameter                                                                                                                     | Reference                                                                                | PR | NR | IF |
|----------------|------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------|----|----|----|
| 1.1-1.3        | Check correct<br>execution of<br>terminal<br>authentication<br>protocol in the DUT | Use certificate roles Inspection<br>System, Authentication Terminal and<br>Signature Terminal with specified<br>access rights | [TR-03110-2],<br>2.3, 3.4,<br>[TR-03110-3],<br>B.3,<br>[TR-03110-4]<br>2.1.3.2, 2.2.3.2, | SA |    | UT |

| RQ_no<br>R_TA_ | Description                                                                                                                | Parameter                                                                                                                              | Reference                                                             | PR | NR | IF |
|----------------|----------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------|----|----|----|
|                |                                                                                                                            |                                                                                                                                        | 2.3,<br>[TR-03119],<br>D.3                                            |    |    |    |
| 2.1            | Check that the DUT<br>aborts terminal<br>authentication when<br>discovering<br>inconsistent internal<br>data               | Terminal certificate CHAT used in<br>terminal authentication different<br>from CHAT used in PACE protocol                              | [TR-03110-2],<br>3.4,<br>[TR-03110-3]<br>B.3,<br>[TR-03119],<br>A.5.1 |    | SA | UT |
| 3.1            | Check that the DUT<br>aborts terminal<br>authentication when<br>detecting internal<br>error or error<br>communicated by LT | LT returns error code to command<br>MSE: Set DST (setting public key for<br>certificate verification)                                  | [TR-03110-2],<br>3.4,<br>[TR-03110-3],<br>B.3                         |    | SA | LT |
| 3.2            |                                                                                                                            | LT returns error code to command<br>PSO: Verify Certificate when verifying<br>terminal certificates                                    | [TR-03110-2],<br>3.4,<br>[TR-03110-3],<br>B.3                         |    | SA | LT |
| 3.3            |                                                                                                                            | LT returns error code to command<br>MSE: Set AT (transmitting parameters<br>for terminal authentication to LT)                         | [TR-03110-2],<br>3.4,<br>[TR-03110-3],<br>B.3                         |    | SA | LT |
| 3.4            |                                                                                                                            | LT returns error code to command Get<br>Challenge (random number for<br>terminal authentication)                                       | [TR-03110-2],<br>3.4,<br>[TR-03110-3],<br>B.3                         |    | SA | LT |
| 3.5            |                                                                                                                            | LT returns error code to command<br>External Authenticate when checking<br>signed data from UT in terminal<br>authentication protocol. | [TR-03110-2],<br>3.4,<br>[TR-03110-3],<br>B.3                         |    | SA | LT |
| 4.1            | Check that the DUT<br>aborts terminal<br>authentication on<br>Secure Messaging<br>error in LT                              | Reader does not receive SM data<br>objects from LT in answer messages of<br>LT                                                         | [TR-03110-2],<br>3.4,<br>[TR-03110-3],<br>B.3                         |    | SA | LT |
| 4.2, 4.3       |                                                                                                                            | Reader receives incorrect SM data<br>objects from LT in answer messages of<br>LT                                                       | [TR-03110-2],<br>3.4,<br>[TR-03110-3],<br>B.3                         |    | SA | LT |
| 4.4,4.5        |                                                                                                                            | The DUT aborts terminal<br>authentication, if it receives that<br>wrong SM data from LT in response<br>APDU to command MSE: Set DST    | [TR-03110-2]                                                          |    | SA | LT |

Table 8: Verification requirements for terminal authentication, execution in the DUT

### 2.2.4 Chip Authentication

#### 2.2.4.1 General Preliminary Remarks

The chip authentication protocol is the third part of the EAC protocol. It is executed completely only in Signature Terminals. In Authentication Terminals command messages and answer messages for the smart card used in the protocol are transmitted between UT and LT. Here the DUT merely performs SM using the session keys as derived in PACE protocol.

| 2.2.4.2 |  |  | List of Verification Requirements |
|---------|--|--|-----------------------------------|
|---------|--|--|-----------------------------------|

| RQ_no<br>R_CA_ | Description                                                                                                                | Parameter                                                                                                                     | Reference                                                                                                             | PR | NR | IF |
|----------------|----------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------|----|----|----|
| 1.1-1.3        | Check correct<br>execution of chip<br>authentication<br>protocol in the DUT                                                | Use certificate roles Inspection<br>System, Authentication Terminal and<br>Signature Terminal with specified<br>access rights | [TR-03110-2],<br>2.3, 3.3,<br>[TR-03110-3],<br>B.2,<br>[TR-03110-4]<br>2.1.3.2, 2.2.3.2,<br>2.3<br>[TR-03119],<br>D.3 | SA |    | UT |
| 1.4, 1.5       |                                                                                                                            | Use of different algorithms and<br>multiple key pairs                                                                         | [TR-03110-2],<br>3.3,<br>[TR-03110-3],<br>A.1.1.2, A.4,<br>B.2                                                        | SA |    | LT |
| 2.1            | Check that the DUT<br>aborts chip<br>authen-tication<br>when detecting<br>internal error or<br>error communicated<br>by LT | LT returns error code to command<br>MSE: Set AT (transmitting parameters<br>for chip authentication to LT)                    | [TR-03110-2],<br>3.3,<br>[TR-03110-3],<br>B.2                                                                         |    | SA | LT |
| 2.2            |                                                                                                                            | LT returns error code to command<br>General Authenticate when verifying<br>the ephemeral public key of the DUT                | [TR-03110-2],<br>3.3,<br>[TR-03110-3],<br>B.2                                                                         |    | SA | LT |
| 2.3            |                                                                                                                            | LT computes incorrect key data for SM                                                                                         | [TR-03110-2],<br>3.3,<br>[TR-03110-3],<br>B.2                                                                         |    | SA | LT |
| 3.1            | Check that the DUT<br>aborts chip<br>authen-tication<br>when receiving<br>incorrect data from<br>LT                        | LT returns incorrect random number<br>in answer message to command<br>General Authenticate                                    | [TR-03110-2],<br>3.3,<br>[TR-03110-3],<br>B.2                                                                         |    | SA | LT |
| 3.2            |                                                                                                                            | LT returns incorrect cryptogram in                                                                                            | [TR-03110-2],                                                                                                         |    | SA | LT |

| RQ_no<br>R_CA_ | Description | Parameter                                                                                                                            | Reference                                                      | PR | NR | IF |
|----------------|-------------|--------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|----|----|----|
|                |             | answer message to command General<br>Authenticate                                                                                    | 3.3,<br>[TR-03110-3],<br>B.2                                   |    |    |    |
| 3.3            |             | LT transmits authentication token<br>that has been generated with an<br>algorithm that differs from the<br>algorithm used by the DUT | [TR-03110-2],<br>3.3,<br>[TR-03110-3],<br>A.1.1.2, A.4,<br>B.2 |    | SA | LT |
| 3.4            |             | LT transmits authentication token<br>that has been generated with a wrong<br>static key pair.                                        | [TR-03110-2],<br>3.3,<br>[TR-03110-3],<br>A.1.1.2, A.4,<br>B.2 |    | SA | LT |

Table 9: Verification requirements for chip authentication, execution in the DUT

### 2.2.5 Access to the eID Application

#### 2.2.5.1 General Preliminary Remarks

The access to the eID application is only admitted after successful execution of the EAC protocol (General Authentication Procedure). UT must have been using the DUT to authenticated to LT with certificate role Inspection System or Authentication Terminal. After performing EAC, the SM channel is established between UT and LT, i. e. the commands for the eID application are transmitted by the DUT in transparent mode. Therefore the verification requirements for the eID application exclusively handle positive tests.

#### 2.2.5.2 List of Verification Requirements

| RQ_no<br>R_eID_ | Description                                                        | Parameter                                                                    | Reference                                                  | PR | NR | IF |
|-----------------|--------------------------------------------------------------------|------------------------------------------------------------------------------|------------------------------------------------------------|----|----|----|
| 1.1             | Check correct reading<br>access to eID data with<br>EAC by the DUT | Use certificate role Inspection<br>System with specified access rights       | [TR-03110-4],<br>2.2,<br>[TR-03110-4],<br>2.1.3.2          | CT |    | UT |
| 1.2             |                                                                    | Use certificate role Authentication<br>Terminal with specified access rights | [TR-03110-2],<br>E.1,<br>[TR-03110-4],<br>2.2.3.2          | CT |    | UT |
| 1.3             |                                                                    | Use of different algorithms for<br>Secure Messaging                          | [TR-03110-4],<br>2.2,<br>[TR-03110-3]<br>A.4, 2.2.3.2, E.2 | SA |    | LT |
| 2.1             | Check correct writing<br>access to eID data with<br>EAC by the DUT | Use certificate role Authentication<br>Terminal with specified access rights | [TR-03110-4],<br>2.2,<br>[TR-03110-3],<br>2.2.3.2          | CT |    | UT |

| RQ_no<br>R_eID_ | Description                                                                                          | Parameter                                                                                                                                            | Reference                                           | PR       | NR | IF |
|-----------------|------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|----------|----|----|
| 3.1             | Check correct execution<br>of internal eID<br>functions that have<br>been called in LT by the<br>DUT | Certificate role Authentication<br>Terminal with access right restricted<br>identification:<br>Execute restricted identification<br>protocol         | [TR-03110-2],<br>3.5,<br>[TR-03110-4],<br>2.2.3.2   | SA       |    | UT |
| 3.2             |                                                                                                      | Certificate role Authentication<br>Terminal with access right age<br>verification:<br>Execute age verification for card<br>holder                    | [TR-03110-4],<br>2.2.3.2                            | SA<br>LM |    | UT |
| 3.3             |                                                                                                      | Certificate role Authentication<br>Terminal with access right<br>community ID verification:<br>Execute verification of card holder's<br>community ID | [TR-03110-4],<br>2.2.3.2                            | SA       |    | UT |
| 4.1             | Password management<br>functions for<br>authenticated terminals                                      | Certificate role Authentication<br>Terminal with access right password<br>management:<br>Changing PIN in LT<br>optional (if supported by terminal)   | [TR-03110-2],<br>2.4.2,<br>[TR-03110-4],<br>2.2.3.2 | SA       |    | UT |
| 4.2             |                                                                                                      | Certificate role Authentication<br>Terminal with access right password<br>management:<br>Changing CAN in LT<br>optional (if supported by terminal)   | [TR-03110-2],<br>2.4.2,<br>[TR-03110-4],<br>2.2.3.2 | SA       |    | UT |
| 4.3             |                                                                                                      | Certificate role Authentication<br>Terminal with access right password<br>management:<br>Unblock PIN in LT optional (if<br>supported by terminal)    | [TR-03110-2],<br>2.4.2,<br>[TR-03110-4],<br>2.2.3.2 | SA       |    | UT |
| 4.4             |                                                                                                      | Certificate role Authentication<br>Terminal with access right password<br>management:<br>Activate PIN in LT                                          | [TR-03110-2],<br>2.4.2,<br>[TR-03110-4],<br>2.2.3.2 | SA       |    | UT |
| 4.5             |                                                                                                      | Certificate role Authentication<br>Terminal with access right password<br>management:<br>Deactivate PIN in LT                                        | [TR-03110-2],<br>2.4.2,<br>[TR-03110-4],<br>2.2.3.2 | SA       |    | UT |
| 5.1, 5.2        | Password management<br>functions for<br>unauthenticated<br>terminals after PACE                      | Setting a new PIN using the<br>currently valid PIN<br>Consider the special case that the<br>current PIN is a transport PIN                           | [TR-03110-2],<br>2.4.1                              | SA       |    | UT |
| 5.3             |                                                                                                      | Resetting retry counter for PIN<br>using PUK                                                                                                         | [TR-03110-2],<br>2.4.1                              | SA       |    | UT |
| 5.4             |                                                                                                      | Setting a new PIN using PUK<br>optional (if supported by the DUT)                                                                                    | [TR-03110-2],<br>2.4.1                              | SA       |    | UT |

| RQ_no<br>R_eID_ | Description | Parameter                                                        | Reference              | PR | NR | IF |
|-----------------|-------------|------------------------------------------------------------------|------------------------|----|----|----|
| 5.5             |             | Resume temporarily a PIN using<br>CAN                            | [TR-03110-2],<br>2.4.1 | SA |    | UT |
| 5.6-5.8         |             | Resume a temporarily resumed PIN<br>by using it in PACE protocol | [TR-03110-2],<br>2.4.1 | SA |    | UT |

Table 10: Verification requirements for eID application, execution in the DUT

#### 2.2.6 Access to Biometric Data

#### 2.2.6.1 General Preliminary Remarks

The access to the data groups of the ePassport application containing biometric data is admitted for Inspection Systems with appropriate access rights after successful execution of the EAC protocol (General Authentication Procedure).

#### 2.2.6.2 List of Verification Requirements

| RQ_no<br>R_bio_ | Description                                                              | Parameter                                                                                                                               | Reference                | PR | NR | IF |
|-----------------|--------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------|--------------------------|----|----|----|
| 1.1             | Check correct reading<br>access to biometric data<br>with EAC by the DUT | Use certificate role Inspection<br>System with access rights for DG 3<br>(Fingerprint) and DG 4 (Iris) of the<br>ePassport application. | [TR-03110-4],<br>2.1.3.2 | CT |    | UT |

Table 11: Verification requirements for access to biometric data, execution in the DUT

### 2.2.7 Use of the Digital Signature Application

#### 2.2.7.1 General Preliminary Remarks

In this section verification requirements will be defined that focus on the correct behaviour of the DUT during the processing of functions related to qualified electronic signatures according to [TR-03117]. In this application the DUT is part of a so-called "signature application component" and the smart card is a secure signature creation device (SSCD) according to the German digital signature act [SigG] and the signature ordinance [SigV].

According to the Technical Guideline [TR-03117] that defines requirements for the DUT and the smart card, the following functions and procedures have to be considered:

- 1 Activation of the smart card as SSCD including
	- a Setting of the operational user authentication data (Setting of the eSign-PIN, see also management of user authentication data)
	- b Generation of the signature key pair by the certification authority (QCA) issuing qualified certificates
- 2 Operational use of the smart card as SSCD
	- a Options for entering the CAN
	- b Generation of qualified electronic signatures
	- c Management of the user authentication data
- i Setting a new eSign-PIN
- ii Changing the eSign-PIN
- iii Unblocking the eSign-PIN
- d Termination of the signature function
	- i Terminating the eSign-PIN
	- ii Terminating the signature key

For the processing of these procedures it is necessary to use the roles authentication reader and signature reader. According to [TR-03117], Annex A2, Table 1 Inspection Systems have no access to the eSign application.

Authentication readers must have the access right "Install Qualified Certificate" and signature readers the access right "Generate qualified electronic signature". With the exception of access rights requirements for advanced signatures are not specified yet in [TR-03117], so this document at hand does not define any test requirement for advanced signatures.

| RQ_no<br>R_Sig_ | Description                                                                                    | Parameter                                                                                                                                                                                                                                                                                                                                                                          | Reference                      | PR | NR | IF |
|-----------------|------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|----|----|----|
| 1.1             | Verification of the<br>correct execution of the<br>key pair generation<br>initiated by the QCA | Use of the role Authentication<br>Terminal (of the QCA) with the<br>access rights to read personal data of<br>the smart card user as well as for<br>issuing and installation of the<br>qualified certificate ("Install Qualified<br>Certificate")<br>Use of the PIN for the PACE protocol<br>between the Signature Terminal and<br>the LT.                                         | [TR-03117],<br>4.3.2           | CT |    | UT |
| 1.2             |                                                                                                | Access with the Authentication<br>Terminal of the QCA to the necessary<br>identification data of the smart card<br>user (stored in the smart card)<br>according to §5 clause 1 SigG and §3<br>clause 1 SigV (where necessary DG1<br>to DG21).<br>Select the eID application<br>Read personal data                                                                                  | [TR-03117],<br>4.3.2           | CT |    | UT |
| 1.3             |                                                                                                | Access with the Authentication<br>Terminal to the eSign application<br>(Select the eSign application)<br>Transmission of the command<br>Generate Asymmetric Key Pair for<br>the generation of the key pair from<br>the UT via authentication and<br>Signature Terminal to the LT.<br>The Authentication Terminal reads<br>the generated signature verification<br>key from the LT. | [TR-03117],<br>4.3.2,<br>A.2.5 | CT |    | UT |

#### 2.2.7.2 List of Verification Requirements

| RQ_no<br>R_Sig_ | Description                                                                                                                       | Parameter                                                                                                                                                                                                                                                                                                                                                                                  | Reference                      | PR | NR | IF |
|-----------------|-----------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|----|----|----|
| 2.1, 2.2        | Verification that the<br>DUT aborts the key pair<br>generation when<br>detecting internal error<br>or error communicated<br>by LT | Authentication terminal does not<br>have the access right "Install<br>Qualified Certificate"<br>Use of a wrong password for the<br>PACE protocol                                                                                                                                                                                                                                           | [TR-03117],<br>4.3.2           |    | SA | UT |
| 2.3, 2.4        |                                                                                                                                   | The LT returns that the eSign<br>application could not be selected<br>The LT returns an error code to the<br>command Generate Asymmetric Key<br>Pair:<br>The private key or the related<br>eSign-PIN is not terminated                                                                                                                                                                     | [TR-03117],<br>4.3.2,<br>A.2.5 |    | SA | LT |
| 3.1             | Verification of the<br>correct execution of a<br>signature generation                                                             | Use of a Signature Terminal (of the<br>smart card user) with the access right<br>"Generate qualified electronic<br>signature"<br>Use of the CAN for the PACE<br>protocol between Signature<br>Terminal and LT                                                                                                                                                                              | [TR-03117],<br>4.4.2           | CT |    | UT |
| 3.2             |                                                                                                                                   | The UT selects the eSign application<br>and requires via the Signature<br>Terminal the smart card user to<br>enter the eSign-PIN at the Signature<br>Terminal<br>Entering the eSign-PIN at the<br>Signature Terminal<br>Transmission of the command Verify<br>for the successful verification of the<br>eSign-PIN to the LT<br>Response from the LT to the<br>Signature Terminal or the UT | [TR-03117],<br>4.4.2,<br>A.2.1 | CT |    | UT |
| 3.3             |                                                                                                                                   | The UT transfers the command<br>PSO:Compute Digital Signature for<br>the generation of a digital signature<br>to the Signature Terminal<br>Transfer of the command by the<br>Signature Terminal to the LT<br>Return of the generated signature<br>from the LT to the Signature<br>Terminal<br>Return of the received signature by<br>the Signature Terminal to the UT                      | [TR-03117],<br>4.4.2,<br>A.2.4 | SA |    | UT |
| 4.1-4.4         | Verification that the<br>DUT aborts the<br>signature generation<br>when detecting internal<br>error or error                      | Signature terminal does not have the<br>access right "Generate qualified<br>electronic signature"<br>Use of password for the PACE<br>protocol which doesn't have the                                                                                                                                                                                                                       | [TR-03117],<br>4.4.2           |    | SA | UT |

| RQ_no<br>R_Sig_ | Description                                                                                                                                                  | Parameter                                                                                                                                                                                                                                                                                                                                                                     | Reference                                | PR | NR | IF |
|-----------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|----|----|----|
|                 | communicated by LT                                                                                                                                           | required permits.                                                                                                                                                                                                                                                                                                                                                             |                                          |    |    |    |
| 4.5, 4.6        |                                                                                                                                                              | The LT returns that the eSign<br>application could not be selected<br>The LT returns an error code to the<br>command Verify:<br>Failed user authentication, X further<br>attempts<br>The error counter of the eSign-PIN is<br>expired (no further attempts for user<br>authentication possible)<br>The eSign-PIN is terminated<br>The referenced password is not<br>available | [TR-03117],<br>4.4.2,<br>A.2.1,<br>A.2.4 |    | CT | LT |
|                 |                                                                                                                                                              | The LT returns an error code to the<br>command PSO:Compute Digital<br>Signature:<br>The related eSign-PIN was not<br>verified successfully<br>The signature key is terminated<br>Incorrect command data                                                                                                                                                                       |                                          |    |    |    |
| 5.1             | Password management<br>functions for Signature<br>Terminals                                                                                                  | Use of a Signature Terminal (of the<br>smart card user) with the access right<br>"Generate qualified electronic<br>signature"<br>Setting eSign-PIN in LT using PIN                                                                                                                                                                                                            | [TR-03117],<br>4.4.3,<br>A.2.2           | SA |    | UT |
| 5.2             |                                                                                                                                                              | Use of a Signature Terminal (of the<br>smart card user) with the access right<br>"Generate qualified electronic<br>signature"<br>Changing eSign-PIN in LT using<br>CAN                                                                                                                                                                                                        | [TR-03117],<br>4.4.3,<br>A.2.2           | SA |    | UT |
| 5.3             |                                                                                                                                                              | Use of a Signature Terminal (of the<br>smart card user) with the access right<br>"Generate qualified electronic<br>signature"<br>Resetting retry counter for<br>eSign-PIN using PUK                                                                                                                                                                                           | [TR-03117],<br>4.4.3,<br>A.2.3           | SA |    | UT |
| 6.1, 6.2        | Verification that the<br>Signature Terminal<br>aborts the password<br>management function<br>when detecting internal<br>error or error<br>communicated by LT | Setting the eSign-PIN<br>Signature terminal does not have the<br>access right "Generate qualified<br>electronic signature"<br>Use of password for the PACE<br>protocol which doesn't have the<br>required permits.                                                                                                                                                            | [TR-03117],<br>4.4.3                     |    | SA | UT |
| 6.3, 6.4        |                                                                                                                                                              | Setting the eSign-PIN<br>The LT returns that the eSign                                                                                                                                                                                                                                                                                                                        | [TR-03117],<br>4.4.3,                    |    | SA | LT |

| RQ_no<br>R_Sig_ | Description                                                                                                                                        | Parameter                                                                                                                                                                                                                                         | Reference                      | PR | NR | IF |
|-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|----|----|----|
|                 |                                                                                                                                                    | application could not be selected<br>The LT returns an error code to the<br>command Change Reference Data                                                                                                                                         | A.2.2                          |    |    |    |
| 6.5, 6.6        |                                                                                                                                                    | Changing the eSign-PIN<br>Signature terminal does not have the<br>access right "Generate qualified<br>electronic signature"<br>Use of password for the PACE<br>protocol which doesn't have the<br>required permits.                               | [TR-03117],<br>4.4.3           |    | SA | UT |
| 6.7             |                                                                                                                                                    | Changing the eSign-PIN<br>The LT returns an error code to the<br>command Change Reference Data                                                                                                                                                    | [TR-03117],<br>4.4.3,<br>A.2.2 |    | SA | LT |
| 6.8, 6.9        |                                                                                                                                                    | Resetting Retry Counter of<br>eSign-PIN<br>Signature terminal does not have the<br>access right "Generate qualified<br>electronic signature"<br>Use of password for the PACE<br>protocol which doesn't have the<br>required permits.              | [TR-03117],<br>4.4.3,<br>A.2.3 |    | SA | UT |
| 6.10            |                                                                                                                                                    | Resetting Retry Counter of<br>eSign-PIN<br>The LT returns an error code to the<br>command Reset Retry Counter                                                                                                                                     | [TR-03117],<br>4.4.3           |    | SA | LT |
| 7.1, 7.2        | Verification of the<br>correct execution of the<br>termination of the<br>signature function                                                        | Use of a sSgnature Terminal (of the<br>smart card user) with the access right<br>"Generate qualified electronic<br>signature"<br>Termination of the eSign-PIN or the<br>signature key with PIN                                                    | [TR-03117],<br>4.4.4,<br>A.2.6 | CT |    | UT |
| 8.1, 8.2        | Verification that the<br>Signature Terminal<br>aborts a termination<br>function when<br>detecting internal error<br>or error communicated<br>by LT | Termination of the eSign-PIN or the<br>signature key<br>Signature terminal does not have the<br>access right "Generate qualified<br>electronic signature"<br>Use of password for the PACE<br>protocol which doesn't have the<br>required permits. | [TR-03117],<br>4.4.4           |    | SA | UT |
| 8.3             |                                                                                                                                                    | The LT returns an error code to the<br>command Terminate                                                                                                                                                                                          | [TR-03117],<br>4.4.4,<br>A.2.6 |    | SA | LT |

Table 12: Verification Requirements use of the signature application, execution in the DUT

# <span id="page-24-0"></span>3 Implementation Conformance Statement

The purpose of the Implementation Conformance Statement is the declaration of optional functionality of the product to be approved by the applicant. The declarations of the applicant are used for the determination of the set of test cases appropriated to the functionality of the product.

The Implementation Conformance Statement must be filled completely by the applicant. The information of the filled ICS must be documented in the test report.

The test result will only cover the function declared in this statement.

### 3.1 Supported profiles and functions

All test cases of a profile which is declared with "Yes" by the applicant, have to be performed completely. The test coverage can be limited by declarations in chapter [3.3](#page-25-0) and [3.4.](#page-26-0)

| Profile | Task                                                                                                        | Applicant<br>declaration<br>(Yes / No) |
|---------|-------------------------------------------------------------------------------------------------------------|----------------------------------------|
| R_Tra   | Reader supports transmission of card commands over the PC/SC<br>interface to the smart card                 |                                        |
| R_PACE  | Reader supports execution of PACE protocol according to<br>[TR-03110-2], 3.2                                |                                        |
| R_TA    | Reader supports execution of terminal authentication protocol<br>according to [TR-03110-2], 3.4             |                                        |
| R_CA    | Reader supports execution of chip authentication protocol<br>(version 2) according to [TR-03110-2], 3.3.1.2 |                                        |
| R_eID   | Reader supports access to eID application                                                                   |                                        |
| R_bio   | Reader supports access to biometric data in the smart card                                                  |                                        |
| R_Sig   | Reader supports generation of qualified electronic signatures<br>according to [TR-03117]                    |                                        |

### 3.1.1 Profiles

Table 13: Profiles for the DUT

### 3.1.2 Functions

| Profile                                                                                                       | Task                                                                                        | Applicant<br>declaration<br>(Yes / No) |
|---------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|----------------------------------------|
| R_Chg_PIN                                                                                                     | Password management function to change the PIN is supported<br>by the DUT.                  |                                        |
| R_Chg_CAN                                                                                                     | Password management function to change the CAN is supported<br>by the DUT.                  |                                        |
| R_UNLK_PIN_PUK                                                                                                | Password management function to unblock the PIN after using<br>PUK is supported by the DUT. |                                        |
| R_PIN_MGT_AT                                                                                                  | PIN management functions for Authentication Terminals is<br>supported by the DUT.           |                                        |
| R_PIN_MGT_uT<br>PIN management functions for unauthenticated terminals after<br>PACE is supported by the DUT. |                                                                                             |                                        |

Table 14: Functions for the DUT

### <span id="page-25-1"></span>3.2 Cryptographic algorithms

The applicant of the DUT SHALL declare all supported algorithms used to perform the PACE and Chip- and Terminal-Authentication and eSign(QES) if applicable. The algorithm identifiers as defined in [TR-03110-3] have to be used (e.g. PACE-ECDH-GM-AES-CBC-CMAC-128, ...).

| Protocol | supported algorithms |
|----------|----------------------|
| PACE     |                      |
| TA       |                      |
| CA       |                      |
| eSign    |                      |

Table 15: Supported algorithms

### <span id="page-25-0"></span>3.3 Terminal type

The applicant of the DUT SHALL declare the supported terminal roles.

| Terminal Type                | Applicant declaration (Yes / No) |
|------------------------------|----------------------------------|
| Inspection System (IS)       |                                  |
| Authentication Terminal (AT) |                                  |
| Signature Terminal (ST)      |                                  |

Table 16: Supported terminal roles

### <span id="page-26-0"></span>3.4 Passwords

The DUT can accept different types of passwords for the PACE protocol. Some DUTs may accept the password via a PC/SC command, while others block passwords from the host. The allowed input channel may also be dependent on the terminal type.

|                   |     | IS | AT | ST |
|-------------------|-----|----|----|----|
| allows input from | MRZ |    |    |    |
| host              | CAN |    |    |    |
|                   | PIN |    |    |    |
|                   | PUK |    |    |    |
| allows input from | MRZ |    |    |    |
| PIN pad           | CAN |    |    |    |
|                   | PIN |    |    |    |
|                   | PUK |    |    |    |

Table 17: Matrix for the supported passwords dependent on the terminal role

# 4 Definition of Configuration Data for the Tests

### 4.1 Terminal Certificates

Terminal certificates used in the tests are built up as follows:

| '7F 21' | var.    |                                      |      |      |      |                                    | Certificate template (tag, length)                                                                                                |
|---------|---------|--------------------------------------|------|------|------|------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------|
|         | '7F 4E' | 'XX'                                 |      |      |      |                                    | Certificate body (tag, length)                                                                                                    |
|         |         | '5F 29'                              | '01' |      |      | 'XX'                               | Certificate profile identifier                                                                                                    |
|         |         | '42'                                 | var. |      |      | 'XX  XX'                           | Certificate authority reference                                                                                                   |
|         |         | '7F 49'                              | var. |      |      | 'XX  XX'                           | Public key                                                                                                                        |
|         |         | '5F 20'                              | var. |      |      | 'XX  XX'                           | Certificate holder reference                                                                                                      |
|         |         | '7F 4C'                              | var. |      |      |                                    | Certificate Holder Authorization<br>Template (CHAT) (tag, length)                                                                 |
|         |         |                                      | '06' | '09' |      | '04 00 7F 00 07 03 01 02           | Object identifier for role RR:                                                                                                    |
|         |         |                                      |      |      |      | RR'                                | RR = 01: Inspection System<br>RR = 02: Authentication Terminal<br>RR = 03: Signature Terminal                                     |
|         |         |                                      | '53' | 'LZ' |      | 'XX  XX'                           | Discretionary data (access rights)<br>Value see tables 19 to 24 = 01, if RR =<br>01<br>LZ = 05, if RR = 02<br>LZ = 01, if RR = 03 |
|         |         | '5F 25'                              | '06' |      |      | 'XX  XX'                           | Certificate effective date                                                                                                        |
|         |         | '5F 24'                              | '06' |      |      | 'XX  XX'                           | Certificate expiration date                                                                                                       |
|         |         | '65'                                 | var. |      |      |                                    | Certificate extensions (Tag, Length)                                                                                              |
|         |         |                                      | '73' | var. |      |                                    | Discretionary Data Template (Tag,<br>Length)                                                                                      |
|         |         |                                      |      | '06' | '0A' | '04 00 7F 00 07 03 01 03<br>01 01' | Object identifier for certificate<br>description (plain text format)                                                              |
|         |         |                                      |      | '80' | var. | 'XX  XX'                           | Hash value over certificate<br>description                                                                                        |
|         |         |                                      | '73' | var. |      |                                    | Discretionary data template (tag,<br>length)                                                                                      |
|         |         |                                      |      | '06' | '09' | '04 00 7F 00 07 03 01 03<br>02'    | Object identifier for terminal sector                                                                                             |
|         |         |                                      |      | '80' | var. | 'XX  XX'                           | Hash value over public key DO 1st<br>sector                                                                                       |
|         |         |                                      |      | '81' | var. | 'XX  XX'                           | Hash value over public key DO 2nd<br>sector                                                                                       |
|         | '5F 37' | var.                                 |      |      |      | 'XX  XX'                           | Certificate signature                                                                                                             |
|         |         | Table 18: Structure of a certificate |      |      |      |                                    |                                                                                                                                   |

| No. | Value | Description                                                        |  |  |
|-----|-------|--------------------------------------------------------------------|--|--|
| 1   | '03'  | Universal rights:<br>Reading access to biometric data of ePassport |  |  |
| 2   | '00'  | No access to eID- and ePassport functions                          |  |  |

<span id="page-28-0"></span>Table 19: Choice of access rights for Inspection Systems

| No. | Value            | Description                                                                                                                                                                                                                                                                                                                                                            |
|-----|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | '3E 1F FF FF F7' | Universal rights:<br>Write access to DG 17 – DG 21<br>Read access to DG 1 – DG 21<br>Right to install qualified certificates<br>Right to install certificates<br>Right to execute password management functions<br>Right to use CAN<br>Right to perform restricted identification<br>Right to perform community ID verification<br>Right to perform age identification |
| 2   | '30 00 00 00 02' | Write access to DG 17 and DG 18<br>Right to perform community ID verification                                                                                                                                                                                                                                                                                          |
| 3   | '3E 1F FF FF 17' | Write access to DG 17 – DG 21<br>Read access to DG 1 – DG 21<br>Right to use CAN<br>Right to perform restricted identification<br>Right to perform community ID verification<br>Right to perform age identification                                                                                                                                                    |
| 4   | '00 01 13 FB 07' | Read access to DG 1, DG 2, DG 4 – DG 10, DG 13 and DG 17<br>Right to perform restricted identification<br>Right to perform community ID verification<br>Right to perform age identification                                                                                                                                                                            |

<span id="page-28-3"></span>Table 20: Choice of access rights for Authentication Terminals

| No. | Value | Description                                     |
|-----|-------|-------------------------------------------------|
| 1   | '03'  | Universal rights:<br>Right to generate ES + QES |
| 2   | '00'  | No signature generation                         |

<span id="page-28-1"></span>Table 21: Choice of access rights for Signature Terminals

| No. | Value | Description                           |
|-----|-------|---------------------------------------|
| 1   | C3    | CVCA                                  |
| 2   | '83'  | Document Verifier (official domestic) |

<span id="page-28-2"></span>Table 22: Choice of access rights for CA certificates (Inspection Systems)

| No. | Value            | Description                                |
|-----|------------------|--------------------------------------------|
| 1   | 'FE 1F FF FF F7' | CVCA                                       |
| 2   | '7E 1F FF FF F7' | Document Verifier (non official / foreign) |

<span id="page-29-2"></span>Table 23: Choice of access rights for CA certificates (Authentication Terminals)

| No. | Value | Description                                        |
|-----|-------|----------------------------------------------------|
| 1   | 'C3'  | CVCA                                               |
| 2   | '43'  | Document Verifier (certification service provider) |

<span id="page-29-0"></span>Table 24: Choice of access rights for CA certificates (Signature Terminals)

### 4.2 Extension of PC/SC Interface

According to [TR-03119], D.2, the call of the PC/SC function SCardControl from [PCSC10] is extended by GetReadersPACECapabilities and EstablishPACEChannel. InBuffer und OutBuffer of SCardControl are specified as follows:

#### 4.2.1 InBuffer (for GetReadersPACECapabilities)

According to [TR-03119], D.3, D1.1, the value for InBuffer in GetReadersPACECapabilities is: 01 00 00

#### 4.2.2 OutBuffer (for GetReadersPACECapabilities)

According to [TR-03119], D.2, D.1.1. the value for OutBuffer in GetReadersPACECapabilities is: <Result\_Code> 00 02 01 <Bit\_Map> Result\_Code: Result code according to [TR-03119], D.1.2 Bit\_Map: Bit map according to table [27](#page-31-0)

### <span id="page-29-1"></span>4.2.3 InBuffer (for EstablishPACEChannel)

According to [TR-03119], D.3, D.1.2, the value for InBuffer in EstablishPACEChannel is: 02 <L\_inputData> <Password-ID> <L\_CHAT> <CHAT> <L\_PIN> <PIN> <L\_CERT\_DESC> <CERT\_DESC> Password-ID: '01' (MRZ-Password), '02' (CAN), '03' (PIN) or '04' (PUK) CHAT: Restricted CHAT for terminal certificate (coding see table [26\)](#page-30-1) or empty PIN: if provided by host; e. g. CAN CERT\_DESC: complete description of certificate as described in [TR-03119], D.1.2, and [TR-03110-4], 2.2.6. See table [25](#page-30-0) for an example.

| T  | L          | Value |      |   |          |  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |  |  |  |  |  |  |  |  |                      |
|----|------------|-------|------|---|----------|--|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|--|--|--|--|--|--|----------------------|
| 30 | 82 01 02 T |       | L    | V |          |  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |  |  |  |  |  |  |  |  | Comment              |
|    |            | 06    | 0A   |   |          |  | 04 00 7F 00 07 03 01 03 01 01                                                                                                                                                                                                                                                                                                                                                                                                                                                                |  |  |  |  |  |  |  |  | descriptio<br>nType  |
|    |            | A1    | 11   |   | 0C 0F    |  | 54 65 73 74 69 73 73 75 65 72 20 47 6D 62 48                                                                                                                                                                                                                                                                                                                                                                                                                                                 |  |  |  |  |  |  |  |  | issuerName<br>[1]    |
|    |            | A2    | 1A   |   | 13 18    |  | 68 74 74 70 3A 2F 2F 77 77 77 2E 74 65 73 74 69<br>73 73 75 65 72 2E 64 65                                                                                                                                                                                                                                                                                                                                                                                                                   |  |  |  |  |  |  |  |  | issuerURL<br>[2]     |
|    |            | A3    | 0F   |   | 0C 0D    |  | 54 65 73 74 68 61 75 73 20 47 6D 62 48                                                                                                                                                                                                                                                                                                                                                                                                                                                       |  |  |  |  |  |  |  |  | subjectNam<br>e [3]  |
|    |            | A4    | 18   |   | 13 16    |  | 68 74 74 70 3A 2F 2F 77 77 77 2E 74 65 73 74 68<br>61 75 73 2E 64 65                                                                                                                                                                                                                                                                                                                                                                                                                         |  |  |  |  |  |  |  |  | subjectURL<br>[4]    |
|    |            | A5    | 8199 |   | 0C 81 96 |  | 41 6E 73 63 68 72 69 66 74 3A 20 0D 0A 54 65 73<br>74 68 61 75 73 20 47 6D 62 48 0D 0A 51 75 61 6C<br>69 74 C3 A4 74 73 73 74 72 2E 20 31 0D 0A 33 33<br>31 30 30 20 50 61 64 65 72 62 6F 72 6E 0D 0A 0D<br>0A 45 2D 4D 61 69 6C 2D 41 64 72 65 73 73 65 3A<br>20 0D 0A 6E 70 61 40 74 65 73 74 68 61 75 73 2E<br>64 65 0D 0A 0D 0A 5A 77 65 63 6B 20 64 65 73 20<br>41 75 73 6C 65 73 65 76 6F 72 67 61 6E 67 73 3A<br>20 0D 0A 54 65 73 74 20 64 65 72 20 54 65 72 6D<br>69 6E 61 6C 73 2E |  |  |  |  |  |  |  |  | termsOfUsa<br>ge [5] |

<span id="page-30-0"></span>Table 25: Example for CERT\_DESC

| Pos. | Length<br>(in<br>Bytes) | Value                           | Description                                                                                                                     |
|------|-------------------------|---------------------------------|---------------------------------------------------------------------------------------------------------------------------------|
| 1    | 1                       | '06'                            | Tag for Object Identifier (Role)                                                                                                |
| 2    | 1                       | '09'                            | Length for Object Identifier (Role)                                                                                             |
| 3    | 9                       | '04 00 7F 00 07 03 01 02<br>RR' | Object identifier for role RR:<br>RR = 01: Inspection System<br>RR = 02: Authentication Terminal<br>RR = 03: Signature Terminal |
| 4    | 1                       | '53'                            | Tag for discretionary data (access rights)                                                                                      |
| 5    | 1                       | 'XX'                            | Length for discretionary data (access rights):<br>XX = 01, if RR = 01<br>XX = 05, if RR = 02<br>XX = 01, if RR = 03             |
| 6    | var.                    | 'XX  XX'                        | Discretionary data (access rights)<br>Value see tables 19 to 21                                                                 |

<span id="page-30-1"></span>Table 26: Structure of the CHAT data object

### <span id="page-31-2"></span>4.2.4 OutBuffer (for EstablishPACEChannel)

According to [TR-03119], D.3, D.1.2, the value for OutBuffer in EstablishPACEChannel is: <Result\_Code> <L\_outputData> <status\_mse> <L\_dca> <data\_card\_acc> <L\_CAR1> <CAR1> <L\_CAR2> <CAR2> <L\_IDPICC> <IDPICC> Result\_Code: Result code according to [TR-03119], D.1.2 status\_mse: Status bytes in response to MSE: Set AT data\_card\_acc: Data for card access CAR1: Current certificate authority reference (CAR) CAR2: Previous certificate authority reference (CAR) IDPICC: ID\_PICC, necessary for TA

Remark: If the DUT uses a certificate with role Signature Terminal, the data objects <CAR1> , <CAR2> and <IDPICC> are omitted according to [TR-03119], D.2, since the secure channel between smart card and DUT will be established automatically.

| b7 | b6 | b5 | b4 | b3 | b2 | b1 | b0 |                              |
|----|----|----|----|----|----|----|----|------------------------------|
| 0  |    |    |    |    |    |    |    | RFU                          |
|    | 1  |    |    |    |    |    |    | PACE supported               |
|    |    | 1  |    |    |    |    |    | eID-function supported       |
|    |    |    | 1  |    |    |    |    | Signature function supported |
|    |    |    |    | 0  | 0  | 0  | 0  | RFU                          |

<span id="page-31-0"></span>Table 27: Bitmap for functions supported by the DUT

### 4.3 Communication Steps at the Card Interface

The following protocol descriptions have to be executed at the card interface. Some of them can be called directly from the UT while other must not be called from the UT directly but from the DUT. If not described in an other way, all passwords have to be entered directly on the DUTs PIN Pad [\(4.3.1](#page-31-1) PACE and [4.3.9](#page-35-0) PIN Management).

### <span id="page-31-1"></span>4.3.1 PACE

The PACE protocol can be executed without or with Secure Messaging. If executed with Secure Messaging the SM keys have been derived by a former PACE protocol. If not explicitly mentioned otherwise, the PACE protocol is performed without SM in the test cases.

In the following a showcase for the protocol steps of PACE is given. Details on the steps and a normative description and sequence can be found in [TR-03110-3], B1.

| Step | Description                                                                                                                       |                                                       |  |  |  |  |  |  |  |
|------|-----------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|--|--|--|--|--|--|--|
| 1    | DUT gets content of EF.CardAccess.                                                                                                |                                                       |  |  |  |  |  |  |  |
| 2    | LT receives command                                                                                                               | MSE: Set AT (mutual authentication in PACE)           |  |  |  |  |  |  |  |
| 3    | LT sends response to                                                                                                              | Parameters: OID, Password-ID, OID-Role, Access Rights |  |  |  |  |  |  |  |
| 4    | LT receives command<br>General Authenticate (Step 1)                                                                              |                                                       |  |  |  |  |  |  |  |
| 5    | LT derives encryption key K_pi from smart card password, generates nonce s and computes<br>encrypted nonce encNonce = E(K_pi, s). |                                                       |  |  |  |  |  |  |  |
| 6    | LT sends response to<br>General Authenticate (Step 1)                                                                             |                                                       |  |  |  |  |  |  |  |

| 7  | LT receives command                                                                                                                                                                                                          | General Authenticate (Step 2) |
|----|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
| 8  | LT sends response to                                                                                                                                                                                                         |                               |
| 9  | LT receives command                                                                                                                                                                                                          | General Authenticate (Step 3) |
| 10 | LT generates data Deph = Map(D_PICC, s) and, using Deph, the ephemeral key pair (SKeph_PICC,<br>PKeph_PICC). LT checks that PKeph_ICC is different from PKeph_PCD.                                                           |                               |
| 11 | LT sends response to                                                                                                                                                                                                         | General Authenticate (Step 3) |
| 12 | LT receives command                                                                                                                                                                                                          | General Authenticate (Step 4) |
| 13 | LT computes key material KA(SKeph_PICC, PKeph_PCD, Deph), extracts Kmac from key material<br>and checks that T_PCD is identical to MAC(Kmac, PKeph_PICC). LT computes authentication<br>token T_PICC = MAC(Kmac, PKeph_PCD). |                               |
| 14 | LT sends response to                                                                                                                                                                                                         | General Authenticate (Step 4) |

### <span id="page-32-0"></span>4.3.2 Terminal Authentication

A showcase for the protocol steps for Terminal Authentication is given in the follwoing. Details on the steps and a normative description and sequence can be found in [TR-03110-3], B3.

| Step                                                                                                                          | Description                                                                                                                                                   |                                           |  |
|-------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|--|
| 1                                                                                                                             | UT sends command                                                                                                                                              | MSE: Set DST for certificate verification |  |
| 2                                                                                                                             | LT receives command                                                                                                                                           |                                           |  |
| 3                                                                                                                             | LT sends response to                                                                                                                                          |                                           |  |
| 4                                                                                                                             | UT receives response to                                                                                                                                       |                                           |  |
| 5                                                                                                                             | UT sends command                                                                                                                                              | PSO: Verify Certificate                   |  |
| 6                                                                                                                             | LT receives command                                                                                                                                           |                                           |  |
| 7                                                                                                                             | LT sends response to                                                                                                                                          |                                           |  |
| 8                                                                                                                             | UT receives response to                                                                                                                                       |                                           |  |
| The steps 1-8 are performed for all certificates in the certificate chain, i. e. CA certificates and terminal<br>certificate. |                                                                                                                                                               |                                           |  |
| 9                                                                                                                             | UT generates new ephemeral key pair (SKeph_PCD, PKeph_PCD) and computes Comp(PKeph_PCD).<br>Moreover UT provides auxiliary data for key exchange A_PCD.       |                                           |  |
| 10                                                                                                                            | UT sends command                                                                                                                                              | MSE: Set AT for external authentication   |  |
| 11                                                                                                                            | LT receives command                                                                                                                                           |                                           |  |
| 12                                                                                                                            | LT sends response to                                                                                                                                          |                                           |  |
| 13                                                                                                                            | UT receives response to                                                                                                                                       |                                           |  |
| 14                                                                                                                            | UT sends command                                                                                                                                              | Get Challenge                             |  |
| 15                                                                                                                            | LT receives command                                                                                                                                           |                                           |  |
| 16                                                                                                                            | LT sends response to                                                                                                                                          |                                           |  |
| 17                                                                                                                            | UT receives response to                                                                                                                                       |                                           |  |
| 18                                                                                                                            | UT computes s_PCD = Sign(SKeph_PCD, ID_PICC   r1_PICC   Comp(PKeph_PCD)   A_PCD). (Hint:<br>ID_PICC has been provided to UT at the end of the PACE protocol). |                                           |  |

| 19 | UT sends command        | External Authenticate |
|----|-------------------------|-----------------------|
| 20 | LT receives command     |                       |
| 21 | LT sends response to    |                       |
| 22 | UT receives response to |                       |

### <span id="page-33-0"></span>4.3.3 Chip Authentication

Before performing Chip Authentication the EF.CardSecurity shall be read and Passive Authentication with the Security Object shall be performed. A showcase for the protocol steps is given in the follwoing. Details on the steps and a normative description and sequence can be found in [TR-03110-3], B2.

| Step | Description                                                                                                                                                                                                                                                                                                                                                            |                                         |  |
|------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|--|
| 1    | UT sends command                                                                                                                                                                                                                                                                                                                                                       | MSE: Set AT for internal authentication |  |
| 2    | LT receives command                                                                                                                                                                                                                                                                                                                                                    |                                         |  |
| 3    | LT sends response to                                                                                                                                                                                                                                                                                                                                                   |                                         |  |
| 4    | UT receives response to                                                                                                                                                                                                                                                                                                                                                |                                         |  |
| 5    | UT sends command                                                                                                                                                                                                                                                                                                                                                       | General Authenticate                    |  |
| 6    | LT receives command                                                                                                                                                                                                                                                                                                                                                    |                                         |  |
| 7    | LT generates random number r2_PICC and computes key material K = KA(SK_PICC,<br>PKeph_PCD, D_PICC), K_MAC = KDF_MAC(K, r2_PICC), K_ENC = KDF_ENC(K, r2_PICC) and<br>T_PICC = MAC(K_MAC, PKeph_PCD).                                                                                                                                                                    |                                         |  |
| 8    | LT sends response to                                                                                                                                                                                                                                                                                                                                                   | General Authenticate                    |  |
| 9    | UT receives response to                                                                                                                                                                                                                                                                                                                                                |                                         |  |
| 10   | UT computes K = KA(SKeph_PCD, PK_PICC, D_PICC), K_MAC = KDF_MAC(K, r2_PICC), K_ENC<br>= KDF_ENC(K, r2_PICC) and checks that T_PICC is identical to MAC(K_MAC, PKeph_PCD).<br>K_MAC and K_ENC are the session keys for secure messaging when generating digital<br>signatures or for access to the eID application that ask for authentication with PACE, TA and<br>CA. |                                         |  |

### <span id="page-33-1"></span>4.3.4 Select the eSign Application

The following table presents a showcase for selecting the eSign Application. Further details can be found in [ISO-7816].

| Step | Description             |                                            |
|------|-------------------------|--------------------------------------------|
| 1    | UT sends command        | Select                                     |
| 2    | LT receives command     | Parameter AID of the eSign<br>application: |
| 3    | LT sends response to    | 'A0 00 00 01 67 45 53 49 47 4E'            |
| 4    | UT receives response to |                                            |

### <span id="page-34-0"></span>4.3.5 Reading Data from the eID Application

| Step | Description             |                                                                                                                                                                                                              |  |
|------|-------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| 1    | UT sends command        | Select                                                                                                                                                                                                       |  |
| 2    | LT receives command     | Parameter AID of eID application: 'E8 07 04 00 7F 00 07<br>03 02'                                                                                                                                            |  |
| 3    | LT sends response to    |                                                                                                                                                                                                              |  |
| 4    | UT receives response to |                                                                                                                                                                                                              |  |
| 5    | UT sends command        | Read Binary                                                                                                                                                                                                  |  |
| 6    | LT receives command     | Parameter P1:<br>'81'<br>(SFI '01' for DG1)                                                                                                                                                                  |  |
| 7    | LT sends response to    | '82'<br>(SFI '02' for DG2)                                                                                                                                                                                   |  |
| 8    | UT receives response    | '83'<br>(SFI '03' for DG3)<br><br><br>'89'<br>(SFI '09' for DG9)<br>'8A'<br>(SFI '0A' for DG10)<br><br><br>'8F'<br>(SFI '0F' for DG15)<br>'90'<br>(SFI '10' for DG16)<br><br><br>'95'<br>(SFI '15' for DG21) |  |

The following table presents a showcase for reading data from the eID Application. Further details can be found in [ISO-7816].

### <span id="page-34-1"></span>4.3.6 Writing Data into the eID Application

The following table presents a showcase for writing data into the eID Application. Further details can be found in [ISO-7816].

| Step | Description          |                                                                      |                                                                                                                                      |
|------|----------------------|----------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------|
| 1    | UT sends command     | Select                                                               |                                                                                                                                      |
| 2    | LT receives command  | Parameter AID of eID application: 'E8 07 04 00 7F 00 07<br>03 02'    |                                                                                                                                      |
| 3    | LT sends response to |                                                                      |                                                                                                                                      |
| 4    | UT receives response |                                                                      |                                                                                                                                      |
| 5    | UT sends command     | Update Binary                                                        |                                                                                                                                      |
| 6    | LT receives command  | Parameter P1:<br>'81'                                                | (SFI '01' for DG1)                                                                                                                   |
| 7    | LT sends response to | '82'                                                                 | (SFI '02' for DG2)                                                                                                                   |
| 8    | UT receives response | '83'<br><br><br>'89'<br>'8A'<br><br><br>'8F'<br>'90'<br><br><br>'95' | (SFI '03' for DG3)<br>(SFI '09' for DG9)<br>(SFI '0A' for DG10)<br>(SFI '0F' for DG15)<br>(SFI '10' for DG16)<br>(SFI '15' for DG21) |

### <span id="page-35-1"></span>4.3.7 Restricted Identification

| Step | Description                                                                        |                                                              |  |
|------|------------------------------------------------------------------------------------|--------------------------------------------------------------|--|
| 1    | UT sends command                                                                   | MSE: Set AT for internal authentication                      |  |
| 2    | LT receives secured command                                                        | Parameter:<br>OID: OID for RI                                |  |
| 3    | LT sends response to                                                               | sk_id_ref: Reference to private key SK_ID in the smart       |  |
| 4    | UT receives response to                                                            | card, used for RI                                            |  |
| 5    | UT sends command                                                                   | General Authenticate                                         |  |
| 6    | LT receives secured command                                                        | Parameter:<br>pk_sec: public key of the sector (PK_Sector)   |  |
| 7    | LT generates its sector specific identifier I_sector_ID using SK_ID and PK_Sector. |                                                              |  |
| 8    | LT sends response to                                                               | General Authenticate                                         |  |
| 9    | UT receives secured response<br>to                                                 | Parameter:<br>sec_id: sector specific identifier I_sector_ID |  |

The following table is a showcase for restricted identification. Further details can be found in [ISO-7816].

### <span id="page-35-2"></span>4.3.8 Auxiliary Data Verification

The following table is a showcase for auxiliary data verification. Further details can be found in [ISO-7816].

| Step | Description                 |                                                                                                                                                   |
|------|-----------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------|
| 1    | UT sends command            | Verify                                                                                                                                            |
| 2    | LT receives secured command | Parameter:<br>OID: OID of the auxiliary data to be verified (age<br>verification, document validity verification or<br>community ID verification) |
| 3    | LT sends response to        |                                                                                                                                                   |
| 4    | UT receives response to     |                                                                                                                                                   |

#### <span id="page-35-0"></span>4.3.9 PIN Management

In the following tables different showcases for PIN management are given. Further details can be found in [ISO-7816]. The PIN management routines are initiated by the UT. Depending on whether the DUT comprises a PIN pad, the UT sends a PC/SC command or directly an APDU with appropriate parameters.

#### <span id="page-35-3"></span>4.3.9.1 Changing password

| Step | Description                                     |                                                                   |
|------|-------------------------------------------------|-------------------------------------------------------------------|
| 1    | LT receives secured command Reset Retry Counter |                                                                   |
| 2    | LT sends response to                            | Parameter<br>P2: '02' (for changing CAN), '03' (for changing PIN) |
| 3    | UT receives response to                         |                                                                   |

#### <span id="page-35-4"></span>4.3.9.2 Unblocking password

| Step<br>Description |
|---------------------|
|---------------------|

| 2 | LT receives secured command Reset Retry Counter |  |
|---|-------------------------------------------------|--|
| 3 | LT sends response to                            |  |
| 4 | UT receives response to                         |  |

#### <span id="page-36-0"></span>4.3.9.3 Activating / Deactivating password

| Step | Description                 |                                                              |
|------|-----------------------------|--------------------------------------------------------------|
| 1    | UT sends command            | Activate / Deactivate                                        |
| 2    | LT receives secured command | Parameter<br>INS: '44' (for Activate), '04' (for Deactivate) |
| 3    | LT sends response to        |                                                              |
| 4    | UT receives response to     |                                                              |

#### <span id="page-36-1"></span>4.3.10 Reading Data from the ePassport Application

The following table is a showcase for reading data from the ePassport application. Further details can be found in [ISO-7816].

| Step | Description             |                                             |
|------|-------------------------|---------------------------------------------|
| 1    | UT sends command        | Select                                      |
| 2    | LT receives command     | Parameter:<br>AID of ePassport application  |
| 3    | LT sends response to    |                                             |
| 4    | UT receives response to |                                             |
| 5    | UT sends command        | Read Binary                                 |
| 6    | LT receives command     | Parameter:<br>P1: 80 + <SFI__DF_to_be_read> |
| 7    | LT sends response to    |                                             |
| 8    | UT receives response to |                                             |

# 5 Test Specification

The test cases are derived from verification requirements. They refine these requirements by defining a test goal, all conditions, test steps and verifications that are necessary for the implementation and execution of a test.

The structure of this chapter follows the structure of the verification requirements whereas for each requirement number (RQ\_no) an additional structuring level is defined that enumerates the test cases which are assigned to the verification requirement. Each test case is described by a table. The structure of such a table is shown in table [28.](#page-37-0)

| Name in table column | Contents                                                                                                                                                                                                                                                                                                                    |
|----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Test ID              | Identifier for the test case in the form<br><code test object>_<code function>_<No. VR>.<No. para>.<br><No. test case><br><No. test case> (distinguishes test cases within a verification requirement):<br>1, 2, 3<br>The meaning of <code test object>, <code function>, <No. VR> and <No.<br>para> is defined in table 5. |
| Purpose              | What shall be tested, which aspect of the verification requirement?                                                                                                                                                                                                                                                         |
| Reference            | Reference to the specification requirement                                                                                                                                                                                                                                                                                  |
| Profiles             | Set of profiles required for test execution. The profiles allowed are declared<br>in the ICS (see table 22). Profiles may be logical connected by AND, OR and<br>NOT.                                                                                                                                                       |
| Preconditions        | Roles and access rights of the terminal certificates needed for test<br>execution and other preparatory steps, if necessary.                                                                                                                                                                                                |
| Test scenario        | List of all necessary steps to reach the Purpose                                                                                                                                                                                                                                                                            |
| Expected results     | Verification steps and expected results                                                                                                                                                                                                                                                                                     |
| Post processing      | If necessary, steps after test execution to ensure execution of further test<br>cases.                                                                                                                                                                                                                                      |

<span id="page-37-0"></span>Table 28: Structure of a test case description

For all test cases where no terminal role and password type is defined, these parameters can be chosen from these which are supported by the DUT (see chapter [3.3](#page-25-0) [Terminal type\)](#page-25-0).

If no terminal type and/or password is defined, the priority of the terminal type to use in the test cases are: AT, IS and ST. The priority of the password to use in the test cases are CAN, PIN and MRZ. That does mean, first select the first supported terminal type then select the first supported password type which is supported in combination with the terminal type.

**The used terminal type and password type must be documented in the test report.**

### 5.1 Transparent Mode

### 5.1.1 R\_Tra\_1 – Correct Reading of smart card Data in Transparent Mode

| Test ID | R_Tra_1.1                                                                                   |
|---------|---------------------------------------------------------------------------------------------|
| Purpose | Check the DUT for correct reading access to smart card data which are freely<br>accessible. |

| References       | [TR-03110-2]                                                                                                                                                                                                                                                                                                                                                   |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Profiles         | R_Tra                                                                                                                                                                                                                                                                                                                                                          |
| Preconditions    | -                                                                                                                                                                                                                                                                                                                                                              |
| Test scenario    | 1.<br>UT sends command Read Binary SFI '1C' (EF.CardAccess) to the DUT:<br>00 B0 9C 00 <Le> (Le: Number of Bytes in answer message)<br>2.<br>Reader transmits command received from UT to LT.<br>3.<br>LT sends response to Read Binary to the DUT:<br><Data> 90 00 (Data: Data from EF.CardAccess)<br>4.<br>Reader transmits response received from LT to UT. |
| Expected results | 1.<br>-<br>2.<br>The command APDU received at LT is correctly coded and coincides with the<br>command APDU sent by UT.<br>3.<br>-<br>4.<br>The response APDU received at UT is correctly coded and coincides with the<br>response APDU sent by LT.                                                                                                             |
| Post processing  | Reset of smart card and the DUT                                                                                                                                                                                                                                                                                                                                |

| Test ID          | R_Tra_1.2                                                                                                                                                                                                                                                                                                                                                   |  |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| Purpose          | Check for an abort when trying to read smart card data, which are not freely<br>accessible, without authentication.                                                                                                                                                                                                                                         |  |
| References       | [TR-03110-2]                                                                                                                                                                                                                                                                                                                                                |  |
| Profiles         | R_Tra                                                                                                                                                                                                                                                                                                                                                       |  |
| Preconditions    | -                                                                                                                                                                                                                                                                                                                                                           |  |
| Test scenario    | 1.<br>UT sends command Read Binary SFI '1D' (EF.CardSecurity) to the DUT:<br>00 B0 9D 00 <Le> (Le: Number of Bytes in answer message)<br>2.<br>Reader transmits command received from UT to LT.<br>3.<br>LT sends response to Read Binary to the DUT:<br><SW1SW2> (SW1SW2: negative Return Code)<br>4.<br>Reader transmits response received from LT to UT. |  |
| Expected results | 1.<br>-<br>2.<br>The command APDU received at LT is correctly coded and coincides with the<br>command APDU sent by UT.<br>3.<br>-<br>4.<br>The response APDU received at UT is correctly coded and coincides with the<br>response APDU sent by LT.                                                                                                          |  |
| Post processing  | Reset of smart card and the DUT                                                                                                                                                                                                                                                                                                                             |  |

### 5.2 PACE

### 5.2.1 R\_PACE\_1 – Correct Execution of PACE Protocol

| Test ID | R_PACE_1.1_template                                                                                                                                                                       |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose | Check correct execution of PACE protocol in the DUT. Use certificate with role<br>Inspection System.<br>The test is executed with the passwords CAN and MRZ. It calls an extension of the |

| References<br>Profiles<br>Preconditions | PC/SC function SCardControl where the password is transmitted in the InBuffer for<br>EstablishPACEChannel.<br>[TR-03110-2], 3.2, [TR-03110-4],2.1.3.2, [TR-03119], D.3<br>R_PACE<br>Certificate with role Inspection System and access rights according to table 19, No. 1;<br>CA certificates according to table 22, No. 1, 2<br>Make certificates and the password (CAN resp. MRZ-Password) available in UT<br>1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|-----------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Test scenario                           | (see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: as defined in table 29<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: value of the password<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. The return codes in all response APDUs are<br>positive ('90 00').<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Expected results                        | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT as defined in table<br>29.<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '01'<br>(Inspection System).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 19, No. 1.<br>•<br>All command APDUs received by the LT are correctly coded and secured by<br>SM from the DUT.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i. e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>•<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the<br>smart card.<br>•<br><IDPICC>: The field contains the correct ID_PICC. |
| Post processing                         | Reset of smart card and the DUT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

| Test case ID | Password          | <Password-ID> |
|--------------|-------------------|---------------|
| R_PACE_1.1a  | Use PACE with MRZ | '01'          |
| R_PACE_1.1b  | Use PACE with CAN | '02'          |

#### <span id="page-39-0"></span>*Table* 29: Test case R\_PACE\_1.1

| Test ID | R_PACE_1.2_template                                                            |
|---------|--------------------------------------------------------------------------------|
| Purpose | Check correct execution of PACE protocol in the DUT. Use certificate with role |

|                  | Authentication Terminal.<br>The test is executed with the passwords PIN and CAN. It calls an extension of the<br>PC/SC function SCardControl where the password is transmitted as user input via<br>the PIN Pad of the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |  |  |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|
| References       | [TR-03110-2], 3.2, [TR-03110-4],2.2.3.2, [TR-03119], D.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |  |  |
| Profiles         | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |  |  |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>Make certificates and the password (PIN and CAN) available in UT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |  |  |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: as defined in table 30<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: empty, password is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. The return codes in all response APDUs are<br>positive ('90 00').<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4).                                                                                                                                                                                                                                                                                                                                                                                    |  |  |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT as defined in table<br>30<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '02'<br>(Authentication Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 20, No. 1.<br>•<br>All command APDUs received by the LT are correctly coded and secured by<br>SM from the DUT.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i. e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>•<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the<br>smart card.<br>•<br><IDPICC>: The field contains the correct ID_PICC. |  |  |
| Post processing  | Reset of smart card and the DUT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |  |  |

| Test case ID | Password          | <Password-ID> |
|--------------|-------------------|---------------|
| R_PACE_1.2a  | Use PACE with CAN | '02'          |
| R_PACE_1.2b  | Use PACE with PIN | '03'          |

<span id="page-40-0"></span>*Table* 30: Test case R\_PACE\_1.2

Test ID R\_PACE\_1.3\_template

| Purpose          | Check correct execution of PACE protocol in the DUT. Use certificate with role<br>Signature Terminal.<br>The test is executed with the passwords CAN and PIN. It calls an extension of the<br>PC/SC function SCardControl where the password is transmitted as user input via<br>the PIN Pad of the DUT. All supported possibilities to provide the password have to<br>be tested.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| References       | [TR-03110-2], 3.2, [TR-03110-4],2.3, [TR-03119], D.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Profiles         | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Preconditions    | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates and the password (CAN and. PIN) available in UT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: as defined in table 31<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: empty, password is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1, 4.3.2 and 4.3.3. The return codes in all<br>response APDUs are positive ('90 00').<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4).                                                                                                                                                                                                                                                                                                                                                              |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT as defined in table<br>31<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '03'<br>(Signature Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 21, No. 1.<br>•<br>All command APDUs received by the LT are correctly coded and secured by<br>SM from the DUT.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i. e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>•<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the<br>smart card.<br>•<br><IDPICC>: The field contains the correct ID_PICC. |
| Post processing  | Reset of smart card and the DUT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

| Test case ID | Password          | <Password-ID> |
|--------------|-------------------|---------------|
| R_PACE_1.3a  | Use PACE with CAN | '02'          |
| R_PACE_1.3b  | Use PACE with PIN | '03'          |

<span id="page-41-0"></span>*Table* 31: Test case R\_PACE\_1.3

| Test ID          | R_PACE_1.4_template                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check correct execution of PACE protocol in the DUT. Use an unauthenticated<br>terminal.<br>The test is executed with the passwords CAN, PIN and PUK. It calls an extension of<br>the PC/SC function SCardControl where the password is transmitted as user input<br>via the PIN Pad of the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| References       | [TR-03110-2], 2.4.1, 3.2, [TR-03119], D.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Profiles         | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Preconditions    | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>:as defined in table 32<br>•<br><CHAT>: empty<br>•<br><PIN>: empty, password is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: empty<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. The return codes in all response APDUs are<br>positive ('90 00').<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4).                                                                                                                                                                                                                                                                                                                                                                                               |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT as defined in table<br>32<br>•<br>The data object with tag 7F 4C is missing in command APDU to MSE: Set AT<br>(since CHAT is empty).<br>•<br>All command APDUs received by the LT are correctly coded and secured by<br>SM from the DUT.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i. e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>•<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the<br>smart card.<br>•<br><IDPICC>: The field contains the correct ID_PICC. |
| Post processing  | Reset of smart card and the DUT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

| Test case ID | Password          | <Password-ID> |
|--------------|-------------------|---------------|
| R_PACE_1.4a  | Use PACE with CAN | '02'          |
| R_PACE_1.4b  | Use PACE with PIN | '03'          |
| R_PACE_1.4c  | Use PACE with PUK | '04'          |

<span id="page-42-0"></span>*Table* 32: Test case R\_PACE\_1.4

Test ID R\_PACE\_1.5

| Purpose          | Check correct execution of PACE protocol in the DUT. Use of several algorithms for<br>the PACE protocol. The values for PACEInfo and PACEDomainParameterInfo within<br>EF.CardAccess of the LT indicates that LT supports exactly one algorithm.<br>The test has to be executed for each PACE algorithm specified in the manufacturer's<br>conformance statement (chapter 3.2 Cryptographic algorithms). This test case is only<br>rated as a PASS if all passes are completed successfully.<br>The test is executed with the password CAN. It calls an extension of the PC/SC<br>function SCardControl where the password is transmitted in the InBuffer for<br>EstablishPACEChannel.                                                                                                                                                                                                                                                                                               |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| References       | [TR-03110-2], 3.2, [TR-03110-3], A.1.1.1, A.1.2, A.3, B.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Profiles         | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>Make certificates and the password CAN available in UT<br>Make valid values for PACEInfo and PACEDomainParameterInfo within<br>EF.CardAccess available in LT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (CAN is used)<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: value of the password<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. The return codes in all response APDUs are<br>positive ('90 00').<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4).                                                                                                                                                                                                                                                                                                               |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '02', CAN is<br>used.<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '02'<br>(Authentication Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 20, No. 1.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i. e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>•<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the<br>smart card.<br>•<br><IDPICC>: The field contains the correct ID_PICC. |
| Post processing  | Reset of smart card and the DUT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

| Test ID | R_PACE_1.6                                                                                                                                                       |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose | Check correct execution of PACE protocol in the DUT, if LT supports several<br>algorithms for PACE. Use three different PACEInfo in EF.CardAccess with different |

|                  | algorithms and standardized domain parameters. Use algorithms and domain<br>parameters which are supported by the DUT (chapter 3.2 Cryptographic algorithms).<br>Don't use a PACEDomainParameterInfo within EF.CardAccess.<br>The test is executed with the password CAN. It calls an extension of the PC/SC<br>function SCardControl where the password is transmitted in the InBuffer for<br>EstablishPACEChannel.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| References       | [TR-03110-2], 3.2, [TR-03110-3], A.1.1.1, A.1.2, A.3, B.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Profiles         | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>Make certificates and the password CAN available in UT<br>Make valid values for PACEInfo and PACEDomainParameterInfo within<br>EF.CardAccess available in LT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (CAN is used)<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: value of the password<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. The return codes in all response APDUs are<br>positive ('90 00').<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4).                                                                                                                                                                                                                                                                                                                  |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '02', CAN is<br>used.<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '02'<br>(Authentication Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 20, No. 1.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i. e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>•<br><CAR1> and<br><CAR2>: The current and previous CAR are as defined in the<br>smart card.<br>•<br><IDPICC>: The field contains the correct ID_PICC. |
| Post processing  | Reset of smart card and the DUT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

### 5.2.2 R\_PACE\_2 – Abort of PACE Protocol because of Internal LT Error

| Test ID | R_PACE_2.1_template                                                                                         |
|---------|-------------------------------------------------------------------------------------------------------------|
| Purpose | Check that the DUT aborts PACE protocol when LT derives cryptographic key from<br>CAN-Password incorrectly. |

|                  | The test is executed with the password CAN. It calls an extension of the PC/SC<br>function SCardControl where the password is transmitted in the InBuffer for<br>EstablishPACEChannel.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| References       | [TR-03110-2], 3.2, [TR-03110-4], 2.1.3.2, [TR-03119], D.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Profiles         | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Preconditions    | Certificates as described in table 33.<br>Make certificates and the CAN available in UT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>:'02' (CAN is used)<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: value of the password<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. LT derives an incorrect encryption key K_pi<br>from the password stored in the smart card. The return codes in the response<br>APDUs of all commands apart from General Authenticate (Step 4) are positive ('90<br>00'). The return code in the response APDU to General Authenticate (Step 4) (if<br>this message is sent) is an error code ('63 XX') indicating that the authentication<br>has failed.<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4). |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is ''02' (CAN is<br>used).<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT as described in<br>table 33.<br>•<br>The <access rights> in command APDU to MSE: Set AT as described in<br>table 33.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative, 'F0 06 63 XX', if LT sends<br>return code '63 XX' in response to General Authenticate (Step 4)<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.                                                                                                                                                                                                                                                  |
| Post processing  | Reset of smart card and the DUT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

| Test case ID | Terminal type                                                                                                                                       | <OID-Role> |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|------------|
| R_PACE_2.1a  | Certificate with role Inspection System and access rights according<br>to table 19, No. 1; CA certificates according to table 22, No. 1, 2          | '01'       |
| R_PACE_2.1b  | Certificate with role Authentication Terminal and access rights<br>according to table 20, No. 1; CA certificates according to table 23,<br>No. 1, 2 | '02'       |

#### <span id="page-45-0"></span>Table 33: Test case R\_PACE\_2.1

| Test ID | R_PACE_2.2                                                                     |
|---------|--------------------------------------------------------------------------------|
| Purpose | Check that the DUT aborts PACE protocol when LT derives cryptographic key from |

|                  | PIN incorrectly.<br>The test is executed with the passwords PIN. It calls an extension of the PC/SC<br>function SCardControl where the password is transmitted as user input via the PIN<br>Pad of the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| References       | [TR-03110-2], 3.2, [TR-03110-4], 2.2.3.2, [TR-03119], D.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Profiles         | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to table 20,<br>No. 1; CA certificates according to table 23, No. 1, 2<br>Make certificates and the password (PIN) available in UT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '03'<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: empty, password is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. LT derives an incorrect encryption key K_pi<br>from the password stored in the smart card. The return codes in the response<br>APDUs of all commands apart from General Authenticate (Step 4) are positive ('90<br>00'). The return code in the response APDU to General Authenticate (Step 4) is an<br>error code ('63 XX') indicating that the authentication has failed.<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4). |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '03'.<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '02'<br>•<br>The <access rights> in command APDU to MSE: Set AT as defined in<br>table 20, No. 1.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative, i. e. 'F0 06 63 XX', if LT sends<br>return code '63 XX' in response to General Authenticate (Step 4), or<br>'F0 10 00 01', if the DUT aborts communication with LT.<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.                                                                                                                                                                                                 |
| Post processing  | Reset of smart card and the DUT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

| Test ID       | R_PACE_2.3_template                                                                                                                                                                                                                                                                     |
|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts PACE protocol when LT returns error code to command<br>MSE: Set AT.<br>The test is executed with the password CAN. It calls an extension of the PC/SC<br>function SCardControl where the password is transmitted in the InBuffer for<br>EstablishPACEChannel. |
| References    | [TR-03110-2], 3.2, [TR-03110-4], 2.1.3.2, [TR-03119], D.3                                                                                                                                                                                                                               |
| Profiles      | R_PACE                                                                                                                                                                                                                                                                                  |
| Preconditions | Certificates as described in table 34.<br>Make certificates and the password (CAN) available in UT.                                                                                                                                                                                     |

| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (CAN is used)<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: value of the password<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. LT sends the negative return code '6A 88' in<br>answer message to MSE: Set AT back to the DUT. It is expected that the DUT<br>aborts protocol execution after receiving this return code.<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4).                                                                                      |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '02', since CAN<br>is used.<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT as described in<br>table 34.<br>•<br>The <access rights> in command APDU to MSE: Set AT as described in<br>table 34.<br>•<br>The command APDUs for General Authenticate (Step 1, 2, 3, 4) are missing,<br>since the DUT must abort communication to LT after receiving the specified<br>error code to MSE: Set AT.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative, i. e. 'F0 02 6A 88'.<br>•<br><status_mse>: The status code for command MSE: Set AT is '6A 88'. |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |

| Test case ID | Terminal type                                                                                                                                       | <OID-Role> |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|------------|
| R_PACE_2.3a  | Certificate with role Inspection System and access rights according<br>to table 19, No. 1; CA certificates according to table 22, No. 1, 2          | '01'       |
| R_PACE_2.3b  | Certificate with role Authentication Terminal and access rights<br>according to table 20, No. 1; CA certificates according to table 23,<br>No. 1, 2 | '02'       |

#### <span id="page-47-0"></span>Table 34: Test case R\_PACE\_2.3

| Test ID       | R_PACE_2.4_template                                                                                                                                                                                                                                                                                                                                     |
|---------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts PACE protocol when LT transmits incorrect data for<br>mapping function Map in answer to card command General Authenticate (Step 2).<br>The test is executed with the password CAN. It calls an extension of the PC/SC<br>function SCardControl where the password is transmitted in the InBuffer for<br>EstablishPACEChannel. |
| References    | [TR-03110-2], 3.2, [TR-03110-3], B.1, [TR-03110-4], 2.2.3.2, [TR-03119], D.3                                                                                                                                                                                                                                                                            |
| Profiles      | R_PACE                                                                                                                                                                                                                                                                                                                                                  |
| Preconditions | Certificates as described in table 35.<br>Make certificates and the CAN available in UT.                                                                                                                                                                                                                                                                |

| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (CAN is used)<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: value of the password<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. LT receives card command General<br>Authenticate (Step 2) with Mapping Data of the terminal from the DUT via CLI.<br>LT sends incorrect Mapping data of the smart card (D_PICC) in the response<br>APDU to card command General Authenticate (Step 2) back to the DUT. The<br>return codes in the response APDUs of all commands apart from General<br>Authenticate (Step 4) are positive ('90 00'). The return code in the response APDU<br>to General Authenticate (Step 4) is an error code ('63 XX') indicating that the<br>authentication has failed. |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                  | 3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '02' since CAN<br>is used.<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT as described in<br>table 35.<br>•<br>The <access rights> in command APDU to MSE: Set AT as described in<br>table 35.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative, i. e. 'F0 06 63 XX', if LT sends<br>return code '63 XX' in response to General Authenticate (Step 4), or<br>'F0 10 00 01', if the DUT aborts communication with LT.<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.                                                                                                                                                                                                                                                         |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

| Test case ID | Terminal type                                                                                                                                       | <OID-Role> |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|------------|
| R_PACE_2.4a  | Certificate with role Inspection System and access rights according<br>to table 19, No. 1; CA certificates according to table 22, No. 1, 2          | '01'       |
| R_PACE_2.4b  | Certificate with role Authentication Terminal and access rights<br>according to table 20, No. 1; CA certificates according to table 23,<br>No. 1, 2 | '02'       |

<span id="page-48-0"></span>Table 35: Test case R\_PACE\_2.4

### 5.2.3 R\_PACE\_3 – Abort of PACE Protocol because of Incorrect LT Data

| Test ID | R_PACE_3.1_template                                                                                                                                                                                                                                                                                                       |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose | Check that the DUT aborts PACE protocol when LT transmits incorrect PACE<br>parameters (inconsistent data in these parameters).<br>The test is executed with the password CAN. It calls an extension of the PC/SC<br>function SCardControl where the password is transmitted in the InBuffer for<br>EstablishPACEChannel. |

| References       | [TR-03110-2], 3.2, [TR-03110-4], 2.1.3.2, [TR-03119], D.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Profiles         | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Preconditions    | Certificates as described in table 36.<br>Make certificates and the CAN available in UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (CAN is used)<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: empty, password is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. LT sends inconsistent data as data from<br>EF.CardAccess in response APDU to command Read Binary with the following<br>change:<br>In SecurityInfo PACEInfo change length byte of tag "version" from '01' to '02':<br>30 0F 06 0A 04 00 7F 00 07 02 02 04 02 02 02 02 01.<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4). |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The command APDUs for MSE: Set AT, General Authenticate (Step 1, 2, 3, 4)<br>are missing, since the DUT must abort communication to LT after receiving<br>the inconsistent data in response APDU to Read Binary.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative, i. e. 'E0 00 00 01'.                                                                                                                                                                                                                                                                                                                                                 |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

| Test case ID | Terminal type                                                                                                                                       | <OID-Role> |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|------------|
| R_PACE_3.1a  | Certificate with role Inspection System and access rights according<br>to table 19, No. 1; CA certificates according to table 22, No. 1, 2          | '01'       |
| R_PACE_3.1b  | Certificate with role Authentication Terminal and access rights<br>according to table 20, No. 1; CA certificates according to table 23,<br>No. 1, 2 | '02'       |

<span id="page-49-0"></span>Table 36: Test case R\_PACE\_3.1

| Test ID       | R_PACE_3.2_template                                                                                                                                                                                                                                                                                                                                                 |
|---------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts PACE protocol when LT transmits incorrect PACE<br>parameters (algorithm ID contained in these parameters which is not supported by<br>the DUT).<br>The test is executed with the password CAN. It calls an extension of the PC/SC<br>function SCardControl where the password is transmitted in the InBuffer for<br>EstablishPACEChannel. |
| References    | [TR-03110-2], 3.2, [TR-03110-4], 2.1.3.2, [TR-03119], D.3                                                                                                                                                                                                                                                                                                           |
| Profiles      | R_PACE                                                                                                                                                                                                                                                                                                                                                              |
| Preconditions | Certificates as described in table 37.                                                                                                                                                                                                                                                                                                                              |

|                  | Make certificates and the CAN available in UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '03' (PIN is used)<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: value of the password<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. LT sends data from EF.CardAccess with an<br>algorithm-ID in the PACE parameters, which is not supported by the DUT, in<br>response APDU to command Read Binary. It is expected that the DUT aborts<br>protocol execution after receiving these data.<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4). |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The command APDUs for MSE: Set AT, General Authenticate (Step 1, 2, 3, 4)<br>are missing, since the DUT must abort communication to LT after receiving<br>the response APDU to Read Binary.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative, i. e. 'E0 00 00 02'.                                                                                                                                                                                                                                                                                                                      |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

| Test case ID | Terminal type                                                                                                                                       | <OID-Role> |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|------------|
| R_PACE_3.2a  | Certificate with role Inspection System and access rights according<br>to table 19, No. 1; CA certificates according to table 22, No. 1, 2          | '01'       |
| R_PACE_3.2b  | Certificate with role Authentication Terminal and access rights<br>according to table 20, No. 1; CA certificates according to table 23,<br>No. 1, 2 | '02'       |

#### <span id="page-50-0"></span>Table 37: Test case R\_PACE\_3.2

| Test ID       | R_PACE_3.3_template                                                                                                                                                                                                                                                                                                                               |
|---------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts PACE protocol when LT transmits an incorrect<br>cryptogram in response message to card command General Authenticate (Step 1).<br>The test is executed with the password CAN. It calls an extension of the PC/SC<br>function SCardControl where the password is transmitted in the InBuffer for<br>EstablishPACEChannel. |
| References    | [TR-03110-2], 3.2, [TR-03110-3], B.1, [TR-03110-4], 2.1.3.2, [TR-03119], D.3                                                                                                                                                                                                                                                                      |
| Profiles      | R_PACE                                                                                                                                                                                                                                                                                                                                            |
| Preconditions | Certificates as described in table 38.<br>Make certificates and the CAN available in UT.                                                                                                                                                                                                                                                          |
| Test scenario | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (CAN is used)<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles                                                     |

|                  | •<br><PIN>: value of the password<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. LT computes the encrypted nonce<br>encNonce incorrectly, i. e. different from E(K_pi, s).The return codes in the<br>response APDUs of all commands apart from General Authenticate (Step 4) are<br>positive ('90 00'). The return code in the response APDU to General Authenticate<br>(Step 4) (if this message is sent) is an error code ('63 XX') indicating that the<br>authentication has failed.<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4).                                                                                                                           |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '02', since CAN<br>is used.<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT as described in<br>table 38.<br>•<br>The <access rights> in command APDU to MSE: Set AT as described in<br>table 38.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative, i. e. 'F0 06 63 XX', if LT sends<br>return code '63 XX' in response to General Authenticate (Step 4), or<br>'F0 10 00 01', if the DUT aborts communication with LT.<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'. |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

| Test case ID | Terminal type                                                                                                                                       | <OID-Role> |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|------------|
| R_PACE_3.3a  | Certificate with role Inspection System and access rights according<br>to table 19, No. 1; CA certificates according to table 22, No. 1, 2          | '01'       |
| R_PACE_3.3b  | Certificate with role Authentication Terminal and access rights<br>according to table 20, No. 1; CA certificates according to table 23,<br>No. 1, 2 | '02'       |

#### <span id="page-51-0"></span>Table 38: Test case R\_PACE\_3.3

| Test ID       | R_PACE_3.4_template                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts PACE protocol when LT transmits an ephemeral public<br>key in response message to card command General Authenticate (Step 3) that<br>coincides with the ephemeral public key transmitted by the DUT in the command<br>APDU to this command.<br>The test is executed with the password CAN. It calls an extension of the PC/SC<br>function SCardControl where the password is transmitted in the InBuffer for<br>EstablishPACEChannel. |
| References    | [TR-03110-2], 3.2, [TR-03110-3], B.1, [TR-03110-4], 2.1.3.2, [TR-03119], D.3                                                                                                                                                                                                                                                                                                                                                                                    |
| Profiles      | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Preconditions | Certificates as described in table 39.<br>Make certificates and the CAN available in UT.                                                                                                                                                                                                                                                                                                                                                                        |

| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (CAN is used)<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: value of the password<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. LT generates the ephemeral key pair<br>correctly but transmits in response message to card command General<br>Authenticate (Step 3) the ephemeral public key received from the DUT. It is<br>expected that the DUT aborts protocol execution after receiving the ephemeral<br>public key in response APDU to General Authenticate (Step 3).<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4). |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '02', since CAN<br>is used.<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT as described in<br>table 39.<br>•<br>The <access rights> in command APDU to MSE: Set AT as described in<br>table 39.<br>•<br>The command APDU for General Authenticate (Step 4) must be missing.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative, i. e. 'F0 10 00 01', since the<br>DUT aborts communication with LT.<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.                                                                                                                                 |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

| Test case ID | Terminal type                                                                                                                                       | <OID-Role> |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|------------|
| R_PACE_3.4a  | Certificate with role Inspection System and access rights according<br>to table 19, No. 1; CA certificates according to table 22, No. 1, 2          | '01'       |
| R_PACE_3.4b  | Certificate with role Authentication Terminal and access rights<br>according to table 20, No. 1; CA certificates according to table 23,<br>No. 1, 2 | '02'       |

#### <span id="page-52-0"></span>Table 39: Test case R\_PACE\_3.4

| Test ID    | R_PACE_3.5_template                                                                                                                                                                                                                                                                                                                                                                                   |
|------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose    | Check that the DUT aborts PACE protocol when LT transmits an incorrect<br>cryptogram, that it has generated with derived SM key data, in response message to<br>card command General Authenticate (Step 4).<br>The test is executed with the password CAN. It calls an extension of the PC/SC<br>function SCardControl where the password is transmitted in the InBuffer for<br>EstablishPACEChannel. |
| References | [TR-03110-2], 3.2, [TR-03110-4], 2.1.3.2, [TR-03119], D.3                                                                                                                                                                                                                                                                                                                                             |
| Profiles   | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                |

| Preconditions    | Certificates as described in table 40.<br>Make certificates and the CAN available in UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (CAN is used)<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: value of the password<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. LT computes authentication token T_PICC<br>incorrectly, i. e. different from MAC(Kmac, PKeph_PCD). The return codes in the<br>response APDUs of all commands are positive ('90 00').<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4). |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '02', since CAN<br>is used.<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT as described in<br>table 40.<br>•<br>The <access rights> in command APDU to MSE: Set AT as described in<br>table 40.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative ('0xE0 00 00 06').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.                                                                                                        |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

| Test case ID | Terminal type                                                                                                                                       | <OID-Role> |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|------------|
| R_PACE_3.5a  | Certificate with role Inspection System and access rights according<br>to table 19, No. 1; CA certificates according to table 22, No. 1, 2          | '01'       |
| R_PACE_3.5b  | Certificate with role Authentication Terminal and access rights<br>according to table 20, No. 1; CA certificates according to table 23,<br>No. 1, 2 | '02'       |

#### <span id="page-53-0"></span>Table 40: Test case R\_PACE\_3.5

| Test ID | R_PACE_3.6_template                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose | Check that the DUT aborts PACE protocol when LT transmits an authentication<br>token (T_PICC), that it has generated with a wrong algorithm, in response message to<br>card command General Authenticate (Step 4).<br>The values for PACEInfo and PACEDomainParameterInfo within EF.CardAccess of<br>the LT indicates that LT supports exactly one algorithm. But for the generation of<br>T_PICC LT uses another algorithm.<br>The test has to be executed for each algorithm specified in the manufacturer's<br>conformance statement. The following substitutions have to be used (algorithm<br>indicated in EF.CardAccess, algorithm used by LT):<br>–<br>id-PACE-DH-GM 1, id-PACE-DH-GM 2<br>–<br>id-PACE-DH-GM 2, id-PACE-DH-GM 1 |

|                  | –<br>id-PACE-DH-GM 3, id-PACE-DH-GM 1<br>–<br>id-PACE-DH-GM 4, id-PACE-DH-GM 1<br>–<br>id-PACE-ECDH-GM 1, id-PACE-ECDH-GM 2<br>–<br>id-PACE-ECDH-GM 2, id-PACE-ECDH-GM 1<br>–<br>id-PACE-ECDH-GM 3, id-PACE-ECDH-GM 1<br>–<br>id-PACE-ECDH-GM 4, id-PACE-ECDH-GM 1<br>–<br>id-PACE-DH-IM 1, id-PACE-DH-IM 2<br>–<br>id-PACE-DH-IM 2, id-PACE-DH-IM 1<br>–<br>id-PACE-DH-IM 3, id-PACE-DH-IM 1<br>–<br>id-PACE-DH-IM 4, id-PACE-DH-IM 1<br>–<br>id-PACE-ECDH-IM 1, id-PACE-ECDH-IM 2<br>–<br>id-PACE-ECDH-IM 2, id-PACE-ECDH-IM 1<br>–<br>id-PACE-ECDH-IM 3, id-PACE-ECDH-IM 1<br>–<br>id-PACE-ECDH-IM 4, id-PACE-ECDH-IM 1<br>The test is executed with the CAN. It calls an extension of the PC/SC function<br>SCardControl where the password is transmitted in the InBuffer for<br>EstablishPACEChannel. |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| References       | [TR-03110-2], 3.2, [TR-03110-3], A.1.1.1, A.1.2, A.3, B.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Profiles         | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Preconditions    | Certificates as described in table 41.<br>Make certificates and the CAN available in UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (CAN is used)<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: value of the password<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. LT computes authentication token T_PICC<br>incorrectly, with a wrong algorithm. The return codes in the response APDUs of all<br>commands are positive ('90 00').<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4).                                      |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '02', since CAN<br>is used.<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT as described in<br>table 41.<br>•<br>The <access rights> in command APDU to MSE: Set AT as described in<br>table 41.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative ('0xE0 00 00 06').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.                                                                                                                          |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

| Test case ID | Terminal type                                                                                                                                       | <OID-Role> |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|------------|
| R_PACE_3.6a  | Certificate with role Inspection System and access rights according<br>to table 19, No. 1; CA certificates according to table 22, No. 1, 2          | '01'       |
| R_PACE_3.6b  | Certificate with role Authentication Terminal and access rights<br>according to table 20, No. 1; CA certificates according to table 23,<br>No. 1, 2 | '02'       |

<span id="page-55-0"></span>Table 41: Test case R\_PACE\_3.6

### 5.2.4 R\_PACE\_4 – Abort of PACE Protocol because of Incorrect UT Data

| Test ID          | R_PACE_4.1_template                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |  |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| Purpose          | Check that the DUT aborts PACE protocol when UT transmits an incorrect<br>Password-ID in the input of the PC/SC function. The test is performed subsequently<br>with the incorrect Password-IDs '00', '05' and '11'.                                                                                                                                                                                                                                                                  |  |
| References       | [TR-03110-2], 3.2, [TR-03110-4], 2.1.3.2, [TR-03119], D.3                                                                                                                                                                                                                                                                                                                                                                                                                             |  |
| Profiles         | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |  |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>Make certificates available in UT.                                                                                                                                                                                                                                                                                                |  |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: see table 42<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: empty (all executions)<br>•<br><CERT_DESC>: List of certificates as specified in Profiles (all executions)<br>2.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4). |  |
| Expected results | 1.<br>-<br>2.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative, '0xE00000003' or<br>'0xD00000002' or '0xD00000003'.                                                                                                                                                                                                                                                             |  |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                      |  |

| Test case ID | <Password-ID> |
|--------------|---------------|
| R_PACE_4.1a  | '00'          |
| R_PACE_4.1b  | '05'          |
| R_PACE_4.1c  | '11'          |

#### <span id="page-55-1"></span>Table 42: Test case R\_PACE\_4.1

| Test ID | R_PACE_4.2_template                                                                                                                                                                                                  |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose | Check that the DUT aborts PACE protocol when UT transmits an incorrect<br>Password-ID in the input of the PC/SC function. The test is performed subsequently<br>with the incorrect Password-IDs '00', '05' and '11'. |

| References       | [TR-03110-2], 3.2, [TR-03110-4], 2.1.3.2, [TR-03119], D.3                                                                                                                                                                                                                                                                                                                                                                                                                             |  |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| Profiles         | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |  |
| Preconditions    | Certificate with role Inspection System and access rights according to<br>table 19, No. 1; CA certificates according to table 22, No. 1, 2<br>Make certificates available in UT.                                                                                                                                                                                                                                                                                                      |  |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: see table 43<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: empty (all executions)<br>•<br><CERT_DESC>: List of certificates as specified in Profiles (all executions)<br>2.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4). |  |
| Expected results | 1.<br>-<br>2.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative, '0xE00000003' or<br>'0xD00000002' or '0xD00000003'.                                                                                                                                                                                                                                                             |  |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                      |  |

| Test case ID | <Password-ID> |
|--------------|---------------|
| R_PACE_4.2a  | '00'          |
| R_PACE_4.2b  | '05'          |
| R_PACE_4.2c  | '11'          |

#### <span id="page-56-0"></span>Table 43: Test case R\_PACE\_4.2

| Test ID       | R_PACE_4.3_template                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts PACE protocol when an incorrect password is<br>transmitted.<br>The test is executed with the password CAN. It calls an extension of the PC/SC<br>function SCardControl where the password is transmitted in the InBuffer for<br>EstablishPACEChannel.                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| References    | [TR-03110-2], 3.2, [TR-03110-4], 2.1.3.2, [TR-03119], D.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Profiles      | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Preconditions | Certificate as described in table 44.<br>Make certificates and the CAN available in UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Test scenario | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (CAN is used)<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>:incorrect value of the password<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. LT derives an encryption key K_pi from the<br>password stored in the smart card that differs from the encryption key derived<br>from the wrong password in the DUT. The return codes in the response APDUs of |

|                  | all commands apart from General Authenticate (Step 4) are positive ('90 00'). The<br>return code in the response APDU to General Authenticate (Step 4) is an error<br>code ('63 XX') indicating that the authentication has failed.<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4).                                                                                                                                                                                                                                                                                                                                                                          |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '02' (CAN is<br>used).<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT as described in<br>table 44.<br>•<br>The <access rights> in command APDU to MSE: Set AT as described in<br>table 44.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative, i. e. 'F0 06 63 XX'.<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'. |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

| Test case ID | Terminal type                                                                                                                                       | <OID-Role> |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|------------|
| R_PACE_4.3a  | Certificate with role Inspection System and access rights according<br>to table 19, No. 1; CA certificates according to table 22, No. 1, 2          | '01'       |
| R_PACE_4.3b  | Certificate with role Authentication Terminal and access rights<br>according to table 20, No. 1; CA certificates according to table 23,<br>No. 1, 2 | '02'       |

#### <span id="page-57-0"></span>Table 44: Test case R\_PACE\_4.3

| Test ID       | R_PACE_4.4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|---------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts PACE protocol when an incorrect password is<br>transmitted.<br>The test is executed with the passwords PIN. It calls an extension of the PC/SC<br>function SCardControl where the password is transmitted as user input via the PIN<br>Pad of the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| References    | [TR-03110-2], 3.2, [TR-03110-4], 2.2.3.2, [TR-03119], D.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Profiles      | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Preconditions | Certificate with role Authentication Terminal and access rights according to table 20,<br>No. 1; CA certificates according to table 23, No. 1, 2<br>Make certificates and the password PIN available in UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Test scenario | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '03'<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: empty, an incorrect password is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. LT derives an encryption key K_pi from the<br>password stored in the smart card that differs from the encryption key derived<br>from the wrong password in the DUT. The return codes in the response APDUs of |

|                  | all commands apart from General Authenticate (Step 4) are positive ('90 00'). The<br>return code in the response APDU to General Authenticate (Step 4) (if this<br>message is sent) is an error code ('63 XX') indicating that the authentication has<br>failed.<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4).                                                                                                                                                                                                                                                                                                                 |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '03'.<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '02'.<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 20, No. 1.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative, i. e. 'F0 06 63 XX'.<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'. |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

| Test ID          | R_PACE_4.5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that the DUT aborts PACE protocol when an incorrect password (MRZ) is<br>transmitted.<br>The test is executed with password MRZ. It calls an extension of the PC/SC function<br>SCardControl where the password is transmitted in the InBuffer for<br>EstablishPACEChannel.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| References       | [TR-03110-2], 3.2, [TR-03110-4], 2.2.3.2, [TR-03119], D.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Profiles         | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Preconditions    | Certificate with role Inspection System and access rights according to<br>table 19, No. 1; CA certificates according to table 22, No. 1, 2<br>Make certificates and the password (MRZ) available in UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '01' (MRZ is used)<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: wrong value of the password<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. LT derives an encryption key K_pi from the<br>password stored in the smart card that differs from the encryption key derived<br>from the transport PIN in the DUT. The return codes in the response APDUs of all<br>commands apart from General Authenticate (Step 4) are positive ('90 00'). The<br>return code in the response APDU to General Authenticate (Step 4) (if this<br>message is sent) is an error code ('63 XX') indicating that the authentication has<br>failed.<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4). |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions (only if these commands have been<br>transmitted by the DUT):<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '01' (MRZ is                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

|                 | used).<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '01'<br>(Inspection System).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 19, No. 1.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative, i. e. 'D0 00 00 02'.<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00', if this<br>command has been transmitted, and not specified, otherwise. |
|-----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Post processing | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

| Test ID          | R_PACE_4.6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that the DUT aborts PACE protocol when an incorrect combination of<br>Password-ID and CHAT is transmitted in input of PC/SC function. The Password-ID<br>addresses CAN.<br>Use certificate with role Authentication Terminal, that is not authorized to use the<br>CAN.<br>The test is executed with the password CAN. It calls an extension of the PC/SC<br>function SCardControl where the password is transmitted in the InBuffer for<br>EstablishPACEChannel.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| References       | [TR-03110-2], 3.2, [TR-03110-4], 2.2.3.2, [TR-03119], D.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Profiles         | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 2 (not authorized to use CAN); CA certificates according to table 23, No. 1,<br>2<br>Make certificates and the CAN available in UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (CAN is used)<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: value of the password<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. LT sends the negative return code '6A 80',<br>indicating that the terminal type referenced by the CHAT is not authorized to use<br>the referenced password (CAN), in answer message to MSE: Set AT back to the<br>DUT. It is expected that the DUT aborts protocol execution after receiving this<br>return code. Alternatively, the DUT may detect the inconsistency between CHAT<br>and password and thus does not send MSE: Set AT.<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4). |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '02' since CAN<br>is used, if this command is sent.<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '02'<br>(Authentication Terminal), if this command is sent.<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

|                 | in table 20, No. 2, if this command is sent.<br>•<br>The command APDUs for General Authenticate (Step 1, 2, 3, 4) are missing,<br>since the DUT must abort communication to LT after receiving the specified<br>error code to MSE: Set AT.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative in all cases. It is 'F0 02 6A 80', if<br>MSE: Set AT is sent, and 'D0 00 00 03', otherwise.<br>•<br><status_mse>: The status code for command MSE: Set AT is '6A 80', if this<br>command is sent, and not specified, otherwise. |
|-----------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Post processing | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

| Test ID          | R_PACE_4.7                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that the DUT aborts PACE protocol when an incorrect combination of<br>Password-ID and CHAT is transmitted in input of PC/SC function. The Password-ID<br>addresses PIN. Use certificate with role Inspection System (IS are not authorized to<br>use PIN).<br>The test is executed with the PIN. It calls an extension of the PC/SC function<br>SCardControl where the password is transmitted as user input via the PIN Pad of the<br>DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| References       | [TR-03110-2], 3.2, [TR-03110-4], 2.1.3.2, [TR-03119], D.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Profiles         | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Preconditions    | Certificate with role Inspection System and access rights according to<br>table 19, No. 1; CA certificates according to table 22, No. 1, 2<br>Make certificates and the PIN available in UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '03' (PIN is used)<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: empty, password is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. LT sends the negative return code '6A 80',<br>indicating that the terminal type referenced by the CHAT is not authorized to use<br>the referenced password, in answer message to MSE: Set AT back to the DUT. It is<br>expected that the DUT aborts protocol execution after receiving this return code.<br>Alternatively, the DUT may detect the inconsistence between CHAT and<br>password and thus does not send MSE: Set AT.<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4). |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '03' since PIN is<br>used, if this command is sent.<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '01'<br>(Inspection System), if this command is sent.<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 19, No. 1, if this command is sent.<br>•<br>The command APDUs for General Authenticate (Step 1, 2, 3, 4) are missing,                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |

|                 | since the DUT must abort communication to LT after receiving the specified<br>error code to MSE: Set AT.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:                                                              |
|-----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                 | •<br><Result_Code>: The result code is negative in all cases. It is 'F0 02 6A 80', if<br>MSE: Set AT is sent, and 'D0 00 00 03', otherwise.<br>•<br><status_mse>: The status code for command MSE: Set AT is '6A 80', if this<br>command is sent, and not specified, otherwise. |
| Post processing | Reset of smart card and the DUT.                                                                                                                                                                                                                                                |

| Test ID          | R_PACE_4.8                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that the DUT aborts PACE protocol when UT transmit the PIN via PC/SC<br>command.<br>The test is executed with the eID-PIN. It calls an extension of the PC/SC function<br>SCardControl where the password is transmitted in the InBuffer for<br>EstablishPACEChannel.                                                                                                                                                                                                         |
| References       | [TR-03110-2], 3.2, [TR-03110-4], 2.2.3.2, [TR-03119]                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Profiles         | R_PACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>Make certificates and the password (eID-PIN) available in UT.                                                                                                                                                                                                                                                                   |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '03' (PIN is used)<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: value of the password (eID-PIN)<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4). |
| Expected results | 1.<br>-<br>2.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative, i. e. 'D0 00 00 03'.<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.                                                                                                                                                                                                                |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                    |

### 5.3 Terminal Authentication

For all test cases for terminal authentication the precondition is to successful establish a PACE channel. Where no terminal role and password type is defined, these parameters can be chosen from these which are supported by the DUT (see chapter [3.3](#page-25-0) [Terminal type\)](#page-25-0).

If no terminal type and/or password is defined, the priority of the terminal type to use in the test cases are. AT, IS and ST. The priority of the password to use -in the test cases are CAN, PIN and MRZ. That does mean, first select the first supported terminal type then select the first supported password type which is supported in combination with the terminal type.

**The used terminal type and password must be documented in the test report.**

### 5.3.1 R\_TA\_1 – Correct Execution of Terminal Authentication Protocol

| Test ID          | R_TA_1.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check the DUT for correct execution of terminal authentication protocol. Use<br>certificate with role Inspection System.                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| References       | [TR-03110-2], 3.4, [TR-03110-3],B.3, [TR-03110-4], 2.1.3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Profiles         | R_PACE AND R_TA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Preconditions    | Certificate with role Inspection System and access rights according to<br>table 19, No. 1; CA certificates according to table 22, No. 1, 2<br>The PACE protocol has been executed successfully with CAN in the DUT. After PACE<br>protocol especially the following smart card data are available in UT:<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>–<br>ID_PICC (identification of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol. |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.2:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').                                                                                                                                                                                   |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before. The<br>SM in the command APDU generated by the DUT and received by LT is correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.                                                                                                                                                                       |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |

| Test ID       | R_TA_1.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|---------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check the DUT for correct execution of terminal authentication protocol. Use<br>certificate with role Authentication Terminal.                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| References    | [TR-03110-2], 3.4, [TR-03110-3], B.3, [TR-03110-4], 2.2.3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Profiles      | R_PACE AND R_TA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Preconditions | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>The PACE protocol has been executed successfully with PIN in the DUT. After PACE<br>protocol especially the following smart card data are available in UT:<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>–<br>ID_PICC (identification of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol. |
| Test scenario | The execution steps have to be performed as described in chapter 4.3.2:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').                                                                                                                                                                                         |

| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before. The<br>SM in the command APDU generated by the DUT and received by LT is correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before. |
|------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                              |

| Test ID          | R_TA_1.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check the DUT for correct execution of terminal authentication protocol. Use<br>certificate with role Signature Terminal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| References       | [TR-03110-2], 3.4, [TR-03110-3], B.3, [TR-03110-4], 2.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Profiles         | R_PACE AND R_TA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Preconditions    | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>The PACE protocol has been executed successfully with CAN in the DUT. After PACE<br>protocol especially the following smart card data are available in the DUT:<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>–<br>ID_PICC (identification of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.                                                                                                                                                                                                                                                                               |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.2 and 4.3.3:<br>All command steps for Terminal Authentication have to be executed directly from<br>the DUT without sending commands from the UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM. The SM<br>in the command APDU generated by the DUT and received by LT is correct.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 5.2.4), the following<br>holds:<br>•<br><Result_Code>: The result code is positive (i. e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access coincide<br>with the data of EF.CardAccess in LT.<br>•<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the<br>smart card.<br>•<br><IDPICC>: The field contains the correct ID_PICC.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before. |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

### 5.3.2 R\_TA\_2 – Abort because of Inconsistent Reader Data

| Test ID    | R_TA_2.1                                                                                                                                                                                                                       |
|------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose    | Check that the DUT aborts terminal authentication if the terminal certificate<br>description used in the terminal authentication protocol is different from the<br>terminal certificate description used in the PACE protocol. |
| References | [TR-03110-2], 3.4, [TR-03110-3], B.3, [TR-03110-4], 2.1.3.2, [TR-03119]                                                                                                                                                        |
| Profiles   | R_PACE                                                                                                                                                                                                                         |

| Preconditions    | Certificate with role Authentication Terminal and access rights according to table 20,<br>No. 1; CA certificates according to table 23, No. 1, 2<br>The PACE protocol has been executed successfully with CAN in the DUT.<br>EstablishPACEChannel must contain a complete certificate description<br>(CERT_DESC) as described in chapter 4.2.3. After PACE protocol especially the<br>following smart card data are available in UT:<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>–<br>ID_PICC (identification of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.                                                                                                                           |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.2:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').<br>The hash value of the terminal certificate description submitted by UT in the<br>command APDU to PSO: Verify Certificate is different from the hash value which the<br>DUT had to calculate from the terminal certificate description (CERT_DESC) used in<br>the PACE protocol.                                                                                                                                                      |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before. The<br>SM in the command APDU generated by the DUT and received by LT is correct.<br>UT receives response APDUs to the commands MSE: Set DST and PSO: Verify<br>Certificate for all certificates of the certificate chain which are correctly coded<br>without SM. The response APDUs to MSE: Set DST and PSO: Verify Certificate (for<br>the CV certificates) coincide apart from SM with the response APDU sent by LT<br>directly before. The response APDU to PSO: Verify for the terminal certificate<br>received by UT consists of the negative return code '69 85'. It is expected that the<br>DUT aborts protocol execution after sending this return code. |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

### 5.3.3 R\_TA\_3 – Abort because of Internal LT Error

| Test ID       | R_TA_3.1                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|---------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts terminal authentication when LT returns error code to<br>command MSE: Set DST (setting public key for certificate verification).                                                                                                                                                                                                                                                                                                     |
| References    | [TR-03110-2], 3.4, [TR-03110-3], B.3, [TR-03110-4], 2.1.3.2                                                                                                                                                                                                                                                                                                                                                                                                    |
| Profiles      | R_PACE AND R_TA                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Preconditions | Certificate with universal access rights.<br>The PACE protocol has been executed successfully in the DUT. After PACE protocol<br>especially the following smart card data are available in the DUT:<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>–<br>ID_PICC (identification of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol. |
| Test scenario | The execution steps have to be performed as described in chapter 4.3.2:                                                                                                                                                                                                                                                                                                                                                                                        |

|                  | All steps for Terminal Authentication have to be executed directly by the DUT<br>without sending commands from the UT.<br>When LT receive the first command APDU MSE: Set DST the return code in response<br>APDU send from the LT shall be negative ('6A 80').                                                                              |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | Each command APDU received at LT is correctly coded and secured by SM. The SM<br>in the command APDU generated by the DUT and received by LT is correct.<br>When the DUT receives the negative response to MSE: Set DST, the Terminal<br>Authentication must be aborted.<br>The expected result code is '0xF8 00 6A 80' (see chapter 4.2.4). |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                             |

| Test ID          | R_TA_3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that the DUT aborts terminal authentication when LT returns error code to<br>command PSO: Verify Certificate when verifying the terminal certificate.                                                                                                                                                                                                                                                                                                    |
| References       | [TR-03110-2], 3.4, [TR-03110-3], B.3, [TR-03110-4], 2.1.3.2                                                                                                                                                                                                                                                                                                                                                                                                    |
| Profiles         | R_PACE AND R_TA                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Preconditions    | Certificate with universal access rights.<br>The PACE protocol has been executed successfully in the DUT. After PACE protocol<br>especially the following smart card data are available in the DUT:<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>–<br>ID_PICC (identification of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol. |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.2:<br>All command steps for Terminal Authentication have to be executed directly by the<br>DUT without sending commands from the UT.<br>The LT sends negative return code ('6A 80') to the first PSO: Verify Certificate<br>command received from the DUT. The return codes to all other commands sent by<br>the DUT are positive ('90 00').                                              |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM. The SM<br>in the command APDU generated by the DUT and received by LT is correct.<br>When the DUT receives the negative response to PSO: Verify Certificate, the<br>Terminal Authentication must be aborted.<br>The expected result code is '0xF8 01 6A 80' (see chapter 4.2.4).                                                                                                        |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                               |

| Test ID       | R_TA_3.3                                                                                                                                                                                                                                           |
|---------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts terminal authentication when LT returns error code to<br>command MSE: Set AT (transmitting parameters for terminal authentication to LT).                                                                                |
| References    | [TR-03110-2], 3.4, [TR-03110-3], B.3, [TR-03110-4], 2.1.3.2                                                                                                                                                                                        |
| Profiles      | R_PACE AND R_TA                                                                                                                                                                                                                                    |
| Preconditions | Certificate with universal access rights.<br>The PACE protocol has been executed successfully in the DUT. After PACE protocol<br>especially the following smart card data are available in the DUT:<br>–<br>PK_PICC (public key of the smart card) |

|                  | –<br>D_PICC (static domain parameters of the smart card)<br>–<br>ID_PICC (identification of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.                                                                                                                                                                              |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.2:<br>All command steps for Terminal Authentication have to be executed directly by the<br>DUT without sending commands from the UT.<br>The LT sends negative return code ('6A 88') in response APDU to the first MSE: Set<br>AT. The return codes to all other commands sent by the DUT are positive ('90 00'). |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM. The SM<br>in the command APDU generated by the DUT and received by LT is correct.<br>When the DUT receives the negative response to MSE: Set AT, the Terminal<br>Authentication must be aborted.<br>The expected result code is '0xF8 06 6A 88' (see chapter 4.2.4).                                           |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                      |

| Test ID          | R_TA_3.4                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that the DUT aborts terminal authentication when LT returns error code to<br>command Get Challenge (random number for terminal authentication).                                                                                                                                                                                                                                                                                                          |
| References       | [TR-03110-2], 3.4, [TR-03110-3], B.3, [TR-03110-4], 2.1.3.2                                                                                                                                                                                                                                                                                                                                                                                                    |
| Profiles         | R_PACE AND R_TA                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Preconditions    | Certificate with universal access rights.<br>The PACE protocol has been executed successfully in the DUT. After PACE protocol<br>especially the following smart card data are available in the DUT:<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>–<br>ID_PICC (identification of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol. |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.2:<br>All command steps for Terminal Authentication have to be executed directly by the<br>DUT without sending commands from the UT.<br>The LT sends negative return code ('ZZ ZZ', the actual value depends on the smart<br>card operating system) in response APDU to Get Challenge. The return codes to all<br>other commands sent by the DUT are positive ('90 00').                  |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM. The SM<br>in the command APDU generated by the DUT and received by LT is correct.<br>When the DUT receives the negative response to Get Challenge command, the<br>Terminal Authentication must be aborted.<br>The expected result code is '0xF8 07 ZZ ZZ' (see chapter 4.2.4).                                                                                                          |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                               |

| Test ID | R_TA_3.5                                                                                                                                                                                        |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose | Check that the DUT aborts terminal authentication when LT returns error code to<br>command External Authenticate when checking signed data from the DUT in<br>terminal authentication protocol. |

| References       | [TR-03110-2], 3.4, [TR-03110-3], B.3, [TR-03110-4] 2.1.3.2                                                                                                                                                                                                                                                                                                                                                                                                     |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Profiles         | R_PACE AND R_TA                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Preconditions    | Certificate with universal access rights.<br>The PACE protocol has been executed successfully in the DUT. After PACE protocol<br>especially the following smart card data are available in the DUT:<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>–<br>ID_PICC (identification of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol. |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.2:<br>All command steps for Terminal Authentication have to be executed directly by the<br>DUT without sending commands from the UT.<br>The LT sends negative return code ('69 85') in response APDU to External<br>Authenticate. The return codes to all other commands sent by the DUT are positive<br>('90 00').                                                                       |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM. The SM<br>in the command APDU generated by the DUT and received by LT is correct.<br>When the DUT receives the negative response to External Authenticate command,<br>the Terminal Authentication must be aborted.<br>The expected result code is '0xF8 08 69 85' (see chapter 4.2.4).                                                                                                  |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                               |

#### 5.3.4 R\_TA\_4 – Abort because of Secure Messaging Error

| Test ID          | R_TA_4.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that the DUT aborts terminal authentication if it does not receive SM data<br>objects from LT in response APDU to command Get Challenge.                                                                                                                                                                                                                                                                                                                                                                                      |
| References       | [TR-03110-2], 3.4, [TR-03110-3], B.3, [TR-03110-4], 2.1.3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Profiles         | R_PACE AND R_TA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Preconditions    | Certificate with universal access rights.<br>The PACE protocol has been executed successfully in the DUT. After PACE protocol<br>especially the following smart card data are available in the DUT:<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>–<br>ID_PICC (identification of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.                                                                      |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.2:<br>All command steps for Terminal Authentication have to be executed directly by the<br>DUT without sending commands from the UT LT receives command APDUs (with<br>SM) from the DUT. LT sends response APDUs (with SM) back to the DUT for the<br>commands MSE: Set DST, PSO: Verify Certificate for all certificates of the certificate<br>chain and MSE: Set AT.<br>LT sends response APDUs without SM back to the DUT for the command Get<br>Challenge. |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM The SM in                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

|                 | the command APDU generated by the DUT and received by LT is correct.<br>The LT receive the command APDUs:<br>•<br>MSE: Set DST<br>•<br>PSO: Verify Certificate (for all certificates in the certificate chain)<br>•<br>MSE: Set AT and<br>•<br>Get ChallengeIt is expected that the DUT detects the missing SM in response<br>APDU to Get Challenge received from LT and aborts command execution.<br>The Terminal Authentication must be aborted.<br>UT receives result code 'F0 10 00 01'. |
|-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Post processing | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                             |

| Test ID          | R_TA_4.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that the DUT aborts terminal authentication if it receives incorrect SM data<br>objects from LT in response APDU to command MSE: Set DST (wrong tag '98' instead<br>of '99' for the processing status).                                                                                                                                                                                                                                                                            |
| References       | [TR-03110-2], 3.4, [TR-03110-3], B.3, [TR-03110-4], 2.1.3.2                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Profiles         | R_PACE AND R_TA                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Preconditions    | Certificate with universal access rights.<br>The PACE protocol has been executed successfully in the DUT. After PACE protocol<br>especially the following smart card data are available in the DUT:<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>–<br>ID_PICC (identification of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.                           |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.2:<br>All command steps for Terminal Authentication have to be executed directly by the<br>DUT without sending commands from the UT.LT receives command MSE: Set DST<br>(with SM) from the DUT. LT sends response APDU with incorrect SM (wrong tag '98'<br>instead of '99' for the processing status) back to the DUT for this command.<br>The return code in response APDU to MSE: Set DST is positive ('90 00'). |
| Expected results | The command APDU to MSE: Set DST received at LT is correctly coded and secured<br>by SM.<br>It is expected that the DUT detects the incorrect SM in response APDU to MSE: Set<br>DST received from LT and aborts command execution. The Terminal Authentication<br>must be aborted.<br>UT receives result code 'F0 10 00 01'.                                                                                                                                                            |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

| Test ID       | R_TA_4.3                                                                                                                                                                                     |
|---------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts terminal authentication if it receives incorrect SM data<br>objects from LT in response APDU to command MSE: Set DST (wrong cryptogram in<br>the MAC data object). |
| References    | [TR-03110-2], 3.4, [TR-03110-3], B.3, [TR-03110-4], 2.1.3.2                                                                                                                                  |
| Profiles      | R_PACE AND R_TA                                                                                                                                                                              |
| Preconditions | Certificate with universal access rights.<br>The PACE protocol has been executed successfully in the DUT. After PACE protocol                                                                |

|                  | especially the following smart card data are available in the DUT:<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>–<br>ID_PICC (identification of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.                                                                                                                                                 |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.2:<br>All command steps for Terminal Authentication have to be executed directly by the<br>DUT without sending commands from the UT. LT receives command APDU MSE:<br>Set DST (with SM) from the DUT. LT sends response APDU with incorrect SM (wrong<br>cryptogram in the MAC data object) back to the DUT for this command.<br>The return code in response APDU to MSE: Set DST is positive ('90 00'). |
| Expected results | The command APDU to MSE: Set DST received at LT is correctly coded and secured<br>by SM.<br>It is expected that the DUT detects the incorrect SM in response APDU to MSE: Set<br>DST received from LT and aborts command execution. The Terminal Authentication<br>must be aborted.<br>UT receives result code 'F0 10 00 01'.                                                                                                                                                 |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                              |

| Test ID       | R_TA_4.4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|---------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | The DUT aborts terminal authentication, if it receives that SM data objects are<br>missing from LT in response APDU to command MSE: Set DST (wrong tag '98'<br>instead of '99' for the processing status).<br>Check that the session keys are deleted after error in secure messaging handling (69<br>87).<br>The PACE protocol is executed with password CAN.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| References    | [TR-03110-2]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Profiles      | R_PACE AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Preconditions | Certificate with role Signature Terminal and access rights according to table 21, No.<br>1; CA certificates according to table 24, No. 1, 2<br>Make certificates and the password CAN available in UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Test scenario | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (CAN is used)<br>•<br><CHAT>: Restricted CHAT: at least "Generate qualified electronic signature"<br>•<br><PIN>: empty, because password (CAN) is entered via PIN Pad of the DUT<br>2.<br>Entering the correct CAN into the DUT<br>3.<br>LT receives command APDUs without SM from the DUT and sends response<br>APDUs without SM back to the DUT as described in chapter 4.3.1. The return<br>codes in all response APDUs are positive ('90 00').<br>4.<br>LT receives command MSE: Set DST with SM as described in chapter 4.3.2 and<br>sends response APDUs with incorrect SM (wrong tag '98' instead of '99' for the<br>processing status) back to the DUT for this command.<br>Response APDU: 98 02 <SW1SW2> 8E 08 <MAC> <SW1SW2><br>The return code in response APDU to MSE: Set DST is positive ('90 00').<br>5.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (CAN is used) |

|                  | •<br><CHAT>: Restricted CHAT: at least "Generate qualified electronic signature"<br>•<br><PIN>: empty, because password (CAN) is entered via PIN Pad of the DUT<br>6.<br>Entering the correct CAN into the DUT<br>7.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapters 4.3.1 (without SM), 4.3.2 (with SM) and 4.3.3<br>(with SM). The return codes in all response APDUs are positive ('90 00'). In case of<br>a Signature Terminal all authentication protocols (PACE, TA and CA) are<br>completely performed within EstablishPACEChannel between the DUT and LT.<br>8.<br>UT receives OutBuffer of ScardControl (see chapter 4.2.4).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>–<br>2.<br>–<br>3.<br>The command APDUs for the PACE protocols which LT receives from the DUT<br>are built up as described in chapters 4.3.1. For the PACE protocol with the<br>following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '02' (CAN).<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '03' (Signature<br>Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined in table<br>21, No. 1.<br>4.<br>UT receives a returncode from Terminal, that shows, that an expected SM Data<br>object is missing<br>•<br><Result_Code>: The result code is negative (i.e. 'XX YY 69 87').<br>5.<br>–<br>6.<br>–<br>7.<br>The command APDUs for the authentication protocols which LT receives from<br>the DUT are built up as described in chapters 4.3.1 (without SM), 4.3.2 (with SM)<br>and 4.3.3 (with SM). For the PACE protocol with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '02' (CAN).<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '03' (Signature<br>Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined in<br>Table 21, No. 1.<br>8.<br>For the OutBuffer of ScardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i.e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access coincide<br>with the data of EF.CardAccess in LT. |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

| Test ID       | R_TA_4.5                                                                                                                                                                                                                                                                                                                                        |
|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | The DUT aborts terminal authentication if it receives an incorrect SM data objects<br>from LT in response APDU to command MSE: Set DST (tag '8E' has false length, '07'<br>instead if '08').<br>Check that the session keys are deleted after error in secure messaging handling<br>(6988).<br>The PACE protocol is executed with password CAN. |
| References    | [TR-03110-2]                                                                                                                                                                                                                                                                                                                                    |
| Profiles      | R_PACE                                                                                                                                                                                                                                                                                                                                          |
| Preconditions | Certificate with role Signature Terminal and access rights according to table 21, No.                                                                                                                                                                                                                                                           |

|                  | 1; CA certificates according to table 24, No. 1, 2<br>Make certificates and the password CAN available in UT.<br>The PACE protocol has been executed successfully with Password-IDs CAN in the<br>DUT. After PACE protocol especially the following smart card data are available in<br>UT:<br>-PK_PICC (public key of the smart card)<br>-D_PICC (static domain parameters of the smart card)<br>-ID_PICC (identification of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Test scenario    | 1.<br>LT receives command MSE: Set DST with SM as described in chapter 4.3.2 and<br>sends response APDUs with incorrect SM (MAC tag '8E' has only 7 bytes data)<br>back to the DUT for this command.<br>Response APDU:<br>99 02 <SW1SW2> 8E 07 <MAC> <SW1SW2><br>The return code in response APDU to MSE: Set DST is positive ('9000').<br>2.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (CAN is used)<br>•<br><CHAT>: Restricted CHAT for terminal certificate as specified in Profiles<br>•<br><PIN>: value of the password<br>3.<br>LT receives command APDUs without SM from the DUT and sends response<br>APDUs without SM back to the DUT as described in chapter 4.3.1. The return<br>codes in all response APDUs are positive ('90 00').<br>4.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4).                                                                                      |
| Expected results | 1.<br>UT received an error code 'F0 10 00 01' (Communication abort).<br>2.<br>–<br>3.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '02', CAN is used.<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '02'<br>(Authentication Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined in table<br>20, No. 1.<br>4.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i. e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access coincide<br>with the data of EF.CardAccess in LT.<br>•<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the<br>smart card.<br>•<br><IDPICC>: The field contains the correct ID_PICC. |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

### 5.4 Chip Authentication

For all test cases for chip authentication the precondition is to successful establish a PACE channel. Where no terminal role and password type is defined, these parameters can be chosen from those which are supported by the DUT (see chapter [3.3](#page-25-0) [Terminal type\)](#page-25-0).

If no terminal type and/or password is defined, the priority of the terminal type to use in the test cases are AT, IS and ST. The priority of the password to use -in the test cases are CAN, PIN and MRZ. That means, first select the first supported terminal type, then select the first supported password type which is supported in combination with the terminal type.

**The used terminal type and password must be documented in the test report.**

| Test ID          | R_CA_1.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check the DUT for correct execution of chip authentication protocol. Use certificate<br>with role Inspection System.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| References       | [TR-03110-2], 3.3, [TR-03110-3], B.2, [TR-03110-4], 2.1.3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Profiles         | R_PACE AND R_CA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Preconditions    | Certificate with role Inspection System and access rights according to<br>table 19, No. 1; CA certificates according to table 22, No. 1, 2<br>The PACE and terminal authentication protocols have been executed successfully<br>with CAN. After execution of these protocols especially the following smart card and<br>terminal data are available in UT:<br>–<br>ephemeral terminal key pair (SKeph_PCD, PKeph_PCD)<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.<br>Terminal Authentication has been successful executed by the UT. |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.3:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').<br>Moreover UT generates the keys K_MAC and K_ENC for subsequent secure<br>messaging as described in step 10 of chapter 4.3.3.                                                                                                                                                                                 |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before. The<br>SM in the command APDU generated by the DUT and received by LT is correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.                                                                                                                                                                                                                                                                                                    |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

### 5.4.1 R\_CA\_1 – Correct Execution of Chip Authentication Protocol

| Test ID       | R_CA_1.2                                                                                                                                                                                                                                                                                                                   |
|---------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check the DUT for correct execution of chip authentication protocol. Use certificate<br>with role Authentication Terminal.                                                                                                                                                                                                 |
| References    | [TR-03110-2], 3.3, [TR-03110-3], B.2, [TR-03110-4], 2.2.3.2                                                                                                                                                                                                                                                                |
| Profiles      | R_PACE AND R_CA                                                                                                                                                                                                                                                                                                            |
| Preconditions | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>The PACE and terminal authentication protocols have been executed successfully<br>with PIN. After execution of these protocols especially the following smart card and |

|                  | terminal data are available in UT:<br>–<br>ephemeral terminal key pair (SKeph_PCD, PKeph_PCD)<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.<br>Terminal Authentication has been successful executed by the UT.                                                                                                                                         |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.3:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').<br>Moreover UT generates the keys K_MAC and K_ENC for subsequent secure<br>messaging as described in step 10 of chapter 4.3.3. |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before. The<br>SM in the command APDU generated by the DUT and received by LT is correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.                                                                                                                    |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

| Test ID          | R_CA_1.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check the DUT for correct execution of chip authentication protocol. Use certificate<br>with role Signature Terminal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| References       | [TR-03110-2], 3.3, [TR-03110-3], B.2, [TR-03110-4], 2.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Profiles         | R_PACE AND R_CA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Preconditions    | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>The PACE and terminal authentication protocols have been executed successfully<br>with CAN. After execution of these protocols especially the following smart card and<br>terminal data are available in the DUT:<br>–<br>ephemeral terminal key pair (SKeph_PCD, PKeph_PCD)<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.<br>Terminal Authentication has been successful executed by the DUT. |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.3:<br>All command steps for Chip Authentication have to be executed directly by the DUT<br>without sending commands from the UT. LT receives command APDUs (with SM)<br>from the DUT and sends response APDUs (with SM) back to the DUT. The return<br>codes in all response APDUs are positive ('90 00').<br>Moreover Reader and LT generates the keys K_MAC and K_ENC for subsequent<br>secure messaging as described in step 10 of chapter 4.3.3.                                                                                                                                                                               |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM. The SM<br>in the command APDU generated by the DUT and received by LT is correct.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the following<br>holds:                                                                                                                                                                                                                                                                                                                                                                                                                                            |

|                 | •<br><Result_Code>: The result code is positive (i. e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access coincide<br>with the data of EF.CardAccess in LT.<br>•<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the<br>smart card.<br>•<br><IDPICC>: The field contains the correct ID_PICC. |
|-----------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Post processing | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                   |

| Test ID          | R_CA_1.4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check the DUT for correct execution of chip authentication protocol. Use of several<br>algorithms for the chip authentication protocol. The values for<br>ChipAuthenticationInfo and ChipAuthenticationDomainParameterInfo within<br>EF.CardAccess of the LT indicates that LT supports exactly one algorithm and one<br>static key pair. This means that only one data object<br>ChipAuthenticationPublicKeyInfo is available in EF.CardSecurity.<br>The test has to be executed for each chip authentication algorithm specified in the<br>manufacturer's conformance statement (chapter 3.2 Cryptographic algorithms). This<br>test case is only rated as a PASS if all passes are completed successfully. |
| References       | [TR-03110-2], 3.3, [TR-03110-3], A.1.1.2, A.4, B.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Profiles         | R_PACE AND R_CA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Preconditions    | Certificate with universal access rights.<br>The PACE and terminal authentication protocols have been executed successfully in<br>the DUT. After execution of these protocols especially the following smart card and<br>terminal data are available in the DUT:<br>–<br>ephemeral terminal key pair (SKeph_PCD, PKeph_PCD)<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.<br>Terminal Authentication has been successful executed by the DUT.                                                                                                       |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.3:<br>All command steps for Chip Authentication have to be executed directly by the DUT<br>without sending commands from the UT.<br>Moreover the DUT and LT generates the keys K_MAC and K_ENC for subsequent<br>secure messaging as described in step 10 of chapter 4.3.3.                                                                                                                                                                                                                                                                                                                                                              |
| Expected results | The following results are expected:<br>Each command APDU received at LT is correctly coded and secured by SM. The SM<br>in the command APDU generated by the DUT and received by LT is correct.<br>Chip Authentication performs correct and the DUT returns positive Result code to<br>UT.                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

| Test ID | R_CA_1.5                                                                                                                                                                                                                                                                                                   |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose | Check the DUT for correct execution of chip authentication protocol. Use of several<br>algorithms and multiple keys for the chip authentication protocol. LT stores two<br>static key pairs for chip authentication. This means that in EF.CardAccess two<br>SecurityInfos with ChipAuthenticationInfo and |

|                  | ChipAuthenticationDomainParameterInfo are available and that EF.CardSecurity<br>contains two public keys.<br>For this the related algorithms are identical but the static key pairs are different.<br>The test has to be executed for one chip authentication algorithm specified in the<br>manufacturer's conformance statement (chapter 3.2 Cryptographic algorithms). This<br>test case is only rated as a PASS if all passes are completed successfully.                                                                                                                                                                                                                                                  |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| References       | [TR-03110-2], 3.3, [TR-03110-3], A.1.1.2, A.4, B.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Profiles         | R_PACE AND R_CA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Preconditions    | Certificate with universal access rights according.<br>The PACE and terminal authentication protocols have been executed successfully in<br>the DUT. After execution of these protocols especially the following smart card and<br>terminal data are available in the DUT:<br>–<br>ephemeral terminal key pair (SKeph_PCD, PKeph_PCD)<br>–<br>PK_PICC_1 and PK_PICC_2 (public keys of the smart card)<br>–<br>keyId_1 and keyId_2 of the related static key pairs<br>–<br>D_PICC_1 and D_PICC_2 (static domain parameters of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.<br>Terminal Authentication has been successful executed by the DUT. |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.3:<br>All command steps for Chip Authentication have to be executed directly by the DUT<br>without sending commands from the UT. LT receives command APDUs (with SM)<br>from the DUT and sends response APDUs (with SM) back to the DUT. The return<br>codes in all response APDUs are positive ('90 00').<br>Moreover the DUT and LT generates the keys K_MAC and K_ENC for subsequent<br>secure messaging as described in step 10 of chapter 4.3.3.                                                                                                                                                                                    |
| Expected results | The following results are expected:<br>Each command APDU received at LT is correctly coded and secured by SM. The SM<br>in the command APDU generated by the DUT and received by LT is correct.<br>Chip Authentication performs correct and the DUT returns positive Result code to<br>UT.                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

### 5.4.2 R\_CA\_2 – Abort because of Internal LT Error

| Test ID       | R_CA_2.1                                                                                                                                                                                                                                                                                                                                                                                                                          |
|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts chip authentication when LT returns error code to<br>command MSE: Set AT (transmitting parameters for chip authentication to LT).                                                                                                                                                                                                                                                                       |
| References    | [TR-03110-2], 3.3, [TR-03110-3], B.2, [TR-03110-4], 2.1.3.2                                                                                                                                                                                                                                                                                                                                                                       |
| Profiles      | R_PACE AND R_CA                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Preconditions | Certificate universal access rights.<br>The PACE and terminal authentication protocols have been executed successfully in<br>the DUT. After execution of these protocols especially the following smart card and<br>terminal data are available in the DUT:<br>–<br>ephemeral terminal key pair (SKeph_PCD, PKeph_PCD)<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card) |

|                  | A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.<br>Terminal Authentication has been successful executed by the DUT.                                                                                                                                                                                                                                                                                                                             |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.3:<br>All command steps for Chip Authentication have to be executed directly by the DUT<br>without sending commands from the UT. LT receives command APDUs (with SM)<br>from the DUT and sends response APDUs (with SM) back to the DUT.<br>The LT sends negative return code ('6A 88') in response APDU to the first MSE: Set<br>AT. The return codes to all other commands sent by the DUT are positive ('90 00'). |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM. The SM<br>in the command APDU generated by the DUT and received by LT is correct.<br>When the DUT receives the negative response to MSE: Set AT, the Chip<br>Authentication must be aborted. UT receives negative result code.<br>The expected result code is '0xF8 0B 6A 88' (see chapter 4.2.4).                                                                                                                 |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

| Test ID          | R_CA_2.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that the DUT aborts chip authentication when LT returns error code to<br>command General Authenticate when verifying the ephemeral public key of the<br>DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| References       | [TR-03110-2], 3.3, [TR-03110-3], B.2, [TR-03110-4], 2.1.3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Profiles         | R_PACE AND R_CA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Preconditions    | Certificate with universal access rights according.<br>The PACE and terminal authentication protocols have been executed successfully<br>with the DUT. After execution of these protocols especially the following smart card<br>and terminal data are available in the DUT:<br>–<br>ephemeral terminal key pair (SKeph_PCD, PKeph_PCD)<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.<br>Terminal Authentication has been successful executed by the DUT. |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.3:<br>All command steps for Chip Authentication have to be executed directly by the DUT<br>without sending commands from the UT. LT receives command APDUs (with SM)<br>from the DUT and sends response APDUs (with SM) back to the DUT.<br>The return code to MSE: Set AT command sent by the DUT is positive ('90 00'). The<br>LT sends negative return code ('6A 80') in response APDU to the General<br>Authenticate command.                                                                                                              |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM. The SM<br>in the command APDU generated by the DUT and received by LT is correct.<br>When the DUT receives the negative response to General Authenticate command,<br>the Chip Authentication must be aborted. UT receives negative result code.<br>The expected result code is '0xF8 0C 6A 80' (see chapter 4.2.4).                                                                                                                                                                                                                          |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Test ID          | R_CA_2.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

| Purpose          | Check that the DUT aborts chip authentication when LT computes incorrect key data<br>for SM.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| References       | [TR-03110-2], 3.3, [TR-03110-3], B.2, [TR-03110-4], 2.1.3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Profiles         | R_PACE AND R_CA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Preconditions    | Certificate with universal access rights.<br>The PACE and terminal authentication protocols have been executed successfully in<br>the DUT. After execution of these protocols especially the following smart card and<br>terminal data are available in the DUT:<br>–<br>ephemeral terminal key pair (SKeph_PCD, PKeph_PCD)<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.<br>Terminal Authentication has been successful executed by the DUT.                                                                                                                                                                                                                                                                                                                                         |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.3:<br>All command steps for Chip Authentication have to be executed directly by the DUT<br>without sending commands from the UT. LT receives command APDUs (with SM)<br>from the DUT and sends response APDUs (with SM) back to the DUT The return<br>codes in all response APDUs are positive ('90 00').<br>LT generates random number r2_PICC and – according to step 7 in chapter 4.3.3 –<br>computes key material K = KA(SK_PICC, PKeph_PCD, D_PICC) correctly, but derives<br>a wrong K_MAC', i. e. different from KDF_MAC(K, r2_PICC), and computes a wrong<br>T_PICC' = MAC(K_MAC', PKeph_PCD).<br>The DUT receives random number r2_PICC and authentication token T_PICC' in<br>response APDU to General Authenticate. The DUT derives key material K =<br>KA(SKeph_PCD, PK_PICC, D_PICC), keys K_MAC = KDF_MAC(K, r2_PICC) and<br>computes MAC(K_MAC, PKeph_PCD). |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM. The SM<br>in the command APDU generated by the DUT and received by LT is correct.<br>The DUT checks that the received T_PICC' is different from the computed<br>MAC(K_MAC, PKeph_PCD). The Chip Authentication must be aborted. UT receives<br>negative result code.<br>The expected result code is '0xE0 00 00 0A' (see chapter 4.2.4).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

### 5.4.3 R\_CA\_3 – Abort because of Incorrect LT Data

| Test ID       | R_CA_3.1                                                                                                                                                                                                                                                                                                                                                                   |
|---------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts chip authentication when LT returns an incorrect<br>response APDU to command General Authenticate.                                                                                                                                                                                                                                               |
| References    | [TR-03110-2], 3.3, [TR-03110-3], B.2, [TR-03110-4], 2.1.3.2                                                                                                                                                                                                                                                                                                                |
| Profiles      | R_PACE AND R_CA                                                                                                                                                                                                                                                                                                                                                            |
| Preconditions | Certificate with universal access rights.<br>The PACE and terminal authentication protocols have been executed successfully in<br>the DUT. After execution of these protocols especially the following smart card and<br>terminal data are available in the DUT:<br>–<br>ephemeral terminal key pair (SKeph_PCD, PKeph_PCD)<br>–<br>PK_PICC (public key of the smart card) |

|                  | –<br>D_PICC (static domain parameters of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.<br>Terminal Authentication has been successful executed by the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.3:<br>All command steps for Chip Authentication have to be executed directly by the DUT<br>without sending commands from the UT. LT receives command APDUs (with SM)<br>from the DUT and sends response APDUs (with SM) back to the DUT. The return<br>codes in all response APDUs are positive ('90 00').<br>LT generates random number r2_PICC and – according to step 7 in chapter 4.3.3 –<br>computes key material K = KA(SK_PICC, PKeph_PCD, D_PICC), key K_MAC =<br>KDF_MAC(K, r2_PICC) and T_PICC = MAC(K_MAC, PKeph_PCD) correctly. LT<br>transmits an incorrect r2_PICC', i. e. different from r2_PICC, to the DUT.<br>The DUT receives random number r2_PICC' and authentication token T_PICC in<br>response APDU to General Authenticate. The DUT derives key material K =<br>KA(SKeph_PCD, PK_PICC, D_PICC), keys K_MAC' = KDF_MAC(K, r2_PICC') and<br>computes MAC(K_MAC', PKeph_PCD). |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM. The SM<br>in the command APDU generated by the DUT and received by LT is correct.<br>The DUT checks that the received T_PICC is different from the computed<br>MAC(K_MAC', PKeph_PCD). The Chip Authentication must be aborted. UT receives<br>negative result code.<br>The expected result code is '0xE0 00 00 0A' (see chapter 4.2.4).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

| Test ID       | R_CA_3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts chip authentication when LT returns an incorrect<br>cryptogram in response APDU to command General Authenticate.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| References    | [TR-03110-2], 3.3, [TR-03110-3], B.2, [TR-03110-4], 2.1.3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Profiles      | R_PACE AND R_CA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Preconditions | Certificate with universal access rights.<br>The PACE and terminal authentication protocols have been executed successfully in<br>the DUT. After execution of these protocols especially the following smart card and<br>terminal data are available in the DUT:<br>–<br>ephemeral terminal key pair (SKeph_PCD, PKeph_PCD)<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.<br>Terminal Authentication has been successful executed by the DUT.                                                                                         |
| Test scenario | The execution steps have to be performed as described in chapter 4.3.3:<br>All command steps for Chip Authentication have to be executed directly by the DUT<br>without sending commands from the UT. LT receives command APDUs (with SM)<br>from the DUT and sends response APDUs (with SM) back to the DUT. The return<br>codes in all response APDUs are positive ('90 00').<br>LT generates random number r2_PICC and – according to step 7 in chapter 4.3.3 –<br>computes key material K = KA(SK_PICC, PKeph_PCD, D_PICC), key K_MAC =<br>KDF_MAC(K, r2_PICC) and T_PICC = MAC(K_MAC, PKeph_PCD) correctly. LT<br>transmits an incorrect T_PICC', i. e. different from T_PICC, to the DUT. |

|                  | The DUT receives random number r2_PICC and authentication token T_PICC' in<br>response APDU to General Authenticate. The DUT derives key material K =<br>KA(SKeph_PCD, PK_PICC, D_PICC), keys K_MAC = KDF_MAC(K, r2_PICC) and<br>computes MAC(K_MAC, PKeph_PCD).                                                                                                                                                |
|------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | Each command APDU received at LT is correctly coded and secured by SM. The SM<br>in the command APDU generated by the DUT and received by LT is correct.<br>The DUT checks that the received T_PICC' is different from the computed<br>MAC(K_MAC, PKeph_PCD). The Chip Authentication must be aborted. UT receives<br>negative result code.<br>The expected result code is '0xE0 00 00 0A' (see chapter 4.2.4). |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                |

| Test ID       | R_CA_3.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts chip authentication when LT returns an incorrect<br>cryptogram generated with a wrong algorithm in response APDU to command<br>General Authenticate.<br>The values for ChipAuthenticationInfo and<br>ChipAuthenticationDomainParameterInfo within EF.CardAccess of the LT indicates<br>that LT supports exactly one algorithm. But for the generation of T_PICC LT uses<br>another algorithm.<br>The test has to be executed for one algorithm specified in the manufacturer's<br>conformance statement (see chapter 3.2 Cryptographic algorithms). The following<br>substitutions have to be used (algorithm indicated in EF.CardAccess, algorithm used<br>by LT):<br>–<br>id-CA-DH 1, id-CA-DH 2<br>–<br>id-CA-DH 2, id-CA-DH 1<br>–<br>id-CA-DH 3, id-CA-DH 1<br>–<br>id-CA-DH 4, id-CA-DH 1<br>–<br>id-CA-ECDH 1, id-CA-ECDH 2<br>–<br>id-CA-ECDH 2, id-CA-ECDH 1<br>–<br>id-CA-ECDH 3, id-CA-ECDH 1<br>–<br>id-CA-ECDH 4, id-CA-ECDH 1 |
| References    | [TR-03110-2], 3.3, [TR-03110-3], A.1.1.2, A.4, B.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Profiles      | R_PACE AND R_CA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Preconditions | Certificate with universal access rights.<br>The PACE and terminal authentication protocols have been executed successfully in<br>the DUT. After execution of these protocols especially the following smart card and<br>terminal data are available in the DUT:<br>–<br>ephemeral terminal key pair (SKeph_PCD, PKeph_PCD)<br>–<br>PK_PICC (public key of the smart card)<br>–<br>D_PICC (static domain parameters of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.<br>Terminal Authentication has been successful executed by the DUT.                                                                                                                                                                                                                                                                                                                                                               |
| Test scenario | The execution steps have to be performed as described in chapter 4.3.3:<br>All command steps for Chip Authentication have to be executed directly by the DUT<br>without sending commands from the UT. LT receives command APDUs (with SM)<br>from the DUT and sends response APDUs (with SM) back to the DUT. The return<br>codes in all response APDUs are positive ('90 00').                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |

|                  | LT generates random number r2_PICC and – according to step 7 in chapter 4.3.3 –<br>computes key material K = KA(SK_PICC, PKeph_PCD, D_PICC), key K_MAC =<br>KDF_MAC(K, r2_PICC) correctly and T_PICC' = MAC(K_MAC, PKeph_PCD) also<br>correctly, but with a wrong algorithm. LT transmits this incorrect T_PICC' to the<br>DUT.<br>The DUT receives random number r2_PICC and authentication token T_PICC' in<br>response APDU to General Authenticate. The DUT derives key material K =<br>KA(SKeph_PCD, PK_PICC, D_PICC), keys K_MAC = KDF_MAC(K, r2_PICC) and<br>computes MAC(K_MAC, PKeph_PCD). |
|------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | Each command APDU received at LT is correctly coded and secured by SM. The SM<br>in the command APDU generated by the DUT and received by LT is correct.<br>The DUT checks that the received T_PICC' is different from the computed<br>MAC(K_MAC, PKeph_PCD). The Chip Authentication must be aborted. UT receives<br>negative result code.<br>The expected result code is '0xE0 00 00 0A' (see chapter 4.2.4).                                                                                                                                                                                     |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |

| Test ID       | R_CA_3.4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts chip authentication when LT returns an incorrect<br>cryptogram in response APDU to command General Authenticate. The generation of<br>the cryptogram is based on the correct algorithm but LT uses a wrong static key pair.<br>LT stores two static key pairs for chip authentication. This means that in<br>EF.CardAccess two SecurityInfos with ChipAuthenticationInfo and<br>ChipAuthenticationDomainParameterInfo are available and that EF.CardSecurity<br>contains two public keys.<br>For this the related algorithms are identical but the static key pairs are different.<br>The test has to be executed for one chip authentication algorithm specified in the<br>manufacturer's conformance statement (see chapter 3.2 Cryptographic algorithms). |
| References    | [TR-03110-2], 3.3, [TR-03110-3], A.1.1.2, A.4, B.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Profiles      | R_PACE AND R_CA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Preconditions | Certificate with universal access rights.<br>The PACE and terminal authentication protocols have been executed successfully in<br>the DUT. After execution of these protocols especially the following smart card and<br>terminal data are available in the DUT:<br>–<br>ephemeral terminal key pair (SKeph_PCD, PKeph_PCD)<br>–<br>PK_PICC_1 and PK_PICC_2 (public key of the smart card)<br>–<br>keyId_1 and keyId_2 of the related static key pairs<br>–<br>D_PICC_1 and D_PICC_2 (static domain parameters of the smart card)<br>A Secure Messaging Channel (SM) is established between DUT and LT after PACE<br>protocol.<br>Terminal Authentication has been successful executed by the DUT.                                                                                     |
| Test scenario | The execution steps have to be performed as described in chapter 4.3.3:<br>All command steps for Chip Authentication have to be executed directly by the DUT<br>without sending commands from the UT. LT receives command APDUs (with SM)<br>from the DUT and sends response APDUs (with SM) back to the DUT. The return<br>codes in all response APDUs are positive ('90 00').<br>LT generates random number r2_PICC and – according to step 7 in chapter 4.3.3 –<br>computes key material<br>K = KA(SK_PICC_2, PKeph_PCD, D_PICC), if UT identifies keyId_1, or                                                                                                                                                                                                                      |

|                  | K = KA(SK_PICC_1, PKeph_PCD, D_PICC), if UT identifies keyId_2<br>key K_MAC = KDF_MAC(K, r2_PICC) and T_PICC' = MAC(K_MAC, PKeph_PCD)<br>correctly. LT transmits T_PICC' to the DUT.<br>The DUT receives random number r2_PICC and authentication token T_PICC' in<br>response APDU to General Authenticate. UT derives key material<br>K = KA(SKeph_PCD, PK_PICC_1, D_PICC), if the DUT identified keyId_1, or<br>K = KA(SKeph_PCD, PK_PICC_2, D_PICC), if the DUT identified keyId_2,<br>keys K_MAC = KDF_MAC(K, r2_PICC) and computes MAC(K_MAC, PKeph_PCD). |
|------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | The following results are expected:<br>Each command APDU received at LT is correctly coded and secured by SM. The SM<br>in the command APDU generated by the DUT and received by LT is correct.<br>The DUT checks that the received T_PICC' is different from the computed<br>MAC(K_MAC, PKeph_PCD). The Chip Authentication must be aborted. UT receives<br>negative result code.<br>The expected result code is '0xE0 00 00 0A' (see chapter 4.2.4).                                                                                                          |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

### 5.5 Access to the eID Application

### 5.5.1 R\_eID\_1 – Correct Reading Access to eID Data with EAC

| Test ID          | R_eID_1.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check the DUT for correct reading access to eID data with EAC. Use certificate with<br>role Inspection System.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| References       | [TR-03110-4], 2.2, 2.1.3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Profiles         | R_PACE AND R_eID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Preconditions    | Certificate with role Inspection System and access rights according to<br>table 19, No. 1; CA certificates according to table 22, No. 1, 2<br>The PACE, terminal authentication and chip authentication protocols have been<br>executed successfully with MRZ-Password via InBuffer for EstablishPACEChannel.<br>After execution of these protocols, a Secure Messaging Channel (SM) is established<br>between UT and LT.                                                                                                              |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.5:<br>The command sequence described there is subsequently performed with SFIs '01', ,<br>'0C' and '11', , '15' (referencing data groups DG1,, DG12 and DG17,, DG21).<br>UT sends command APDUs to the DUT via PC/SC with SM. LT receives command<br>APDUs with SM from the DUT and sends response APDUs with SM back to the DUT.<br>UT receives response APDUs from the DUT via PC/SC with SM. The return codes in<br>all response APDUs are positive ('90 00'). |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides with the command APDU sent by UT directly before.<br>Each response APDU received at UT is correctly coded and secured by SM and<br>coincides with the response APDU sent by LT directly before.                                                                                                                                                                                                                                                 |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Test ID          | R_eID_1.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

Purpose Check the DUT for correct reading access to eID data with EAC. Use certificate with

|                  | role Authentication Terminal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| References       | [TR-03110-4], 2.2, 2.2.3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Profiles         | R_PACE AND R_eID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1, 2; CA certificates according to table 23, No. 1, 2<br>The PACE, terminal authentication and chip authentication protocols have been<br>executed successfully with PIN as user input via PIN Pad. After execution of these<br>protocols, a Secure Messaging Channel (SM) is established between UT and LT.                                                                                                                             |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.5:<br>The command sequence described there is subsequently performed with SFIs '01', ,<br>'0C' and '11', , '15' (referencing data groups DG1,, DG12 and DG17,, DG21).<br>UT sends command APDUs to the DUT via PC/SC with SM. LT receives command<br>APDUs with SM from the DUT and sends response APDUs with SM back to the DUT.<br>UT receives response APDUs from the DUT via PC/SC with SM. The return codes in<br>all response APDUs are positive ('90 00'). |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides with the command APDU sent by UT directly before.<br>Each response APDU received at UT is correctly coded and secured by SM and<br>coincides with the response APDU sent by LT directly before.                                                                                                                                                                                                                                                 |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |

| Test ID       | R_eID_1.3_template                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check the DUT for correct reading access to eID data with EAC. Use certificate with<br>role Authentication Terminal.<br>In compliance to the Implementation Conformance Statement different algorithms<br>for secure messaging have to be used. The algorithms<br>–<br>3DES<br>–<br>AES – 128<br>–<br>AES – 192<br>–<br>AES – 256<br>have to be tested if supported by the DUT The test has to be performed for each<br>supported algorithm.                                                                                           |
| References    | [TR-03110-4], 2.2, 2.2.3.2, [TR-03110-3], A.4, E.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Profiles      | R_PACE AND R_eID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Preconditions | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1, 2; CA certificates according to table 23, No. 1, 2<br>The PACE, terminal authentication and chip authentication protocols have been<br>executed successfully with password CAN or PIN as user input via PIN Pad. After<br>execution of these protocols, a Secure Messaging Channel (SM) is established<br>between UT and LT.                                                                                                          |
| Test scenario | The execution steps have to be performed as described in chapter 4.3.5:<br>The command sequence described there is subsequently performed with SFIs '01', ,<br>'0C' and '11', , '15' (referencing data groups DG1,, DG12 and DG17,, DG21).<br>UT sends command APDUs to the DUT via PC/SC with SM. LT receives command<br>APDUs with SM from the DUT and sends response APDUs with SM back to the DUT.<br>UT receives response APDUs from the DUT via PC/SC with SM. The return codes in<br>all response APDUs are positive ('90 00'). |

| Expected results | The following results are expected:<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides with the command APDU sent by UT directly before.<br>Each response APDU received at UT is correctly coded and secured by SM and<br>coincides with the response APDU sent by LT directly before. |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                              |

| Test case ID | Algorithm |
|--------------|-----------|
| R_eID_1.3a   | 3DES      |
| R_eID_1.3b   | AES – 128 |
| R_eID_1.3c   | AES – 192 |
| R_eID_1.3d   | AES – 256 |

Table 45: Test case R\_eID\_1.3

### 5.5.2 R\_eID\_2 – Correct Writing Access to eID Data with EAC

| Test ID          | R_eID_2.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check the DUT for correct writing access to eID data with EAC. Use certificate with<br>role Authentication Terminal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| References       | [TR-03110-4], 2.2, 2.2.3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Profiles         | R_PACE AND R_eID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>The PACE, terminal authentication and chip authentication protocols have been<br>executed successfully with CAN or PIN as user input via PIN Pad. After execution of<br>these protocols, a Secure Messaging Channel (SM) is established between UT and LT.<br>The contents of data groups DG17,, DG21 of the smart card at LT are known in UT.                                                                                                      |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.6:<br>The command sequence described there is subsequently performed with SFIs '11', ,<br>'15' (referencing data groups DG17,, DG21). Use new data for each DG. Check the<br>correct execution of the UPDATE BINARY by reading the DG.<br>UT sends command APDUs to the DUT via PC/SC with SM. LT receives command<br>APDUs with SM from the DUT and sends response APDUs with SM back to the DUT.<br>UT receives response APDUs from the DUT via PC/SC with SM. The return codes in<br>all response APDUs are positive ('90 00'). |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides with the command APDU sent by UT directly before.<br>Each response APDU received at UT is correctly coded and secured by SM and<br>coincides with the response APDU sent by LT directly before.<br>Check that the new data in the updated DGs corresponds with the data that was<br>used in the UPDATE BINARY command.                                                                                                                                                                                           |
| Post processing  | The original contents of DG17, , DG21 in the smart card at LT is restored using the<br>command sequence from chapter 4.3.6.<br>Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                         |

### 5.5.3 R\_eID\_3 – Correct Execution of Internal eID Functions

| Test ID          | R_eID_3.1                                                                                                                                                                                                                                                                                                                                                                                                                      |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check the DUT for correct execution of restricted identification for smart cards. Use<br>certificate with role Authentication Terminal.                                                                                                                                                                                                                                                                                        |
| References       | [TR-03110-2], 3.5, [TR-03110-4], 2.2.3.2                                                                                                                                                                                                                                                                                                                                                                                       |
| Profiles         | R_PACE AND R_eID                                                                                                                                                                                                                                                                                                                                                                                                               |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>The PACE, terminal authentication and chip authentication protocols have been<br>executed successfully with Password-IDs CAN or PIN as user input via PIN Pad. After<br>execution of these protocols, a Secure Messaging Channel (SM) is established<br>between UT and LT. |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.7:<br>UT sends command APDUs to the DUT via PC/SC with SM. LT receives command<br>APDUs with SM from the DUT and sends response APDUs with SM back to the DUT.<br>UT receives response APDUs from the DUT via PC/SC with SM. The return codes in<br>all response APDUs are positive ('90 00').                                                            |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides with the command APDU sent by UT directly before.<br>Each response APDU received at UT is correctly coded and secured by SM and<br>coincides with the response APDU sent by LT directly before.                                                                                                                                         |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                               |

| Test ID       | R_eID_3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|---------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check the DUT for correct age verification for card holder. Use certificate with role<br>Authentication Terminal.<br>The test case is performed in several variants for the date of birth to be checked:<br>–<br>date of birth to be checked is smaller than date of birth in smart card – 1<br>–<br>date of birth to be checked coincides with date of birth in smart card – 1<br>–<br>date of birth to be checked coincides with date of birth<br>–<br>date of birth to be checked coincides with date of birth in smart card + 1<br>–<br>date of birth to be checked is greater than date of birth in smart card + 1<br>This test case is only rated as a PASS if all passes are completed successfully.                                                            |
| References    | [TR-03110-4], 2.2.3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Profiles      | R_PACE AND R_eID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Preconditions | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>The PACE, terminal authentication and chip authentication protocols have been<br>executed successfully with Password-IDs CAN or PIN as user input via PIN Pad. After<br>execution of these protocols, a Secure Messaging Channel (SM) is established<br>between UT and LT.<br>In the MSE: Set AT command of the terminal authentication protocol (see<br>chapter 4.3.2) the field <aux_data><br>must be mapped to the following value:<br>73 <L_73> 06 <L_06> <OID> 53 <L_53> <disc_data><br>OID: OID for age verification<br>disc_data: date of birth to be checked (the variants to be checked are defined under |

|                  | Purpose)                                                                                                                                                                                                                                                                                                                                                                                                                         |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.8 (one<br>execution for each variant as defined under Purpose):<br>UT sends command APDUs to the DUT via PC/SC with SM. LT receives command<br>APDUs with SM from the DUT and sends response APDUs with SM back to the DUT.<br>UT receives response APDUs from the DUT via PC/SC with SM. The return codes in<br>all response APDUs are positive ('90 00'). |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides with the command APDU sent by UT directly before.<br>Each response APDU received at UT is correctly coded and secured by SM and<br>coincides with the response APDU sent by LT directly before.                                                                                                                                           |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                 |

| Test ID          | R_eID_3.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check the DUT for correct verification of card holder's community ID. Use certificate<br>with role Authentication Terminal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| References       | [TR-03110-4], 2.2.3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Profiles         | R_PACE AND R_eID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>The PACE, terminal authentication and chip authentication protocols have been<br>executed successfully with CAN or PIN as user input via PIN Pad. After execution of<br>these protocols, a Secure Messaging Channel (SM) is established between UT and LT.<br>In the MSE: Set AT command of the terminal authentication protocol (see<br>chapter 4.3.2) the field <aux_data><br>must be mapped to the following value:<br>73 <L_73> 06 <L_06> <OID> 53 <L_53> <disc_data><br>OID: OID for community ID verification<br>disc_data: community ID to be checked |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.8:<br>UT sends command APDUs to the DUT via PC/SC with SM. LT receives command<br>APDUs with SM from the DUT and sends response APDUs with SM back to the DUT.<br>UT receives response APDUs from the DUT via PC/SC with SM. The return codes in<br>all response APDUs are positive ('90 00').                                                                                                                                                                                                                                                                                                                                              |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides with the command APDU sent by UT directly before.<br>Each response APDU received at UT is correctly coded and secured by SM and<br>coincides with the response APDU sent by LT directly before.                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

### 5.5.4 R\_eID\_4 – Password Management Functions for Authenticated Terminals

The test case in this chapter are only for DUTs which can handle the PIN management function direct and accept AT certificates which have enabled the bit "PIN Management".

| Test ID | R_eID_4.1                                                                                                                                               |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose | Check that an authenticated terminal supports the password management function<br>to change the PIN. Use certificate with role Authentication Terminal. |

| References       | [TR-03110-2], 2.4.2, [TR-03110-4], 2.2.3.2,                                                                                                                                                                                                                                                                                                                                                                                                                    |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Profiles         | R_PACE AND R_eID AND (R_Chg_PIN OR R_PIN_MGT_AT)                                                                                                                                                                                                                                                                                                                                                                                                               |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>The PACE, terminal authentication and chip authentication protocols have been<br>executed successfully with PIN as user input via PIN Pad. After execution of these<br>protocols, a Secure Messaging Channel (SM) is established between UT and LT.                                                        |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.9.1, where the<br>command Reset Retry Counter is performed with P2 = '03' (for changing PIN):<br>UT sends command APDUs to the DUT via PC/SC with SM. LT receives command<br>APDUs with SM from the DUT and sends response APDUs with SM back to the DUT.<br>UT receives response APDUs from the DUT via PC/SC with SM. The return codes in<br>all response APDUs are positive ('90 00'). |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides with the command APDU sent by UT directly before.<br>Each response APDU received at UT is correctly coded and coincides with the<br>response APDU sent by LT directly before.                                                                                                                                                                                           |
| Post processing  | The original PIN is restored in the smart card.<br>Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                            |

| Test ID          | R_eID_4.2                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that an authenticated terminal supports the password management function<br>to change the CAN. Use certificate with role Authentication Terminal.                                                                                                                                                                                                                                                                                                        |
| References       | [TR-03110-2], 2.4.2, [TR-03110-4], 2.2.3.2                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Profiles         | R_PACE AND R_eID AND R_Chg_CAN                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>The PACE, terminal authentication and chip authentication protocols have been<br>executed successfully with Password-ID CAN as user input via PIN Pad. After<br>execution of these protocols, a Secure Messaging Channel (SM) is established<br>between UT and LT.                                         |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.9.1, where the<br>command Reset Retry Counter is performed with P2 = '02' (for changing CAN):<br>UT sends command APDUs to the DUT via PC/SC with SM. LT receives command<br>APDUs with SM from the DUT and sends response APDUs with SM back to the DUT.<br>UT receives response APDUs from the DUT via PC/SC with SM. The return codes in<br>all response APDUs are positive ('90 00'). |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides with the command APDU sent by UT directly before.<br>Each response APDU received at UT is correctly coded and coincides with the<br>response APDU sent by LT directly before.                                                                                                                                                                                           |
| Post processing  | The original CAN is restored in the smart card.<br>Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                            |
|                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

| Test ID | R_eID_4.3                                                                      |
|---------|--------------------------------------------------------------------------------|
| Purpose | Check that an authenticated terminal supports the password management function |

|                  | to unblock the PIN. Use certificate with role Authentication Terminal.                                                                                                                                                                                                                                                                                                                                                                           |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| References       | [TR-03110-2], 2.4.2, [TR-03110-4], 2.2.3.2                                                                                                                                                                                                                                                                                                                                                                                                       |
| Profiles         | R_PACE AND R_eID AND R_PIN_MGT_AT                                                                                                                                                                                                                                                                                                                                                                                                                |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>The PIN is blocked in the smart card.<br>The PACE, terminal authentication and chip authentication protocols have been<br>executed successfully with CAN as user input via PIN Pad. After execution of these<br>protocols, a Secure Messaging Channel (SM) is established between UT and LT. |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.9.2:<br>UT sends command APDUs to the DUT via PC/SC with SM. LT receives command<br>APDUs with SM from the DUT and sends response APDUs with SM back to the DUT.<br>UT receives response APDUs from the DUT via PC/SC with SM. The return codes in<br>all response APDUs are positive ('90 00').                                                                            |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides with the command APDU sent by UT directly before.<br>Each response APDU received at UT is correctly coded and coincides with the<br>response APDU sent by LT directly before.                                                                                                                                                                             |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                 |

| Test ID          | R_eID_4.4                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that an authenticated terminal supports the password management function<br>to activate the PIN. Use certificate with role Authentication Terminal.                                                                                                                                                                                                                                                                                            |
| References       | [TR-03110-2], 2.4.2, [TR-03110-4], 2.2.3.2                                                                                                                                                                                                                                                                                                                                                                                                           |
| Profiles         | R_PACE AND R_eID AND R_PIN_MGT_AT                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>The PIN is deactivated in the smart card.<br>The PACE, terminal authentication and chip authentication protocols have been<br>executed successfully with CAN as user input via PIN Pad. After execution of these<br>protocols, a Secure Messaging Channel (SM) is established between UT and LT. |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.9.3, where the<br>command Activate is performed with (Byte INS = '44'):<br>UT sends command APDUs to the DUT via PC/SC with SM. LT receives command<br>APDUs with SM from the DUT and sends response APDUs with SM back to the DUT.<br>UT receives response APDUs from the DUT via PC/SC with SM. The return codes in<br>all response APDUs are positive ('90 00').             |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides with the command APDU sent by UT directly before.<br>Each response APDU received at UT is correctly coded and secured by SM and<br>coincides with the response APDU sent by LT directly before.                                                                                                                                                               |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                     |

| Test ID | R_eID_4.5                                                                                                                                                   |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose | Check that an authenticated terminal supports the password management function<br>to deactivate the PIN. Use certificate with role Authentication Terminal. |

| References       | [TR-03110-2], 2.4.2, [TR-03110-4], 2.2.3.2                                                                                                                                                                                                                                                                                                                                                                                                 |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Profiles         | R_PACE AND R_eID AND R_PIN_MGT_AT                                                                                                                                                                                                                                                                                                                                                                                                          |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>The PACE, terminal authentication and chip authentication protocols have been<br>executed successfully with PIN as user input via PIN Pad. After execution of these<br>protocols, a Secure Messaging Channel (SM) is established between UT and LT.                                    |
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.9.3, where the<br>command Deactivate is performed with (Byte INS = '04'):<br>UT sends command APDUs to the DUT via PC/SC with SM. LT receives command<br>APDUs with SM from the DUT and sends response APDUs with SM back to the DUT.<br>UT receives response APDUs from the DUT via PC/SC with SM. The return codes in<br>all response APDUs are positive ('90 00'). |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides with the command APDU sent by UT directly before.<br>Each response APDU received at UT is correctly coded and secured by SM and<br>coincides with the response APDU sent by LT directly before.                                                                                                                                                     |
| Post processing  | The deactivated PIN is activated again.<br>Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                |

#### 5.5.5 R\_eID\_5 – Password Management Functions for Unauthenticated Terminals after PACE

| Test ID          | R_eID_5.1                                                                                                                                                                                                                                                                                                                                                                                                              |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that an unauthenticated terminal supports the password management<br>function to change the PIN. The current PIN is not a transport PIN.                                                                                                                                                                                                                                                                         |
| References       | [TR-03110-2], 2.4.1, [PCSC10]                                                                                                                                                                                                                                                                                                                                                                                          |
| Profiles         | R_PACE AND R_eID AND R_PIN_MGT_uT                                                                                                                                                                                                                                                                                                                                                                                      |
| Preconditions    | The PACE protocol has been executed successfully with PIN as user input via PIN<br>Pad, where the PIN is not a transport PIN. After execution of this protocol, a Secure<br>Messaging Channel (SM) is established between DUT and LT.                                                                                                                                                                                  |
| Test scenario    | UT sends command FEATURE_MODIFY_PIN_DIRECT to the DUT via PC/SC. Since<br>the SM channel is established with the current active PIN, only the new PIN shall be<br>requested as user input.<br>LT receives command APDUs with SM from the DUT and sends response APDUs<br>with SM back to the DUT. UT receives response APDUs from the DUT via PC/SC. The<br>return codes in all response APDUs are positive ('90 00'). |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides with the command APDU sent by UT directly before.<br>Each response APDU received at UT is correctly coded and coincides with the<br>response APDU sent by LT directly before.                                                                                                                                                   |
| Post processing  | The original PIN is restored in the smart card.<br>Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                    |
|                  |                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Test ID          | R_eID_5.2                                                                                                                                                                                                                                                                                                                                                                                                              |

|                  | function to change the PIN. The current PIN is a transport PIN.                                                                                                                                                                                                                                                                                                                                                        |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| References       | [TR-03110-2], 2.4.1; [PCSC10]                                                                                                                                                                                                                                                                                                                                                                                          |
| Profiles         | R_PACE AND R_eID AND R_PIN_MGT_uT                                                                                                                                                                                                                                                                                                                                                                                      |
| Preconditions    | The PACE protocol has been executed successfully with PIN as user input via PIN<br>Pad, where the PIN is a transport PIN. After execution of this protocol, a Secure<br>Messaging Channel (SM) is established between DUT and LT.                                                                                                                                                                                      |
| Test scenario    | UT sends command FEATURE_MODIFY_PIN_DIRECT to the DUT via PC/SC. Since<br>the SM channel is established with the current active PIN, only the new PIN shall be<br>requested as user input.<br>LT receives command APDUs with SM from the DUT and sends response APDUs<br>with SM back to the DUT. UT receives response APDUs from the DUT via PC/SC. The<br>return codes in all response APDUs are positive ('90 00'). |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides with the command APDU sent by UT directly before.<br>Each response APDU received at UT is correctly coded and coincides with the<br>response APDU sent by LT directly before.                                                                                                                                                   |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                       |

| Test ID          | R_eID_5.3                                                                                                                                                                                                                                                                                      |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that an unauthenticated terminal supports the password management<br>function to reset the retry counter for the PIN using the PUK.                                                                                                                                                      |
| References       | [TR-03110-2], 2.4.1, [PCSC10]                                                                                                                                                                                                                                                                  |
| Profiles         | R_PACE AND R_eID AND R_PIN_MGT_uT                                                                                                                                                                                                                                                              |
| Preconditions    | The PIN is blocked in the smart card.<br>The PACE protocol has been executed successfully with PUK as user input via PIN<br>Pad. After execution of this protocol, a Secure Messaging Channel (SM) is established<br>between DUT and LT.                                                       |
| Test scenario    | UT sends command APDU "Reset Retry Counter" without SM to the DUT. LT<br>receives command APDUs with SM from the DUT and sends response APDUs with<br>SM back to the DUT. UT receives response APDUs from the DUT via PC/SC. The<br>return codes in all response APDUs are positive ('90 00'). |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides with the command APDU sent by UT directly before.<br>Each response APDU received at UT is correctly coded and coincides with the<br>response APDU sent by LT directly before.                           |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                               |

| Test ID       | R_eID_5.4                                                                                                                                                                |
|---------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that an unauthenticated terminal supports the password management<br>function to set a new PIN using the PUK.                                                      |
| References    | [TR-03110-2], 2.4.1, [PCSC10]                                                                                                                                            |
| Profiles      | R_PACE AND R_eID AND R_UNLK_PIN_PUK                                                                                                                                      |
| Preconditions | The PACE protocol has been executed successfully with PUK as user input via PIN<br>Pad. After execution of this protocol, a Secure Messaging Channel (SM) is established |

|                  | between DUT and LT.                                                                                                                                                                                                                                                                                                                                                                                     |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Test scenario    | UT sends command FEATURE_MODIFY_PIN_DIRECT to the DUT via PC/SC. Since<br>the SM channel is established with the PUK, only the new PIN shall be requested as<br>user input.<br>LT receives command APDUs with SM from the DUT and sends response APDUs<br>with SM back to the DUT. UT receives response APDUs from the DUT via PC/SC. The<br>return codes in all response APDUs are positive ('90 00'). |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides with the command APDU sent by UT directly before.<br>Each response APDU received at UT is correctly coded and coincides with the<br>response APDU sent by LT directly before.                                                                                                                                    |
| Post processing  | The original PIN is restored in the smart card.<br>Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                     |

| Test ID          | R_eID_5.5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that an unauthenticated terminal resumes temporarily a PIN using the CAN.<br>The test is executed with the CAN. It calls an extension of the PC/SC function<br>SCardControl where the CAN is transmitted as user input via the PIN Pad of the<br>DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| References       | [TR-03110-2], 2.4.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Profiles         | R_PACE AND R_eID AND R_PIN_MGT_uT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Preconditions    | The PIN is suspended (retry counter = 1).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (since CAN is used)<br>•<br><CHAT>: empty<br>•<br><PIN>: empty, password is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: empty<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. The return codes in all response APDUs are<br>positive ('90 00').<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4).                                                                                                                                                                                                                                                                                             |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '02', since CAN<br>is used.<br>•<br>The data object with tag 7F 4C is missing in command APDU to MSE: Set<br>AT (since CHAT is empty).<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i. e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>•<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the<br>smart card.<br>•<br><IDPICC>: The field contains the correct ID_PICC. |

| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Test ID          | R_eID_5.6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Purpose          | Check that an unauthenticated terminal resumes a temporarily resumed PIN by<br>using it in PACE protocol. This PACE protocol is performed with Secure Messaging<br>(SM) where the SM keys have been derived by execution of another PACE protocol<br>with the CAN. The test case assumes, as specified in the Precondition, that the PACE<br>protocol with CAN has been executed before test start.<br>The test is executed with the PIN. It calls an extension of the PC/SC function<br>SCardControl where the PIN is transmitted as user input via the PIN Pad of the DUT.                                                                                                                                                                                                                                                                                                                                                                                            |
| References       | [TR-03110-2], 2.4.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Profiles         | R_PACE AND R_eID AND R_PIN_MGT_uT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Preconditions    | First a suspended PIN has been used (i. e. retry counter = 1).<br>Then the PACE protocol has been executed successfully with Password-ID CAN to<br>temporarily resume the PIN. After execution of this protocol, a Secure Messaging<br>Channel (SM) is established between DUT and LT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '03' (since PIN is used)<br>•<br><CHAT>: empty<br>•<br><PIN>:empty, password is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: empty<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. The return codes in all response APDUs are<br>positive ('90 00'). All command and response APDUs are secured with Secure<br>Messaging where SM keys are used that have have been derived in the PACE<br>protocol with CAN according to Precondition.<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4).                                                                                                                                                                                  |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '03', since PIN is<br>used.<br>•<br>The data object with tag 7F 4C is missing in command APDU to MSE: Set<br>AT (since CHAT is empty).<br>•<br>All command APDUs are secured correctly with Secure Messaging.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i. e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '63 C1'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>•<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the<br>smart card.<br>•<br><IDPICC>: The field contains the correct ID_PICC. |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

92 Bundesamt für Sicherheit in der Informationstechnik

Test ID R\_eID\_5.7

| Purpose          | Check that an unauthenticated terminal resumes a temporarily resumed PIN by<br>using it in PACE protocol. This PACE protocol is performed with Secure Messaging<br>(SM) where the SM keys have been derived by execution of another PACE protocol<br>with the CAN. The test case assumes, as specified in the Precondition, that the PACE<br>protocol with CAN has been executed before test start.<br>In the test case a first attempt to resume the temporarily resumed PIN is answered<br>by an error code from LT. A second attempt to resume the PIN shall be performed<br>with the SM keys derived in the PACE protocol with the CAN.<br>The test is executed with the PIN. It calls an extension of the PC/SC function<br>SCardControl where the PIN is transmitted as user input via the PIN Pad of the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| References       | [TR-03110-2], 2.4.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Profiles         | R_PACE AND R_eID AND R_PIN_MGT_uT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Preconditions    | First a suspended PIN has been used (i. e. retry counter = 1).<br>Then the PACE protocol has been executed successfully with Password-ID CAN to<br>temporarily resume the PIN. After execution of this protocol, a Secure Messaging<br>Channel (SM) is established between DUT and LT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows (first<br>attempt to resume PIN):<br>•<br><Password-ID>: '03' (since PIN is used)<br>•<br><CHAT>: empty<br>•<br><PIN>: empty, password is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: empty<br>2.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. The return code in the response APDU to<br>MSE: Set AT is negative ('6A 00'). The command and response APDU to MSE: Set<br>AT are secured with Secure Messaging where SM keys are used that have have<br>been derived in the PACE protocol with CAN according to Precondition.<br>3.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4).<br>4.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows (second<br>attempt to resume PIN):<br>•<br><Password-ID>: '03' (since PIN is used)<br>•<br><CHAT>: empty<br>•<br><PIN>: empty, password is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: empty<br>5.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. All command and response APDUs are<br>secured with Secure Messaging where SM keys are used that have have been<br>derived in the PACE protocol with CAN according to Precondition.<br>6.<br>UT receives OutBuffer of SCardControl (see chapter 4.2.4). |
| Expected results | 1.<br>-<br>2.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The command APDU to MSE: Set AT is sent by the DUT.<br>•<br>The command APDU to MSE: Set AT is secured correctly with Secure<br>Messaging.<br>3.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is negative.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

|                 | •<br><data_card_acc>, <CAR1>, <CAR2> and<br><IDPICC>:<br>The fields are empty.<br>4.<br>-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                 | 5.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '03', since PIN is<br>used.<br>•<br>The data object with tag 7F 4C is missing in command APDU to MSE: Set<br>AT (since CHAT is empty).<br>•<br>All command APDUs are secured correctly with Secure Messaging where the<br>SM keys are the same as in step 2.<br>6.<br>For the OutBuffer of SCardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i. e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '63 C1'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>•<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the |
|                 | smart card.<br>•<br><IDPICC>: The field contains the correct ID_PICC.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Post processing | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |

| Test ID          | R_eID_5.8                                                                                                                                                                                               |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that an unauthenticated terminal aborts the password management function<br>to change the PIN if the new PIN was submitted by the UT.                                                             |
| References       | [TR-03110-2], 2.4.1                                                                                                                                                                                     |
| Profiles         | R_PACE AND R_eID AND R_PIN_MGT_uT                                                                                                                                                                       |
| Preconditions    | The PACE protocol has been executed successfully with eID-PIN as user input via<br>PIN Pad. After execution of this protocol, a Secure Messaging Channel (SM) is<br>established between DUT and LT.     |
| Test scenario    | UT sends command APDU "Reset Retry Counter" with new PIN as described in<br>chapter 4.3.9.1 (P2 = '03') without SM to the DUT. The DUT receives the command<br>APDU sends response APDU back to the UT. |
| Expected results | The DUT returns error code 0x6982.                                                                                                                                                                      |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                        |

### 5.6 Access to Biometric Data

#### 5.6.1 R\_bio\_1 – Correct Reading Access to Biometric Data with EAC

| Test ID    | R_bio_1.1                                                                                                                                                                               |
|------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose    | Check the DUT for correct reading access to biometric data Fingerprint (DG 3) and<br>Iris (DG 4) of the ePassport application with EAC. Use certificate with role Inspection<br>System. |
| References | [TR-03110-4], 2.1.3.2                                                                                                                                                                   |
| Profiles   | R_PACE AND R_bio                                                                                                                                                                        |

| Preconditions    | Certificate with role Inspection System and access rights according to<br>table 19, No. 1; CA certificates according to table 22, No. 1, 2<br>The PACE, terminal authentication and chip authentication protocols have been<br>executed successfully with CAN. After execution of these protocols, a Secure<br>Messaging Channel (SM) is established between UT and LT.                                                                                                                                         |
|------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Test scenario    | The execution steps have to be performed as described in chapter 4.3.10:<br>The command sequence described there is subsequently performed with SFIs<br>referencing data groups DG 3 (Fingerprint) and DG 4 (Iris).<br>UT sends command APDUs to the DUT via PC/SC with SM. LT receives command<br>APDUs with SM from the DUT and sends response APDUs with SM back to the DUT.<br>UT receives response APDUs from the DUT via PC/SC with SM. The return codes in<br>all response APDUs are positive ('90 00'). |
| Expected results | Each command APDU received at LT is correctly coded and secured by SM and<br>coincides with the command APDU sent by UT directly before.<br>Each response APDU received at UT is correctly coded and secured by SM and<br>coincides with the response APDU sent by LT directly before.                                                                                                                                                                                                                          |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

### 5.7 Use of the Digital Signature Application

### 5.7.1 R\_Sig\_1 – Successful Key Pair Generation

| Test ID       | R_Sig_1.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check correct execution of authentication protocols PACE, TA and CA with<br>Authentication Terminal of the QCA and LT.<br>PACE between the DUT and LT, TA and CA between Authentication Terminal and LT.<br>Use of certificate with role Authentication Terminal with access right "Install<br>Qualified Certificate".<br>The test for the PACE protocol is executed with Password-ID PIN.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| References    | [TR-03117], 4.3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Profiles      | R_PACE AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Preconditions | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>Make certificates available in UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Test scenario | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '03' (PIN is used)<br>•<br><CHAT>: Restricted CHAT: at least "Install Qualified Certificate" and the<br>smart card-User related data requested from the QCA (DG1 to DG21)<br>•<br><PIN>: empty, because password (PIN) is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>Entering the correct PIN into the DUT.<br>3.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. The return codes in all response APDUs are<br>positive ('90 00').<br>4.<br>UT receives OutBuffer of ScardControl (see chapter 4.2.4).<br>5.<br>The execution steps for terminal authentication have to be performed as<br>described in chapter 4.3.2: |

|                  | UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').<br>6.<br>The execution steps for chip authentication have to be performed as described in<br>chapter 4.3.3:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').<br>Moreover UT generates the keys K_MAC and K_ENC for subsequent secure<br>messaging as described in step 10 of chapter 4.3.3.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>-<br>2.<br>-<br>3.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '03' (PIN).<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '02'<br>(Authentication Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 20, No. 1.<br>4.<br>For the OutBuffer of ScardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i.e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>•<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the<br>smart card.<br>•<br><IDPICC>: The field contains the correct ID_PICC.<br>5.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.<br>6.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before. |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

| Test ID | R_Sig_1.2                                                                                                                                                                                                                                                                                                                                                                                     |
|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose | Check access with the Authentication Terminal of the QCA to the necessary<br>identification data of the smart card-User (DG1 to DG21).<br>PACE between the DUT and LT, TA and CA between Authentication Terminal and LT.<br>Use of certificate with role Authentication Terminal with access right "Install<br>Qualified Certificate".<br>The PACE protocol is executed with Password-ID PIN. |

| References       | [TR-03110-4], 2.2, [TR-03117], 4.3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Profiles         | R_PACE AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>Make certificates available in UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '03' (PIN is used)<br>•<br><CHAT>: Restricted CHAT: at least "Install Qualified Certificate" and the<br>smart card-User related data (DG1 to DG21)<br>•<br><PIN>: empty, because password (PIN) is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>Entering the correct PIN into the DUT.<br>3.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. The return codes in all response APDUs are<br>positive ('90 00').<br>4.<br>UT receives OutBuffer of ScardControl (see chapter 4.2.4).<br>5.<br>The execution steps for terminal authentication have to be performed as<br>described in chapter 4.3.2:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').<br>6.<br>The execution steps for chip authentication have to be performed as described in<br>chapter 4.3.3:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').<br>Moreover UT generates the keys K_MAC and K_ENC for subsequent secure<br>messaging as described in step 10 of chapter 4.3.3.<br>7.<br>UT sends command SELECT to the smart card:<br>'0C A4 04 0C <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00'<br>with 'E80704007F00070302' = AID of DF.eID<br>8.<br>UT sends READ BINARY commands to the smart card to retrieve data DG1 to<br>DG21 from the eID application:<br>READ BINARY: '0C B0 P1 00 <Lc> 97 01 00 8E 08 <MAC> 00'<br>with P1 = '8 <SFI>'. Read all Data Groups which are available on the chip (usually<br>DG1 to 12 and 17 to 21). |
| Expected results | 1.<br>-<br>2.<br>-<br>3.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '03' (PIN).<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '02'<br>(Authentication Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 20, No. 1.<br>4.<br>For the OutBuffer of ScardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i.e. '00 00 00 00').                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

|                 | •<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>•<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the<br>smart card.<br>•<br><IDPICC>: The field contains the correct ID_PICC.                                               |
|-----------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                 | 5.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before. |
|                 | 6.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct.<br>Each response APDU received at UT is correctly coded without SM and coincides                                                                     |
|                 | apart from SM with the response APDU sent by LT directly before.<br>7.<br>The response APDU of the command SELECT is positive. Response APDU for<br>SELECT is:                                                                                                                                                                                                                                         |
|                 | 99 02 90 00 8E 08 <MAC> 90 00<br>8.<br>The response APDUs of the READ BINARY commands are all positive. Response<br>APDU for READ BINARY DG_x is:<br>87 <L87> 01 <Cryptogram of DG_x> 99 02 90 00 8E 08 <MAC> 90 00                                                                                                                                                                                    |
| Post processing | The decrypted and reformatted data coincide with the related data of DG_x in LT.<br>Reset of smart card and the DUT                                                                                                                                                                                                                                                                                    |
|                 |                                                                                                                                                                                                                                                                                                                                                                                                        |

| Test ID       | R_Sig_1.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check access with the Authentication Terminal of the QCA to the signature<br>application of the smart card for key generation.<br>PACE between the DUT and LT, TA and CA between Authentication Terminal and LT.<br>Use of certificate with role Authentication Terminal with access right "Install<br>Qualified Certificate".<br>The PACE protocol is executed with Password-ID PIN.                                                                                                                                                         |
| References    | [TR-03117], 4.3.2, A.2.5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Profiles      | R_PACE AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Preconditions | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>Make certificates available in UT.<br>Status of eSign-PIN in LT is "operational".<br>Status of signature key in LT is "terminated".                                                                                                                                                                                                                                                       |
| Test scenario | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '03' (PIN is used)<br>•<br><CHAT>: Restricted CHAT: at least "Install Qualified Certificate" and the<br>smart card-User related data (DG1 to DG21)<br>•<br><PIN>: empty, because password (PIN) is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>Entering the correct PIN into the DUT. |

|                  | 3.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. The return codes in all response APDUs are<br>positive ('90 00').<br>4.<br>UT receives OutBuffer of ScardControl (see chapter 4.2.4).<br>5.<br>The execution steps for terminal authentication have to be performed as<br>described in chapter 4.3.2:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                  | SM). The return codes in all response APDUs are positive ('90 00').<br>6.<br>The execution steps for chip authentication have to be performed as described in                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|                  | chapter 4.3.3:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').<br>Moreover UT generates the keys K_MAC and K_ENC for subsequent secure<br>messaging as described in step 10 of chapter 4.3.3.<br>7.<br>UT sends SELECT to the smart card:                                                                                                              |
|                  | '0C A4 04 0C <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00'<br>with 'A0 00 00 01 67 45 53 49 47 4E' = AID of DF.eSign                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                  | 8.<br>UT sends the command GENERATE ASYMMETRIC KEY PAIR to the smart card<br>Command APDU GENERATE ASYMMETRIC KEY PAIR:<br>'0C 47 82 00 <Lc> 87 <L87> 01 <Cryptogram> 97 <L97> <Le> 8E 08 <MAC> 00'<br>with Data (in plaintext):<br>B6 <LB6> 84 <L84> <private key reference>   <br>'7F 49': data related to the key to be generated (optional)                                                                                                                                                                                                                                                                  |
| Expected results | 1.<br>-<br>2.<br>-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|                  | 3.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '03' (PIN).<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '02'<br>(Authentication Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 20, No. 1.                                                                                                                                                                                                  |
|                  | 4.<br>For the OutBuffer of ScardControl, that UT receives (see chapter 4.2.4), the                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|                  | following holds:<br>•<br><Result_Code>: The result code is positive (i.e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>•<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the<br>smart card.                                                                                                                                                                                                                      |
|                  | •<br><IDPICC>: The field contains the correct ID_PICC.<br>5.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.<br>6.<br>Each command APDU received at LT is correctly coded and secured by SM and                                                              |

|                 | coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct. |
|-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                 | Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.              |
|                 | 7.<br>The response of the command SELECT is positive. Response APDU for SELECT is:                                                                             |
|                 | '99 02 90 00 8E 08 <MAC> 90 00'                                                                                                                                |
|                 | 8.<br>The response of the command GENERATE ASYMMETRIC KEY PAIR is positive:<br>Response APDU for GENERATE ASYMMETRIC KEY PAIR is:                              |
|                 | 87 <L87> 01 <Cryptogram of Public Key Data Object> 99 02 90 00 8E 08 <MAC> 90<br>00                                                                            |
|                 | Public Key Data Object:                                                                                                                                        |
|                 | '7F 49' <L7F 49> <Public Key>                                                                                                                                  |
|                 | The decrypted and reformatted data coincide with the public key data object of<br>the signature key in the eSign application in LT.                            |
| Post processing | Termination of the signature key in the smart card.<br>Reset of smart card and the DUT.                                                                        |

#### 5.7.2 R\_Sig\_2 – Abort Key Pair Generation

| Test ID       | R_Sig_2.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts key pair generation if it the Authentication Terminal<br>does not have the access right "Install Qualified Certificate".<br>PACE between the DUT and LT, TA and CA between Authentication Terminal and LT.<br>Use of certificate with role Authentication Terminal without access right "Install<br>Qualified Certificate".<br>The PACE protocol is executed with Password-ID PIN.                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| References    | [TR-03117], 4.3.2, A.2.5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Profiles      | R_PACE AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Preconditions | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 3; CA certificates according to table 23, No. 1, 2<br>Make certificates available in UT.<br>Status of eSign-PIN in LT is "operational".<br>Status of signature key in LT is "terminated".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Test scenario | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '03' (PIN is used)<br>•<br><CHAT>: Restricted CHAT: at least the smart card-User related data (DG1 to<br>DG21)<br>•<br><PIN>: empty, because password (PIN) is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>Entering the correct PIN into the the DUT.<br>3.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. The return codes in all response APDUs are<br>positive ('90 00').<br>4.<br>UT receives OutBuffer of ScardControl (see chapter 4.2.4).<br>5.<br>The execution steps for terminal authentication have to be performed as |

|                  | described in chapter 4.3.2:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').<br>6.<br>The execution steps for chip authentication have to be performed as described in<br>chapter 4.3.3:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').<br>Moreover UT generates the keys K_MAC and K_ENC for subsequent secure<br>messaging as described in step 10 of chapter 4.3.3.<br>7.<br>UT sends the command SELECT to the smart card:<br>'0C A4 04 0C <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00'<br>with 'A0 00 00 01 67 45 53 49 47 4E' = AID of DF.eSign<br>8.<br>UT sends command GENERATE ASYMMETRIC KEY PAIR to the smart card:<br>'0C 47 82 00 <Lc> 87 <L87> 01 <Cryptogram> 97 <L97> <Le> 8E 08 <MAC> 00'<br>with Data (in plaintext):<br>B6 <LB6> 84 <L84> <private key reference>   <br>'7F 49': data related to the key to be generated (optional) |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>-<br>2.<br>-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                  | 3.<br>The command APDUs which LT receives from the DUT are built up as described                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                  | in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '03' (PIN).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                  | •<br>The role in <OID-Role> in command APDU to MSE: Set AT is '02'<br>(Authentication Terminal).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                  | •<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 20, No. 3.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                  | 4.<br>For the OutBuffer of ScardControl, that UT receives (see chapter 4.2.4), the<br>following holds:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                  | •<br><Result_Code>: The result code is positive (i.e. '00 00 00 00').                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                  | •<br><status_mse>: The status code for command MSE: Set AT is '90 00'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                  | •<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                  | •<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                  | smart card.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|                  | •<br><IDPICC>: The field contains the correct ID_PICC.<br>5.<br>Each command APDU received at LT is correctly coded and secured by SM and                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|                  | coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|                  | Each response APDU received at UT is correctly coded without SM and coincides                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                  | apart from SM with the response APDU sent by LT directly before.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                  | 6.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                  | The SM in the command APDU generated by the DUT and received by LT is                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                  | correct.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                  | Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                  | 7.<br>The response of the command SELECT is positive. Response APDU for SELECT is:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |

|                 | '99 02 90 00 8E 08 <MAC> 90 00'<br>8.<br>The response APDU of the command GENERATE ASYMMETRIC KEY PAIR is<br>negative ('69 82', Security Status not satisfied). Response APDU for GENERATE<br>ASYMMETRIC KEY PAIR is:<br>99 02 69 82 8E 08 <MAC> 69 82 |
|-----------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Post processing | Reset of smart card and the DUT.                                                                                                                                                                                                                       |

| Test ID       | R_Sig_2.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts key pair generation if the Authentication Terminal have<br>the access right "Install Qualified Certificate" but the PACE protocol is performed<br>with the CAN (instead of the PIN).<br>PACE between the DUT and LT, TA and CA between Authentication Terminal and LT.<br>Use of certificate with role Authentication Terminal with access right "Install<br>Qualified Certificate".<br>The PACE protocol is executed with Password-ID CAN.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| References    | [TR-03117], 4.3.2, A.2.5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Profiles      | R_PACE AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Preconditions | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>Make certificates available in UT.<br>Status of eSign-PIN in LT is "operational".<br>Status of signature key in LT is "terminated".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Test scenario | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (CAN is used)<br>•<br><CHAT>: Restricted CHAT: at least "Install Qualified Certificate" and the<br>smart card-User related data (DG1 to DG21)<br>•<br><PIN>: empty, because password (CAN) is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>Entering the correct CAN into the DUT.<br>3.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. The return codes in all response APDUs are<br>positive ('90 00').<br>4.<br>UT receives OutBuffer of ScardControl (see chapter 4.2.4).<br>5.<br>The execution steps for terminal authentication have to be performed as<br>described in chapter 4.3.2:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').<br>6.<br>The execution steps for chip authentication have to be performed as described in<br>chapter 4.3.3:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').<br>Moreover UT generates the keys K_MAC and K_ENC for subsequent secure<br>messaging as described in step 10 of chapter 4.3.3. |

|                  | 7.<br>UT sends command SELECT to the smart card:<br>'0C A4 04 0C <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00'<br>with 'A0 00 00 01 67 45 53 49 47 4E' = AID of DF.eSign<br>8.<br>UT sends command GENERATE ASYMMETRIC KEY PAIR to the smart card:<br>'0C 47 82 00 <Lc> 87 <L87> 01 <Cryptogram> 97 <L97> <Le> 8E 08 <MAC> 00'<br>with Data (in plaintext):<br>B6 <LB6> 84 <L84> <private key reference>   <br>'7F 49': data related to the key to be generated (optional)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|                  | 2.<br>-<br>3.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '02' (CAN).<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '02'<br>(Authentication Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 20, No. 1.<br>4.<br>For the OutBuffer of ScardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i.e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>•<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the<br>smart card.<br>•<br><IDPICC>: The field contains the correct ID_PICC.<br>5.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.<br>6.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.<br>7.<br>The response of the command SELECT is positive. Response APDU for SELECT is:<br>'99 02 90 00 8E 08 <MAC> 90 00'<br>8.<br>The response of the command GENERATE ASYMMETRIC KEY PAIR is negative<br>('69 82', Security Status not satisfied). Response APDU for GENERATE<br>ASYMMETRIC KEY PAIR is:<br>99 02 69 82 8E 08 <MAC> 69 82 |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Test ID          | R_Sig_2.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

| Purpose | Check that the DUT aborts key pair generation if the eSign application could not be |
|---------|-------------------------------------------------------------------------------------|
|         | selected.                                                                           |
|         | PACE between the DUT and LT, TA and CA between Authentication Terminal and LT.      |

|                  | Use of certificate with role Authentication Terminal with access right "Install<br>Qualified Certificate".<br>The PACE protocol is executed with Password-ID PIN.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| References       | [TR-03117], 4.3.2, A.2.5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Profiles         | R_PACE AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Preconditions    | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>Make certificates available in UT.<br>Status of eSign-PIN in LT is "operational".<br>Status of signature key in LT is "terminated".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '03' (PIN is used)<br>•<br><CHAT>: Restricted CHAT: at least "Install Qualified Certificate" and the<br>smart card-User related data (DG1 to DG21)<br>•<br><PIN>: empty, because password (PIN) is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>Entering the correct PIN into the the DUT.<br>3.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. The return codes in all response APDUs are<br>positive ('90 00').<br>4.<br>UT receives OutBuffer of ScardControl (see chapter 4.2.4).<br>5.<br>The execution steps for terminal authentication have to be performed as<br>described in chapter 4.3.2:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').<br>6.<br>The execution steps for chip authentication have to be performed as described in<br>chapter 4.3.3:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').<br>Moreover UT generates the keys K_MAC and K_ENC for subsequent secure<br>messaging as described in step 10 of chapter 4.3.3.<br>7.<br>UT sends command SELECT to the smart card:<br>'0C A4 04 0C <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00'<br>with '4E 47 49 53 45 67 01 00 00 A0' = Incorrect AID of DF.eSign |
| Expected results | 1.<br>-<br>2.<br>-<br>3.<br>The command APDUs which LT receives from the DUT are built up as described                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|                  | in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '03' (PIN).<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '02'<br>(Authentication Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 20, No. 1.<br>4.<br>For the OutBuffer of ScardControl, that UT receives (see chapter 4.2.4), the<br>following holds:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |

|                 | •<br><Result_Code>: The result code is positive (i.e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>•<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the<br>smart card.<br>•<br><IDPICC>: The field contains the correct ID_PICC.<br>5.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.<br>6.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.<br>7.<br>The response APDU of the command SELECT is negative('6A 82', File or<br>application not found). Response APDU for SELECT is:<br>'99 02 6A 82 8E 08 <MAC> 6A 82' |
|-----------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Post processing | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |

| Test ID       | R_Sig_2.4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts key pair generation if the LT returns an error code to the<br>command Generate Asymmetric Key Pair.<br>PACE between the DUT and LT, TA and CA between Authentication Terminal and LT.<br>Use of certificate with role Authentication Terminal with access right "Install<br>Qualified Certificate".<br>The PACE protocol is executed with Password-ID PIN.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| References    | [TR-03117], 4.3.2, A.2.5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Profiles      | R_PACE AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Preconditions | Certificate with role Authentication Terminal and access rights according to<br>table 20, No. 1; CA certificates according to table 23, No. 1, 2<br>Make certificates available in UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Test scenario | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '03' (PIN is used)<br>•<br><CHAT>: Restricted CHAT: at least "Install Qualified Certificate" and the<br>smart card-User related data (DG1 to DG21)<br>•<br><PIN>: empty, because password (PIN) is entered via PIN Pad of the DUT<br>•<br><CERT_DESC>: List of certificates as specified in Profiles<br>2.<br>Entering the correct PIN into the DUT.<br>3.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapter 4.3.1. The return codes in all response APDUs are<br>positive ('90 00').<br>4.<br>UT receives OutBuffer of ScardControl (see chapter 4.2.4).<br>5.<br>The execution steps for terminal authentication have to be performed as |

|                  | described in chapter 4.3.2:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').<br>6.<br>The execution steps for chip authentication have to be performed as described in<br>chapter 4.3.3:<br>UT sends command APDUs to the DUT via PC/SC (without SM). LT receives<br>command APDUs (with SM) from the DUT and sends response APDUs (with SM)<br>back to the DUT. UT receives response APDUs from the DUT via PC/SC (without<br>SM). The return codes in all response APDUs are positive ('90 00').<br>Moreover UT generates the keys K_MAC and K_ENC for subsequent secure<br>messaging as described in step 10 of chapter 4.3.3.<br>7.<br>UT sends command SELECT to the smart card:<br>'0C A4 04 0C <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00'<br>with 'A0 00 00 01 67 45 53 49 47 4E' = AID of DF.eSign<br>8.<br>UT sends command GENERATE ASYMMETRIC KEY PAIR to the smart card:<br>'0C 47 82 00 <Lc> 87 <L87> 01 <Cryptogram> 97 <L97> <Le> 8E 08 <MAC> 00'<br>with Data (in plaintext):<br>B6 <LB6> 84 <L84> <private key reference>   <br>'7F 49': data related to the key to be generated (optional)<br>9.<br>The LT returns an error code to the DUT, the response APDU is built up as<br>follows:<br>'99 02 SW1 SW2 8E 08 <MAC> SW1 SW2' with<br>SW1 SW2 = '69 84' (Reference data not usable) or<br>SW1 SW2 = '6A 88' (Referenced data not found) |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>-<br>2.<br>-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                  | 3.<br>The command APDUs which LT receives from the DUT are built up as described<br>in chapter 4.3.1 with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '03' (PIN).<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '02'<br>(Authentication Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                  | in table 20, No. 1.<br>4.<br>For the OutBuffer of ScardControl, that UT receives (see chapter 4.2.4), the<br>following holds:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                  | •<br><Result_Code>: The result code is positive (i.e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>•<br><CAR1> and <CAR2>: The current and previous CAR are as defined in the                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                  | smart card.<br>•<br><IDPICC>: The field contains the correct ID_PICC.<br>5.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                  | correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.<br>6.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

|                 | The SM in the command APDU generated by the DUT and received by LT is<br>correct.                                                                 |
|-----------------|---------------------------------------------------------------------------------------------------------------------------------------------------|
|                 | Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before. |
|                 | 7.<br>The response APDU of the command SELECT is positive. Response APDU for<br>SELECT is:                                                        |
|                 | '99 02 90 00 8E 08 <MAC> 90 00'                                                                                                                   |
|                 | 8.<br>The LT receives the secured command GENERATE ASYMMETRIC KEY PAIR as<br>sent by the UT.                                                      |
|                 | 9.<br>The response APDU of the command GENERATE ASYMMETRIC KEY PAIR is<br>negative. Response APDU for GENERATE ASYMMETRIC KEY PAIR as sent by LT. |
| Post processing | Reset of smart card and the DUT.                                                                                                                  |

### 5.7.3 R\_Sig\_3 – Successful Signature Generation

| Test ID          | R_Sig_3.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check correct execution of the PACE protocol, TA and CA with a Signature Terminal.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with Password-ID CAN which is entered<br>via the PIN Pad of the Signature Terminal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| References       | [TR-03117], 4.4.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Profiles         | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Preconditions    | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (CAN is used)<br>•<br><CHAT>: Restricted CHAT: at least "Generate qualified electronic signature"<br>•<br><PIN>: empty, because password (CAN) is entered via PIN Pad of the DUT<br>2.<br>Entering the correct CAN into the DUT.<br>3.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapters 4.3.1, 4.3.2 and 4.3.3. The return codes in all<br>response APDUs are positive ('90 00'). In case of a Signature Terminal all<br>authentication protocols (PACE, TA and CA) are completely performed within<br>EstablishPACEChannel between the DUT and LT.<br>4.<br>UT receives OutBuffer of ScardControl (see chapter 4.2.4). |
| Expected results | 1.<br>-<br>2.<br>-<br>3.<br>The command APDUs for the authentication protocols which LT receives from<br>the DUT are built up as described in chapters 4.3.1, 4.3.2 and 4.3.3. For the PACE<br>protocol with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '02' (CAN).<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '03'<br>(Signature Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined                                                                                                                                                                                                                                                                                                                                                                                              |

|                 | in table 21, No. 1.<br>4.<br>For the OutBuffer of ScardControl, that UT receives (see chapter 4.2.4), the<br>following holds:                                                                                                                                              |
|-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                 | •<br><Result_Code>: The result code is positive (i.e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT. |
| Post processing | Reset of smart card and the DUT.                                                                                                                                                                                                                                           |

| Test ID          | R_Sig_3.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check correct execution of the eSign-PIN verification with a Signature Terminal.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The PACE protocol is executed with Password-ID CAN which is transmitted by the<br>UT to the Signature Terminal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| References       | [TR-03117], 4.4.2, A.2.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Profiles         | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Preconditions    | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Successful PACE protocol with CAN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>eSign-PIN is valid, in status "operational" and not blocked.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Test scenario    | 1.<br>The execution steps for the selection of the eSign application have to be<br>performed as described in chapter 4.3.4: UT sends command APDUs to the DUT<br>via PC/SC (without SM). LT receives command APDUs (with SM) from the DUT<br>and sends response APDUs (with SM) back to the DUT. UT receives response<br>APDUs from the DUT via PC/SC (without SM). The return codes in all response<br>APDUs are positive ('90 00').<br>2.<br>UT calls PC/SC function FEATURE_VERIFY_PIN_DIRECT of the Signature<br>Terminal.<br>3.<br>The Signature Terminal requests for entering the password.<br>4.<br>The correct eSign-PIN is entered successfully into the Signature Terminal.<br>5.<br>The Signature Terminal generates the secured command APDU for the Verify<br>command and transmits it to the LT.<br>6.<br>The LT verifies the secured command APDU for the Verify command.<br>7.<br>The LT sends the secured response APDU back to the Signature Terminal;<br>Secured Response APDU for Verify:<br>'99 02 90 00 8E 08 <MAC> 90 00'<br>8.<br>The Signature Terminal sends the unsecured response APDU for the VERIFY<br>command back to the UT. |
| Expected results | 1.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.<br>2.<br>-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |

|                 | 3.<br>The Signature Terminal requests the password entry.                       |
|-----------------|---------------------------------------------------------------------------------|
|                 | 4.<br>-                                                                         |
|                 | 5.<br>-                                                                         |
|                 | 6.<br>The secured command APDU for the VERIFY which LT receives from the DUT is |
|                 | built up as follows;<br>Secured command APDU Verify:                            |
|                 | '0C 20 00 P2 <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00';                     |
|                 | P2: Reference of the eSign-PIN                                                  |
|                 | with Data (in plaintext): eSign-PIN                                             |
|                 | 7.<br>-                                                                         |
|                 | 8.<br>The unsecured response APDU for the VERIFY which UT receives from the DUT |
|                 | is built up as follows:                                                         |
|                 | Unsecured response APDU Verify:                                                 |
|                 | '90 00'                                                                         |
| Post processing | Reset of smart card and the DUT.                                                |

| Test ID          | R_Sig_3.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check correct execution of the signature generation with a Signature Terminal.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The PACE protocol is executed with Password-ID CAN which is transmitted by the<br>UT to the Signature Terminal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| References       | [TR-03117], 4.4.2, A.2.4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Profiles         | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Preconditions    | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Successful PACE protocol with CAN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>eSign application is selected and the eSign-PIN was successfully verified.<br>Private signature key is in status "operational".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Test scenario    | 1.<br>UT sends unsecured command APDU for the PSO : Compute Digital Signature<br>command to the Signature Terminal:<br>Unsecured command APDU for PSO : Compute Digital Signature:<br>'00 2A 9E 9A <Lc> <Hash value of the data to be signed> <Le>'.<br>2.<br>The Signature Terminal generates the secured command APDU for the<br>PSO : Compute Digital Signature command and transmits it to the LT.<br>3.<br>The LT verifies the secured command APDU for the PSO : Compute Digital<br>Signature command.<br>4.<br>The LT sends the secured response APDU for the PSO : Compute Digital<br>Signature command with the generated signature back to the Signature<br>Terminal;<br>Secured response APDU for PSO : Compute Digital Signature:<br>'87 <L87> 01 <Cryptogram> 99 02 90 00 8E 08 <MAC> 90 00';<br>Cryptogram: Encrypted Signature.<br>5.<br>The Signature Terminal sends the unsecured response APDU for the<br>PSO : Compute Digital Signature command back to the UT. |
| Expected results | 1.<br>-<br>2.<br>-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |

|                 | 3.<br>The secured command APDU for the PSO : Compute Digital Signature command<br>which LT receives from the DUT is built up as follows;<br>Secured command APDU PSO : Compute Digital Signature:<br>Select: '0C 2A 9E 9A <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00';<br>Cryptogram: Encrypted hash value of the data to be signed.<br>4.<br>-<br>5.<br>The unsecured response APDU for the PSO : Compute Digital Signature which |
|-----------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                 | UT receives from the DUT is built up as follows:<br>Unsecured response APDU PSO : Compute Digital Signature:<br>'<Digital Signature> 90 00';                                                                                                                                                                                                                                                                                         |
| Post processing | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                     |

#### 5.7.4 R\_Sig\_4 – Abort Signature Generation

| Test ID       | R_Sig_4.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts eSign-PIN verification if the Signature Terminal does not<br>have a certificate with the access right "Generate qualified electronic signature".<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal without access right "Generate qualified electronic signature".<br>The PACE protocol is executed with Password-ID CAN which is transmitted by the<br>UT to the Signature Terminal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| References    | [TR-03117], 4.4.2, A.2.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Profiles      | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Preconditions | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 2; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Successful PACE protocol with CAN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>eSign-PIN is valid, in status "operational" and not blocked.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Test scenario | 1.<br>The execution steps for the selection of the eSign application have to be<br>performed as described in chapter 4.3.4: UT sends command APDUs to the DUT<br>via PC/SC (without SM). LT receives command APDUs (with SM) from the DUT<br>and sends response APDUs (with SM) back to the DUT. UT receives response<br>APDUs from the DUT via PC/SC (without SM). The return codes in all response<br>APDUs are positive ('90 00').<br>2.<br>UT calls PC/SC function FEATURE_VERIFY_PIN_DIRECT of the Signature<br>Terminal.<br>3.<br>The Signature Terminal requests for entering the password.<br>4.<br>The correct eSign-PIN is entered successfully into the Signature Terminal.<br>5.<br>The Signature Terminal generates the secured command APDU for the VERIFY<br>command and transmits it to the LT.<br>6.<br>The LT verifies the secured command APDU for the VERIFY command.<br>7.<br>The LT sends the secured response APDU indicating an error back to the<br>Signature Terminal;<br>Secured Response APDU for VERIFY with status code '69 82':<br>'99 02 69 82 8E 08 <MAC> 69 82'.<br>8.<br>The Signature Terminal sends the unsecured response APDU for the VERIFY |

|                  | command back to the UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.<br>2.<br>-<br>3.<br>The Signature Terminal requests the password entry.<br>4.<br>-<br>5.<br>-<br>6.<br>The secured command APDU for the VERIFY which LT receives from the DUT is<br>built up as follows;<br>Secured command APDU Verify:<br>'0C 20 00 P2 <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00';<br>P2: Reference of the eSign-PIN with Data (in plaintext): eSign-PIN<br>7.<br>-<br>8.<br>The unsecured response APDU for the Verify which UT receives from the DUT is<br>built up as follows:<br>Unsecured response APDU Verify:<br>'69 82' |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

| Test ID       | R_Sig_4.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts signature generation if the Signature Terminal does not<br>have a certificate with the access right "Generate qualified electronic signature".<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal without access right "Generate qualified electronic signature".<br>The PACE protocol is executed with Password-ID CAN which is transmitted by the<br>UT to the Signature Terminal.                                                                                                                      |
| References    | [TR-03117], 4.4.2, A.2.4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Profiles      | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Preconditions | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 2; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Successful PACE protocol with CAN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>eSign application is selected and the eSign-PIN was successfully verified (status have<br>to be set in LT).<br>Private signature key is in status "operational".                                                                                                       |
| Test scenario | 1.<br>UT sends unsecured command APDU for the PSO : Compute Digital Signature<br>command to the Signature Terminal:<br>Unsecured command APDU for PSO : Compute Digital Signature:<br>'00 2A 9E 9A <Lc> <Hash value of the data to be signed> <Le>'<br>2.<br>The Signature Terminal generates the secured command APDU for the<br>PSO : Compute Digital Signature command and transmits it to the LT.<br>3.<br>The LT verifies the secured command APDU for the PSO : Compute Digital<br>Signature command.<br>4.<br>The LT sends the secured response APDU for the PSO : Compute Digital |

|                  | Signature command with the an error code back to the Signature Terminal;<br>Secured response APDU for PSO : Compute Digital Signature:<br>'99 02 69 82 8E 08 <MAC> 69 82<br>5.<br>The Signature Terminal sends the unsecured response APDU for the<br>PSO : Compute Digital Signature command back to the UT.                                                                                                                                                                                                                                                                         |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>-<br>2.<br>-<br>3.<br>The secured command APDU for the PSO : Compute Digital Signature command<br>which LT receives from the DUT is built up as follows;<br>Secured command APDU PSO : Compute Digital Signature:<br>Select: '0C 2A 9E 9A <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00';<br>Cryptogram: Encrypted hash value of the data to be signed.<br>4.<br>-<br>5.<br>The unsecured response APDU for the PSO : Compute Digital Signature which<br>UT receives from the DUT is built up as follows:<br>Unsecured response APDU PSO : Compute Digital Signature:<br>'69 82' |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

| Test ID       | R_Sig_4.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|---------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts eSign-PIN verification if the password which is used for<br>the PACE protocol doesn't provide the required permits.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The PACE protocol is executed with Password-ID PIN which is transmitted as user<br>input via the PIN pad.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| References    | [TR-03117], 4.4.2, A.2.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Profiles      | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Preconditions | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Successful PACE protocol with PIN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>eSign-PIN is valid, in status "operational" and not blocked.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Test scenario | 1.<br>The execution steps for the selection of the eSign application have to be<br>performed as described in chapter 4.3.4: UT sends command APDUs to the DUT<br>via PC/SC (without SM). LT receives command APDUs (with SM) from the DUT<br>and sends response APDUs (with SM) back to the DUT. UT receives response<br>APDUs from the DUT via PC/SC (without SM). The return codes in all response<br>APDUs are positive ('90 00').<br>2.<br>UT calls PC/SC function FEATURE_VERIFY_PIN_DIRECT of the Signature<br>Terminal.<br>3.<br>The Signature Terminal requests for entering the password.<br>4.<br>The correct eSign-PIN is entered successfully into the Signature Terminal.<br>5.<br>The Signature Terminal generates the secured command APDU for the VERIFY<br>command and transmits it to the LT.<br>6.<br>The LT verifies the secured command APDU for the VERIFY command.<br>7.<br>The LT sends the secured response APDU indicating an error back to the |

|                  | Signature Terminal;<br>Secured Response APDU for VERIFY with status code '69 82':<br>'99 02 69 82 8E 08 <MAC> 69 82'.<br>8.<br>The Signature Terminal sends the unsecured response APDU for the VERIFY<br>command back to the UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.<br>2.<br>-<br>3.<br>The Signature Terminal requests the password entry.<br>4.<br>-<br>5.<br>-<br>6.<br>The secured command APDU for the VERIFY which LT receives from the DUT is<br>built up as follows;<br>Secured command APDU Verify:<br>'0C 20 00 P2 <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00';<br>P2: Reference of the eSign-PIN<br>with Data (in plaintext): eSign-PIN<br>7.<br>-<br>8.<br>The unsecured response APDU for the VERIFY which UT receives from the DUT<br>is built up as follows:<br>Unsecured response APDU Verify:<br>'69 82' |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |

| Test ID       | R_Sig_4.4                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts signature generation if the password which is used for<br>the PACE protocol doesn't provide the required permits.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The PACE protocol is executed with Password-ID PIN which is transmitted as user<br>input via the PIN pad.                                                      |
| References    | [TR-03117], 4.4.2, A.2.4                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Profiles      | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Preconditions | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Successful PACE protocol with PIN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>eSign application is selected and the eSign-PIN was successfully verified (status have<br>to be set in LT).<br>Private signature key is in status "operational". |
| Test scenario | 1.<br>UT sends unsecured command APDU for the PSO : Compute Digital Signature<br>command to the Signature Terminal:<br>Unsecured command APDU for PSO : Compute Digital Signature:<br>'00 2A 9E 9A <Lc> <Hash value of the data to be signed> <Le>'.                                                                                                                                                                                                                                |

|                  | 2.<br>The Signature Terminal generates the secured command APDU for the<br>PSO : Compute Digital Signature command and transmits it to the LT.<br>3.<br>The LT verifies the secured command APDU for the PSO : Compute Digital<br>Signature command.<br>4.<br>The LT sends the secured response APDU for the PSO : Compute Digital<br>Signature command with the an error code back to the Signature Terminal;<br>Secured response APDU for PSO : Compute Digital Signature:<br>'99 02 69 82 8E 08 <MAC> 69 82.<br>5.<br>The Signature Terminal sends the unsecured response APDU for the<br>PSO : Compute Digital Signature command back to the UT. |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>-<br>2.<br>-<br>3.<br>The secured command APDU for the PSO : Compute Digital Signature command<br>which LT receives from the DUT is built up as follows;<br>Secured command APDU PSO : Compute Digital Signature:<br>Select: '0C 2A 9E 9A <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00';<br>Cryptogram: Encrypted hash value of the data to be signed.<br>4.<br>-<br>5.<br>The unsecured response APDU for the PSO : Compute Digital Signature which<br>UT receives from the DUT is built up as follows:<br>Unsecured response APDU PSO : Compute Digital Signature:<br>'69 82'                                                                |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

| Test ID       | R_Sig_4.5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|---------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts eSign-PIN verification if the LT sends an error code.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The PACE protocol is executed with Password-ID CAN which is transmitted by the<br>UT to the Signature Terminal.                                                                                                                                                                                                                                                                                                               |
| References    | [TR-03117], 4.4.2, A.2.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Profiles      | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Preconditions | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Successful PACE protocol with CAN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>eSign-PIN is valid, in status "operational" and not blocked.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                                                          |
| Test scenario | 1.<br>The execution steps for the selection of the eSign application have to be<br>performed as described in chapter 4.3.4: UT sends command APDUs to the DUT<br>via PC/SC (without SM). LT receives command APDUs (with SM) from the DUT<br>and sends response APDUs (with SM) back to the DUT. UT receives response<br>APDUs from the DUT via PC/SC (without SM). The return codes in all response<br>APDUs are positive ('90 00').<br>2.<br>UT calls PC/SC function FEATURE_VERIFY_PIN_DIRECT of the Signature<br>Terminal.<br>3.<br>The Signature Terminal requests for entering the password.<br>4.<br>The correct eSign-PIN is entered successfully into the Signature Terminal. |

|                  | 5.<br>The Signature Terminal generates the secured command APDU for the VERIFY<br>command and transmits it to the LT.<br>6.<br>The LT verifies the secured command APDU for the VERIFY command.<br>7.<br>The LT sends the secured response APDU indicating an error back to the<br>Signature Terminal;<br>Secured Response APDU for Verify with status code SW1 SW2:<br>'99 02 SW1 SW2 8E 08 <MAC> SW1 SW2' and<br>SW1 SW2 = '63C2' (Verification failed) or<br>SW1 SW2 = '69 83' (Authentication method blocked) or<br>SW1 SW2 = '69 84' (Reference data not usable) or<br>SW1 SW2 = '6A 88' (Referenced data not found).<br>8.<br>The Signature Terminal sends the unsecured response APDU for the VERIFY<br>command back to the UT.                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.<br>2.<br>-<br>3.<br>The Signature Terminal requests the password entry.<br>4.<br>-<br>5.<br>-<br>6.<br>The secured command APDU for the VERIFY which LT receives from the DUT is<br>built up as follows;<br>Secured command APDU VERIFY:<br>'0C 20 00 P2 <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00';<br>P2: Reference of the eSign-PIN<br>with Data (in plaintext): eSign-PIN.<br>7.<br>-<br>8.<br>The unsecured response APDU for the VERIFY which UT receives from the DUT<br>is built up as follows:<br>Unsecured response APDU Verify: SW1 SW2 with:<br>SW1 SW2 = '63C2' (Verification failed) or<br>SW1 SW2 = '69 83' (Authentication method blocked) or<br>SW1 SW2 = '69 84' (Reference data not usable) or<br>SW1 SW2 = '6A 88' (Referenced data not found). |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

| Test ID       | R_Sig_4.6                                                                                                                                                                                                                                                                                                                                                              |
|---------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts signature generation if the LT sends an error code.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The PACE protocol is executed with Password-ID CAN which is transmitted by the<br>UT to the Signature Terminal. |
| References    | [TR-03117], 4.4.2, A.2.4                                                                                                                                                                                                                                                                                                                                               |
| Profiles      | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                     |
| Preconditions | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.                                                                                                                                                                                      |

|                  | Successful PACE protocol with CAN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>eSign application is selected and the eSign-PIN was successfully verified (status have<br>to be set in LT).<br>Private signature key is in status "operational".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Test scenario    | 1.<br>UT sends unsecured command APDU for the PSO : Compute Digital Signature<br>command to the Signature Terminal:<br>Unsecured command APDU for PSO : Compute Digital Signature:<br>'00 2A 9E 9A <Lc> <Hash value of the data to be signed> <Le>'.<br>2.<br>The Signature Terminal generates the secured command APDU for the<br>PSO : Compute Digital Signature command and transmits it to the LT.<br>3.<br>The LT verifies the secured command APDU for the PSO : Compute Digital<br>Signature command.<br>4.<br>The LT sends the secured response APDU for the PSO : Compute Digital<br>Signature command with the an error code back to the Signature Terminal;<br>Secured response APDU for PSO : Compute Digital Signature:<br>'99 02 SW1 SW2 8E 08 <MAC> 69 82 with or<br>SW1 SW2 = '69 84' (Reference data not usable) or<br>SW1 SW2 = '6A 80' (Incorrect parameters in data field).<br>5.<br>The Signature Terminal sends the unsecured response APDU for the<br>PSO : Compute Digital Signature command back to the UT. |
| Expected results | 1.<br>-<br>2.<br>-<br>3.<br>The secured command APDU for the PSO : Compute Digital Signature command<br>which LT receives from the DUT is built up as follows;<br>Secured command APDU PSO : Compute Digital Signature:<br>Select: '0C 2A 9E 9A <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00';<br>Cryptogram: Encrypted hash value of the data to be signed.<br>4.<br>-<br>5.<br>The unsecured response APDU for the PSO : Compute Digital Signature which<br>UT receives from the DUT is built up as follows:<br>Unsecured response APDU PSO : Compute Digital Signature:<br>'69 84' (Reference data not usable) or<br>'6A 80' (Incorrect parameters in data field)                                                                                                                                                                                                                                                                                                                                                                 |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

### 5.7.5 R\_Sig\_5 – Successful Password Management Functions

| Test ID       | R_Sig_5.1                                                                                                                                                                                                                                                                                                                                                                           |
|---------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check correct execution of setting the eSign-PIN with a Signature Terminal.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with Password-ID PIN which is entered<br>via the PIN Pad of the Signature Terminal. |
| References    | [TR-03117], 4.4.3, A.2.2                                                                                                                                                                                                                                                                                                                                                            |
| Profiles      | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                  |
| Preconditions | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2                                                                                                                                                                                                                                         |

|                  | Make certificates available in UT.<br>Status of the eSign-PIN is "terminated".<br>Status of the private signature key is "terminated".<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '03' (PIN is used)<br>•<br><CHAT>: Restricted CHAT: at least "Generate qualified electronic signature"<br>•<br><PIN>: empty, because password (PIN) is entered via PIN Pad of the DUT<br>2.<br>Entering the correct PIN into the DUT.<br>3.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapters 4.3.1, 4.3.2 and 4.3.3. The return codes in all<br>response APDUs are positive ('90 00'). In case of a Signature Terminal all<br>authentication protocols (PACE, TA and CA) are completely performed within<br>EstablishPACEChannel between the DUT and LT.<br>4.<br>UT receives OutBuffer of ScardControl (see chapter 4.2.4).<br>5.<br>The execution steps for the selection of the eSign application have to be<br>performed as described in chapter 4.3.4: UT sends command APDUs to the DUT<br>via PC/SC (without SM). LT receives command APDUs (with SM) from the DUT<br>and sends response APDUs (with SM) back to the DUT. UT receives response<br>APDUs from the DUT via PC/SC (without SM). The return codes in all response<br>APDUs are positive ('90 00').<br>6.<br>UT calls PC/SC function FEATURE_MODIFY_PIN_DIRECT of the Signature<br>Terminal.<br>7.<br>The Signature Terminal requests for entering the new password.<br>8.<br>The correct new eSign-PIN is entered successfully into the Signature Terminal.<br>9.<br>The Signature Terminal generates the secured command APDU for the CHANGE<br>REFERENCE DATA command and transmits it to the LT.<br>10. The LT verifies the secured command APDU for the CHANGE REFERENCE DATA<br>command.<br>11. The LT sends the secured response APDU back to the Signature Terminal;<br>Secured Response APDU for Change Reference Data:<br>'99 02 90 00 8E 08 <MAC> 90 00'.<br>12. The Signature Terminal sends the unsecured response APDU for the Change<br>Reference Data command back to the UT. |
| Expected results | 1.<br>-<br>2.<br>-<br>3.<br>The command APDUs for the authentication protocols which LT receives from<br>the DUT are built up as described in chapters 4.3.1, 4.3.2 and 4.3.3. For the PACE<br>protocol with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '03' (PIN).<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '03'<br>(Signature Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 21, No. 1.<br>4.<br>For the OutBuffer of ScardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i. e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>5.<br>Each command APDU received at LT is correctly coded and secured by SM and                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

|                 | coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.<br>6.<br>-<br>7.<br>The Signature Terminal requests the entry for the new password.<br>8.<br>-<br>9.<br>-<br>10. The secured command APDU for the CHANGE REFERENCE DATA which LT<br>receives from the DUT is built up as follows;<br>Secured command APDU Change Reference Data:<br>'0C 24 01 P2 <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00';<br>P2: Reference of the eSign-PIN<br>with Data (in plaintext): new eSign-PIN.<br>11.-<br>12. The unsecured response APDU for the CHANGE REFERENCE DATA which UT<br>receives from the DUT is built up as follows:<br>Unsecured response APDU Change Reference Data: |
|-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                 | '90 00'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Post processing | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |

| Test ID       | R_Sig_5.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|---------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check correct execution of changing the eSign-PIN with a Signature Terminal.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with Password-ID CAN which is entered<br>via the PIN Pad of the Signature Terminal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| References    | [TR-03117], 4.4.3, A.2.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Profiles      | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Preconditions | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Status of the eSign-PIN is "operational" and not blocked.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Test scenario | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '02' (CAN is used)<br>•<br><CHAT>: Restricted CHAT: at least "Generate qualified electronic signature"<br>•<br><PIN>: empty, because password (CAN) is entered via PIN Pad of the DUT<br>2.<br>Entering the correct CAN into the DUT.<br>3.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapters 4.3.1, 4.3.2 and 4.3.3. The return codes in all<br>response APDUs are positive ('90 00'). In case of a Signature Terminal all<br>authentication protocols (PACE, TA and CA) are completely performed within<br>EstablishPACEChannel between the DUT and LT.<br>4.<br>UT receives OutBuffer of ScardControl (see chapter 4.2.4).<br>5.<br>The execution steps for the selection of the eSign application have to be<br>performed as described in chapter 4.3.4: UT sends command APDUs to the DUT |

|                  | via PC/SC (without SM). LT receives command APDUs (with SM) from the DUT<br>and sends response APDUs (with SM) back to the DUT. UT receives response<br>APDUs from the DUT via PC/SC (without SM). The return codes in all response<br>APDUs are positive ('90 00').<br>6.<br>UT calls PC/SC function FEATURE_MODIFY_PIN_DIRECT of the Signature<br>Terminal.<br>7.<br>The Signature Terminal requests for entering the old and the new password.<br>8.<br>The correct old and the new eSign-PIN are entered successfully into the<br>Signature Terminal.<br>9.<br>The Signature Terminal generates the secured command APDU for the CHANGE<br>REFERENCE DATA command and transmits it to the LT.<br>10. The LT verifies the secured command APDU for the Change Reference Data<br>command.<br>11. The LT sends the secured response APDU back to the Signature Terminal;<br>Secured Response APDU for CHANGE REFERENCE DATA:<br>'99 02 90 00 8E 08 <MAC> 90 00'.<br>12. The Signature Terminal sends the unsecured response APDU for the CHANGE<br>REFERENCE DATA command back to the UT.                                                                                                                                                   |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>-<br>2.<br>-<br>3.<br>The command APDUs for the authentication protocols which LT receives from<br>the DUT are built up as described in chapters 4.3.1, 4.3.2 and 4.3.3. For the PACE<br>protocol with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '02' (CAN).<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '03'<br>(Signature Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 21, No. 1.<br>4.<br>For the OutBuffer of ScardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i. e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>5.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct.<br>Each response APDU received at UT is correctly coded without SM and coincides |
|                  | apart from SM with the response APDU sent by LT directly before.<br>6.<br>-<br>7.<br>The Signature Terminal requests the entry for the old and new password.<br>8.<br>-<br>9.<br>-<br>10. The secured command APDU for the CHANGE REFERENCE DATA which LT<br>receives from the DUT is built up as follows;<br>Secured command APDU CHANGE REFERENCE DATA:<br>'0C 24 00 P2 <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00';<br>P2: Reference of the eSign-PIN<br>with Data (in plaintext): old eSign-PIN    new eSign-PIN.<br>11.-<br>12. The unsecured response APDU for the CHANGE REFERENCE DATA which UT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |

|                 | receives from the DUT is built up as follows:<br>Unsecured response APDU Change Reference Data:<br>'90 00'. |
|-----------------|-------------------------------------------------------------------------------------------------------------|
| Post processing | Reset of smart card and the DUT.                                                                            |

| Test ID       | R_Sig_5.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check correct execution of resetting the retry counter of the eSign-PIN with a<br>Signature Terminal.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with Password-ID PUK which is entered<br>via the PIN Pad of the Signature Terminal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| References    | [TR-03117], 4.4.3, A.2.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Profiles      | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Preconditions | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Status of the eSign-PIN is "operational" and blocked.<br>Use counter of the PUK is not zero, i.e. the processing of a further reset retry counter<br>is possible.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Test scenario | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '04' (PUK is used)<br>•<br><CHAT>: Restricted CHAT: at least "Generate qualified electronic signature"<br>•<br><PIN>: empty, because password (PUK) is entered via PIN Pad of the DUT<br>2.<br>Entering the correct PUK into the DUT.<br>3.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapters 4.3.1, 4.3.2 and 4.3.3. The return codes in all<br>response APDUs are positive ('90 00'). In case of a Signature Terminal all<br>authentication protocols (PACE, TA and CA) are completely performed within<br>EstablishPACEChannel between the DUT and LT.<br>4.<br>UT receives OutBuffer of ScardControl (see chapter 4.2.4).<br>5.<br>The execution steps for the selection of the eSign application have to be<br>performed as described in chapter 4.3.4: UT sends command APDUs to the DUT<br>via PC/SC (without SM). LT receives command APDUs (with SM) from the DUT<br>and sends response APDUs (with SM) back to the DUT. UT receives response<br>APDUs from the DUT via PC/SC (without SM). The return codes in all response<br>APDUs are positive ('90 00').<br>6.<br>UT sends the unsecured command RESET RETRY COUNTER to the Signature<br>Terminal.<br>Unsecured command APDU for Reset Retry Counter:<br>'00 2C 03 P2 <Lc> <data is empty>';<br>P2: Reference to eSign-PIN.<br>7.<br>The Signature Terminal generates the secured command APDU for the RESET<br>RETRY COUNTER command and transmits it to the LT.<br>8.<br>The LT verifies the secured command APDU for the RESET RETRY COUNTER<br>command.<br>9.<br>The LT sends the secured response APDU back to the Signature Terminal; |

|                  | Secured Response APDU for RESET RETRY COUNTER:<br>'99 02 90 00 8E 08 <MAC> 90 00'.                                                                                                                                                                |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                  | 10. The Signature Terminal sends the unsecured response APDU for the RESET                                                                                                                                                                        |
|                  | RETRY COUNTER command back to the UT.                                                                                                                                                                                                             |
| Expected results | 1.<br>-<br>2.<br>-                                                                                                                                                                                                                                |
|                  | 3.<br>The command APDUs for the authentication protocols which LT receives from<br>the DUT are built up as described in chapters 4.3.1, 4.3.2 and 4.3.3. For the PACE<br>protocol with the following additions:                                   |
|                  | •<br>The <Password-ID> in command APDU to MSE: Set AT is '04' (PUK).<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '03'                                                                                                        |
|                  | (Signature Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined                                                                                                                                                   |
|                  | in table 21, No. 1.<br>4.<br>For the OutBuffer of ScardControl, that UT receives (see chapter 4.2.4), the<br>following holds:                                                                                                                     |
|                  | •<br><Result_Code>: The result code is positive (i. e. '00 00 00 00').                                                                                                                                                                            |
|                  | •<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.                                                 |
|                  | 5.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct. |
|                  | Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.                                                                                                 |
|                  | 6.<br>-<br>7.<br>-                                                                                                                                                                                                                                |
|                  | 8.<br>The secured command APDU for the RESET RETRY COUNTER which LT receives<br>from the DUT is built up as follows;                                                                                                                              |
|                  | Secured command APDU RESET RETRY COUNTER:<br>'0C 2C 03 P2 <Lc> 8E 08 <MAC> 00';                                                                                                                                                                   |
|                  | P2: Reference of the eSign-PIN.<br>9.<br>-                                                                                                                                                                                                        |
|                  | 10. The unsecured response APDU for the RESET RETRY COUNTER which UT<br>receives from the DUT is built up as follows:                                                                                                                             |
|                  | Unsecured response APDU RESET RETRY COUNTER:<br>'90 00';                                                                                                                                                                                          |
|                  | The error counter of the eSign-PIN in LT is set to its initial value.                                                                                                                                                                             |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                  |

### 5.7.6 R\_Sig\_6 – Abort Password Management Functions

| Test ID | R_Sig_6.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose | Check that the DUT aborts setting of the eSign-PIN if the Signature Terminal does<br>not have a certificate with the access right "Generate qualified electronic signature".<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal without access right "Generate qualified electronic signature".<br>The PACE protocol is executed with Password-ID PIN which is entered via the PIN<br>Pad of the Signature Terminal. |

| References       | [TR-03117], 4.4.3, A.2.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Profiles         | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Preconditions    | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 2; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Status of the eSign-PIN is "terminated".<br>Status of the private signature key is "terminated".<br>Successful PACE protocol with PIN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>The eSign application was successfully selected.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                                                                                              |
| Test scenario    | 1.<br>UT calls PC/SC function FEATURE_MODIFY_PIN_DIRECT of the Signature<br>Terminal.<br>2.<br>The Signature Terminal requests for entering the new password.<br>3.<br>The correct new eSign-PIN is entered successfully into the Signature Terminal.<br>4.<br>The Signature Terminal generates the secured command APDU for the CHANGE<br>REFERENCE DATA command and transmits it to the LT.<br>5.<br>The LT verifies the secured command APDU for the CHANGE REFERENCE DATA<br>COMMAND.<br>6.<br>The LT sends the secured response APDU with an error code back to the<br>Signature Terminal;<br>Secured Response APDU for CHANGE REFERENCE DATA:<br>'99 02 69 82 8E 08 <MAC> 69 82'.<br>7.<br>The Signature Terminal sends the unsecured response APDU for the CHANGE<br>REFERENCE DATA command back to the UT. |
| Expected results | 1.<br>-<br>2.<br>The Signature Terminal requests the entry for the new password.<br>3.<br>-<br>4.<br>-<br>5.<br>The secured command APDU for the CHANGE REFERENCE DATA which LT<br>receives from the DUT is built up as follows;<br>Secured command APDU CHANGE REFERENCE DATA:<br>'0C 24 01 P2 <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00';<br>P2: Reference of the eSign-PIN<br>with Data (in plaintext): new eSign-PIN.<br>6.<br>-<br>7.<br>The unsecured response APDU for the CHANGE REFERENCE DATA which UT<br>receives from the DUT is built up as follows:<br>Unsecured response APDU CHANGE REFERENCE DATA:<br>'69 82'.                                                                                                                                                                                 |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |

| Test ID | R_Sig_6.2                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose | Check that the DUT aborts setting of the eSign-PIN if the password which is used<br>for the PACE protocol doesn't provide the required permits.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with Password-ID CAN which is entered<br>via the PIN Pad of the Signature Terminal. |

| References       | [TR-03117], 4.4.3, A.2.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |  |  |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|
| Profiles         | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |  |  |
| Preconditions    | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Status of the eSign-PIN is "terminated".<br>Status of the private signature key is "terminated".<br>Successful PACE protocol with CAN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>The eSign application was successfully selected.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                                                                                              |  |  |
| Test scenario    | 1.<br>UT calls PC/SC function FEATURE_MODIFY_PIN_DIRECT of the Signature<br>Terminal.<br>2.<br>The Signature Terminal requests for entering the new password.<br>3.<br>The correct new eSign-PIN is entered successfully into the Signature Terminal.<br>4.<br>The Signature Terminal generates the secured command APDU for the CHANGE<br>REFERENCE DATA command and transmits it to the LT.<br>5.<br>The LT verifies the secured command APDU for the CHANGE REFERENCE DATA<br>command.<br>6.<br>The LT sends the secured response APDU with an error code back to the<br>Signature Terminal;<br>Secured Response APDU for CHANGE REFERENCE DATA:<br>'99 02 69 82 8E 08 <MAC> 69 82'.<br>7.<br>The Signature Terminal sends the unsecured response APDU for the CHANGE<br>REFERENCE DATA command back to the UT. |  |  |
| Expected results | 1.<br>-<br>2.<br>The Signature Terminal requests the entry for the new password.<br>3.<br>-<br>4.<br>-<br>5.<br>The secured command APDU for the CHANGE REFERENCE DATA which LT<br>receives from the DUT is built up as follows;<br>Secured command APDU CHANGE REFERENCE DATA:<br>'0C 24 01 P2 <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00';<br>P2: Reference of the eSign-PIN with Data (in plaintext): new eSign-PIN.<br>6.<br>-<br>7.<br>The unsecured response APDU for the CHANGE REFERENCE DATA which UT<br>receives from the DUT is built up as follows:<br>Unsecured response APDU CHANGE REFERENCE DATA:<br>'69 82'.                                                                                                                                                                                    |  |  |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |  |  |

| Test ID | R_Sig_6.3_template                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose | Check that the DUT aborts password management function if the eSign application<br>could not be selected.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with different Password-IDs: PIN, CAN<br>and PUK. The specific password is entered via the PIN Pad of the Signature Terminal.<br>So this test case covers three variants:<br>–<br>PIN: abort in case of setting the eSign-PIN |

|                  | –<br>CAN: abort in case of changing the eSign-PIN<br>–<br>PUK: abort in case of resetting the retry counter of the eSign-PIN.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |  |  |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|
| References       | [TR-03117], 4.4.3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |  |  |
| Profiles         | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |  |  |
| Preconditions    | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Status of the eSign-PIN is "terminated".<br>Status of the private signature key is "terminated".<br>Successful PACE protocol with PIN, CAN or PUK (see table 46), TA and CA between<br>Signature Terminal and LT with establishment of a trusted channel.                                                                                                                                                                                                 |  |  |
| Test scenario    | 1.<br>UT starts function (see table 46) by sending unsecured command SELECT to the<br>Signature Terminal:<br>Unsecured command APDU for Select:<br>'00 A4 04 0C <Lc> <AID of eSign application>';<br>'A0 00 00 01 67 45 53 49 47 4E' = AID of eSign application.<br>2.<br>The LT receives the secured command APDU for the command SELECT.<br>3.<br>The LT sends the secured response APDU with an error code to the DUT. The<br>secured response APDU for the SELECT is built up as follows:<br>'99 02 6A 82 8E 08 <MAC> 6A 82';<br>'6A 82': File or application not found.<br>4.<br>The UT receives the response code to the command SELECT. |  |  |
| Expected results | 1.<br>-<br>2.<br>The secured command APDU for the SELECT command which LT receives from<br>the DUT is built up as follows;<br>Secured command APDU SELECT:<br>'0C A4 04 0C <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00'<br>with Data (in plaintext):<br>AID = 'A0 00 00 01 67 45 53 49 47 4E' AID of eSign application.<br>3.<br>-<br>4.<br>The unsecured response APDU for the SELECT command which UT receives<br>from the DUT is built up as follows:<br>Unsecured response APDU SELECT:<br>'6A 82'.                                                                                                                                       |  |  |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |  |  |

| Test case  | Password | Function                                      |
|------------|----------|-----------------------------------------------|
| R_Sig_6.3a | PIN      | Setting the eSign-PIN.                        |
| R_Sig_6.3b | CAN      | Changing the eSign-PIN.                       |
| R_Sig_6.3c | PUK      | Resetting the retry counter of the eSign-PIN. |

<span id="page-123-0"></span>Table 46: Test case R\_Sig\_6.3

| Test ID | R_Sig_6.4                                                                                                                                                                                                      |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose | Check that the DUT aborts setting of the eSign-PIN if the LT returns an error code to<br>the command Change Reference Data.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role |

|                  | Signature Terminal with access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with Password-ID PIN which is entered<br>via the PIN Pad of the Signature Terminal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| References       | [TR-03117], 4.4.3, A.2.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Profiles         | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Preconditions    | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Successful PACE protocol with PIN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>The eSign application was successfully selected.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Test scenario    | 1.<br>UT calls PC/SC function FEATURE_MODIFY_PIN_DIRECT of the Signature<br>Terminal.<br>2.<br>The Signature Terminal requests for entering the new password.<br>3.<br>The correct new eSign-PIN is entered successfully into the Signature Terminal.<br>4.<br>The Signature Terminal generates the secured command APDU for the CHANGE<br>REFERENCE DATA command and transmits it to the LT.<br>5.<br>The LT verifies the secured command APDU for the CHANGE REFERENCE DATA<br>command.<br>6.<br>The LT sends the secured response APDU with an error code back to the<br>Signature Terminal;<br>Secured Response APDU for CHANGE REFERENCE DATA:<br>'99 02 SW1 SW2 8E 08 <MAC> SW1 SW2' with<br>SW1 SW2 = '69 83' (Authentication method blocked) or<br>SW1 SW2 = '69 84' (Reference data not usable) or<br>SW1 SW2 = '6A 80' (Incorrect parameters in data field) or<br>SW1 SW2 = '69 88' (Referenced data not found).<br>7.<br>The Signature Terminal sends the unsecured response APDU for the CHANGE<br>REFERENCE DATA command back to the UT. |
| Expected results | 1.<br>-<br>2.<br>The Signature Terminal requests the entry for the new password.<br>3.<br>-<br>4.<br>-<br>5.<br>The secured command APDU for the CHANGE REFERENCE DATA which LT<br>receives from the DUT is built up as follows;<br>Secured command APDU CHANGE REFERENCE DATA:<br>'0C 24 01 P2 <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00';<br>P2: Reference of the eSign-PIN with Data (in plaintext): new eSign-PIN.<br>6.<br>-<br>7.<br>The unsecured response APDU for the CHANGE REFERENCE DATA which UT<br>receives from the DUT is built up as follows:<br>Unsecured response APDU CHANGE REFERENCE DATA:<br>SW1 SW2 with<br>SW1 SW2 = '69 83' (Authentication method blocked) or<br>SW1 SW2 = '69 84' (Reference data not usable) or<br>SW1 SW2 = '6A 80' (Incorrect parameters in data field) or<br>SW1 SW2 = '69 88' (Referenced data not found).                                                                                                                                                                                        |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

| Test ID          | R_Sig_6.5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that the DUT aborts changing the eSign-PIN if the Signature Terminal does<br>not have a certificate with the access right "Generate qualified electronic signature".<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal without access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with Password-ID CAN which is entered<br>via the PIN Pad of the Signature Terminal.                                                                                                                                                                                                                                                                                                                                                          |
| References       | [TR-03117], 4.4.3, A.2.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Profiles         | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Preconditions    | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 2; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Status of the eSign-PIN is "operational" and not blocked.<br>Successful PACE protocol with CAN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>The eSign application was successfully selected.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                                                                                                                                                                 |
| Test scenario    | 1.<br>UT calls PC/SC function FEATURE_MODIFY_PIN_DIRECT of the Signature<br>Terminal.<br>2.<br>The Signature Terminal requests for entering the old and the new password.<br>3.<br>The correct old and the new eSign-PIN are entered successfully into the<br>Signature Terminal.<br>4.<br>The Signature Terminal generates the secured command APDU for the CHANGE<br>REFERENCE DATA command and transmits it to the LT.<br>5.<br>The LT verifies the secured command APDU for the CHANGE REFERENCE DATA<br>command.<br>6.<br>The LT sends the secured response APDU with an error code back to the<br>Signature Terminal;<br>Secured Response APDU for CHANGE REFERENCE DATA:<br>'99 02 69 82 8E 08 <MAC> 69 82'.<br>7.<br>The Signature Terminal sends the unsecured response APDU for the CHANGE<br>REFERENCE DATA command back to the UT. |
| Expected results | 1.<br>-<br>2.<br>The Signature Terminal requests the entry for the old and new password.<br>3.<br>-<br>4.<br>-<br>5.<br>The secured command APDU for the CHANGE REFERENCE DATA which LT<br>receives from the DUT is built up as follows;<br>Secured command APDU CHANGE REFERENCE DATA:<br>'0C 24 00 P2 <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00';<br>P2: Reference of the eSign-PIN with Data (in plaintext): old eSign-PIN    new<br>eSign-PIN.<br>6.<br>-<br>7.<br>The unsecured response APDU for the CHANGE REFERENCE DATA with an<br>error code which UT receives from the DUT is built up as follows:<br>Unsecured response APDU CHANGE REFERENCE DATA:<br>'69 82'.                                                                                                                                                                 |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |

| Test ID          | R_Sig_6.6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that the DUT aborts changing the eSign-PIN if the password which is used<br>for the PACE protocol doesn't provide the required permits.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with Password-ID PIN which is entered<br>via the PIN Pad of the Signature Terminal.                                                                                                                                                                                                                                                                                                                                                                                          |
| References       | [TR-03117], 4.4.3, A.2.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Profiles         | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| Preconditions    | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Status of the eSign-PIN is "operational" and not blocked.<br>Successful PACE protocol with PIN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>The eSign application was successfully selected.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                                                                                                                                                                 |
| Test scenario    | 1.<br>UT calls PC/SC function FEATURE_MODIFY_PIN_DIRECT of the Signature<br>Terminal.<br>2.<br>The Signature Terminal requests for entering the old and the new password.<br>3.<br>The correct old and the new eSign-PIN are entered successfully into the<br>Signature Terminal.<br>4.<br>The Signature Terminal generates the secured command APDU for the CHANGE<br>REFERENCE DATA command and transmits it to the LT.<br>5.<br>The LT verifies the secured command APDU for the CHANGE REFERENCE DATA<br>command.<br>6.<br>The LT sends the secured response APDU with an error code back to the<br>Signature Terminal;<br>Secured Response APDU for CHANGE REFERENCE DATA:<br>'99 02 69 82 8E 08 <MAC> 69 82'.<br>7.<br>The Signature Terminal sends the unsecured response APDU for the CHANGE<br>REFERENCE DATA command back to the UT. |
| Expected results | 1.<br>-<br>2.<br>The Signature Terminal requests the entry for the old and new password.<br>3.<br>-<br>4.<br>-<br>5.<br>The secured command APDU for the CHANGE REFERENCE DATA which LT<br>receives from the DUT is built up as follows;<br>Secured command APDU CHANGE REFERENCE DATA:<br>'0C 24 00 P2 <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00';<br>P2: Reference of the eSign-PIN with Data (in plaintext): old eSign-PIN    new<br>eSign-PIN.<br>6.<br>-<br>7.<br>The unsecured response APDU for the CHANGE REFERENCE DATA with an<br>error code which UT receives from the DUT is built up as follows:<br>Unsecured response APDU CHANGE REFERENCE DATA:<br>'69 82'.                                                                                                                                                                 |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |

| Test ID          | R_Sig_6.7                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that the DUT aborts changing the eSign-PIN if the LT returns an error code to<br>the command Change Reference Data.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with Password-ID CAN which is entered<br>via the PIN Pad of the Signature Terminal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| References       | [TR-03117], 4.4.3, A.2.2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Profiles         | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Preconditions    | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Status of the eSign-PIN is "operational" and not blocked.<br>Successful PACE protocol with PIN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>The eSign application was successfully selected.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Test scenario    | 1.<br>UT calls PC/SC function FEATURE_MODIFY_PIN_DIRECT of the Signature<br>Terminal.<br>2.<br>The Signature Terminal requests for entering the old and the new password.<br>3.<br>The correct old and the new eSign-PIN are entered successfully into the<br>Signature Terminal.<br>4.<br>The Signature Terminal generates the secured command APDU for the CHANGE<br>REFERENCE DATA command and transmits it to the LT.<br>5.<br>The LT verifies the secured command APDU for the CHANGE REFERENCE DATA<br>command.<br>6.<br>The LT sends the secured response APDU with an error code back to the<br>Signature Terminal;<br>Secured Response APDU for CHANGE REFERENCE DATA:<br>'99 02 SW1 SW2 8E 08 <MAC> SW1 SW2' with<br>SW1 SW2 = '69 83' (Authentication method blocked) or<br>SW1 SW2 = '69 84' (Reference data not usable) or<br>SW1 SW2 = '6A 80' (Incorrect parameters in data field) or<br>SW1 SW2 = '69 88' (Referenced data not found).<br>7.<br>The Signature Terminal sends the unsecured response APDU for the CHANGE<br>REFERENCE DATA command back to the UT. |
| Expected results | 1.<br>-<br>2.<br>The Signature Terminal requests the entry for the old and new password.<br>3.<br>-<br>4.<br>-<br>5.<br>The secured command APDU for the CHANGE REFERENCE DATA which LT<br>receives from the DUT is built up as follows;<br>Secured command APDU CHANGE REFERENCE DATA:<br>'0C 24 00 P2 <Lc> 87 <L87> 01 <Cryptogram> 8E 08 <MAC> 00';<br>P2: Reference of the eSign-PIN with Data (in plaintext): old eSign-PIN    new<br>eSign-PIN.<br>6.<br>-<br>7.<br>The unsecured response APDU for the CHANGE REFERENCE DATA with an<br>error code which UT receives from the DUT is built up as follows:<br>Unsecured response APDU CHANGE REFERENCE DATA:                                                                                                                                                                                                                                                                                                                                                                                                                |

|                 | SW1 SW2 with<br>SW1 SW2 = '69 83' (Authentication method blocked) or<br>SW1 SW2 = '69 84' (Reference data not usable) or<br>SW1 SW2 = '6A 80' (Incorrect parameters in data field) or<br>SW1 SW2 = '69 88' (Referenced data not found). |
|-----------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Post processing | Reset of smart card and the DUT.                                                                                                                                                                                                        |

| Test ID          | R_Sig_6.8                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that the DUT aborts resetting the retry counter of the eSign-PIN if the<br>Signature Terminal does not have a certificate with the access right "Generate<br>qualified electronic signature".<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal without access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with Password-ID PUK which is entered<br>via the PIN Pad of the Signature Terminal.                                                                                                                                                                                                                                                       |
| References       | [TR-03117], 4.4.3, A.2.3, [TR-03110-3] B6.1, B.11.9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Profiles         | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Preconditions    | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 2; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Status of the eSign-PIN is "operational" and blocked.<br>Use counter of the PUK is not zero, i.e. the processing of a further reset retry counter<br>is possible.<br>Successful PACE protocol with PUK, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>The eSign application was successfully selected.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                               |
| Test scenario    | 1.<br>UT sends the unsecured command RESET RETRY COUNTER to the Signature<br>Terminal.<br>Unsecured command APDU for Reset Retry Counter:<br>'00 2C 03 P2 <Lc> <data is empty>';<br>P2: Reference to eSign-PIN.<br>2.<br>The Signature Terminal generates the secured command APDU for the RESET<br>RETRY COUNTER command and transmits it to the LT.<br>3.<br>The LT verifies the secured command APDU for the RESET RETRY COUNTER<br>command.<br>4.<br>The LT sends the secured response APDU with an error code back to the<br>Signature Terminal;<br>Secured Response APDU for RESET RETRY COUNTER:<br>'99 02 69 82 8E 08 <MAC> 69 82'.<br>5.<br>The Signature Terminal sends the unsecured response APDU for the RESET<br>RETRY COUNTER command back to the UT. |
| Expected results | 1.<br>-<br>2.<br>-<br>3.<br>The secured command APDU for the RESET RETRY COUNTER which LT receives<br>from the DUT is built up as follows;<br>Secured command APDU RESET RETRY COUNTER:<br>'0C 2C 03 P2 <Lc> 8E 08 <MAC> 00';<br>P2: Reference of the eSign-PIN.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

|                 | 4.<br>-<br>5.<br>The unsecured response APDU for the RESET RETRY COUNTER with an error<br>code which UT receives from the DUT is built up as follows:<br>Unsecured response APDU RESET RETRY COUNTER:<br>'69 82'. |
|-----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Post processing | Reset of smart card and the DUT.                                                                                                                                                                                  |

| Test ID          | R_Sig_6.9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that the DUT aborts resetting the retry counter of the eSign-PIN if the<br>password which is used for the PACE protocol doesn't provide the required permits.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with Password-ID CAN which is entered<br>via the PIN Pad of the Signature Terminal.                                                                                                                                                                                                                                                                                           |
| References       | [TR-03117], 4.4.3, A.2.3, [TR-03110-3] B.6.1, B.11.6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Profiles         | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Preconditions    | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Status of the eSign-PIN is "operational" and blocked.<br>Use counter of the PUK is not zero, i.e. the processing of a further reset retry counter<br>is possible.<br>Successful PACE protocol with CAN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>The eSign application was successfully selected.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                |
| Test scenario    | 1.<br>UT sends the unsecured command RESET RETRY COUNTER to the Signature<br>Terminal.:<br>Unsecured command APDU for RESET RETRY COUNTER:<br>'00 2C 03 P2 <Lc> <data is empty>';<br>P2: Reference to eSign-PIN.<br>2.<br>The Signature Terminal generates the secured command APDU for the RESET<br>RETRY COUNTER command and transmits it to the LT.<br>3.<br>The LT verifies the secured command APDU for the RESET RETRY COUNTER<br>command.<br>4.<br>The LT sends the secured response APDU with an error code back to the<br>Signature Terminal;<br>Secured Response APDU for RESET RETRY COUNTER:<br>'99 02 69 82 8E 08 <MAC> 69 82'.<br>5.<br>The Signature Terminal sends the unsecured response APDU for the RESET<br>RETRY COUNTER command back to the UT. |
| Expected results | 1.<br>-<br>2.<br>-<br>3.<br>The secured command APDU for the RESET RETRY COUNTER which LT receives<br>from the DUT is built up as follows;<br>Secured command APDU RESET RETRY COUNTER:<br>'0C 2C 03 P2 <Lc> 8E 08 <MAC> 00';<br>P2: Reference of the eSign-PIN.<br>4.<br>-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |

|                 | 5.<br>The unsecured response APDU for the RESET RETRY COUNTER with an error<br>code which UT receives from the DUT is built up as follows:<br>Unsecured response APDU RESET RETRY COUNTER:<br>'69 82'. |
|-----------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Post processing | Reset of smart card and the DUT.                                                                                                                                                                       |

| Test ID          | R_Sig_6.10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose          | Check that the DUT aborts resetting the retry counter of the eSign-PIN if the LT<br>returns an error code to the command Reset Retry Counter.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with Password-ID PUK which is entered<br>via the PIN Pad of the Signature Terminal.                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| References       | [TR-03117], 4.4.3, A.2.3, [TR-03110-3] B.6.1, B.11.6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Profiles         | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Preconditions    | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Successful PACE protocol with PUK, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>The eSign application was successfully selected.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Test scenario    | 1.<br>UT sends the unsecured command RESET RETRY COUNTER to the Signature<br>Terminal.:<br>Unsecured command APDU for RESET RETRY COUNTER:<br>'00 2C 03 P2 <Lc> <data is empty>';<br>P2: Reference to eSign-PIN.<br>2.<br>The Signature Terminal generates the secured command APDU for the RESET<br>RETRY COUNTER command and transmits it to the LT.<br>3.<br>The LT verifies the secured command APDU for the RESET RETRY COUNTER<br>command.<br>4.<br>The LT sends the secured response APDU with an error code back to the<br>Signature Terminal;<br>Secured Response APDU for RESET RETRY COUNTER:<br>'99 02 SW1 SW2 8E 08 <MAC> SW1 SW2' with<br>SW1 SW2 = '69 84' (Referenced data invalidated) or<br>SW1 SW2 = '6A 88' (Referenced data not found).<br>5.<br>The Signature Terminal sends the unsecured response APDU for the RESET<br>RETRY COUNTER command back to the UT. |
| Expected results | 1.<br>-<br>2.<br>-<br>3.<br>The secured command APDU for the RESET RETRY COUNTER which LT receives<br>from the DUT is built up as follows;<br>Secured command APDU RESET RETRY COUNTER:<br>'0C 2C 03 P2 <Lc> 8E 08 <MAC> 00';<br>P2: Reference of the eSign-PIN.<br>4.<br>-<br>5.<br>The unsecured response APDU for the RESET RETRY COUNTER with an error<br>code which UT receives from the DUT is built up as follows:                                                                                                                                                                                                                                                                                                                                                                                                                                                             |

|                 | Unsecured response APDU RESET RETRY COUNTER:<br>SW1 SW2 with<br>SW1 SW2 = '69 84' (Referenced data invalidated) or<br>SW1 SW2 = '6A 88' (Referenced data not found). |
|-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Post processing | Reset of smart card and the DUT.                                                                                                                                     |

### 5.7.7 R\_Sig\_7 – Successful Termination of the Signature Function

| Test ID       | R_Sig_7.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check correct execution of the termination of the eSign-PIN with a Signature<br>Terminal.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with Password-ID PIN which is entered<br>via the PIN Pad of the Signature Terminal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| References    | [TR-03117], 4.4.4, A.2.6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Profiles      | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Preconditions | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Test scenario | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '03' (PIN is used)<br>•<br><CHAT>: Restricted CHAT: at least "Generate qualified electronic signature"<br>•<br><PIN>: empty, because password (PIN) is entered via PIN Pad of the DUT.<br>2.<br>Entering the correct PIN into the DUT.<br>3.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapters 4.3.1, 4.3.2 and 4.3.3. The return codes in all<br>response APDUs are positive ('90 00'). In case of a Signature Terminal all<br>authentication protocols (PACE, TA and CA) are completely performed within<br>EstablishPACEChannel between the DUT and LT.<br>4.<br>UT receives OutBuffer of ScardControl (see chapter 4.2.4).<br>5.<br>The execution steps for the selection of the eSign application have to be<br>performed as described in chapter 4.3.4: UT sends command APDUs to the DUT<br>via PC/SC (without SM). LT receives command APDUs (with SM) from the DUT<br>and sends response APDUs (with SM) back to the DUT. UT receives response<br>APDUs from the DUT via PC/SC (without SM). The return codes in all response<br>APDUs are positive ('90 00').<br>6.<br>UT sends unsecured command TERMINATE to the Signature Terminal:<br>Unsecured command APDU for Terminate:<br>'00 E6 10 P2 <Lc> <data empty>';<br>P2: Reference to eSign-PIN.<br>7.<br>The Signature Terminal generates the secured command APDU for the<br>TERMINATE command and transmits it to the LT.<br>8.<br>The LT verifies the secured command APDU for the TERMINATE command.<br>9.<br>The LT sends the secured response APDU back to the Signature Terminal;<br>Secured Response APDU for TERMINATE: |

|                  | '99 02 90 00 8E 08 <MAC> 90 00'.<br>10. The Signature Terminal sends the unsecured response APDU for the TERMINATE<br>command back to the UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>-<br>2.<br>-<br>3.<br>The command APDUs for the authentication protocols which LT receives from<br>the DUT are built up as described in chapters 4.3.1, 4.3.2 and 4.3.3. For the PACE<br>protocol with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '03' (PIN).<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '03'<br>(Signature Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 21, No. 1.<br>4.<br>For the OutBuffer of ScardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i.e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>5.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is<br>correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.<br>6.<br>-<br>7.<br>-<br>8.<br>The secured command APDU for the TERMINATE command which LT receives<br>from the DUT is built up as follows;<br>Secured command APDU TERMINATE:<br>'0C E6 10 P2 <Lc> 8E 08 <MAC> 00';<br>P2: Reference of the eSign-PIN.<br>9.<br>-<br>10. The unsecured response APDU for the TERMINATE command which UT receives<br>from the DUT is built up as follows:<br>Unsecured response APDU TERMINATE: |
| Post processing  | '90 00'.<br>Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |

| Test ID       | R_Sig_7.2                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check correct execution of the termination of the private signature key with a<br>Signature Terminal.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with Password-ID PIN which is entered<br>via the PIN Pad of the Signature Terminal. |
| References    | [TR-03117], 4.4.4, A.2.6                                                                                                                                                                                                                                                                                                                                                                                      |
| Profiles      | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                            |
| Preconditions | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2                                                                                                                                                                                                                                                                   |

|                  | Make certificates available in UT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Test scenario    | 1.<br>UT calls PC/SC function SCardControl with InBuffer for EstablishPACEChannel<br>(see chapter 4.2.3), where the positions in InBuffer are defined as follows:<br>•<br><Password-ID>: '03' (PIN is used)<br>•<br><CHAT>: Restricted CHAT: at least "Generate qualified electronic signature"<br>•<br><PIN>: empty, because password (PIN) is entered via PIN Pad of the DUT.<br>2.<br>Entering the correct PIN into the DUT.<br>3.<br>LT receives command APDUs from the DUT and sends response APDUs back to<br>the DUT as described in chapters 4.3.1, 4.3.2 and 4.3.3. The return codes in all<br>response APDUs are positive ('90 00'). In case of a Signature Terminal all<br>authentication protocols (PACE, TA and CA) are completely performed within<br>EstablishPACEChannel between the DUT and LT.<br>4.<br>UT receives OutBuffer of ScardControl (see chapter 4.2.4).<br>5.<br>The execution steps for the selection of the eSign application have to be<br>performed as described in chapter 4.3.4: UT sends command APDUs to the DUT<br>via PC/SC (without SM). LT receives command APDUs (with SM) from the DUT<br>and sends response APDUs (with SM) back to the DUT. UT receives response<br>APDUs from the DUT via PC/SC (without SM). The return codes in all response<br>APDUs are positive ('90 00').<br>6.<br>UT sends unsecured command TERMINATE to the Signature Terminal:<br>Unsecured command APDU for Terminate:<br>'00 E6 21 00 <Lc> <DST with reference to the signature key>';<br>DST with reference to the signature key:<br>B6 <LB6> 84 <L84> <private key reference>.<br>7.<br>The Signature Terminal generates the secured command APDU for the<br>TERMINATE command and transmits it to the LT.<br>8.<br>The LT verifies the secured command APDU for the TERMINATE command.<br>9.<br>The LT sends the secured response APDU back to the Signature Terminal;<br>Secured Response APDU for TERMINATE:<br>'99 02 90 00 8E 08 <MAC> 90 00'.<br>10. The Signature Terminal sends the unsecured response APDU for the |
|                  | TERMINATE command back to the UT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Expected results | 1.<br>-<br>2.<br>-<br>3.<br>The command APDUs for the authentication protocols which LT receives from<br>the DUT are built up as described in chapters 4.3.1, 4.3.2 and 4.3.3. For the PACE<br>protocol with the following additions:<br>•<br>The <Password-ID> in command APDU to MSE: Set AT is '03' (PIN).<br>•<br>The role in <OID-Role> in command APDU to MSE: Set AT is '03'<br>(Signature Terminal).<br>•<br>The <access rights> in command APDU to MSE: Set AT are as defined<br>in table 21, No. 1.<br>4.<br>For the OutBuffer of ScardControl, that UT receives (see chapter 4.2.4), the<br>following holds:<br>•<br><Result_Code>: The result code is positive (i.e. '00 00 00 00').<br>•<br><status_mse>: The status code for command MSE: Set AT is '90 00'.<br>•<br><data_card_acc>: The transmitted smart card data for card access<br>coincide with the data of EF.CardAccess in LT.<br>5.<br>Each command APDU received at LT is correctly coded and secured by SM and<br>coincides apart from SM with the command APDU sent by UT directly before.<br>The SM in the command APDU generated by the DUT and received by LT is                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

|                 | correct.<br>Each response APDU received at UT is correctly coded without SM and coincides<br>apart from SM with the response APDU sent by LT directly before.<br>6.<br>-<br>7.<br>-<br>8.<br>The secured command APDU for the TERMINATE command which LT receives<br>from the DUT is built up as follows;<br>Secured command APDU TERMINATE:<br>'0C E6 21 00 <Lc> 87 <L87> <Cryptogram> 8E 08 <MAC> 00';<br>Cryptogram: Encrypted DST with reference to the private signature key:<br>DST with reference to the signature key:<br>B6 <LB6> 84 <L84> <private key reference>.<br>9.<br>-<br>10. The unsecured response APDU for the TERMINATE command which UT receives<br>from the DUT is built up as follows:<br>Unsecured response APDU TERMINATE:<br>'90 00'. |
|-----------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Post processing | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

#### 5.7.8 R\_Sig\_8 – Abort Termination of the Signature Function

| Test ID       | R_Sig_8.1_template                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|---------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts termination of the signature function if the Signature<br>Terminal does not have a certificate with the access right "Generate qualified<br>electronic signature". The test case covers the two variants<br>–<br>termination of the eSign-PIN and<br>–<br>termination of the private signature key.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal without access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with Password-ID PIN which is entered<br>via the PIN Pad of the Signature Terminal. |
| References    | [TR-03117], 4.4.4, A.2.6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Profiles      | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Preconditions | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 2; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Successful PACE protocol with PIN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>The eSign application was successfully selected.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                        |
| Test scenario | 1.<br>UT calls function (see table 47) bysending unsecured command TERMINATE.<br>2.<br>The Signature Terminal generates the secured command APDU for the<br>TERMINATE command and transmits it to the LT.<br>3.<br>The LT verifies the secured command APDU for the TERMINATE command.<br>4.<br>The LT sends the secured response APDU with an error code back to the<br>Signature Terminal;<br>Secured Response APDU for TERMINATE:<br>'99 02 69 82 8E 08 <MAC> 69 82'.<br>5.<br>The Signature Terminal sends the unsecured response APDU for the                                                                                       |

|                  | TERMINATE command back to the UT.                                                                                                                                                                                                                                                                                                                               |
|------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Expected results | 1.<br>-<br>2.<br>-<br>3.<br>The secured command APDU for the TERMINATE command which LT receives<br>from the DUT is built up as described in table 47.<br>4.<br>-<br>5.<br>The unsecured response APDU with an error code for the TERMINATE command<br>which UT receives from the DUT is built up as follows:<br>Unsecured response APDU TERMINATE:<br>'69 82'. |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                |

| Test case  | Function                                     | Test scenario (Step 1)                                                                                                                                                                                                                          | Expected results (Step 3)                                                                                                                                                                                                                                                                                     |
|------------|----------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| R_Sig_8.1a | Termination of the<br>eSign-PIN.             | Unsecured command APDU for<br>TERMINATE the eSign-PIN:<br>'00 E6 10 P2 <Lc> <data empty>'<br>with<br>P2: Reference to eSign-PIN;                                                                                                                | Secured command APDU<br>TERMINATE the eSign-PIN:<br>'0C E6 10 P2 <Lc> 8E 08 <MAC><br>00';<br>P2: Reference of the eSign-PIN                                                                                                                                                                                   |
| R_Sig_8.1b | Termination of the<br>private signature key. | Unsecured command APDU for<br>TERMINATE the private<br>signature key:<br>'00 E6 21 00 <Lc> <DST with<br>reference to the signature key>'<br>with<br>DST with reference to the<br>signature key:<br>B6 <LB6> 84 <L84> <private key<br>reference> | Secured command APDU<br>TERMINATE the private<br>signature key:<br>'0C E6 21 00 <Lc> 87 <L87><br><Cryptogram> 8E 08 <MAC> 00';<br>Cryptogram: Encrypted DST<br>with reference to the private<br>signature key:<br>DST with reference to the<br>signature key:<br>B6 <LB6> 84 <L84> <private key<br>reference> |

#### <span id="page-135-0"></span>Table 47: Test case R\_Sig\_8.1

| Test ID       | R_Sig_8.2_template                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|---------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Purpose       | Check that the DUT aborts termination of the signature function if the password<br>which is used for the PACE protocol doesn't provide the required permits. The test<br>case covers the two variants<br>–<br>termination of the eSign-PIN and<br>–<br>termination of the private signature key.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with Password-ID CAN which is entered<br>via the PIN Pad of the Signature Terminal. |
| References    | [TR-03117], 4.4.4, A.2.6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Profiles      | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Preconditions | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.                                                                                                                                                                                                                                                                                                                                                                                                                        |

|                  | Successful PACE protocol with CAN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>The eSign application was successfully selected.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                                                                                                                                                                                          |  |
|------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| Test scenario    | 1.<br>UT calls function (see table 48) by sending unsecured command TERMINATE to<br>the Signature Terminal.<br>2.<br>The Signature Terminal generates the secured command APDU for the<br>TERMINATE command and transmits it to the LT.<br>3.<br>The LT verifies the secured command APDU for the TERMINATE command.<br>4.<br>The LT sends the secured response APDU with an error code back to the<br>Signature Terminal;<br>Secured Response APDU for TERMINATE:<br>'99 02 69 82 8E 08 <MAC> 69 82'.<br>5.<br>The Signature Terminal sends the unsecured response APDU for the TERMINATE<br>command back to the UT. |  |
| Expected results | 1.<br>-<br>2.<br>-<br>3.<br>The secured command APDU for the TERMINATE command which LT receives<br>from the DUT is built up as described in table 48.<br>4.<br>-<br>5.<br>The unsecured response APDU with an error code for the TERMINATE command<br>which UT receives from the DUT is built up as follows:<br>Unsecured response APDU TERMINATE:<br>'69 82'.                                                                                                                                                                                                                                                       |  |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |  |

| Test case  | Function                                     | Test scenario (Step 1)                                                                                                                                                                                                                          | Expected results (Step 3)                                                                                                                                                                                                                                                                                     |
|------------|----------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| R_Sig_8.2a | Termination of the<br>eSign-PIN.             | Unsecured command APDU for<br>Terminate the eSign-PIN:<br>'00 E6 10 P2 <Lc> <data empty>'<br>with<br>P2: Reference to eSign-PIN;                                                                                                                | Secured command APDU<br>TERMINATE the eSign-PIN:<br>'0C E6 10 P2 <Lc> 8E 08 <MAC><br>00';<br>P2: Reference of the eSign-PIN                                                                                                                                                                                   |
| R_Sig_8.2b | Termination of the<br>private signature key. | Unsecured command APDU for<br>TERMINATE the private<br>signature key:<br>'00 E6 21 00 <Lc> <DST with<br>reference to the signature key>'<br>with<br>DST with reference to the<br>signature key:<br>B6 <LB6> 84 <L84> <private key<br>reference> | Secured command APDU<br>TERMINATE the private<br>signature key:<br>'0C E6 21 00 <Lc> 87 <L87><br><Cryptogram> 8E 08 <MAC> 00';<br>Cryptogram: Encrypted DST<br>with reference to the private<br>signature key:<br>DST with reference to the<br>signature key:<br>B6 <LB6> 84 <L84> <private key<br>reference> |

<span id="page-136-0"></span>Table 48: Test case R\_Sig\_8.2

| Test ID | R_Sig_8.3_template                                                                   |
|---------|--------------------------------------------------------------------------------------|
| Purpose | Check that the DUT aborts termination of the signature function if the LT returns an |

|                  | error code to the command Terminate. The test case covers the two variants<br>–<br>termination of the eSign-PIN and<br>–<br>termination of the private signature key.<br>PACE, TA and CA between Signature Terminal and LT. Use of certificate with role<br>Signature Terminal with access right "Generate qualified electronic signature".<br>The test for the PACE protocol is executed with Password-ID PIN which is entered<br>via the PIN Pad of the Signature Terminal.                                                                                                                                                                                                                                                       |  |
|------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| References       | [TR-03110-2], 3.4.4, [TR-03110-3], A.2.6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |  |
| Profiles         | R_PACE AND R_TA AND R_CA AND R_Sig                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |  |
| Preconditions    | Certificate with role Signature Terminal and access rights according to<br>table 21, No. 1; CA certificates according to table 24, No. 1, 2<br>Make certificates available in UT.<br>Successful PACE protocol with CAN, TA and CA between Signature Terminal and LT<br>with establishment of a trusted channel.<br>The eSign application was successfully selected.<br>Reference eSign-PIN is retrieved from DF.CIA stored in LT.                                                                                                                                                                                                                                                                                                   |  |
| Test scenario    | 1.<br>UT calls function (see table 49) by sending unsecured command TERMINATE to<br>the Signature Terminal.<br>2.<br>The Signature Terminal generates the secured command APDU for the<br>TERMINATE command and transmits it to the LT.<br>3.<br>The LT verifies the secured command APDU for the TERMINATE command.<br>4.<br>The LT sends the secured response APDU with an error code back to the<br>Signature Terminal;<br>Secured Response APDU for TERMINATE:<br>'99 02 SW1 SW2 8E 08 <MAC> SW1 SW2' with<br>SW1 SW2 = '69 84' (Reference data not usable) or<br>SW1 SW2 = '6A 88' (Referenced data not found).<br>5.<br>The Signature Terminal sends the unsecured response APDU for the TERMINATE<br>command back to the UT. |  |
| Expected results | 1.<br>-<br>2.<br>-<br>3.<br>The secured command APDU for the Terminate command which LT receives<br>from the DUT is built up as described in table 49.<br>4.<br>-<br>5.<br>The unsecured response APDU with an error code for the TERMINATE command<br>which UT receives from the DUT is built up as follows:<br>Unsecured response APDU TERMINATE:<br>SW1 SW2 with<br>SW1 SW2 = '69 84' (Reference data not usable) or<br>SW1 SW2 = '6A 88' (Referenced data not found).                                                                                                                                                                                                                                                           |  |
| Post processing  | Reset of smart card and the DUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |  |

| Test case  | Function                                     | Test scenario (Step 1)                                                                                                                                                                                                                          | Expected results (Step 3)                                                                                                                                                                                                                                                                                     |
|------------|----------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| R_Sig_8.3a | Termination of the<br>eSign-PIN.             | Unsecured command APDU for<br>Terminate the eSign-PIN:<br>'00 E6 10 P2 <Lc> <data empty>'<br>with<br>P2: Reference to eSign-PIN;                                                                                                                | Secured command APDU<br>TERMINATE the eSign-PIN:<br>'0C E6 10 P2 <Lc> 8E 08 <MAC><br>00';<br>P2: Reference of the eSign-PIN                                                                                                                                                                                   |
| R_Sig_8.3b | Termination of the<br>private signature key. | Unsecured command APDU for<br>TERMINATE the private<br>signature key:<br>'00 E6 21 00 <Lc> <DST with<br>reference to the signature key>'<br>with<br>DST with reference to the<br>signature key:<br>B6 <LB6> 84 <L84> <private key<br>reference> | Secured command APDU<br>TERMINATE the private<br>signature key:<br>'0C E6 21 00 <Lc> 87 <L87><br><Cryptogram> 8E 08 <MAC> 00';<br>Cryptogram: Encrypted DST<br>with reference to the private<br>signature key:<br>DST with reference to the<br>signature key:<br>B6 <LB6> 84 <L84> <private key<br>reference> |

<span id="page-138-0"></span>Table 49: Test case R\_Sig\_8.3

## Annex

### Bibliography

| TR-03105-5.3 | BSI:Technical Guideline TR-03105 Test plan for eID and eSign compliant eCard reader        |  |
|--------------|--------------------------------------------------------------------------------------------|--|
|              | systems with EACv2 - Terminal Software, Part 5.3, Version 1.2                              |  |
| TR-03110-2   | BSI:Technical Guideline TR-03110-2 Advanced Security Mechanisms for Machine                |  |
|              | Readable Travel Documents and eIDAS Token –Part 2 – Protocols for electronic               |  |
|              | IDentification, Authentication and trust Services (eIDAS)                                  |  |
| TR-03117     | BSI: Technische Richtlinie TR-03117, eCards mit kontaktloser Schnittstelle als sichere     |  |
|              | Signaturerstellungseinheit; Version 1.0                                                    |  |
| TR-03119     | BSI: Technische Richtlinie TR-03119, Requirements for Smart Card Readers Supporting        |  |
|              | eID and eSign Based on Extended Access Control, Version 1.3                                |  |
| TR-03112-1   | BSI: Technische Richtlinie BSI TR-03112-1, eCard-API-Framework                             |  |
| TR-03110-3   | BSI:Technical Guideline TR-03110-3 Advanced Security Mechanisms for Machine                |  |
|              | Readable Travel Documents and eIDAS Token –Part 3 – Common Specifications                  |  |
| PCSC10       | Apple etc.:Interoperability Specifications for ICCs and Personal Computer Systems, Part    |  |
|              | 10 IFDs with Secure PIN Entry Capabilities, Revision 2.02.06, April 2009                   |  |
| TR-03110-4   | BSI:Technical Guideline TR-03110-4 Advanced Security Mechanisms for Machine                |  |
|              | Readable Travel Documents and eIDAS Token –Part 4 – Applications and Document              |  |
|              | Profiles                                                                                   |  |
| SigG         | Gesetz über die Rahmenbedingungen für elektronische Signaturen (Signaturgesetz –           |  |
|              | SigG) vom 16. Mai 2001 (BGBl. I S. 876), zuletzt geändert durch Artikel 4 des Gesetzes vom |  |
|              | 17. Juli 2009                                                                              |  |
| SigV         | Verordnung zur elektronischen Signatur (Signaturverordnung – SigV) vom 16. November        |  |
|              | 2001 (BGBl. I S. 3074), zuletzt geändert durch Verordnung vom 17. Dezember 2009            |  |
| ISO-7816     | ISO 7816: Identification Cards - Integrated Circuit Cards with Contacts                    |  |
|              |                                                                                            |  |

| Abbreviation | Explanation                                     |
|--------------|-------------------------------------------------|
| AID          | Application Identification                      |
| API          | Application Programming Interface               |
| AT           | Authentication Template                         |
| CA           | Chip Authentication                             |
| CAN          | Card Access Number                              |
| CHAT         | Card Holder Authorization Template              |
| CIA          | Cryptographic Information Application           |
| CLI          | Contactless Interface                           |
| CT-API       | Card Terminal API                               |
| CVCA         | Country Verifying Certification Authority       |
| DF           | Dedicated File                                  |
| DG           | Data Group                                      |
| DST          | Digital Signature Template                      |
| DUT          | Device Under Test                               |
| EAC          | Extended Access Control                         |
| eID          | Electronic Identity                             |
| ID           | Identifier                                      |
| LT           | Lower Tester                                    |
| MRZ          | Machine Readable Zone                           |
| MSE          | Manage Security Environment                     |
| OSI          | Open Systems Interconnection Reference Model    |
| PACE         | Password Authenticated Connection Establishment |
| PC/SC        | Personal Computer / Smart card                  |
| PIN          | Personal Identification Number                  |

| Abbreviation | Explanation                                            |
|--------------|--------------------------------------------------------|
| PSO          | Perform Security Operation                             |
| PUK          | PIN Unblocking Key                                     |
| RI           | Restricted Identification                              |
| QCA          | Certification Authority issuing qualified certificates |
| QES          | Qualified Electronic Signature                         |
| SICCT        | Secure Interoperable Chip Card Terminal                |
| SigG         | Digital Signature Act (German)                         |
| SigV         | Digital Signature Ordinance (German)                   |
| SM           | Secure Messaging                                       |
| SSCD         | Secure Signature Creation Device                       |
| TA           | Terminal Authentication                                |
| UT           | Upper Tester                                           |