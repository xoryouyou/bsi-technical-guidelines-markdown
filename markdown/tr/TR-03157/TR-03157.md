![](_page_0_Picture_0.jpeg)

# Konnektor – Prüfspezifikation für das Fachmodul ePA

Technische Richtlinie BSI TR-03157

Trial Use[1](#page-0-0)

<span id="page-0-0"></span>1 Erläuterung siehe Abschnitt [1.5](#page-8-0)

# <span id="page-1-0"></span>Änderungshistorie

| Version | Datum      | Name                                          | Beschreibung                                                     |
|---------|------------|-----------------------------------------------|------------------------------------------------------------------|
| 1.0     | 20.12.2018 | SRC Security<br>Research &<br>Consulting GmbH | Zu OPB Release 3.0.0                                             |
| 1.1     | 19.06.2019 | SRC Security<br>Research &<br>Consulting GmbH | Zu OPB Release 3.1.0<br>Nutzung der Schlüsselgenerierungsdienste |
| 1.2     | 24.07.2019 | SRC Security<br>Research &<br>Consulting GmbH | Zu OPB Release 3.1.1                                             |

Bundesamt für Sicherheit in der Informationstechnik Postfach 20 03 63 53133 Bonn E-Mail: zertifizierung@bsi.bund.de Internet: https://www.bsi.bund.de © Bundesamt für Sicherheit in der Informationstechnik 2019

|                | Änderungshistorie 2                                                    |  |
|----------------|------------------------------------------------------------------------|--|
|                | Danksagung 3                                                           |  |
| 1              | Einleitung 7                                                           |  |
| 1.1            | Gegenstand der Technischen Richtlinie 7                                |  |
| 1.2            | Sicherheitsleistungen des Fachmoduls elektronische Patientenakte7      |  |
| 1.3            | Zielsetzung der Technischen Richtlinie 8                               |  |
| 1.4            | Übersicht der Technischen Richtlinie 9                                 |  |
| 1.4.1          | Methodik 9                                                             |  |
| 1.4.2          | Begriffe 9                                                             |  |
| 1.5            | Offene Punkte 10                                                       |  |
| 2              | Überblick Fachmodul elektronische Patientenakte11                      |  |
| 2.1            | Spezifische Konzepte 11                                                |  |
| 2.1.1          | Verschlüsselte Datenhaltung 11                                         |  |
| 2.1.2<br>2.1.3 | Berechtigungsmanagement 14<br>Informationsflusskontrolle 17            |  |
| 2.2            | Verarbeitete Assets 20                                                 |  |
| 2.3            | Abläufe und Benutzungsszenarien 23                                     |  |
| 2.3.1          | Wiederverwendung von Aktensessions23                                   |  |
| 2.3.2          | Grundsätzlicher Ablauf eines Aktenzugriffs24                           |  |
| 2.3.3          | Verwaltung des Aktenkontos 25                                          |  |
| 2.3.4          | Schlüsselableitung der Berechtigtenschlüssel26                         |  |
| 2.4            | Security Problem Definition 29                                         |  |
| 2.4.1<br>2.4.2 | Bedrohungen 29<br>Organisatorische Sicherheitspolitiken30              |  |
| 2.4.3          | Annahmen 30                                                            |  |
| 2.4.4          | Annahmen zu betrieblichen Restrisiken30                                |  |
| 3              | Zertifizierung des FM ePA nach Technischer Richtlinie32                |  |
| 3.1            | Prüfgegenstand und –werkzeuge 32                                       |  |
| 3.2            | Prüfaufgaben 32                                                        |  |
| 3.2.1          | Funktionale Spezifikations-Tests33                                     |  |
| 3.2.2          | Common Criteria Zertifizierung des Konnektors33                        |  |
| 3.2.3          | Sicherheitsziele für das Fachmodul und dessen Umgebung36               |  |
| 3.3<br>3.3.1   | Rationale 44<br>Berücksichtigung typischer Webservice-Schwachstellen47 |  |
| 3.4            | Prüfschritte 49                                                        |  |
| 3.4.1          | Protokollierung der Prüfergebnisse50                                   |  |
| 3.4.2          | Test-Charakteristiken 51                                               |  |
| 4              | TR-Prüfbericht 60                                                      |  |
| 4.1            | Verfahrensschritte 60                                                  |  |
| 4.2            | Prüfaussagen 60                                                        |  |
| 4.3            | Konfiguration 60                                                       |  |
|                | Literaturverzeichnis 62                                                |  |
|                | Stichwortverzeichnis 64                                                |  |

| Abkürzungsverzeichnis 69 |
|--------------------------|
|--------------------------|

# Abbildungsverzeichnis

| Abbildung 1: Beziehungen des FM ePA mit externen Komponenten7<br>Abbildung 2: Ablauf der Schlüsselableitung 12 |  |
|----------------------------------------------------------------------------------------------------------------|--|
|                                                                                                                |  |
|                                                                                                                |  |
| Abbildung 3: Ablauf des Zugriffs auf Patientenakten-Dokumente13                                                |  |
| Abbildung 4: Verschiedene Berechtigungen mit Bezug zum FM ePA15                                                |  |

# Tabellenverzeichnis

| Tabelle 1: Beteiligte Komponenten mit eingesetzten Sicherheitsmerkmalen8                         |  |
|--------------------------------------------------------------------------------------------------|--|
| Tabelle 2: Sicherheitsfunktionen des Fachmoduls ePA8                                             |  |
| Tabelle 3: Prüfungen im Umfeld des Fachmoduls ePA9                                               |  |
| Tabelle 4: Speicherorte von Schlüsselmaterial im ePA-Aktensystem12                               |  |
| Tabelle 5: Attribute der Base Policy einer LEI in der Dokumentenverwaltung16                     |  |
| Tabelle 6: Beteiligung des Fachmoduls am Schutz von Transportkanälen17                           |  |
| Tabelle 7: Informationsfluss und Anforderungen an die Transportsicherung (abstrakt)19            |  |
| Tabelle 8: Assets im Fachmodul ePA 22                                                            |  |
| Tabelle 9: Mehrere Aktensessions zu einer Patientenakte (Beispiel)23                             |  |
| Tabelle 10: Abläufe für die LEI aus den Perspektiven von Primärsystem und Fachmodul25            |  |
| Tabelle 11: Abläufe aus den Perspektiven von Leistungserbringer und Fachmodul26                  |  |
| Tabelle 12: Ablauf der Vorbereitung SGD-Berechtigtenschlüssel26                                  |  |
| Tabelle 13: Ablauf bei wiederkehrendem Zugriff auf Schlüsselmaterial28                           |  |
| Tabelle 14: Initiale Schüsselableitung für den Versicherten28                                    |  |
| Tabelle 15: Initiale Schüsselableitung für einen LEI28                                           |  |
| Tabelle 16: Gemeinsamer Ablauf bei der initialen Schlüsselableitung29                            |  |
| Tabelle 17: Vom Fachmodul genutzte und sicherheitsrelevante Basisfunktionalität des Konnektors35 |  |
| Tabelle 18: Berücksichtigung der Kartengeneration in der SAML2 Signatur39                        |  |
| Tabelle 19: Ausgehende Informationsflüsse und Anforderungen an die Transportsicherung42          |  |
| Tabelle 20: Parameter für die Zertifikatsprüfung an TLS-Dienst43                                 |  |
| Tabelle 21: Rationale SPD-Sicherheitsziele des Fachmoduls und der Umgebung, sowie Restrisiken47  |  |
| Tabelle 22: Rationale OWASP-Sicherheitsziele des Fachmoduls sowie der Umgebung49                 |  |
| Tabelle 23: Definition der Prüftiefen 50                                                         |  |
| Tabelle 24: Definition der Verdicts 51                                                           |  |
| Tabelle 25: Test Charakteristika für das Fachmodul ePA59                                         |  |

# <span id="page-5-0"></span>1 Einleitung

# 1.1 Gegenstand der Technischen Richtlinie

Das Fachmodul elektronische Patientenakte, kurz ePA, ist ein integraler Bestandteil des Konnektors und nutzt die Basisfunktionalitäten des Konnektors zur Umsetzung der Fachanwendung ePA. Weiterhin greift es auf Fachdienste der Telematikinfrastruktur (TI), insbesondere das ePA-Aktensystem zu. [Abbildung 1](#page-5-1) zeigt die wesentlichen Beziehungen zu den Fachdiensten und dem Primärsystem.

![](_page_5_Figure_4.jpeg)

<span id="page-5-1"></span>*Abbildung 1: Beziehungen des FM ePA mit externen Komponenten*

# 1.2 Sicherheitsleistungen des Fachmoduls elektronische Patientenakte

Das Primärsystem greift auf die Patientenakte zu. Die Kommunikation zum Fachmodul erfolgt mit Protokollen angelehnt an Spezifikationen der Initiative 'Integrating the Healthcare Enterprise'. Im Hintergrund etablieren Konnektor und Fachdienste eine Reihe von Sicherheitsmerkmalen, vgl. [Tabelle 1.](#page-6-0)

| Beteiligte Komponente                                  | Eingesetzte Sicherheitsmerkmale                                                               |
|--------------------------------------------------------|-----------------------------------------------------------------------------------------------|
| Primärsystem                                           | (optional) TLS-Authentisierung des Konnektors                                                 |
| Installierter Konnektor mit eHealth<br>Kartenterminals | Authentisierung mittels SM-B und eGK                                                          |
| Zugangsgateway des Versicherten<br>(ZGdV)              | Challenge / Response Verfahren mit der eGK                                                    |
| Autorisierungskomponente                               | Identifizierung mittels AuthenticationAssertion,<br>Kontrollierter Zugang zum Schlüsselkasten |

| Beteiligte Komponente                 | Eingesetzte Sicherheitsmerkmale                                                               |
|---------------------------------------|-----------------------------------------------------------------------------------------------|
| Schlüsselgenerierungsdienst ePA (SGD) | Ableitung von Berechtigtenschlüsseln                                                          |
| Dokumentenverwaltung                  | Zugangsberechtigung mittels AuthorizationAssertion<br>Kontrollierter Zugang zum Datenspeicher |

#### <span id="page-6-0"></span>Tabelle 1: Beteiligte Komponenten mit eingesetzten Sicherheitsmerkmalen

Die vorliegende Technische Richtlinie definiert die Sicherheitsprüfung der im Fachmodul ePA realisierten Sicherheitsleistungen. Diese sind in [Tabelle 2](#page-6-1) auf abstrakter Ebene skizziert. Neben dem Fachmodul sind Sicherheitsleistungen des Konnektors sowie der Fachdienste der Telematikinfrastruktur miteinbezogen.

| Sicherheitsaspekt              | Sicherheitsfunktion                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |  |
|--------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| Verschlüsselte<br>Datenhaltung | Die Dokumentenablage erfolgt in verschlüsselter Form im Datenspeicher der<br>Komponente Dokumentenverwaltung. Das Fachmodul erzeugt dafür je Patientenakte<br>einen Akten- und Kontextschlüssel, sichert diese mit Hilfe der<br>Schlüsselgenerierungsdienste und legt die gesicherten Schlüssel im Schlüsselkasten<br>der Komponente Autorisierung ab. Aufgabe des Fachmoduls ist das<br>Ver-/Entschlüsseln von Dokumenten unter Nutzung des Aktenschlüssels. Weiter<br>verarbeitet das Fachmodul Transaktionen und Klartext-Dokumenten gegenüber dem<br>Primärsystem.                                                         |  |
| Berechtigungs<br>management    | Die Dokumentenverwaltung gewährt dem Fachmodul erst Zugriff, nachdem die<br>Komponente Autorisierung die Authentizität des Anfragenden geprüft hat. Hierfür<br>erzeugt das Fachmodul für den LEI eine AuthenticationAssertion, wohingegen die<br>AuthenticationAssertion für einen Versicherten / Vertreter vom ZGdV erstellt wird.<br>Wird eine Adhoc-Berechtigung neu für einen LEI eingerichtet, erstellt das Fachmodul<br>die BasePolicy mit der Identifikation der Akte, des Berechtigten sowie<br>Berechtigungsart und -dauer. Die BasePolicy wird an die VAU übermittelt und dort für<br>die Zugriffskontrolle genutzt. |  |
| Informationsfluss<br>kontrolle | Patienten besitzen die freie Wahl zwischen Aktensystemanbietern. Daher können bei<br>jeder Patientenakte andere Komponenten der Telematikinfrastruktur (TI) beteiligt<br>sein. Das Fachmodul stellt über die TI-Zertifikat mit rollenspezifisch vergebenen<br>Zertifikatseigenschaften sicher, dass diese Dienste von der gematik geprüft worden<br>sind. Die Weitergabe von klarer bzw. gesicherten Informationen wird durch das<br>Fachmodul reglementiert. Die Verarbeitung von der eGK eingelesenen Daten wird<br>gegenüber bekannten Angriffen gehärtet.                                                                  |  |

<span id="page-6-1"></span>Tabelle 2: Sicherheitsfunktionen des Fachmoduls ePA

# 1.3 Zielsetzung der Technischen Richtlinie

Die Technische Richtlinie beschreibt und begründet die Testanforderungen an Fachmodule elektronische Patientenakte (ePA). Zielsetzung dieser Prüfvorschrift ist die Beschreibung von Prüfaktivitäten basierend auf explizit formulierten Sicherheitseigenschaften des Fachmoduls, die die Sichtung des Quelltextes sowie gegebenenfalls automatisierte Tests umfasst.

Im Umfeld des Fachmoduls ePA sind die in [Tabelle 3](#page-7-0) aufgeführten Prüfungen vorgesehen. Die verschiedenen Verfahren sind in [gemKPT\_Feldtest\_Kon\_ePA#Abbildung 1] dargestellt. Die vorliegende TR bezieht sich lediglich auf Zeile 4.

| #                           | Bezeichnung | Erläuterung                                                        |
|-----------------------------|-------------|--------------------------------------------------------------------|
| 1.<br>gematik Zulassung des |             | Der Netz- und Anwendungskonnektor unterliegt einer Common Criteria |

| #   | Bezeichnung                                                                                  | Erläuterung                                                                                                                                                                                                                                                                                                                                                                                                                                |  |
|-----|----------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
|     | Konnektors<br>CC-Zertifizierung des<br>Konnektors                                            | Evaluation nach Schutzprofilen. Zusätzlich MUSS das Zertifikat über das<br>Schutzprofil des Konnektors hinausgehende Fähigkeiten der<br>Basisfunktionalitäten gemäß [gemProdT_Kon#3.2.1 bestätigen.                                                                                                                                                                                                                                        |  |
| 2.  | Prüfung des Fachmoduls<br>auf Konformität zur<br>Spezifikation durch den<br>Hersteller       | Die Konformitätsprüfung durch den Hersteller wird als funktionaler Test<br>an den Schnittstellen durchgeführt. Sie stellt das spezifikationskonforme<br>des Fachmoduls nach [gemSpec_FM_ ePA] sicher.                                                                                                                                                                                                                                      |  |
| 3.  | Prüfung des Fachmoduls<br>auf Konformität zur<br>Spezifikation durch die<br>gematik          | Die Berichte und Zusammenfassung der herstellerspezifischen Tests (Zeile<br>2) sind die Voraussetzung für die Zulassung durch die gematik . Dazu<br>erfolgen zusätzlich funktionale Test als reiner Blackbox Test, d.h. ohne<br>Zugriff auf Implementierungsdetails. Die gematik validiert damit die<br>Erfüllung wesentlicher Aspekte der Spezifikation. Details zum Testumfang<br>durch die gematik sind in Abschnitt 3.2.1 dargestellt. |  |
| ´4. | Technische Richtlinie zur<br>Sicherheitsprüfung des<br>Fachmoduls<br>(vorliegendes Dokument) | Fokus ist die Erbringung der Sicherheitsfunktionalität durch das<br>Fachmodul; schließt die Quelltextprüfung mit ein, falls erforderlich.<br>Die TR-Zertifizierung kann nur abgeschlossen werden mit dem Verweis<br>auf einen zertifizierten Konnektor (Zeile 1).                                                                                                                                                                          |  |

<span id="page-7-0"></span>Tabelle 3: Prüfungen im Umfeld des Fachmoduls ePA

# 1.4 Übersicht der Technischen Richtlinie

#### 1.4.1 Methodik

Im Folgenden bezeichnet der Begriff TOE Security Functionality (TSF) die Funktionalität des Fachmoduls, die für die Umsetzung der Sicherheit verantwortlich ist. Der TOE umfasst eine konvexe Hülle dieser Funktionen, d.h. für die Umsetzung notwendige unterstützende Funktionen sind eingeschlossen. Der TOE nutzt die Basisfunktionalität des Konnektors, deren Sicherheit bereits in einer vorausgehenden Common Criteria (CC)-Zertifizierung bestätigt wurde. Diese sind daher von der TR-Prüfung für das Fachmodul ausgeschlossen.

Die Technische Richtlinie formuliert im Sinne der CC eine Security Problem Definition (SPD), die den Evaluator in der Test-Abdeckung und Wahl der Testtiefe für die TSF unterstützt. Aus der SPD werden Sicherheitsziele für den TOE und dessen Umgebung abgeleitet. Für die Sicherheitsziele des TOE wird anhand der Test-Charakteristiken eine fachliche Struktur für die zu erstellenden Prüfberichte vorgegeben.

#### 1.4.2 Begriffe

Diese Technische Richtlinie verwendet folgende Begriffe:

| MUSS                         | der TOE muss eine bestimmte Eigenschaft zwingend aufweisen bzw. der Evaluator muss<br>eine bestimmte Prüfung durchführen                                                                                                                                                                                            |  |
|------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| DARF NICHT /<br>DÜRFEN NICHT | der TOE darf eine bestimmte Eigenschaft unter keinen Umständen aufweisen und der<br>Evaluator soll dies nachvollziehen.                                                                                                                                                                                             |  |
| SOLL                         | der TOE soll eine bestimmte Eigenschaft aufweisen, außer es wird dargelegt, dass durch<br>ein Nicht—Umsetzen kein Risiko für den sicheren Betrieb besteht bzw. der Evaluator soll<br>eine Prüfung durchführen, außer er legt dar, dass durch Auslassen der Prüfung kein<br>Risiko für den sicheren Betrieb besteht. |  |
| KANN                         | der TOE kann eine bestimmte Eigenschaft aufweisen, wobei ein Umsetzen dieser                                                                                                                                                                                                                                        |  |

Eigenschaft vom Lösungsanbieter anzuzeigen ist.

Die Abläufe sind informativ dargestellt und sind nachrangig zu der durch Spezifikationen der gematik geforderten Sequenz zu betrachten. *Kursive Definitionen* und *Rationales* sind außerhalb der Betrachtung durch die TR FM ePA. Die Restrisiken für den Betrieb und durch umgebenden Komponenten sind in Abschnitt [2.4.4](#page-28-0) zusammengefasst.

## <span id="page-8-0"></span>1.5 Offene Punkte

Die Anwendung der vorliegenden Technischen Richtlinie (TR) ist für die TR-Zertifizierung eines Fachmoduls ePA in der gematik verbindlich. Die TR ist im Status "trial -use", d.h. dass Sicherheitsziele festgelegt sind, aber noch Erfahrungen mit der Anwendung der TR-Prüfanforderungen während der Evaluierung gesammelt werden sollen. In der "trial-use" Phase unterstützt die TR-Zertifizierungsstelle (in Abstimmung mit der gematik) mittels Interpretation der TR den Evaluator bei konkret auftretenden Fragestellungen. Die so identifizierten Interpretationen fließen in die nächste Version der TR ein.

Diese Fassung der TR berücksichtigt die Anforderungen für ePA aus dem OPB-Release 3.1.1.

# <span id="page-9-0"></span>2 Überblick Fachmodul elektronische Patientenakte

Die gematik nutzt die Spezifikationen von Integrating the Healthcare Enterprise (IHE) für die Standardisierung aller fachlichen Schnittstellen für die Patientenakte. Die Patientenakte wird im Kontext der TR vereinfacht als Menge von IHE Dokumenten angesehen. Operationsaufrufe vom Primärsystem gelangen als IHE Transaktionen an die SOAP-Schnittstelle des Fachmoduls.

Die Systemlösung sieht neben dem Zugang des Leistungserbringers einen Zugang für den Versicherten vor [gemSysL\_Fachanwendung\_ePA#Abbildung 2]. Dort greift das ePA Frontend des Versicherten (FdV) über das ePA Zugangsgateway des Versicherten (abgekürzt ZGdV) auf das ePA Aktensystem zu.

Das Fachmodul ePA realisiert Sicherheitsfunktionen, die sich aus einzelnen Aspekten der gematik Spezifikation ableiten und im Folgenden erläutertet werden. Abschnitt [2.1](#page-9-2) erläutert die Haupt-Sicherheitsfunktionen; Abschnitt [2.2](#page-18-0) definiert die dafür verarbeiteten Assets und Abschnitt [2.3](#page-20-0) illustriert die Abläufe im Fachmodul. Der Abschnitt [2.4](#page-27-0) fasst die Sicherheitsperspektive in Form einer Security Problem Definition zusammen.

# <span id="page-9-2"></span>2.1 Spezifische Konzepte

Die Sensibilität der medizinischen Daten in der Patientenakte stellt hohe Anforderungen an die Berechtigungs- und Verschlüsselungskonzepte [gemSysL\_ePA#2.5]. Grundsätzlich bestimmt der Versicherte die Zugriffsberechtigungen von Dritten auf seine Patientenakte.

Das Fachmodul unterscheidet zwischen medizinischen Dokumenten und deren Metadaten, wobei letztere die Dokumente kategorisieren und beschreiben. Nur die medizinischen Dokumente selbst werden vor ihrer Übertragung an ein externes Aktensystem durch das Fachmodul verschlüsselt. Die Metadaten liegen dem Aktensystem im Klartext vor, etwa um Suchfragen zu verarbeiten. Die Patientenakte wird vom Aktensystem ausschließlich innerhalb einer vertrauenswürdigen Ausführungsumgebung (VAU) verarbeitet und mit dem Kontextschlüssel gesichert persistiert. Der sogenannte Kontext enthält neben den Metadaten auch Protokolldaten nach SGB V §291a sowie Berechtigungen auf Anwendungsebene. Das Fachmodul ist hierbei für die Sicherung von Dokumentenschlüsseln zuständig und an der Einrichtung von Adhoc-Berechtigungen beteiligt.

Die folgenden Abschnitte beschreiben die Konzepte zur Ver- und Entschlüsselung der Dokumente (Abschnitt [2.1.1](#page-9-1)), zum Berechtigungsmanagement (Abschnitt [2.1.2\)](#page-12-0) sowie zur Kontrolle des Informationsflusses Richtung Primärsysteme und Richtung TI bzw. Aktensystem (Abschnitt [2.1.3](#page-15-0)) aus Perspektive des Fachmoduls ePA. Das Fachmodul beugt Angriffen über seine Außenschnittstellen vor (Abschnitt [2.1.3.4\)](#page-17-1) und führt eine Datensparsame Protokollierung durch (Abschnitt [2.1.3.5](#page-17-0)).

## <span id="page-9-1"></span>2.1.1 Verschlüsselte Datenhaltung

Die Patientenakte wird in verschlüsselter Form persistent abgelegt. Aufgabe des Fachmoduls ist IHE-Dokumente zu ver-/entschlüsseln und sie an das Primärsystem weiterzugeben.

Das Schlüsselmanagement und die Schlüsselhierarchie werden in der Systemlösung vorgegeben [gemSysL\_ePA#2.5.6]. Die Akten- und Kontextschlüssel sind in der Komponente Autorisierung persistent gespeichert und werden im Fachmodul sowie weiterhin *im Fachmodul des KTR-Consumers und dem Frontend des Versicherten* entschlüsselt. Andere Komponenten besitzen keine Zugriff auf die Klartext-Schlüssel.

Den Kontextschlüssel einer Patientenakte übergibt das Fachmodul an die VAU und versetzt diese damit in die Lage, auf die in Ihrem Datenspeicher gesichert abgelegten Kontextdaten zuzugreifen. Für den Zugriff auf Dokumente nutzt das Fachmodul den Aktenschlüssel, um auf die individuellen Dokumentenschlüssel für die Ver-/Entschlüsselung der Dokumente zuzugreifen. Die gesicherten Dokumentenschlüssel werden im

Datenspeicher der VAU abgelegt, während die gesicherten Akten-/Kontextschlüssel im Schlüsselspeicher der Komponente Autorisierung aufbewahrt werden. Auf die gesicherten Akten- und Kontextschlüssel greift das Fachmodul über die Berechtigtenschlüssel zu, die es mit Hilfe der Schlüsselableitung erhält ([Tabelle 4](#page-10-0)).

| Asset                 | Speicherort                                                       | Verarbeitung                                                                                                                                                                             |
|-----------------------|-------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Berechtigtenschlüssel | Schlüsselgenerierungsdienst<br>(deterministisch adhoc<br>erzeugt) | Das Fachmodul übermittelt das<br>Authentisierungszertifikat von eGK bzw. SM-B an<br>SGD1 und SGD2, übergibt die sogenannten<br>Associated Data und erhält zwei<br>Berechtigtenschlüssel. |
| Aktenschlüssel        | Schlüsselspeicher der                                             | Das Fachmodul verschlüsselt Akten- und                                                                                                                                                   |
| Kontextschlüssel      | Komponente Autorisierung                                          | Kontextschlüssel im Zwiebelschalenprinzip mit<br>den beiden Berechtigtenschlüsseln.                                                                                                      |
| Dokumentenschlüssel   | Datenspeicher der VAU /<br>Komponente Dokumenten<br>verwaltung    | Das Fachmodul verschlüsselt den<br>Dokumentenschlüssel symmetrisch mit dem<br>Aktenschlüssel.                                                                                            |

<span id="page-10-0"></span>

|  | Tabelle 4: Speicherorte von Schlüsselmaterial im ePA-Aktensystem |
|--|------------------------------------------------------------------|
|  |                                                                  |

![](_page_10_Figure_4.jpeg)

#### <span id="page-10-1"></span>*Abbildung 2: Ablauf der Schlüsselableitung*

Das Fachmodul organisiert die zu einer Patientenakte zugehörigen Informationen in der sogenannten Aktensession, die im Arbeitsspeicher liegt, d.h. nicht persistent gespeichert wird. Zu den Aufgaben des Fachmoduls gehört die Erzeugung neuer Schlüssel mit Hilfe von Zufall aus dem Konnektor, die Sicherung der Kontext-/Akten-/Dokumentenschlüssel vor dem Speichern bzw. Laden sowie das sichere Löschen. *Die Realisierung kryptographischer Funktionen erfolgt stets durch zertifizierte Eigenschaften des Konnektors.* 

Für die Schlüsselableitung werden zwei von unterschiedlichen Anbietern betriebene Schlüsselgenerierungsdiensten (SGD) genutzt, SGD 1 und SGD 2. Von diesen bezieht das Fachmodul die Berechtigtenschlüssel und sichert damit die Akten-/Kontextschlüssel einer Patientenakte. Ein Berechtigtenschlüssel ist jeweils einzigartig für eine Patientenakte, den jeweiligen Zugriffsbefugten (der Versicherte, seine Vertreter, Leistungserbringer und Kassen) und SGD 1 / SGD 2. Akten- und Kontextschlüssel werden klar zusammengefasst als <epa:PHRKey>. Diese Datenstruktur wird dann in mit dem jeweiligen Berechtigtenschlüssel verschlüsselt in der Komponente Autorisierung aufbewahrt. [Abbildung 2](#page-10-1) skizziert die Verschlüsslung nach dem Zwiebelschalenprinzip in der XML-Datenstruktur <epa:EncryptedKeyContainer>.

Zur Schlüsselableitung werden im SGD-HSM lediglich diejenigen Informationen aufbewahrt, die zur Ableitung der Berechtigtenschlüssel genutzt werden. Während der erstmaligen Ableitung erzeugt das SGD-HSM individuell für den Berechtigten zusätzliche Daten [gemSpec\_SGD\_ePA#2], die von der gematik unter dem Begriff Associated Data zusammengefasst werden. Diese Associated Data müssen für jede folgenden Anforderung des Berechtigtenschlüssels durch das Fachmodul übermittelt werden. Liegen diese nicht für die zugreifende Rolle (Versicherter, Vertreter oder Leistungserbringer) vor, wird vom Fachmodul eine initiale Schlüsselableitung durchgeführt. Die persistente Speicherung der Associated Data erfolgt im Schlüsselkasten der Komponente Autorisierung. Das Fachmodul legt die bei der initialen Schlüsselableitung erhaltenen Associated Data dort ab und ruft diese für wiederkehrende Aufrufe dort ab.

In dem genutzten Authentisierungsverfahren bezieht sich **Associated Data** auf die Eigenschaft, dass diese unverschlüsselt, aber authentisiert an einen verschlüsselt hinterlegten Ciphertext angehängt werden. *Die kryptographische Sicherung wird per Authenticated Encryption with Associated Data (AEAD) Blockmodus (TUC\_KON\_075/076) durchgeführt.*

Die IHE-Dokumente einer Patientenakte werden über die VAU im Datenspeicher in der Komponente Dokumentenverwaltung abgelegt. *Die VAU nutzt den Kontextschlüssel, um die Metadaten der Patientenakte zu verarbeiten und um die erste Verschlüsselungsschicht der IHE-Dokumente abzustreifen (vgl. [Abbildung 3](#page-11-0)).*

![](_page_11_Figure_5.jpeg)

<span id="page-11-0"></span>*Abbildung 3: Ablauf des Zugriffs auf Patientenakten-Dokumente*

Das Fachmodul greift zunächst mit dem Aktenschlüssel auf den gesicherten Dokumentenschlüssel zu und entschlüsselt damit das von der VAU erhaltene IHE-Dokument, um es an das Primärsystem weiterzugeben.

Der Datenpfad wird für neu zu speicherende IHE-Dokumente in umgekehrter Reihenfolge durchlaufen. Die Dokumentenverschlüsselung wird von der Basisfunktionalität durchgeführt, die hierfür einen neuen Dokumentenschlüssel erzeugt und mit dem Aktenschlüssel sichert. Der gesicherte Dokumentenschlüssel zusammen mit dem gesicherten Dokument werden an die VAU gesendet, wo eine Sicherung mit dem

Kontextschlüsselung stattfindet, bevor <xenc:EncryptedData> im Datenspeicher persistiert wird (umgekehrter Ablauf zu [Abbildung 3\)](#page-11-0). Wird eine Patientenakte neu eingerichtet, werden Akten- und Kontextschlüssel mit den Berechtigtenschlüsseln der SGD gesichert und im Schlüsselkasten der Komponente Autorisierung persistent gespeichert (umgekehrter Ablauf zu [Abbildung 2](#page-10-1)).

#### <span id="page-12-0"></span>2.1.2 Berechtigungsmanagement

Die elektronischen Patientenakte setzt an verschiedenen Stellen Zugriffskontrollen ein. Neben verwandten Konzepten wird auch der Begriff "Berechtigung" selbst in verschiedenen Kontexten verwendet. Es wird jeweils herausgestellt, welche Aufgabe das Fachmodul dabei trägt. Als Referenz zwischen den Textstellen und der entsprechenden Komponente in [Abbildung 4](#page-13-0) fungieren die Buchstaben (x).

Die Schlüsselableitung erfolgt unabhängig von Berechtigungen und Authentisierung.

#### 2.1.2.1 Versicherte und Vertreter

Die Operationen I\_PHRManagementService::ActivateAccount und I\_PHRManagementService::RequestFacilityAuthentication bedürfen des **Einverständnis des Versicherten**. In der Erteilung dieser Berechtigung ist jeweils die eGK miteingebunden, vgl. (A) in [Abbildung 4](#page-13-0). Aufgabe des Fachmoduls ist es, über das eHealth-Kartenterminal den Versicherten auf die bevorstehende Operation hinzuweisen, bzw. die zukünftigen Berechtigungen der LEI anzuzeigen. Der Versicherte bestätigt dies durch PIN-Eingabe. Danach bittet das Fachmodul das ZgdV um die Erstellung einer AuthenticationAssertion [gemSysL\_Fachanwendung\_ePA#3.4.1]. *Das ZgdV erzeugt eine Challenge, vgl.* (B), die das Fachmodul über den Signaturdienst und die eGK signieren lässt (C). *Das ZGdV prüft die Signatur der Challenge und erzeugt daraufhin eine AuthenticationAssertion über die eGK.*

#### 2.1.2.2 Leistungserbringer

Der Konnektor besitzt Zugriff auf ein oder mehrere SM-B, die ebenfalls für Berechtigungen miteinbezogen werden. Im Aufrufkontext einer SOAP-Anfrage referenziert das Primärsystem das zu nutzende SM-B, nachdem es dieses beim Konnektor freigeschaltet hat. Für bestimmte Operationen erstellt das Fachmodul eine **AuthenticationAssertion** gemäß [gemSpec\_FM\_ePA#6.5.2]. Das Fachmodul erstellt diese als SAML2 Token nach IHE-Profil XUA angereichert mit Angaben aus dem Aufrufkontext und Informationen aus dem SM-B, vgl. (D). Anschließend wird der Datensatz über den Signaturdienst mit der Signatur des SM-B versehen, vgl. (E) und enthält dann alle Informationen zur eindeutigen Identifikation des Aktenkontos, vgl. (F).

#### <span id="page-12-1"></span>2.1.2.3 Dokumentenverwaltung

In der Vertrauenswürdigen Ausführungsumgebung (VAU) der Dokumentenverwaltung werden **XACML 2.0 Profile** für die Zugriffsberechtigung auf Patientenakten genutzt [gemSpec\_Dokumentenverwaltung#5.3], vgl. (G). Diese Berechtigungen werden als Teil der Patientenakte für die VAU nutzbar im Datenspeicher verwahrt.

![](_page_13_Figure_0.jpeg)

<span id="page-13-0"></span>*Abbildung 4: Verschiedene Berechtigungen mit Bezug zum FM ePA*

[gemSpec\_Dokumentenverwaltung #8] unterscheidet für die Policy Dokumente vier Berechtigte: den Versicherten, einen Vertreter, Leistungserbringerinstitutionen und Kassen. *Berechtigungen für den Versicherten werden innerhalb der VAU selbstständig, Berechtigungen für den Vertreter und die Kasse im* 

*Frontend des Versicherten erstellt. Einträge in die Patientenakte werden von Leistungserbringern erstellt, vgl. (H) und Kassen, jedoch kann der Versicherte auch selbst eigene Dokumente hinzufügen, vgl. (J).* Richtet das Primärsystem eine Ad-Hoc Berechtigungsvergabe für einen LEI auf eine Patientenakte ein, stellt das Fachmodul die Base Policy zusammen ([Tabelle 5](#page-14-0) und vgl. (K) ). Die Permission Policy ist im Fachdienst Dokumentenverwaltung fest vorgegeben.

| Base Policy Attribut                                                                                  | Erläuterung                                                                                                                                                                                                                           |  |  |  |
|-------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|--|
| Telematik ID<br>urn:gematik:subject:organization-id                                                   | Das Fachmodul erhält die Telematik-ID und den Namen der<br>Leistungserbringerinstitution vom Konnektor.                                                                                                                               |  |  |  |
| Name der LEI<br>urn:oasis:names:tc:xspa:1.0:subject:organization                                      |                                                                                                                                                                                                                                       |  |  |  |
| Record Identifier<br>urn:ihe:iti:ser:2016:patient-id                                                  | Die KVNR wird von der eGK ausgelesen und in der Aktensession<br>aufbewahrt. In die Base Policy wird nur dessen unveränderbarer<br>Teil überführt.                                                                                     |  |  |  |
| Gültigkeitszeitraum<br>@MatchId urn:oasis:names:tc:xacml:1.0:<br>function:dateTime-less-than-or-equal | Das Primärsystem setzt beim Aufruf von<br>RequestFacilityAuthorization den Gültigkeitszeitraum und die<br>Zugriffsrechte. Das Fachmodul veranlasst deren Bestätigung<br>über das Kartenterminal und überträgt die Daten danach in die |  |  |  |
| Zugriffsrechte<br>urn:gematik:policy-set-id                                                           | Base Policy.<br>Die Zugriffsrechte legen für diese LEI fest, auf welche<br>Dokumentengruppen (Dokumente eingestellt vom<br>Versicherten/Vertreter, von Ärzten, von der Kasse) Zugriff<br>gewährt wird.                                |  |  |  |

<span id="page-14-0"></span>Tabelle 5: Attribute der Base Policy einer LEI in der Dokumentenverwaltung

#### 2.1.2.4 Weitere Berechtigungen

Die Komponente Autorisierung bezieht den Begriff Berechtigung auf das **Vorhalten von Schlüsselmaterial**. Ein Versicherter oder eine Leistungserbringerinstitution gilt als 'berechtigt', sofern für diesen Schlüsselmaterial hinterlegt ist, vgl. (F). Das Fachmodul führt dann zwei Schritte aus. Zuerst fordert es die Berechtigtenschlüssel an, indem es die AuthenticationAssertion an die Komponente Autorisierung sendet. Danach nutzt das Fachmodul die Basisfunktionalität um Akten- und Kontextschlüssel zu entschlüsseln.

Innerhalb eines ePA-Aktensystems wird ein weiteres Token, die AutorizationAssertion, verwendet. Diese wird in einer VAU verwendet, um die Zugriffsberechtigung auf ein Aktenkonto nachzuweisen, vgl. (L). Das Token wird von der Komponente Autorisierung **als Nachweis der vorangegangenen Prüfungen** der AuthenticationAssertion ausgestellt und signiert, vgl. (M).

Die **Zugriffsberechtigung abhängig von Mandant, Arbeitsplatz und Client System ID** einer Anfrage *wird über das Informationsmodell des Konnektors bestimmt*. Das Fachmodul erfragt diese über den Zugriffsberechtigungsdienst, vgl. (N), bevor es eine vom Primärsystem eingehenden IHE Transaktion durchführt.

Für AuthenticationAssertion und AuthorizationAssertion sowie das Informationsmodell des Konnektors trägt das Fachmodul funktional bei, allerdings liegt die Erbringung der Sicherheitsleistung außerhalb des Fachmoduls.

## <span id="page-15-0"></span>2.1.3 Informationsflusskontrolle

#### 2.1.3.1 Transportkanäle

Das Fachmodul unterhält gesicherte Transportkanäle mit den direkt kontaktierten Fachdiensten und deren Komponenten. Dazu übermittelt das Fachmodul beispielsweise die erwartete Rolle im Zertifikat des genutzten Dienstes im Aufruf des TLS-Dienstes (TUC\_KON\_110), der Funktionalität für eine leichtgewichtige Sicherungsschicht bzw. der ECIES-Schlüsselaushandlung mit einem SGD. *Die Konnektor-Funktionalität wertet während des Verbindungsaufbaus das Zertifikat des Kommunikationspartners aus.* Nur für die TI ausgestellte Zertifikate mit dem korrekten Zertifikatsprofil (TLS einschl. Verbindungen zu SGD: C.FD.TLS-S, Kanal zur VAU: C.FD.AUT) sind zugelassen. *Die Verbindung wird durch die Basisfunktionalität abgebrochen, falls die im Zertifikat festgehaltene Rolle von der Vorgabe im Verbindungsaufbau durch das Fachmodul abweicht.* [Tabelle 6](#page-15-1) führt den Sicherheitsbeitrag des Fachmoduls inklusive der zu übergebenen Rollen OID auf, der in der TR-Evaluation zu untersuchen ist.

| Kommunikationspartner                                                                                                                                              | Beitrag des Fachmoduls zur Sicherheit des Transportkanals                                                                                                                           |  |  |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|
| Namensdienst der TI                                                                                                                                                | Keiner. Das Fachmodul nutzt den Namensdienst und<br>Dienstlokalisierung des Konnektors                                                                                              |  |  |
| TLS-basierte Fachdienste:<br>ePA Zugangsgateway des Versicherten,<br>ePA-Autorisierungskomponente,<br>ePA-Dokumentenverwaltung,<br>Schlüsselgenerierungsdienst ePA | Das Fachmodul spezifiziert die erwartete Rolle anhand der OID,<br>und der TLS-Dienst bricht die Verbindung ab, falls das vorgelegte<br>Zertifikat abweicht (Details in Tabelle 20). |  |  |
| Vertrauenswürdige<br>Ausführungsumgebung (VAU)                                                                                                                     | Keiner. Das Fachmodul nutzt die Basisfunktionalität. Diese prüft<br>die Rolle oid_epa_vau implizit während dem Verbindungsaufbau<br>der leichtgewichtigen Sicherungsschicht2        |  |  |

<span id="page-15-1"></span>Tabelle 6: Beteiligung des Fachmoduls am Schutz von Transportkanälen

#### 2.1.3.2 Nachrichtensicherung zum Schlüsselgenerierungsdienst

Ein Schlüsselgenerierungsdienst enthält ein Hardware Sicherheits Modul (SGD-HSM), eine Request Verarbeitenden Einheit (RVE) sowie einen TLS-Endpunkt [gemSpec\_SGD\_ePA#Abbildung 9]. Während der Übertragung zwischen dem Fachmodul als Client und dem SGD-HSM muss die Vertraulichkeit und Authentizität aller sicherheitsrelevanten Assets geschützt werden. Die Kommunikation mit einem SGD wird dafür zweifach geschützt: *der TLS-Dienst etabliert eine einseitig authentisierte TLS-Verbindung bis zum TLS-Endpunkt* und *innerhalb der Anwendungsschicht realisiert die Basisfunktionalität einen beidseitig authentisierten Datenkanal*. *Die Vertraulichkeit der Nachrichteninhalte und Authentizität der Kommunikationspartner wird dabei mittels 'Elliptic Curve Integrated Encryption Scheme' (ECIES) geschützt*  [gemSpec\_SGD\_ePA#5.2]. Aufgabe des Fachmoduls ist lediglich das Kommando zur initialen Schlüsselableitung zusammenzustellen, bzw. bei wiederkehrende Anfragen die Associated Data aus der Komponente Autorisierung zu beziehen.

#### 2.1.3.3 Weitergabe von sicherheitsrelevanten Informationen

Das Fachmodul schützt die Patientenakte, indem es die Weitergabe von Assets kontrolliert. Einen vollständigen Überblick über die sicherheitsrelevanten Assets im Fachmodul bietet [Tabelle 8](#page-20-1) in Abschnitt [2.2.](#page-18-0) Die folgende [Tabelle 7](#page-17-2) definiert für einzelne Empfänger, welche Maßnahmen im Fachmodul übertragene Informationen schützen.

Sicherheitsrelevante Informationen wie IHE-Dokumente, Akten- und Kontextschlüssel werden vor der Speicherung beim Aktensystem-Anbieter auf Anwendungsebene gesichert (vgl. Abschnitt [2.1.1](#page-9-1)). Das Fachmodul kommuniziert mit den Komponenten immer über transport-gesicherte Kanäle. Die

<span id="page-15-2"></span>2 A\_15210 - FM ePA: Dokumentenverwaltung - sichere Verbindung zur VAU mit Zertifikats- und Rollenprüfung

Transportsicherung erfolgt dabei durch TLS, Protokolle auf Anwendungsebene und ggf. den organisatorischen Schutz des LAN in der Leistungserbringerinstitution, falls dort kein TLS genutzt wird (Überblick in [Tabelle 6](#page-15-1)).

|                                                       | Erlaubte Informationsweitergabe |                           |                                                      |                                              |                                                                                                    |  |
|-------------------------------------------------------|---------------------------------|---------------------------|------------------------------------------------------|----------------------------------------------|----------------------------------------------------------------------------------------------------|--|
|                                                       | al<br>n<br>a<br>S-K<br>L<br>T   | al<br>n<br>a<br>U-K<br>VA | achrichten<br>g<br>n<br>-sicheru<br>N<br>D<br>G<br>S | Übertragungs<br>form innerhalb<br>des Kanals | Kommunikationspartner3                                                                             |  |
| Benutzerdaten                                         |                                 |                           |                                                      |                                              |                                                                                                    |  |
| IHE Dokumente                                         | (x)                             |                           |                                                      | Klartext4                                    | Primärsystem<br>alternativ durch Umgebung gesichert                                                |  |
|                                                       | x                               | x                         |                                                      | Gesichert5                                   | VAU                                                                                                |  |
| IHE Metadaten,<br>Suchkriterien und -                 | (x)                             |                           |                                                      | Klartext6                                    | Primärsystem<br>alternativ durch Umgebung gesichert                                                |  |
| ergebnisse                                            | x                               | x                         |                                                      | Klartext7                                    | VAU                                                                                                |  |
| Spezifische Daten für die verschlüsselte Datenhaltung |                                 |                           |                                                      |                                              |                                                                                                    |  |
| Aktenschlüssel                                        | x                               |                           |                                                      | Gesichert8                                   | Komponente Autorisierung<br>(eingehend in <ePA:PHRKey>)                                            |  |
| Dokumentenschlüssel                                   | x                               |                           |                                                      | Gesichert9                                   | Komponente Autorisierung<br>(eingehend in <ePA:PHRKey>)                                            |  |
|                                                       | x                               | x                         |                                                      | Gesichert10                                  | VAU (in <xenc:encryptedData>)                                                                      |  |
| Associated Data                                       | x                               |                           | x                                                    | Klartext                                     | SGD über Basisfunktionalität                                                                       |  |
|                                                       | x                               |                           |                                                      | Klartext                                     | (als Bestandteil im <AuthorizationKey>)<br>Komponente Autorisierung mittels<br>Basisfunktionalität |  |
| Berechtigtenschlüssel                                 | x                               |                           | x                                                    | Klartext                                     | SGD (nur Empfang mittels<br>Basisfunktionalität)                                                   |  |
| Spezifische Daten für das Berechtigungsmanagement     |                                 |                           |                                                      |                                              |                                                                                                    |  |
| Kontextschlüssel                                      | x                               | x                         |                                                      | Klartext                                     | VAU11                                                                                              |  |
|                                                       | x                               |                           |                                                      | Gesichert                                    | Komponente Autorisierung                                                                           |  |
| BasePolicy                                            | x                               | x                         |                                                      | Klartext                                     | VAU (nur ausgehend)                                                                                |  |
| GatewayChallenge                                      | x                               |                           |                                                      | Klartext                                     | Komponente Versichertengateway12                                                                   |  |
| AuthenticationAssertion                               | x                               |                           |                                                      | Klartext                                     | Komponente ZGdV (nur Empfang)                                                                      |  |

<span id="page-16-0"></span>3 Kursive Schrift : die Verarbeitung findet außerhalb des Fachmoduls, etwa durch die Basisfunktionalität, statt

<span id="page-16-1"></span>4 [gemSpec\_FM\_ePA#5.2.2] Provide & Register Document Set-b [ITI-41] und Retrieve Document Set [ITI-43]

<span id="page-16-2"></span>5 [gemSpec\_FM\_ePA#5.2.2] Cross-Gateway Document Provide [ITI-80] und Cross-Gateway Retrieve [ITI-39]

<span id="page-16-3"></span>6 [gemSpec\_FM\_ePA#5.2.2] Registry Stored Query [ITI-18]

<span id="page-16-4"></span>7 [gemSpec\_FM\_ePA#5.2.2] Cross-Gateway Query [ITI-38]

<span id="page-16-5"></span>8 A\_17869 - FM ePA: Schlüsselableitung bei Entschlüsselung - Entschlüsselung mit Verschlüsselungsdienst

<span id="page-16-6"></span>9 A\_17869 - FM ePA: Schlüsselableitung bei Entschlüsselung - Entschlüsselung mit Verschlüsselungsdienst

<span id="page-16-7"></span>10 A\_13907 - FM ePA: putDocuments - Verschlüsselung der Dokumente

<span id="page-16-8"></span>11 A\_14649 - FM ePA: Dokumentenverwaltung - Verwendung des Kontextschlüsse

<span id="page-16-9"></span>12 A\_14838 - FM ePA: Authentisierung mit eGK - Authentifizierungsbestätigung erstellen

|                        | Erlaubte Informationsweitergabe |                           |                                                      |                                              |                                                              |
|------------------------|---------------------------------|---------------------------|------------------------------------------------------|----------------------------------------------|--------------------------------------------------------------|
|                        | al<br>n<br>a<br>S-K<br>L<br>T   | al<br>n<br>a<br>U-K<br>VA | achrichten<br>g<br>n<br>-sicheru<br>N<br>D<br>G<br>S | Übertragungs<br>form innerhalb<br>des Kanals | Kommunikationspartner                                        |
|                        | x                               |                           |                                                      | Klartext                                     | Komponente Autorisierung (nur<br>ausgehend)                  |
|                        | x                               | x                         |                                                      | Klartext                                     | VAU (nur ausgehend)                                          |
| AuthorizationAssertion | x                               |                           |                                                      | Klartext                                     | Komponente Autorisierung (nur<br>Empfang)                    |
|                        | x                               |                           |                                                      | Klartext                                     | VAU13 (während dem Kanalaufbau<br>durch Basisfunktionalität) |

<span id="page-17-2"></span>Tabelle 7: Informationsfluss und Anforderungen an die Transportsicherung (abstrakt)

#### <span id="page-17-1"></span>2.1.3.4 Schutz der Schnittstellen

Dritte könnten insbesondere Eingaben auf der Schnittstelle zur eGK manipulieren. Für das Fachmodul MUSS die Schnittstelle zur eGK gegenüber typischen Schwachstellen (Buffer Overflows, etc.) gehärtet werden.

Für den Betrieb eines Konnektors wird eine sichere Umgebung angenommen. Dies betrifft die beiden Webservice Schnittstellen PHRService und PHRManagementService und die Basisfunktionalitäten des Konnektors, einschließlich des Datenaustauschs über den TLS-Dienst, Client für den leichtgewichtigen Sicherungskanal in die VAU bzw. Datenaustausch mit den Signaturerstellungsdiensten. In Übereinstimmung mit den Annahmen an den Konnektor wird angenommen, dass auf diesen Schnittstellen eingehende Nachrichten keinen Angriff gegen das Fachmodul enthalten.

#### <span id="page-17-0"></span>2.1.3.5 Protokollierung

Im Umfeld der Patientenakte werden verschiedene Protokollierungen geführt. Für die Sicherheitsbetrachtung des FM ePA ist lediglich das fachmodulspezifische Protokoll relevant [gemSpec\_FM\_ePA#6.9]. Es nutzt den Protokollierungsdienst des Konnektors für die Aufzeichnung von Ereignissen im Fachmodul. Sensible Informationen und Assets dürfen nicht Bestandteil von Protokolleinträgen sein.

Während der spezifizierten eGK-Zugriffe durch das Fachmodul ePA wird keine Protokollierung in der eGK verursacht. *In der Dokumentenverwaltung führt die VAU ein umfangreiches Protokoll als Nachweis der Datenverwendung für den Versicherten nach §291a im aktenkontospezifischen Protokoll, siehe [gemSpec\_DM\_ePA#2.3] und [gemSpec\_Dokumentenverwaltung#4.6].*

<span id="page-17-3"></span><sup>13</sup> A\_15200 - FM ePA: Dokumentenverwaltung - sichere Verbindung zur VAU – Aufrufparameter [gemSpec\_Dokumentenverwaltung] A\_14633 - Komponente ePA-Dokumentenverwaltung – Vermittlung der Verbindung zwischen Client und Verarbeitungskontext

# <span id="page-18-0"></span>2.2 Verarbeitete Assets

Die Sicherheitsbetrachtung unterscheidet zwischen primären Assets, den ursprünglichen Daten der Patientenakte die durch das Fachmodul verarbeitet werden, sowie den sekundären Assets, die im Zusammenhang mit der erbrachten Schutzleistung stehen. Alternativ können diese Assets auch im Frontend des Versicherten (FdV) verarbeitet werden. [Tabelle 8](#page-20-1) stellt die im Fachmodul verarbeiteten, sicherheitsrelevanten Assets dar. *Zusätzlich sind vom Fachmodul verwendete* S*chlüssel, die in eGK bzw. SM-B hinterlegt sind, in der Übersicht mitaufgeführt.* Nach Auswahl nutzt das Fachmodul diese indirekt über den Verschlüsselungsdienst. Für einen schnellen Überblick erläutert die Tabelle auch die jeweilige Komponente für eine persistente Speicherung und die Rolle des Fachmoduls in der Verarbeitung.

| # | Asset<br>Dauerhafte<br>Aufbewahrung                    |                                 | Sicherheitsrelevante<br>Aufgaben für Fachmodul<br>ePA                                                                                                                                                                                                                                                                                              | Erläuterung                                                                                                                                                                                                      |  |  |  |  |
|---|--------------------------------------------------------|---------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|--|--|
|   | Primäre Assets                                         |                                 |                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                  |  |  |  |  |
| 1 | IHE Dokument                                           | VAU (und<br>Primärsystem)       | Speicherung in<br>Dokumentenverwaltung:<br>Primärsystem sendet IHE<br>Dokument an FM; FM<br>verschlüsselt das<br>Dokument und gibt die<br>transformierte Form an<br>VAU weiter;<br>Abruf aus<br>Dokumentenverwaltung:<br>Authentizitätsprüfung und<br>Entschlüsselung des IHE<br>Dokuments; Weitergabe<br>transformierter Daten an<br>Primärsystem | Das FM prüft nicht die Schema<br>Konformität.                                                                                                                                                                    |  |  |  |  |
| 2 | Metadaten zu einem<br>Dokument                         | VAU (und<br>Primärsystem)       | Keine                                                                                                                                                                                                                                                                                                                                              | Fachmodul leitet die neuen<br>Metadaten vom Primärsystem an<br>die VAU weiter (Restricted<br>Update Document Set [ITI-92]).<br>Die Metadaten können<br>personenbezogene/medizinische<br>Informationen enthalten. |  |  |  |  |
| 3 | IHE Suchanfrage                                        | Durch Primärsystem<br>generiert | Keine                                                                                                                                                                                                                                                                                                                                              | Fachmodul leitet Suchanfrage<br>(Registry Stored Query [ITI-18])<br>an VAU weiter (Cross-Gateway<br>Query [ITI-38])                                                                                              |  |  |  |  |
| 4 | IHE Suchergebnis                                       | Von VAU dynamisch<br>ermittelt  | Keine                                                                                                                                                                                                                                                                                                                                              | Fachmodul leitet Suchergebnis<br>an Primärsystem weiter                                                                                                                                                          |  |  |  |  |
|   | Sekundäre Assets für die verschlüsselte Datenhaltung   |                                 |                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                  |  |  |  |  |
| 5 | (Sicherheitsrelevan<br>te Aspekte der)<br>Aktensession | im Fachmodul<br>(temporär)      | FM führt sicheres Löschen<br>durch                                                                                                                                                                                                                                                                                                                 | Die Aktensession bewahrt<br>zwischen Interaktionen mit dem<br>Primärsystem zuvor erhaltene<br>Assets auf                                                                                                         |  |  |  |  |
| 6 | Aktenschlüssel                                         | Komponente<br>Autorisierung     | Initial: FM bezieht<br>Zufallszahl für                                                                                                                                                                                                                                                                                                             | Erzeugung im<br>Zufallszahlengenerator der                                                                                                                                                                       |  |  |  |  |

| #  | Asset                           | Dauerhafte<br>Aufbewahrung                                           | Sicherheitsrelevante<br>Aufgaben für Fachmodul<br>ePA                                                                                                                                                                     | Erläuterung                                                                                                                                                                                                          |
|----|---------------------------------|----------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|    |                                 |                                                                      | Aktenschlüssel;<br>Verschlüsselung mittels<br>SGD;<br>Speicherung in<br>Autorisierung<br>Wiederkehrend:<br>Entschlüsseln mittels SGD                                                                                      | Basisfunktionalität; FM nutzt den<br>Verschlüsselungsdienst und SGD<br>zur Ver-/Entschlüsselung                                                                                                                      |
| 7  | Dokumenten<br>schlüssel         | Dokumenten<br>verwaltung                                             | Speicherung in<br>Dokumentenverwaltung:<br>FM lässt Dokument vom<br>Verschlüsselungsdienst<br>mit neu erzeugtem<br>Schlüssel verschlüsseln;<br>Abruf aus<br>Dokumentenverwaltung:<br>Entschlüsselung des IHE<br>Dokuments | Erzeugung des<br>Dokumentenschlüssels durch<br>Basisfunktionalität; wird mit dem<br>Aktenschlüssel verschlüsselt und<br>gemeinsam mit dem<br>verschlüsselten Dokument in der<br>Dokumentenverwaltung<br>gespeichert. |
| 8  | Associated Data (AD) Komponente | Autorisierung                                                        | Initial: FM sendet Regel<br>und initialen Parameter an<br>SGD;<br>Wiederkehrend: FM prüft<br>Authentizität der von<br>Autorisierung erhaltene<br>AD, bevor AD an SGD<br>weitergegeben werden                              | Schlüsselableitung siehe<br>Abbildung 2 und Abschnitt 2.3.4                                                                                                                                                          |
| 9  | Berechtigten<br>schlüssel       | Keine; wird stets<br>durch SGD mit<br>Associated Data<br>hergeleitet | FM prüft Authentizität des<br>Berechtigtenschlüssels<br>neue Berechtigung:<br>Verschlüsselung von<br>Kontext-/Aktenschlüssel;<br>bestehende Berechtigung:<br>Entschlüsselung von<br>Kontext-/Aktenschlüssel               | Schlüsselableitung siehe<br>Abbildung 2 und Abschnitt 2.3.4                                                                                                                                                          |
|    |                                 | Sekundäre Assets für das Berechtigungsmanagement                     |                                                                                                                                                                                                                           |                                                                                                                                                                                                                      |
| 10 | Kontextschlüssel                | Komponente<br>Autorisierung                                          | Weitergabe an VAU<br>Initial: FM bezieht<br>Zufallszahl für<br>Kontextschlüssel;<br>Verschlüsselung mittels<br>SGD;<br>Speicherung in<br>Autorisierung<br>Wiederkehrend:<br>Entschlüsseln mittels SGD                     | Erzeugung als Zufallszahl durch<br>Basisfunktionalität; Nutzung des<br>Kontextschlüssels während Zugriff<br>des Dokumentenspeichers in der<br>VAU                                                                    |
| 11 | BasePolicy                      | Komponente<br>Dokumentenverwalt<br>ung                               | FM erstellt Base Policy für<br>neue LEIs; Weitergabe an<br>VAU                                                                                                                                                            | Die Base Policy ist an der<br>Zugriffskontrolle innerhalb der<br>Komponente<br>Dokumentenverwaltung<br>beteiligt.                                                                                                    |

| #  | Asset                                                                  | Dauerhafte<br>Aufbewahrung                        | Sicherheitsrelevante<br>Aufgaben für Fachmodul<br>ePA                                                                                                                                           | Erläuterung                                                                                                                                                                                                                                                               |
|----|------------------------------------------------------------------------|---------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 12 | GatewayChallenge                                                       | Komponente ZGdV<br>(nur kurzfristig)              | FM lässt<br>GatewayChallenge von<br>eGK mit<br>Authentisierungsschlüssel<br>signieren                                                                                                           | Erzeugung der<br>AuthenticationAssertion durch<br>ZGdV                                                                                                                                                                                                                    |
| 13 | Authentisierungs<br>schlüssel von<br>Versicherten /<br>Vertreter / LEI | Auf eGK und SM-B14                                | -                                                                                                                                                                                               | Verwendet für die Authentisierung<br>gegenüber dem Aktensystem; eGK<br>signiert GatewayChallenge bzw.<br>SM-B signiert SAML2 Token das<br>durch das Fachmodul erstellt<br>wurde; privater Schlüssel verlässt<br>die Karte nicht.                                          |
| 14 | Authentication<br>Assertion                                            | In der Aktensession<br>(temporär)                 | Fachmodul löscht<br>AuthenticationAssertion<br>nach Ablauf der Gültigkeit.<br>Für SM-B: FM erstellt<br>SAML2-Token und lässt es<br>mit SM-B OSIG-Zertifikat<br>signieren<br>Für eGK: Weitergabe | Für den Authentizitätsnachweis<br>gegenüber den Komponenten<br>Autorisierung und<br>Dokumentenverwaltung;                                                                                                                                                                 |
| 15 | Authorization<br>Assertion                                             | In der Aktensession<br>sowie in VAU<br>(temporär) | Keine                                                                                                                                                                                           | Die AuthorizationAssertion wird<br>für die Zuordnung einer VAU zur<br>Patientenakte benötigt;<br>base64-kodiert; FM erhält diese<br>von der Komponente<br>Autorisierung und übermittelt<br>sie an Komponente<br>Dokumentenverwaltung; FM<br>wertet deren Inhalt nicht aus |

<span id="page-20-1"></span>Tabelle 8: Assets im Fachmodul ePA

Die KVNR wird im Primärsystem und in den Fachdiensten als einzelnes Datum eingesetzt und ist Bestandteil des Record Identifier, der Base Policy und der AuthenticationAssertion. Der unveränderliche Teil der KVNR MUSS aus Sicht des Datenschutzes als persönliches Merkmal gesehen werden, allerdings kann aufgrund der notwendigen Verteilung auf alle beteiligten Komponenten eine sparsame Datenverwendung nicht mit den Mitteln des Informationsflusses reguliert werden. Dies gilt analog für die IHE Metadaten wie beschreibende Attribute eines IHE-Dokuments, Suchanfragen und -ergebnisse.

HomeCommunityID und URL des Aktendienstes besitzen im Rahmen dieser Sicherheitsbetrachtung keine Relevanz.

# <span id="page-20-0"></span>2.3 Abläufe und Benutzungsszenarien

Die Abstraktionsschicht des Fachmoduls ePA bietet dem Primärsystem Zugriff auf die Dokumente der Patientenakte. Abschnitt [2.3.1](#page-21-0) diskutiert die temporäre Ablage von Assets in Aktensessions. Die folgenden

<span id="page-20-2"></span><sup>14</sup> In Generation 2 liegt der Authentisierungsschlüssel als PrK.CH.AUT.R2048 (eGK) bzw. PrK.HCI.ENC.R2048 (SM-B) vor. Auf Smartcards von Generation 2.1 und höher wählt das Fachmodul PrK.CH.AUT.E256 (eGK) bzw. PrK.HCI.ENC.E256 (SM-B) als Authentisierungsschlüssel aus.

Abschnitte illustrieren typische Benutzungsszenarien des Fachmoduls: Abschnitt [2.3.2](#page-22-0) beschreibt den grundsätzlichen Ablauf eines Aktenzugriffs, Abschnitt [2.3.3](#page-23-0) die Verwaltung eines Aktenkontos und Abschnitt [2.3.4](#page-24-0) den Bezug der Berechtigtenschlüssel. Zugunsten verringerter Komplexität wird der kryptographische Schutz hier nur soweit erläutert, wie er für das Verständnis der Abläufe notwendig ist.

#### <span id="page-21-0"></span>2.3.1 Wiederverwendung von Aktensessions

Das Fachmodul muss sicherstellen, dass Zugriffe über das Primärsystem jeweils mit ihren eigenen Berechtigungen versorgt werden und Aktensessions nur dann wiederverwenden, falls zum Zeitpunkt der Einrichtung identische Versicherten-ID bzw. Telematik-ID vorgelegen haben. Ob eine Person oder ein Leistungserbringer Zugriff zu einer Patientenakte besitzt, wird aufgrund des Schlüsselmaterials in der Komponente Autorisierung und der Berechtigungen in der Dokumentenverwaltung geregelt. Im Fachmodul werden überprüfte Berechtigungen in Form einer Aktensession organisiert.

Sofern zu einer Patientenakte bereits eine Aktensession existiert, muss das Fachmodul überprüfen, ob diese vom Anfragenden mitverwendet werden darf. Die Aktensessions unterscheiden sich anhand der erteilten Berechtigungen [gemSpec\_Dokumentenverwaltung#8], d.h. Berechtigungsart und -dauer sowie für die Rollen Versicherter, Vertreter und Leistungserbringerinstitution. Das Fachmodul muss daher unabhängige Aktensessions für ein und dieselbe Patientenakte unterhalten, die sich aufgrund der Merkmale Versicherten-ID bzw. Telematik-ID voneinander abgrenzen. Die Abgrenzung wird eingehalten sofern das Fachmodul jeder KVNR und RecordIdentifier der Patientenakte (für Zugriffe per eGK) sowie jeder Telematik-ID und RecordIdentifier (für Zugriffe per SM-B) eine eigene Aktensession zuordnet.

|                                                                                                    | Zugriffskriterien auf die Aktensession im<br>Fachmodul |                   |
|----------------------------------------------------------------------------------------------------|--------------------------------------------------------|-------------------|
| Verschiedene Aktensessions                                                                         | Versicherten-ID der eGK Record Identifier              |                   |
| 1. Versicherte Musterfrau greift mit ihrer eGK auf eigene<br>Patientenakte zu                      | 0123456789                                             | 0123456789        |
| 2. Vertreterin Mustervertreterin greift mittels eigener<br>eGK auf Patientenakte von Musterfrau zu | 5678901234                                             | 0123456789        |
| Verschiedene Aktensessions                                                                         | Telematik-ID15 der SM-B                                | Record Identifier |
| 3. Ärztin1 und Ärztin2 von Leistungserbringer LEI1<br>greifen auf Patientenakte von Musterfrau zu  | 1-1a25sd-d529                                          | 0123456789        |
| 4. Ärztin3 von Leistungserbringer LEI2 greift auf<br>Patientenakte von Musterfrau zu               | 1-1b31sd-d100                                          | 0123456789        |

<span id="page-21-1"></span>Tabelle 9: Mehrere Aktensessions zu einer Patientenakte (Beispiel)

Im Beispiel von [Tabelle 9](#page-21-1) ermöglichen alle vier Aktensessions den Zugriff auf die gleiche Patientenakte. Greift *Ärztin1* über das Primärsystem auf die Patientenakte von *Musterfrau* zu, wird eine eigene Aktensession etabliert (Zeile 3, [Tabelle 9](#page-21-1)), selbst wenn über die eGK der Versicherten (Zeile 1, [Tabelle 9\)](#page-21-1) oder eines Vertreters (Zeile 2, [Tabelle 9](#page-21-1)) bereits eine Aktensession existiert. Das Fachmodul wertet dann die Telematik-ID in der SM-B des behandelnden Arztes aus. Bei Zugriff einer weiteren Ärztin (Zeilen 3 und 4, [Tabelle 9\)](#page-21-1) wird aufgrund der Telematik-ID bestimmt, ob eine Aktensession wiederverwendet werden darf.

Die Aktensessions beschleunigen Zugriffe des Primärsystems, indem Sie u.a. Kontext-/Aktenschlüssel, Zugänge in die Vertrauenswürdige Ausführungsumgebung (VAU) sowie AuthenticationAssertion und AuthorizationAssertion in einem flüchtigen Speicher vorrätig halten. Einen Missbrauch muss das Fachmodul dabei zuverlässig unterbinden, da sonst die Berechtigungen Dritter in der VAU ausgenutzt werden könnten.

<span id="page-21-2"></span>15 [gemSpec\_PKI#4.7]

## <span id="page-22-0"></span>2.3.2 Grundsätzlicher Ablauf eines Aktenzugriffs

Die Abläufe zwischen Primärsystem und ePA Aktensystem ergeben sich aus [gemSysL\_Fachanwendung\_ ePA#3]. Im Folgenden werden aus diesen Abläufen spezifisch die Sicherheitsleistung des Fachmoduls ePA benannt. Tabelle [10](#page-23-1) schildert in der linken Spalte die Aktion des Primärsystems. Die rechte Spalte stellt die Sicherheitsleistungen des FM ePA für transaktionsübergreifend Abläufe einer LEI dar.

| Ablauf aus Sicht des Primärsystems                                                                                              | Ablauf aus Sicht des Fachmoduls ePA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|---------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Das Primärsystem bereitet den Zugriff auf eine<br>Patientenakte vor und übermittelt dazu dem<br>Fachmodul die betreffende KVNR. | Das Fachmodul wird implizit oder mittels<br>GetHomeCommunityID() beauftragt, die zuständige<br>Dokumentenverwaltung zu suchen. Die Abfragen<br>bearbeitet der Namensdienst des Konnektors, der alle<br>ePA-Aktensysteme nach dem Record Identifier<br>absucht.                                                                                                                                                                                                                                                                                                       |
| Der Konnektor sorgt für eine Autorisierung des<br>Primärsystem des Leistungserbringers.                                         | Im Aufrufkontext referenziert das Primärsystem ein<br>freigeschaltetes SM-B. Über den Signaturdienst des<br>Konnektors erhält das Fachmodul eine signierte<br>AuthenticationAssertion, nachdem es die Inhalte zuvor<br>aus den SOAP-Parametern zusammengestellt hat.<br>Mit Hilfe der AuthenticationAssertion kann das<br>Fachmodul den <AuthorizationKey> und die<br>AuthorizationAssertion bei der Komponente<br>Autorisierung anfragen. Mittels der<br>Schlüsselableitung (vgl. Abschnitt 2.3.4) erhält das<br>Fachmodul Zugriff auf Akten- und Kontextschlüssel. |
| -                                                                                                                               | Zum Öffnen einer Patientenakte sendet das<br>Fachmodul die AuthorizationAssertion an die<br>Komponente Dokumentenverwaltung. Diese<br>erzeugt einen Verarbeitungskontext in einer neuen<br>VAU, mit dem das Fachmodul mit Hilfe der<br>Basisfunktionalität des Konnektors einen Kanal mit<br>Transportsicherung erstellt. Anschließend sendet das<br>Fachmodul den Kontextschlüssel an die VAU.                                                                                                                                                                      |
| Das Primärsystem sendet IHE Anfragen über den<br>Konnektor an das Fachmodul (Beispiel getDocuments).                            | Für [ITI-41] Retrieve Document Set realisiert das<br>Fachmodul ein XCDR Initiating Gateway zwischen<br>Primärsystem und Dokumentenverwaltung. Das<br>Fachmodul erhält die IHE-Anfragen als SOAP<br>Nachricht und übersetzt diese in eine IHE-Anfrage<br>an die VAU der betroffenen Patientenakte. Im Fall<br>von getDocuments() erhält das Fachmodul<br>verschlüsselte Dokumente von der Komponente<br>Dokumentenverwaltung zurück.                                                                                                                                  |
| Das Primärsystem erhält vom Fachmodul die IHE<br>Response.                                                                      | Dafür entschlüsselt das Fachmodul zunächst den<br>Dokumentenschlüssel über den<br>Verschlüsselungsdienst und danach das Dokument<br>selbst (vgl. Abbildung 3). Abschließend erstellt das<br>Fachmodul die IHE-Response an das Primärsystem                                                                                                                                                                                                                                                                                                                           |

| Ablauf aus Sicht des Primärsystems | Ablauf aus Sicht des Fachmoduls ePA                 |  |
|------------------------------------|-----------------------------------------------------|--|
|                                    | und bettet die entschlüsselten Dokumente darin ein. |  |

<span id="page-23-1"></span>Tabelle 10: Abläufe für die LEI aus den Perspektiven von Primärsystem und Fachmodul

#### <span id="page-23-0"></span>2.3.3 Verwaltung des Aktenkontos

Tabelle [11](#page-24-2) stellt die Aktivitäten des Fachmoduls für die Verwaltung des Aktenkontos dar. Jeder Ablauf kann Teile aus [Tabelle 10](#page-23-1) umfassen.

| Abläufe aus Sicht eines Leistungserbringers                                                                                                                                                                                     | Zusätzliche Abläufe aus Sicht des Fachmodul ePA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Aktenkonto aktivieren:<br>Primärsystem veranlasst die erstmalige Einrichtung<br>eines Aktenkontos (ActivateAccount).                                                                                                            | Das Fachmodul sendet zunächst 'Karte anfordern'<br>über den Kartenterminaldienst an das eHealth<br>Kartenterminal. Danach ermittelt der Konnektor den<br>Sperrstatus des eGK-Zertifikats. Das Fachmodul erhält<br>die Information zurück, ob die Zertifikatsgültigkeit<br>erfolgreich geprüft worden ist. Das Fachmodul<br>beginnt die Schlüsselableitung für den Versicherten<br>gemäß Tabelle 12. Im nächsten Schritt fordert es<br>beim Kartendienst 'PIN verifizieren' an und erstellt<br>Akten- und Kontextschlüssel gemäß Tabelle 14. Als<br>Ergebnis hat das FM den Akten-/Kontextschlüssel<br>für den Versicherten in der Komponente<br>Autorisierung abgelegt (Tabelle 16, Schritt 16).                                                                                                                                                                                                                                                                                         |
| Adhoc Berechtigung erstellen:<br>Das Primärsystem sendet die Anfrage RequestFacility<br>Authorization an das Fachmodul.                                                                                                         | Das Fachmodul sendet zunächst 'Karte anfordern'<br>mit relevanten Berechtigungsparametern über den<br>Kartenterminaldienst an das eHealth<br>Kartenterminal. Danach ermittelt der Konnektor den<br>Sperrstatus des eGK-Zertifikats. Das Fachmodul erhält<br>die Information zurück, ob die Zertifikatsgültigkeit<br>erfolgreich geprüft worden ist. Das Fachmodul<br>beginnt die Schlüsselableitung für den LEI gemäß<br>Tabelle 12. Dann bereitet es die Parameter<br>Gültigkeitszeitraum und Zugriffsrechte für die<br>Anzeige auf dem Kartenterminal auf. Der Versicherte<br>/ Vertreter bestätigt die Einrichtung der<br>Berechtigung, indem das Fachmodul über den<br>Kartendienst 'PIN verifizieren' abfragt (Tabelle 15,<br>Schritt 5) und persistiert den Schlüssel (Tabelle 16,<br>Schritt 16). Bei Erfolg erstellt eine Base Policy für die<br>betreffende Telematik ID und übermittelt diese an<br>die VAU, wo sie durch die entsprechende Permission<br>Policy ergänzt wird. |
| Abruf bestehender Berechtigungen:<br>Das Primärsystem fordert die bestehenden<br>Berechtigungen per GetAuthorizationList() an. Im<br>Aufrufkontext wählt das Primärsystem die<br>Telematik-ID anhand des selektierten SM-B aus. | Das Fachmodul iteriert durch die beim Konnektor<br>bekannten ePA Aktensysteme durch. Das Fachmodul<br>authentisiert sich beim jeweiligen Aktensysteman<br>bieter und erhält über<br>I_Authorization_Management::getAuthorizationList() eine Liste<br>der Patientenakten mit dem jeweiligen Ablaufdatum                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |

| Abläufe aus Sicht eines Leistungserbringers                                | Zusätzliche Abläufe aus Sicht des Fachmodul ePA                                                                                 |
|----------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------|
|                                                                            | der Berechtigung [gemSpec_FM_ePA#7.2.1.5].                                                                                      |
| Karte gezogen:<br>Eine eGK Karte wird aus dem Kartenterminal<br>entnommen. | Der Konnektor informiert das FM über ein<br>TUC_KON_256 'Card/Removed'. Das Fachmodul<br>terminiert daraufhin die Aktensession. |

<span id="page-24-2"></span>Tabelle 11: Abläufe aus den Perspektiven von Leistungserbringer und Fachmodul

#### <span id="page-24-0"></span>2.3.4 Schlüsselableitung der Berechtigtenschlüssel

Für den Bezug eines Berechtigtenschlüssel interagiert die Basisfunktionalität im Auftrag des Fachmoduls mit dem Schlüsselgenerierungsdienst. *Das Fachmodul delegiert den Schutz des Protokolls an die Basisfunktionalität mittels entsprechender Aufrufe.* Die folgenden Tabellen differenzieren zwischen den Sicherheitsleistungen des Fachmoduls und den *Leistungen der Basisfunktionalität bzw. dritter Komponenten*[16](#page-24-4) .

Abschnitt [2.3.4.1](#page-24-3) führt den Basisablauf für den Verbindungsaufbau mit den SGD ein. Im Weiteren wird zwischen der initialen (erstmaligen) Schlüsselableitung für einen Berechtigten (Abschnitt [2.3.4.3\)](#page-26-2) und der wiederkehrenden Schlüsselableitung (Abschnitt [2.3.4.2](#page-25-0)) unterschieden.

#### <span id="page-24-3"></span>2.3.4.1 Basisablauf

Der Basisablauf findet zu Beginn jeder Schlüsselableitung statt.

| # 17             | Ablauf                                                                                                                                                                                                                                                                         |  |  |
|------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|
|                  | Basisablauf                                                                                                                                                                                                                                                                    |  |  |
| 1.               | FM identifiziert mittels DNS Service Discovery das SGD1 abhängig vom RecordIdentifier des<br>Aufrufkontextes. Der SGD2 in der Telematikinfrastruktur Platform (SGD-TIP) ist unabhängig<br>von der angefragten Patientenakte [gemSpec_ePA_SGD#2.1].                             |  |  |
| 2.               | FM beauftragt die Basisfunktionalität die Schlüsselableitung vorzubereiten. Parameter sind<br>u.a.<br>•<br>die in 1. ermittelten Schlüsselgenerierungsdienste SGD1 und SGD2, sowie<br>•<br>die cardSession zur eGK des Versicherten, eines Vertreters oder das SM-B eines LEI. |  |  |
| Schritte 1-<br>8 | Basisfunktionalität erstellt ein kurzlebiges ECIES Client-Schlüsselpaar und etabliert zwei<br>beidseitig authentisierte Kanäle jeweils mit SGD1 und SGD2. Dabei wird das AUT-Zertifikat der<br>cardSession zur Authentisierung gegenüber dem SGDx genutzt.                     |  |  |
| 3.               | FM bricht ab, falls mit SGD1 oder SGD2 kein gesicherter Kanal aufgebaut werden konnte.                                                                                                                                                                                         |  |  |

<span id="page-24-1"></span>Tabelle 12: Ablauf der Vorbereitung SGD-Berechtigtenschlüssel

<span id="page-24-5"></span>17 Die nummerierten Schritte beziehen sich auf [gemSpec\_SGD\_ePA#2.3].

<span id="page-24-4"></span><sup>16</sup> Verbindlich ist jeweils die Zuordnung der Afos in [gemProdT\_Kon].

## <span id="page-25-0"></span>2.3.4.2 Wiederkehrende Schlüsselableitung

Um einmal hinterlegte Akten- und Kontextschlüssel erneut zu beziehen, kann das Fachmodul bei SGD1/SGD2 die Ableitung eines Berechtigtenschlüssel anfragen. [Tabelle 12](#page-24-1) und [13](#page-26-3) stellen den Bezug des Schlüsselmaterials sowie dessen Entschlüsselung durch das Fachmodul dar. Es wird zunächst der äußere Schlüsselcontainer (vgl. [Abbildung 2](#page-10-1)), danach der innere entschlüsselt. Danach sind Akten- und Kontextschlüssel im Klartext in der Aktensession vorrätig.

| #                            | Ablauf                                                                                                                                                                                                         |  |  |
|------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|
|                              | Schlüsselmaterial laden                                                                                                                                                                                        |  |  |
| 4.                           | FM holt mittels I_Authorization::getAuthorizationKey() u.a. den <AuthorizationKey> für den<br>Versicherten, dessen Vertreter bzw. eine LEI von der Komponente Autorisierung ab.                                |  |  |
| 5.                           | Bei fehlerfreier Übertragung extrahiert das FM aus dem äußeren<br><epa:EncryptedKeyContainer> die gesamten Associated Data.                                                                                    |  |  |
| 6.                           | FM zerlegt die Associated Data in <Associated Data 1> und <Associated Data 2>.                                                                                                                                 |  |  |
|                              | Schlüsselableitung beauftragen                                                                                                                                                                                 |  |  |
| 7.                           | FM beauftragt Basisfunktionalität, bei SGD2 die Schlüsselableitung mit <Associated<br>Data 2> anzufordern. Das Parameterformat [gemSpec_SGD_ePA#2.5, 2.7, 2.9] wird durch<br>die Basisfunktionalität erstellt. |  |  |
| Schritt 15                   | Basisfunktionalität sendet den KeyDerivation Request an SGD2.                                                                                                                                                  |  |  |
| 8.                           | FM beauftragt Basisfunktionalität, bei SGD1 die Schlüsselableitung mit <Associated<br>Data 1> anzufordern. Das Parameterformat [gemSpec_SGD_ePA#2.5, 2.7, 2.9] wird durch<br>die Basisfunktionalität erstellt. |  |  |
| Schritt 9                    | Basisfunktionalität sendet den KeyDerivation Request an SGD1.                                                                                                                                                  |  |  |
|                              | Äußeren Verschlüsselungscontainer auspacken                                                                                                                                                                    |  |  |
| Schritte<br>17, 18<br>und 20 | Basisfunktionalität erhält KeyDerivation Response von SGD 2, prüft den Erfolg der<br>Schlüsselableitung sowie die Authentizität des Nachrichtensenders.                                                        |  |  |
| 9.                           | FM bricht ab, falls der <Berechtigtenschlüssel 2> nicht fehlerfrei und authentisch<br>empfangen wurde.                                                                                                         |  |  |
| 10.                          | Basisfunktionalität entschlüsselt den äußeren <epa:EncryptedKeyContainer> mit dem<br><Berechtigtenschlüssel 2> und ermittelt Authentizität des inneren<br><epa:EncryptedKeyContainer>.                         |  |  |
| 11.                          | FM bricht bei verletzter Authentizität der eingebetteten Daten ab.                                                                                                                                             |  |  |
|                              | Inneren Verschlüsselungscontainer auspacken                                                                                                                                                                    |  |  |
| Schritte<br>11, 12<br>und 14 | Basisfunktionalität erhält KeyDerivation Response von SGD 1, prüft den Erfolg der<br>Schlüsselableitung sowie die Authentizität des Nachrichtensenders.                                                        |  |  |
| 12.                          | FM bricht ab, falls der <Berechtigtenschlüssel 1> nicht fehlerfrei und authentisch<br>empfangen wurde.                                                                                                         |  |  |
| 13.                          | Basisfunktionalität entschlüsselt den inneren <epa:EncryptedKeyContainer> mit dem<br><Berechtigtenschlüssel 1> und ermittelt Authentizität von <epa:PHRKey>.                                                   |  |  |
| 14.                          | FM bricht bei verletzter Authentizität der eingebetteten Daten ab.                                                                                                                                             |  |  |
|                              | Zugriff auf Schlüsselmaterial                                                                                                                                                                                  |  |  |

| #   | Ablauf                                                                              |  |
|-----|-------------------------------------------------------------------------------------|--|
| 15. | FM extrahiert die Akten- und Kontextschlüssel aus <epa:PHRKey> in die Aktensession. |  |

<span id="page-26-3"></span>Tabelle 13: Ablauf bei wiederkehrendem Zugriff auf Schlüsselmaterial

#### <span id="page-26-2"></span>2.3.4.3 Initiale Schlüsselableitung

Wird die Schlüsselableitung erstmalig durchgeführt, übergibt das Fachmodul im KeyDerivation Request Regel-spezifische Parameter [gemSpec\_SGD\_ePA#2]. Zunächst werden die vorbereitenden Schritte nach [Tabelle 12](#page-24-1) durchgeführt. Wird die Patientenakte eingerichtet, müssen zunächst neue Schlüssel erzeugt werden (ActivateAccount in [Tabelle 14](#page-26-1)), wohingegen für eine Adhoc-Berechtigung eines LEI (RequestFacilityAuthorization in [Tabelle 15](#page-26-0)) vorhandene Schlüssel mit der Berechtigung des Versicherten/Vertreters abgerufen werden. Anschließend erfolgt wieder ein gemeinsamer Ablauf ([Tabelle](#page-27-1)  [16](#page-27-1)).

| #    | Ablauf                                                                                                                                                                                                       |  |
|------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
|      | Initiale Schlüsselableitung für Versicherten                                                                                                                                                                 |  |
| 4.   | FM erhält den Aufruf ActivateAccount() vom Primärsystem.                                                                                                                                                     |  |
| 5.18 | Die Basisfunktionalität erstellt einen Akten- und Kontextschlüssel für die neue Patientenakte aus<br>dem Zufallszahlengenerator des Konnektors (Abschnitt 2.1.1)                                             |  |
| 6.   | FM beauftragt Basisfunktionalität, bei SGD1/2 die Schlüsselableitung anzufordern. Die<br>Basisfunktionalität erkennt, dass "r1" gesetzt werden muss und erstellt die Anfrage gemäß<br>[gemSpec_SGD_ePA#2.4]. |  |

<span id="page-26-1"></span>Tabelle 14: Initiale Schüsselableitung für den Versicherten

| #  | Ablauf für den Versicherten                                                                                                                                                   | Ablauf für den Vertreter                                                                                                                                                                                 |  |
|----|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
|    | Initiale Schlüsselableitung für LEI                                                                                                                                           |                                                                                                                                                                                                          |  |
| 4. | FM erhält den Aufruf RequestFacilityAuthorization() vom Primärsystem.                                                                                                         |                                                                                                                                                                                                          |  |
| 5. | FM holt das Einverständnis des Versicherten ab<br>(RequestFacilityAuthorization in Tabelle 11)                                                                                | FM holt das Einverständnis des Vertreters ab<br>(RequestFacilityAuthorization in Tabelle 11)                                                                                                             |  |
| 6. | FM bezieht den Akten- und Kontextschlüssel<br>für den Versicherten gemäß Tabellen 12 und<br>13.                                                                               | FM bezieht den Akten- und Kontextschlüssel<br>für den Vertreter gemäß Tabellen 12 und 13.                                                                                                                |  |
| 7. | FM erstellt eine BasePolicy für den LEI (Abschnitt 2.1.2.3) und legt diese in der VAU ab.                                                                                     |                                                                                                                                                                                                          |  |
| 8. | FM beauftragt Basisfunktionalität, bei SGD1/2<br>die Schlüsselableitung für <Telematik-ID><br>anzufordern. Die Basisfunktionalität erkennt,<br>dass "r2" gesetzt werden muss. | FM beauftragt Basisfunktionalität, bei SGD1/2<br>die Schlüsselableitung für <Telematik-ID><br>und <KVNR-Kontoinhaber> anzufordern. Die<br>Basisfunktionalität erkennt, dass "r3" gesetzt<br>werden muss. |  |
|    | Das Format der Anfrage gemäß [gemSpec_SGD_ePA#2.6, 2.8] wird durch die Basisfunktionalität<br>gesetzt.                                                                        |                                                                                                                                                                                                          |  |

<span id="page-26-0"></span>Tabelle 15: Initiale Schüsselableitung für einen LEI

<span id="page-26-4"></span>18 A\_14742 - FM ePA: ActivateAccount - Akten- und Kontextschlüssel erzeugen

| #                            | Ablauf                                                                                                                                                                                                                                                                                                                                   |
|------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                              | Schlüsselableitung beauftragen                                                                                                                                                                                                                                                                                                           |
| Schritte 9<br>und 15         | Basisfunktionalität sendet jeweils einen KeyDerivation Request an SGD1 und SGD2.                                                                                                                                                                                                                                                         |
|                              | Inneren Verschlüsselungscontainer bauen                                                                                                                                                                                                                                                                                                  |
| Schritte<br>11, 12<br>und 14 | Basisfunktionalität erhält KeyDerivation Response von SGD 1, prüft den Erfolg der<br>Schlüsselableitung sowie die Authentizität des Nachrichtensenders.                                                                                                                                                                                  |
| 9.                           | FM bricht ab, falls die Nachricht nicht fehlerfrei und authentisch empfangen wurde.                                                                                                                                                                                                                                                      |
| 10.                          | FM zerlegt Nachricht in <Berechtigtenschlüssel 1> und <Associated Data 1>                                                                                                                                                                                                                                                                |
| 11.                          | Basisfunktionalität verschlüsselt und authentisiert den <epa:PHRKey> sowie <Associated<br>Data 1> mit <Berechtigtenschlüssel 1> . Ciphertext und <Associated Data 1> werden<br>Bestandteile des inneren <epa:EncryptedKeyContainer>.                                                                                                     |
|                              | Äußeren Verschlüsselungscontainer bauen                                                                                                                                                                                                                                                                                                  |
| Schritte<br>17, 18<br>und 20 | Basisfunktionalität erhält KeyDerivation Response von SGD 2, prüft den Erfolg der<br>Schlüsselableitung sowie die Authentizität des Nachrichtensenders.                                                                                                                                                                                  |
| 12.                          | FM bricht ab, falls die Nachricht nicht fehlerfrei und authentisch empfangen wurde.                                                                                                                                                                                                                                                      |
| 13.                          | FM zerlegt Nachricht in <Berechtigtenschlüssel 2> und <Associated Data 2>                                                                                                                                                                                                                                                                |
| 14.                          | Basisfunktionalität verschlüsselt und authentisiert den inneren<br><epa:EncryptedKeyContainer> sowie <Associated Data 1> + " " + <Associated Data 2> mit<br><Berechtigtenschlüssel 2> . Ciphertext und Konkatenierung aus <Associated Data 1> + " "<br>+ <Associated Data 2> werden Bestandteile des äußeren<epa:EncryptedKeyContainer>. |
|                              | Schlüsselmaterial hinterlegen                                                                                                                                                                                                                                                                                                            |
| 15.                          | FM erstellt <AuthorizationKey> und bettet den äußeren <epa:EncryptedKeyContainer><br>darin ein.                                                                                                                                                                                                                                          |
| 16.                          | FM legt mittels I_Authorization::putAuthorizationKey() den <AuthorizationKey> in der<br>Komponente Autorisierung ab.                                                                                                                                                                                                                     |

<span id="page-27-1"></span>Tabelle 16: Gemeinsamer Ablauf bei der initialen Schlüsselableitung

# <span id="page-27-0"></span>2.4 Security Problem Definition

Die Security Problem Definition beschreibt Annahmen, Bedrohungen und organisatorische Sicherheitspolitiken, die für das Fachmodul zur Erbringung der Sicherheitsleistung relevant sind. Die TR-Prüfung soll Stellung dazu nehmen, ob die Implementierung des begutachteten Fachmoduls die hier genannten Anforderungen ausreichend abdeckt.

#### 2.4.1 Bedrohungen

| T.Asset         | Das Fachmodul wird missbraucht, um von einem Primärsystem<br>unberechtigterweise auf Assets einer Patientenakte zuzugreifen.                     |
|-----------------|--------------------------------------------------------------------------------------------------------------------------------------------------|
| T.Eavesdropping | Es wird eine Transportverbindung zu einer unberechtigten Komponente<br>aufgebaut, z.B. aufgrund mangelnder Prüfung von Zertifikatseigenschaften. |

| T.eGK.Auth      | Es wird eine gefälschte eGK verwendet, die eGK wurde über OCSP bereits gesperrt<br>oder die OCSP-Prüfung konnte nicht durchgeführt werden.  |
|-----------------|---------------------------------------------------------------------------------------------------------------------------------------------|
| T.eGK.ExploitIF | Zwischen eGK und Kartenleser werden Angriffe auf das Fachmodul oder dessen<br>Eingabeverarbeitung etwa durch Buffer-Overflows durchgeführt. |
| T.LEI.Auth      | Das Fachmodul gewährt einem unberechtigten Leistungserbringerinstitut Zugriff<br>auf eine Patientenakte.                                    |
| T.Residual      | Zwischengespeicherte sensible Informationen sind nach dem Ablauf des Timeouts<br>oder nach Entfernen der eGK zugreifbar.                    |

#### 2.4.2 Organisatorische Sicherheitspolitiken

| OSP.Conformance    | Das Fachmodul nutzt die Basisfunktionen und integriert sich konform zur<br>Security Guidance in den Konnektor.                                         |
|--------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|
| OSP.eGK.Generation | Das Fachmodul wählt Schlüsselmaterial entsprechend der Smartcard Generation<br>aus.                                                                    |
| OSP.KeyTransform   | Bevor das Fachmodul Akten-/Kontextschlüssel in der Komponente Autorisierung<br>persistieren lässt, werden diese über die Schlüsselableitung gesichert. |
| OSP.LEI.Permit     | Das Fachmodul unterstützt die Einrichtung einer Adhoc-Berechtigungen für den<br>LEI.                                                                   |
| OSP.PHRTransform   | Bevor das Fachmodul Dokumente der Patientenakte an die Komponente<br>Dokumentenverwaltung übermittelt, werden diese kryptographisch gesichert.         |
| OSP.Privacy        | Assets (Tabelle 8) werden nicht protokolliert oder persistent gespeichert.                                                                             |
| OSP.Protocol       | Sicherheitsereignisse werden protokolliert.                                                                                                            |
| OSP.ServiceIF      | Nur in der Spezifikation [gemSpec_FM_ePA] definierte Dienste sind vom<br>Primärsystem erreichbar, andere Schnittstellen existieren nicht.              |
| OSP.StaticCode     | Das Fachmodul wird systematisch auf Programmierfehler wie Buffer Overflows<br>untersucht, beispielsweise per statischer Code Analyse.                  |

#### 2.4.3 Annahmen

| A.FairUse   | Das Fachmodul wird konform zur Schnittstellenbeschreibung angesprochen, d.h.<br>aus dem Netz des Primärsystems werden keine Angriffe erwartet.                                                                          |
|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| A.Konnektor | Der Konnektor stellt CC-zertifizierte Basisfunktionalität für die Erbringung<br>sicherheitskritischer Leistungen wie kryptographische Primitive, Algorithmen,<br>Protokolle und die Erzeugung von Zufallszahlen bereit. |

#### <span id="page-28-0"></span>2.4.4 Annahmen zu betrieblichen Restrisiken

Für die Benennung der Restrisiken sind folgende Annahmen getroffen, die über den Sicherheitsnachweis anderer Komponenten und den sicheren Betrieb der Telematikinfrastruktur (TI) abgedeckt werden. Die kursive Einrückung zeigt an, dass deren Prüfung nicht durch diese TR abgedeckt wird.

• *Die Umgebung des Leistungserbringers und der Fachdienste MÜSSEN sicherstellen, dass nur spezifikationskonforme SOAP-Nachrichten zu den Webservice-Schnittstellen des Fachmoduls erfolgen. Eingehende IHE Dokumente vom Primärsystem oder der VAU enthalten keine Angriffe auf das XML-Parsing des Fachmoduls. Die VAU erzeugt IHE Responses an das Fachmodul selbst,*  *so dass auf der vom Fachmodul mit einem Parser interpretierten Ebene keine XML-Angriffe enthalten sein können[19](#page-29-0) .*

*Die LEI Umgebung MUSS alle Forderungen des Schutzprofils [PP0098], Kapitel 3 erfüllen, u.a. den physischen Schutz und ein vertrauenswürdiges Primärsystem und -Netzwerk.* 

*Primärsystem und die Komponenten der Fachdienste berücksichtigen den Datenschutz bei der Nutzung des unveränderlichen Anteils der KVNR sowie der abgeleiteten Attribute, u.a. Record Identifier und AuthenticationAssertion. Das Primärsystem separiert vertrauliche Inhalte von den Metadaten. Liefert das Primärsystem Metadaten, speichert das Fachmodul diese unverschlüsselt in der VAU.* 

*Hat das Primärsystem versäumt, ein genutztes SM-B im Konnektor vor der Nutzung im Aufrufkontext freizuschalten, schlägt die Signatur einer AuthenticationAssertion fehl und der Kartendienst informiert das Fachmodul über den Fehler.* 

- *Eine VAU unterbindet, dass Informationen verschiedener Patienten innerhalb der Dokumentenverwaltung vermischt werden. Die VAU wird von der Dokumentenverwaltung an eine AuthorizationAssertion gebunden. Nach der Schlüsselaushandlung wird der VAU direkt die AuthenticationAssertion übergeben, woraus eine feste Bindung zwischen Telematik-ID, Record Identifier und VAU Kanal etabliert wird. Die VAU verweigert Zugriffe, falls die Gültigkeit der AuthenticationAssertion abgelaufen ist.*
- *FdV: Wird ActivateAccount oder PutDocuments auf dem ePA Frontend des Versicherten (FdV) durchgeführt, werden dort Kontext-, Akten- und Dokumentenschlüssel erzeugt. Die Vertraulichkeit und Authentizität der Patientenakte hängt nimmt eine ausreichende Qualität der verwendeten Zufallsdaten an. Auf der Seite des Fachmoduls wird dafür CC-zertifizierter Zufall aus dem Konnektor eingesetzt. Vergleichbar wäre die Nutzung des eGK Zufallszahlengenerators im FdV oder eine CC-Zertfizierung nach [TR-03116-1#3.9].*

*Schwache FdV Implementierungen stellen ein Risiko dar, das jedoch nur die Patientenakte eines Versicherten betrifft, für den eine fehlerhafte ePA FdV Implementierung genutzt wurde. Grundsätzlich sind alle im Fachmodul erörterten Sicherheitsmechanismen auszuhebeln, indem ein Angreifer nicht über Konnektor und Fachmodul sondern über ein ggf. schadhaftes Frontend des Versicherten geführt werden kann. Aufgrund der Verschlüsselung kann der Angreifer hier jedoch nur das Aktenkonto unter Zugriff der jeweiligen eGK erreichen. Berechtigungen für LEI können am FdV nicht missbraucht werden.* 

<span id="page-29-0"></span>• *eGK / SM-B: Die Smartcards prüfen vor Durchführung kritischer Operationen die jeweilige Benutzerverifikation (PIN-Eingabe). Die betreffenden Operationen sind das Signieren einer Challenge bzw. eines SAML2 Tokens sowie der asymmetrische Teil des hybriden und symmetrischen Ver- / Entschlüsselns durch den Verschlüsselungsdienst. Das SM-B führt dies nur durch, nachdem es per PIN-Eingabe (ausgelöst vom Leistungserbringer selbst über das Primärsystem und den Konnektor) freigeschaltet wurde. Die eGK führt solche Operationen nur durch, nachdem das Fachmodul eine Card2Card Authentication durchgeführt hat und die Operationen 'PIN Verifizieren' des Kartendienstes aufgerufen hat.* 

# <span id="page-30-0"></span>3 Zertifizierung des FM ePA nach Technischer Richtlinie

## 3.1 Prüfgegenstand und –werkzeuge

Der TR-Prüfgegenstand ist das Fachmodul ePA sowie dessen Security Guidance. Die Prüfung bezieht sich auf die erbrachte Sicherheitsleistung des Fachmoduls an den Schnittstellen gemäß [gemSpec\_FM\_ePA#7.1, 7.2]. Auf diese wird von einem Primärsystem zugegriffen.

Die TR-Prüfung des Fachmoduls erfolgt unter zu Hilfenahme folgender Objekte und Dokumente.

- Gesamtes Fachmodul in kompilierter Form (Binärcode bzw. Bytecode) und im Quelltext;
- Benutzbare Entwicklungsumgebung des Fachmoduls zum Debuggen einschließlich eventueller Testfälle;
- angeschlossene eHealth-Kartenterminals zur Aufnahme von SM-B und eGK;
- Security Guidance des Fachmoduls;
- Erfüllung der Voraussetzungen zum Nachvollziehen der funktionalen Tests und Durchführen der TR-Tests, u.a. mindestens Simulationen der Fachdienste, der VAU, der SGD sowie eH-KT, einschließlich transportgesicherter Kanäle; instanziierte Zertifikate sowie Zertifikate für die Negativfälle der beteiligten Komponenten
- eGK und SMC-B der Test-Umgebung entsprechend der Anforderungen der Testfälle;

**Anwendungshinweis**: Für die Zertifikats- und Rollenprüfung soll der Hersteller eine hinreichende Abdeckung von Karten und Zertifikaten der Testumgebung bereitstellen. Alternativ muss dem Evaluator die Möglichkeit gegeben werden, entsprechende Zertifikate anzufordern bzw. selbst zu erstellen.

Der Konnektor-Hersteller stellt für die Prüfung bereit:

• Security Guidance des Konnektors

Die vorgenannten Objekte und Dokumente werden der TR-Prüfstelle vom Hersteller des Fachmoduls, ggf. mit Unterstützung des Konnektor Herstellers, bereitgestellt.

## <span id="page-30-1"></span>3.2 Prüfaufgaben

Die Prüfung nach Technischer Richtlinie deckt die Sicherheitseigenschaften des Fachmodul ePA ab. Die zu prüfende Sicherheitsfunktionalität des FM ePA lässt sich in folgende Prüfaspekte gliedern:

(1) Konsistenz zwischen ausgeliefertem Fachmodul und dessen Quelltext;

(2) Abwesenheit von nicht-spezifizierten Diensten und Schnittstellenfunktionen (O.ServiceIF);

(3) korrekte Funktionalität der Schnittstelle zur eGK, insbesondere Aufdeckung von Implementierungsfehlern bei der Datenübernahme der eGK sowie Vorbeugung vor Angriffen auf eingesetzte Fremdbibliotheken (O.RobustIF);

(4) Protokollierung von Sicherheitsereignissen und Definition von Sicherheitsprotokoll-Meldungen in der Security Guidance (O.Protocol, OE.SecureUse);

(5) Schutz der Assets (O.ClearSession, O.MultiTenancy, O.Privacy);

(6) verschlüsselte Datenhaltung (O.PHR.KeyGen, O.PHR.KeyUse, O.PHR.Transform, O.SGD.Transform);

(7) Berechtigungsmanagement (O.PHR.AuthLEI, O.PHR.AuthEGK, O.VAU.GrantPermit)

- (8) Informationsflusskontrolle (O.PHR.Flow, O.TLS);
- (9) Nutzung der Basisfunktionalität und Erfüllung der Security Guidance des Konnektors (O.Conformance, O.Konnektor, OE.Konnektor);
- (10) Ermittlung der Fachmodul Versionierung (OE.Versioning)

Der Hersteller dokumentiert für jeden Prüfaspekt, wie dessen Anforderung durch die Implementierung sichergestellt wird.

#### <span id="page-31-0"></span>*3.2.1 Funktionale Spezifikations-Tests*

Gemäß [Tabelle 3](#page-7-0), Zeile 2 wird das ePA-Fachmodul funktionaler Tests nach der Spezifikation durch die gematik unterworfen. Diese validieren die durch den Hersteller bereits durchgeführten funktionalen Tests [\(Tabelle 3](#page-7-0), Zeile 1). Einzelne Aspekte, die prinzipiell relevant für diese TR sind, wurden von der TR-Prüfung ausgeschlossen, da bereits eine funktionale Prüfung durch die Tests der gematik erfolgt ist. Von einer erneuten Prüfung wird kein Beitrag zu den definierten Sicherheitszielen erwartet.

Die folgende Liste fasst Anforderungen von [gemSpec\_FM\_ePA] zusammen, deren Umsetzung die Sicherheitsleistung unterstützt und daher vorausgesetzt wird. Die funktionalen Tests der gematik umfassen mindestens folgende Benutzungsszenarien:

- Bei der Bearbeitung von RequestFacilityAuthorization MUSS das Fachmodul Angaben über die vom Primärsystem angeforderte Zugriffsberechtigung auf dem eHealthcard-Terminal darstellen[20](#page-31-1);
- Terminalanzeige bei ActivateAccount[21](#page-31-2);
- Zugriff für gesperrte eGK[22](#page-31-3) / mit nicht ermittelbaren Sperrstatus[23](#page-31-4) verweigern;

#### *3.2.2 Common Criteria Zertifizierung des Konnektors*

Die TR-Prüfung des Fachmoduls basiert auf einem zuvor zertifizierten Konnektor, d.h. sie beruht auf den während der Konnektor-Evaluation festgestellten Sicherheitseigenschaften der Basisfunktionalität. Die Anforderungen an die Basisfunktionalität sind über das Schutzprofil [PP0098] sowie [gemProdT\_Kon#3.2.1] festgelegt. Die Anforderungen aus dem Produkttypsteckbrief müssen daher zusätzlich zum PP im Konnektor-ST aufgenommen und mitzertifiziert werden.

Das Konnektor Security Guidance Dokument (als eines der Ergebnisdokumente der Common Criteria Evaluation des Konnektors) führt sämtliche Schnittstellen für Basisfunktionen des Konnektors auf, deren Sicherheitseigenschaften in der TR-Zertifizierung des Fachmoduls enthalten sind. [Tabelle 17](#page-33-0) unterscheidet in der letzten Spalte den Einsatzzweck der aufgeführten Konnektor-Basisfunktionen: Schnittstellen die eine Sicherheitsleistung für das Fachmodul erbringen, müssen im Rahmen der CC-Zertifizierung mit geprüft werden. Die funktionalen Anforderungen werden durch die gematik Funktionstests abgedeckt, allerdings muss die Security Guidance des Konnektors deren Nutzung durch das Fachmodul erlauben.

| Basisfunktionalität           | Schnittstelle / Beschreibung             | Einsatzzweck |
|-------------------------------|------------------------------------------|--------------|
| Zugriffsberechtigungsdienst24 | TUC_KON_000 "Prüfe Zugriffsberechtigung" | Sicherheit25 |

20 A\_16212 - FM ePA: RequestFacilityAuthorization - Anzeige am Kartenterminal – Anzeigetext

- <span id="page-31-1"></span>A\_16214 - FM ePA: RequestFacilityAuthorization - Anzeige am Kartenterminal - Bestätigung
- A\_16215 FM ePA: RequestFacilityAuthorization Anzeige am Kartenterminal Abbruch
- A\_16216 FM ePA: RequestFacilityAuthorization Terminalanzeige für PIN-Eingaben der Operation

A\_16218 - FM ePA: RequestFacilityAuthorization - Anzeige am Kartenterminal - Nutzerinteraktion

<span id="page-31-2"></span>A\_16219 - RequestFacilityAuthorization - Anzeige am Kartenterminal – Optimierung

- 21 A\_14271 FM ePA: ActivateAccount Terminalanzeige für PIN-Eingaben der Operation
- <span id="page-31-3"></span>22 (informativ) A\_14767 - FM ePA: Übergreifende Anforderung - Gesperrtes Zertifikat auf der eGK
- <span id="page-31-4"></span>23 (informativ) A\_16211 - FM ePA: Übergreifende Anforderung - Zertifikat auf der eGK nicht prüfbar
- <span id="page-31-6"></span><span id="page-31-5"></span>24 A\_15136 - FM ePA: Übergreifende Anforderung - Verwendung des Zugriffsberechtigungsdienstes 25 A\_13941 - FM ePA: Login - Zugriffsberechtigung auf vom Konnektor verwaltete Ressourcen

| Basisfunktionalität                                                            | Schnittstelle / Beschreibung                                                                                                                              | Einsatzzweck |
|--------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------|--------------|
| Kartenterminaldienst                                                           | TUC_KON_051 "Mit Anwender über Kartenterminal inter<br>agieren"                                                                                           | Funktional   |
| Kartendienst26                                                                 | TUC_KON_026 "Liefere CardSession"                                                                                                                         | Funktional   |
|                                                                                | TUC_KON_012 "PIN verifizieren"                                                                                                                            | Sicherheit   |
|                                                                                | TUC_KON_022 "Liefere PIN-Status"                                                                                                                          | Sicherheit   |
|                                                                                | TUC_KON_023 "Karte reservieren"                                                                                                                           | Sicherheit   |
|                                                                                | TUC_KON_005 "Card-to-Card authentisieren"                                                                                                                 | Sicherheit   |
|                                                                                | TUC_KON_018 "eGK-Sperrung prüfen"                                                                                                                         | Sicherheit27 |
| Systeminformationsdienst                                                       | TUC_KON_254 "Liefere Ressourcendetails"<br>(zur Bestimmung der eGK-Version)                                                                               | Sicherheit   |
| Verschlüsselungsdienst                                                         | TUC_KON_075 "Symmetrisch verschlüsseln"                                                                                                                   | Sicherheit   |
|                                                                                | TUC_KON_076 "Symmetrisch entschlüsseln"                                                                                                                   | Sicherheit   |
| Signaturdienst28                                                               | TUC_KON_160 "Dokumente nonQES signieren"                                                                                                                  | Sicherheit   |
| Zertifikatsdienst29                                                            | TUC_KON_037 "Zertifikat prüfen"                                                                                                                           | Sicherheit   |
|                                                                                | TUC_KON_034 "Zertifikatsinformationen extrahieren"                                                                                                        | Sicherheit   |
| Protokollierungsdienst30                                                       | TUC_KON_271 "Schreibe Protokolleintrag"                                                                                                                   | Sicherheit   |
| TLS-Dienst31                                                                   | TUC_KON_110 "Kartenbasierte TLS-Verbindung<br>aufbauen"                                                                                                   | Sicherheit   |
|                                                                                | TUC_KON_111 "Kartenbasierte TLS-Verbindung abbauen"                                                                                                       | Sicherheit   |
| Zeitdienst32                                                                   | TUC_KON_351 "Liefere Systemzeit"                                                                                                                          | Sicherheit   |
| Namensdienst33                                                                 | TUC_KON_361 "DNS-Namen auflösen"                                                                                                                          | Funktional   |
|                                                                                | TUC_KON_362 "Liste der Dienste abrufen"                                                                                                                   | Funktional   |
|                                                                                | TUC_KON_363 "Dienstdetails abrufen"                                                                                                                       | Funktional   |
| Für Schlüsselerzeugung34                                                       | TUC_KON_072 "Daten symmetrisch verschlüsseln" oder<br>alternativ interne Schnittstelle für Erzeu<br>gung eines Akten-, Kontext-,<br>Dokumenten-Schlüssels | Sicherheit   |
| Für leichtgewichtige<br>Sicherungsschicht35                                    | Interne Schnittstellen zum Client für leichtgewichtige<br>Sicherungsschicht auf Anwendungsebene                                                           | Sicherheit   |
| Client für beidseitig<br>authentisierten Ende-zu<br>Ende-verschlüsselten Kanal | Interne Schnittstellen für die ECIES-basierte<br>Kommunikation zwischen Konnektor Basisfunktionalität<br>und zwei SGD-HSMs gemäß                          | Sicherheit   |

<span id="page-32-0"></span>26 A\_15194 - FM ePA: Übergreifende Anforderung - Verwendung des Kartendienstes

<span id="page-32-1"></span>27 (informativ) A\_14767 - FM ePA: Übergreifende Anforderung - Gesperrtes Zertifikat auf der eGK

<span id="page-32-2"></span>28 A\_15892 - FM ePA: Übergreifende Anforderung - Verwendung des Signaturdienstes

<span id="page-32-3"></span>29 A\_15891 - FM ePA: Übergreifende Anforderung - Verwendung des Zertifikatsdienstes

<span id="page-32-4"></span>30 A\_14710 - FM ePA: Übergreifende Anforderung - Verwendung des Protokollierungsdienstes

<span id="page-32-5"></span>31 A\_15535 - FM ePA: Übergreifende Anforderung - Verwendung des TLS-Dienstes des Konnektors

<span id="page-32-6"></span>32 A\_15677 - FM ePA: Übergreifende Anforderung - Verwendung des Zeitdienstes des Konnektors

<span id="page-32-7"></span>33 A\_15135 - FM ePA: Übergreifende Anforderung - Verwendung des Namensdienstes

<span id="page-32-8"></span>34 A\_15867 - FM ePA: Übergreifende Anforderung - Verwendung der Basisfunktionalität des Konnektors zur Schlüsselerzeugung

<span id="page-32-9"></span>35 A\_15894 - Übergreifende Anforderung - Verwendung der Basisfunktionalität des Konnektors zur Kommunikation mit der VAU bei Schlüsselaushandlung

A\_14223 - FM ePA: Autorisierung - Verbindung mit Zertifikats- und Rollenprüfung

| Basisfunktionalität | Schnittstelle / Beschreibung | Einsatzzweck |
|---------------------|------------------------------|--------------|
| mit SGD-HSDM36      |                              |              |

<span id="page-33-0"></span>Tabelle 17: Vom Fachmodul genutzte und sicherheitsrelevante Basisfunktionalität des Konnektors

Das Common Criteria Zertifizierung des Konnektors MUSS weiterhin folgende Eigenschaften der Basisfunktionalität umfassen:

- Rollenprüfung im TLS-Dienst: Das Fachmodul definiert beim Verbindungsaufbau für das TLS-Zertifikat der Gegenstelle eine zulässige Rolle*[37](#page-33-2)*. Werden die Anforderungen des Fachmoduls an das Zertifikat der Gegenstelle nicht erfüllt, MUSS der Konnektor die Verbindung abbrechen.
- Rollenprüfung in der Basisfunktionalität 'leichtgewichtige Sicherungsschicht zur VAU': Weist das Zertifikat der VAU nicht die Rolle *oid\_epa\_vau[38](#page-33-3)* auf, MUSS der Konnektor die Verbindung abbrechen.

#### 3.2.3 Sicherheitsziele für das Fachmodul und dessen Umgebung

#### 3.2.3.1 Prüfaspekt (2): Abwesenheit anderer Schnittstellen

O.ServiceIF Das Fachmodul bietet PHRService und PHRManagementService gemäß [gemSpec\_FM\_ePA#7.1.1] und [gemSpec\_FM\_ePA#7.2.1] an. Das Fachmodul DARF andere Schnittstellen NICHT anbieten. Das Fachmodul MUSS Interaktion mit anderen Fachmodulen vorbeugen.

#### 3.2.3.2 Prüfaspekt (3): korrekte Funktionalität der Schnittstelle zur eGK

O.RobustIF Das Fachmodul MUSS

• einer Ausnutzung mittels bekannter Angriffe aktiv vorbeugen, u.a. bei eingesetzten Fremdbibliotheken. Sind Funktionen einer Fremdbibliothek über die Außenschnittstelle des Fachmoduls erreichbar, DARF eine überholte Version NICHT eingesetzt werden.

**Anwendungshinweis**: Unter dem Begriff Fremdbibliotheken sind Code-Sammlungen für Protokollimplementierungen gemeint. Die OWASP Bedrohung 'A9:2017-Using Components with Known Vulnerabilities' bezieht sich auf die fehlerhafte Nutzung / Konfiguration von Bibliotheken mit bekannten Schwachstellen. Eine Version gilt als überholt, falls eine neuere, um Schwachstellen bereinigte Version verfügbar ist.

• von der eGK Schnittstelle eingehende Informationen daraufhin untersuchen, dass Angriffe wie das Herbeiführen von Buffer Overflows nicht ausnutzbar sind;

**Anwendungshinweis**: Die Prüfung beschränkt sich auf Interaktionen mit einer eGK, da die anderen Schnittstellen über eine Forderung nach einer vertrauenswürdigen Umgebung abgedeckt werden. Dritte könnten die Verbindung zum eHealth-Kartenterminal manipulieren und dabei schadhafte Daten einfügen. Abhängig von der Datenverarbeitung im Fachmodul könnte z.B. Pufferüberschreitungen verursacht werden.

- <span id="page-33-2"></span>37 A\_14930 - FM ePA: Authentisierung mit eGK - TLS mit Zertifikats- und Rollenprüfung A\_14223 - FM ePA: Autorisierung - Verbindung mit Zertifikats- und Rollenprüfung
- <span id="page-33-3"></span>A\_15532 - FM ePA: Dokumentenverwaltung - TLS mit Zertifikats- und Rollenprüfung

<span id="page-33-1"></span><sup>36</sup> A\_18165 - FM ePA: Übergreifende Anforderung - Verwendung der Basisfunktionalität des Konnektors zur Kommunikation mit einem SGD

Eine Untersuchung mittels Fuzzing wird nicht explizit gefordert und kann vom Evaluator im Zweifelsfall zusätzlich nach der statischen Codeuntersuchung hinzugezogen werden.

#### 3.2.3.3 Prüfaspekt (4): Protokollierung

- O.Protocol Das Fachmodul MUSS auftretende Sicherheitsereignisse im Protokollierungsdienst des Konnektors aufzeichnen[39](#page-34-0) .
- OE.SecureUse Die Security Guidance des Fachmoduls MUSS mögliche sicherheitsrelevante Meldungen im Sicherheitsprotokoll definieren.

**Anwendungshinweis**: Die Dokumentation soll alle Fehlerursachen, die im Sicherheitsprotokoll gemeldet werden, darstellen. Damit kann TR-Prüfung diese über Tests abdecken.

#### 3.2.3.4 Prüfaspekt (5): Schutz der Assets

O.ClearSession Auslöser für das Beenden einer Aktensession sind u.a.:

- der Terminaldienst informiert das Fachmodul, dass die eGK aus dem Kartenterminal entfernt wurde[40](#page-34-1);
- 20 Minuten Inaktivität[41](#page-34-2) .

In diesem Fall MUSS das Fachmodul folgende Operationen ausführen:

- die Komponente Dokumentenverwaltung auffordern, die zugeordnete VAU zu schließen[42](#page-34-3);
- die Komponente Autorisierung auffordern, das Erneuern der AuthenticationAssertion zu unterbinden[43](#page-34-4); ein dabei auftretender Fehler MUSS im Sicherheitsprotokoll erfasst werden[44](#page-34-5);
- sämtliche zur Patientenakte gehörigen Daten sicher löschen;
- O.MultiTenancy Das Fachmodul MUSS Aktensessions nach den Tupeln ( Telematik-ID, Record Identifier ) sowie ( Versicherten-ID, Record Identifier ) strikt voneinander trennen[45](#page-34-6) .

**Anwendungshinweis**: Insbesondere DÜRFEN Informationen einer Aktensession NICHT eingesetzt werden, falls das Primärsystem im Aufrufkontext ein SM-B mit abweichender Telematik-ID vorliegt. Aktensessions DÜRFEN NICHT zwischen Aufrufkontexten mit verschiedenen Versicherten-IDs oder verschiedenen Telematik-IDs wiederverwendet werden.

O.Privacy Das Fachmodul MUSS medizinische und personenbezogene Daten sowie Schlüsselmaterial schützen, indem es:

- Zwischengespeicherte Assets außerhalb von Aktensessions frühestmöglich löscht. Das Fachmodul MUSS Dokumentenschlüssel sofort nach der
- <span id="page-34-0"></span>39 A\_14710 - FM ePA: Übergreifende Anforderung - Verwendung des Protokollierungsdienstes (informativ) A\_17230 - FM ePA: Sicherheitsprotokoll (informativ) A\_17451 - FM ePA: Logout Aktensession - Unterbindung der Erneuerung der AuthenticationAssertion – Fehler (informativ) A\_17142 - FM ePA: Logout Aktensession - Löschung der Verbindung zur VAU – Fehler 40 A\_17949 - FM ePA: Aktensession - Löschen der Aktensession bei Entfernen der eGK; Vorbedingung
- <span id="page-34-2"></span><span id="page-34-1"></span>41 A\_14651 - FM ePA: Logout Aktensession - Löschen der Aktensession
- <span id="page-34-3"></span>42 (informativ) A\_14169 - FM ePA: Logout Aktensession - Löschung der Verbindung zur VAU
- <span id="page-34-4"></span>43 A\_17450 - FM ePA: Logout Aktensession - Unterbindung der Erneuerung der AuthenticationAssertion
- <span id="page-34-5"></span>44 A\_17451 - FM ePA: Logout Aktensession - Unterbindung der Erneuerung der AuthenticationAssertion – Fehler
- <span id="page-34-6"></span>45 A\_13677 - FM ePA: Trennung von Operation

Ver-/Entschlüsselung eines Dokuments löschen[46](#page-35-1). Das Fachmodul MUSS AuthenticationAssertions spätestens nach Ablauf der Gültigkeit löschen[47](#page-35-2);

- Assets nicht persistent speichert[48](#page-35-3);
- Assets nicht in Protokolleinträgen verwendet[49](#page-35-4) .

#### 3.2.3.5 Prüfaspekt (6): verschlüsselte Datenhaltung

O.PHR.KeyGen Für die Erzeugung von Dokumentenschlüssel[50](#page-35-5), Akten-/und Kontextschlüssel[51](#page-35-6) MUSS das Fachmodul Zufallszahlen der Länge 256 Bit von der Basisfunktionalität verwenden[52](#page-35-7). Diese DÜRFEN NICHT im Fachmodul nachbearbeitet werden.

#### O.PHR.KeyUse Das Fachmodul MUSS

• vor der Nutzung von kryptographischen Assets deren Bitlänge auf Plausibilität prüfen. Für AES Schlüsselcontainer prüft das Fachmodul die erwartete Länge von 256 Bit[53](#page-35-8). Bei festgestellter Abweichung gegenüber [gemSpec\_Krypt#A\_15705] MUSS das Fachmodul die Operation abbrechen[54](#page-35-9);

**Anwendungshinweis**: Über eine fehlerhafte FdV-Implementierung könnten nicht-konforme Kontext-/Akten-/Dokumentenschlüssels Teil einer Patientenakte werden. Das Fachmodul dekodiert diese Assets aus der hexadezimalen Kodierung (u.a. [Tabelle 13,](#page-26-3) 17.).

- sicherstellen, das Akten-/Kontextschlüssel nur mit AES/GCM und zufälligen Initialisierungsvektoren (IV) genutzt werden[55](#page-35-10);
- für die Signatur des SAML2-Tokens die Kartengeneration bei der Schlüsselauswahl berücksichtigen[56](#page-35-11) ([Tabelle 18](#page-35-0)):

| Ermittelte Generation | Verwendeter Schlüssel der SMC-B |
|-----------------------|---------------------------------|
| G2                    | PrK.HCI.OSIG.R2048              |
| Ab G2.1               | PrK.HCI.OSIG.E256               |

<span id="page-35-0"></span>Tabelle 18: Berücksichtigung der Kartengeneration in der SAML2 Signatur

O.PHR.Transform Vor Übermittlung eines IHE Dokuments in die VAU MUSS das Fachmodul das verschlüsselte Dokument und den verschlüsselten Dokumentenschlüssel in die XML-Datenstruktur einbetten[57](#page-35-12) . Das Fachmodul nutzt den

- <span id="page-35-1"></span>46 A\_13903 - FM ePA: putDocuments - Löschen der Dokumentenschlüssel
- A\_14959 FM ePA: getDocuments Löschen der Dokumentenschlüssel
- <span id="page-35-2"></span>47 (informativ) A\_15203 - FM ePA: Authentisierung mit SM-B - Löschen der AuthenticationAssertion
- <span id="page-35-3"></span>48 A\_14173 - FM ePA: Sicherheit - Keine persistente Speicherung von personenbezogenen Daten A\_14722 - FM ePA: Sicherheit - Keine persistente Speicherung von Dokumenten und Metadaten
- <span id="page-35-4"></span>A\_14174 - FM ePA: Sicherheit - Keine Speicherung von privaten Schlüsseln
- 49 A\_14154 FM ePA: Verbot des Logging von Schlüsselmaterial
- A\_14155 FM ePA: Verbot des Logging von medizinischen und personenbezogenen Daten
- <span id="page-35-5"></span>50 [gemSpec\_DM\_ePA] A\_14975 - Verschlüsselung des Dokuments mit dem DocumentKey; Aspekt Schlüsselerzeugung
- <span id="page-35-6"></span>51 A\_14742 - FM ePA: ActivateAccount - Akten- und Kontextschlüssel erzeugen [gemSpec\_Krypt] A\_15705 - Vorgaben Aktenschlüssel (RecordKey) und Kontextschlüssel (ContextKey) Bullet 1
- 
- <span id="page-35-7"></span>52 A\_15867 - FM ePA: Übergreifende Anforderung - Verwendung der Basisfunktionalität des Konnektors zur Schlüsselerzeugung
- <span id="page-35-8"></span>53 [gemSpec\_Krypt] A\_15705 - Vorgaben Aktenschlüssel (RecordKey) und Kontextschlüssel (ContextKey) Bullet 3
- <span id="page-35-9"></span>54 A\_16193 - FM ePA: Übergreifende Anforderung - Vorgaben Aktenschlüssel und Kontextschlüssel – Fehler 55 [gemSpec\_Krypt] A\_15705 - Vorgaben Aktenschlüssel (RecordKey) und Kontextschlüssel (ContextKey) Bullet 2
- <span id="page-35-11"></span><span id="page-35-10"></span>56 (informativ) A\_17483 - FM ePA: Übergreifende Anforderung - Kryptographische Verfahren für Smartcards der Generation 2 A\_17484 - FM ePA: Übergreifende Anforderung - Kryptographische Verfahren für Smartcards ab Generation 2.1
- <span id="page-35-12"></span>57 A\_13907 - FM ePA: putDocuments - Verschlüsselung der Dokumente (informativ) A\_14977 - Dokumentenverschlüsselung gemäß XML Encryption

Verschlüsselungsdienst[58](#page-36-0) für die Ver- und Entschlüsselung / Authentisierung von IHE-Dokumenten[59](#page-36-1) sowie Dokumentenschlüsseln[60](#page-36-2) .

O.SGD.Transform Bei der wiederkehrenden Schlüsselableitung DARF das Fachmodul den Inhalt der Associated Data NICHT parsen.

> **Anwendungshinweis**: Das Fachmodul erhält die Associated Data aus dem Schlüsselspeicher der Komponente Autorisierung. Das Fachmodul unterscheidet die Rollen nicht. Nachdem das Fachmodul Berechtigtenschlüssel erhalten hat, nutzt es die Basisfunktionalität um Akten-/Kontextschlüssel im Zwiebelschalenprinzip zu entschlüsseln[61](#page-36-3). Eingesetzt wird AES/GCM mit 256 Bit Authentication Tag[62](#page-36-4). Schlägt die Authentizitätsprüfung auf einer Ebene fehl, bricht die Entschlüsselung ab.

Um Akten-/Kontextschlüssel für einen neuen Berechtigten persistent in der Komponente Autorisierung zu hinterlegen, MUSS das Fachmodul:

• KVNR und Telematik-ID der SM-B aus dem Aufrufkontext (abhängig von der Regel) für die Schlüsselableitung nutzen[63](#page-36-5);

**Anwendungshinweis**: Die Telematik-ID[64](#page-36-6) wird durch die Basisfunktionalität kodiert.

- Akten-/Kontextschlüssel im Zwiebelschalenprinzip mit den Berechtigtenschlüsseln sichern und authentisieren[65](#page-36-7);
- nur gesicherte Daten in der XML-Struktur <ePA:EncryptedKeyContainer> übermitteln[66](#page-36-8);

#### 3.2.3.6 Prüfaspekt (7): Berechtigungsmanagement

#### O.PHR.AuthEGK Das Fachmodul MUSS

- eine gegenseitige Card2Card-Authentication zwischen SM-B und eGK initiieren[67](#page-36-9);
- die gleichzeitige Nutzung der eGK in anderen Operationen unterbinden[68](#page-36-10);

#### O.PHR.AuthLEI Das Fachmodul MUSS

- <span id="page-36-0"></span>58 A\_14748 - FM ePA: Übergreifende Anforderung - Verwendung des Verschlüsselungsdienstes
- <span id="page-36-1"></span>59 A\_18008 - FM ePA: putDocuments - Verschlüsselung der Dokumente mit Signaturdienst; Zeile 1 [gemSpec\_DM\_ePA] A\_14975 - Verschlüsselung des Dokuments mit dem DocumentKey; Aspekt Dokument verschlüsseln A\_18009 - FM ePA: getDocuments - Entschlüsselung der Dokumente mit Signaturdienst; Zeile 2
- <span id="page-36-2"></span>60 A\_18008 - FM ePA: putDocuments - Verschlüsselung der Dokumente mit Signaturdienst; Zeile 2 [gemSpec\_DM\_ePA] A\_14976 - Verschlüsselung des DocumentKey mit dem RecordKey A\_18009 - FM ePA: getDocuments - Entschlüsselung der Dokumente mit Signaturdienst; Zeile 1
- 
- <span id="page-36-3"></span>61 A\_17869 - FM ePA: Schlüsselableitung bei Entschlüsselung - Entschlüsselung mit Verschlüsselungsdienst
- [gemSpec\_Krypt] A\_17872 Ver- und Entschlüsselung der Akten und Kontextschlüssel (Schlüsselableitungsfunktionalität ePA) 62 [gemSpec\_Krypt] A\_18004 - Vorgaben für die Kodierung von Chiffraten (innerhalb von ePA)
- <span id="page-36-5"></span><span id="page-36-4"></span>63 (informativ) A\_17992 - FM ePA: Schlüsselableitung - Ermittlung von AssociatedData
- <span id="page-36-6"></span>64 (informativ) A\_14749 - FM ePA: ActivateAccount - Hinterlegen des verschlüsselten Schlüsselmaterials
- <span id="page-36-7"></span>65 A\_17868 - FM ePA: RequestFacilityAuthorization - Akten- und Kontextschlüssel mit eGK verschlüsseln A\_18007 - Schlüsselableitung bei Verschlüsselung - Verschlüsselung mit Verschlüsselungsdienst (informativ) A\_17743 - FM ePA: ActivateAccount - Akten- und Kontextschlüssel für den Versicherten verschlüsseln [gemSpec\_Krypt] A\_17872 - Ver- und Entschlüsselung der Akten und Kontextschlüssel (Schlüsselableitungsfunktionalität ePA)
- <span id="page-36-8"></span>66 A\_14749 - FM ePA: ActivateAccount - Hinterlegen des verschlüsselten Schlüsselmaterials A\_14829 - FM ePA: RequestFacilityAuthorization - Ablage der Schlüssel in der Komponente Autorisierung
- <span id="page-36-9"></span>67 (informativ) A\_15215 - FM ePA: Übergreifende Anforderung - Prüfung von Authentizität und Echtheit der beteiligten Smartcards (C2C)
- <span id="page-36-10"></span>68 (informativ) A\_15137 - FM ePA: Übergreifende Anforderung - Unterbindung paralleler Zugriffe auf die eGK
- vor der Dienstnutzung die Zugriffsberechtigung des aufrufenden Primärsystems *(durch die Basisfunktionalität per TUC\_KON\_000)*[69](#page-37-1) prüfen;
- beim Erstellen der AuthenticationAssertion eine SM-B auswählen, deren Zertifikat eine zulässigen Autorisierungsempfänger-Rolle (ProfessionOID) ausweist UND die der gleichen Telematik-ID wie der Aufrufkontext angehört[70](#page-37-2);
- die Telematik-ID aus dem SM-B des Aufrufkontext es in die AuthenticationAssertion einbringen[71](#page-37-3);

#### O.PHR.Permission Für die Erteilung einer Adhoc-Berechtigung MUSS das Fachmodul:

• die Bestätigung in der eGK als PIN.CH verifizieren lassen[72](#page-37-4);

<span id="page-37-0"></span>**Anwendungshinweis**: Für den Verbindungsaufbau zur VAU signiert die eGK eine GatewayChallenge. Hierfür wird der Versicherte / Vertreter aufgefordert, die per TUC\_KON\_051 angezeigten Details der Berechtigung durch PIN-Eingabe am eH-KT zu bestätigen (f*unktionaler Test siehe Abschnitt [Fehler: Verweis nicht](#page-37-0)  [gefunden](#page-37-0)).* Die PIN-Eingabe muss unabhängig von vorherigen Eingaben erfolgen.

- die gesamte Operation abbrechen, sofern die Komponente Autorisierung putAuthorizationKey() aufgrund eines technischen Fehlers abweist;
- die BasePolicy als XACML 2.0 Profil entsprechend [gemSpec\_Dokumentenverwaltung# Tab\_FM\_ePA\_023][73](#page-37-5) zusammensetzen;

**Anwendungshinweis**: Zunächst werden Akten- und Kontextschlüssel verschlüsselt im Schlüsselkasten der Dokumentenverwaltung abgelegt. Die Spezifikation beabsichtigt, dass die BasePolicy erst an die VAU übermittelt wird, nachdem die Aufnahme der Schlüssel durch die Dokumentenverwaltung bestätigt wurde.

#### 3.2.3.7 Prüfaspekt (8): Informationsflusskontrolle

O.PHR.Flow [Tabelle 18](#page-35-0) definiert die zulässige Informationsweitergabe abhängig von der Art eines Assets und dessen Verschlüsselung.

| Asset         | Selektion anhand der<br>Verschlüsselung | Empfänger    | Beispiele für Operationen           |
|---------------|-----------------------------------------|--------------|-------------------------------------|
| IHE Dokument  | Klar74                                  | Primärsystem | I_PHR_Management::getDocuments      |
|               | Dokumentenschlüssel75                   | VAU          | I_PHR_Management::putDocuments      |
| IHE Metadaten | Klar                                    | VAU          | I_PHR_Management::updateDocumentSet |
| BasePolicy    | Klar76                                  | VAU          | Nach                                |

<span id="page-37-1"></span>69 (informativ) A\_13941 - FM ePA: Login - Zugriffsberechtigung auf vom Konnektor verwaltete Ressourcen

<span id="page-37-2"></span>70 (informativ) A\_17928 - FM ePA: Übergreifende Anforderung - Ermittlung eines SM-B - Prüfung OID

- <span id="page-37-3"></span>71 A\_14927 - FM ePA: Authentisierung mit SM-B - Erstellung des SAML-Token
- A\_15638 FM ePA: Authentisierung mit SM-B Behauptungen im SAML-Token
- <span id="page-37-4"></span>72 A\_14271 - FM ePA: ActivateAccount - Terminalanzeige für PIN-Eingaben der Operation
- <span id="page-37-5"></span>A\_14769 - FM ePA: RequestFacilityAuthorization - Bestätigung der Berechtigung 73 A\_15693 - FM ePA: RequestFacilityAuhtorization – Erstellung von Policy Document
- (informativ) [gemSpec\_Dokumentenverwaltung] A\_15442 Komponente ePA-Dokumentenverwaltung Nutzungsvorgaben zum Inhalt eines Policy Documents zur Berechtigung einer Leistungserbringerinstitution

<span id="page-37-6"></span>74 A\_13907 - FM ePA: putDocuments - Verschlüsselung der Dokumente

(informativ) A\_14700 - FM ePA:getDocuments - Entschlüsselung der Dokumente

<span id="page-37-7"></span><sup>75</sup> [gemSpec\_DM\_ePA] A\_14975 - Verschlüsselung des Dokuments mit dem DocumentKey

| Asset                                     | Selektion anhand der<br>Verschlüsselung | Empfänger                                        | Beispiele für Operationen                                                                                                      |
|-------------------------------------------|-----------------------------------------|--------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------|
|                                           |                                         |                                                  | I_PHR_ManagementService::requestFacili<br>tyAuthorisation                                                                      |
| IHE Suchanfrage                           | Klar77                                  | VAU                                              | I_PHR_Management::find                                                                                                         |
| IHE Suchergebnisse                        | Klar78                                  | Primärsystem                                     | Resultate aus<br>I_PHR_Management::find                                                                                        |
| Kontextschlüssel                          | Klar79                                  | VAU                                              | Notwendig zur Verarbeitung von<br>Metadaten                                                                                    |
|                                           | Berechtigtenschlüssel80                 | Komponente<br>Autorisierung                      | I_Authorization_Management<br>::putAuthorizationKey<br>::replaceAuthorizationKey                                               |
| Aktenschlüssel                            | Berechtigtenschlüssel81                 | Komponente<br>Autorisierung                      | I_Authorization_Management<br>::putAuthorizationKey                                                                            |
| Dokumentenschlüssel Aktenschlüssel82      |                                         | VAU                                              | Speicherung im Datenspeicher                                                                                                   |
| Von der eGK signierte<br>GatewayChallenge | Klar83                                  | Komponente<br>Zugangsgateway des<br>Versicherten | AuthInsurantService<br>::LoginCreateToken<br>Abschluss der<br>AuthenticationAssertion für eGK<br>durch das Versichertengateway |
| Authentication<br>Assertion               | Klar84                                  | Komponente<br>Autorisierung                      | I_Authorization_Management<br>::putAuthorizationKey                                                                            |
|                                           | Klar                                    | VAU                                              | Während der VAU-Nutzung                                                                                                        |
| Authorization<br>Assertion                | Klar85                                  | VAU                                              | Während Einrichtung einer neuen<br>VAU                                                                                         |

<span id="page-38-11"></span>Tabelle 19: Ausgehende Informationsflüsse und Anforderungen an die Transportsicherung

Das Fachmodul MUSS jede sonstige Informationsweitergabe von Assets unterbinden[86](#page-38-9), etwa wenn anderweitige IHE ITI-Akteure oder Operationen angefordert werden[87](#page-38-10) .

O.TLS Das Fachmodul MUSS

- 76 (informativ) A\_14833 FM ePA: RequestFacilityAuthorization Ablage der Policy-Dokumente in der Dokumentenverwaltung
- <span id="page-38-0"></span>77 (informativ) A\_15765 - FM ePA: PHR\_Service: Weiterleiten einer find-Anfrage
- <span id="page-38-1"></span>78 (informativ) A\_15766 - FM ePA: PHR\_Service: Weiterleiten von find-Antworten
- <span id="page-38-2"></span>79 (informativ) A\_14649 - FM ePA: Dokumentenverwaltung - Verwendung des Kontextschlüssels (informativ) A\_14647 - FM ePA: Dokumentenverwaltung - Initialisierung des Aktenkontexts
- <span id="page-38-3"></span>80 A\_17868 - FM ePA: RequestFacilityAuthorization - Akten- und Kontextschlüssel mit 2267 eGK verschlüsseln A\_18007 - Schlüsselableitung bei Verschlüsselung - Verschlüsselung mit Verschlüsselungsdienst
- <span id="page-38-4"></span>81 A\_17868 - FM ePA: RequestFacilityAuthorization - Akten- und Kontextschlüssel mit 2267 eGK verschlüsseln
- A\_18007 Schlüsselableitung bei Verschlüsselung Verschlüsselung mit Verschlüsselungsdienst
- <span id="page-38-5"></span>82 [gemSpec\_DM\_ePA] A\_14976 - Verschlüsselung des DocumentKey mit dem RecordKey A\_18008 - FM ePA: putDocuments - Verschlüsselung der Dokumente mit Signaturdienst

<span id="page-38-6"></span>83 (informativ) A\_14838 - FM ePA: Authentisierung mit eGK - Authentifizierungsbestätigung erstellen; Tab\_FM\_ePA\_030 Authentifizierungsbestätigung erstellen; Zeile 2

<span id="page-38-7"></span>84 (informativ) A\_14014 - FM ePA: Autorisierung Aktensession - Request SAML

- (informativ) A\_14838 FM ePA: Authentisierung mit eGK Authentifizierungsbestätigung erstellen
- <span id="page-38-8"></span>85 (informativ) A\_15200 - FM ePA: Dokumentenverwaltung - sichere Verbindung zur VAU - Aufrufparameter
- <span id="page-38-9"></span>86 A\_14175 - FM ePA: Sicherheit - Keine Weitergabe vertraulicher Informationsobjekte an das PS
- <span id="page-38-10"></span>87 A\_17879 - FM ePA: Übergreifende Anforderung IHE - Außenverhalten der IHE ITI-Implementierung
- Basisfunktionalität des Konnektors für gesicherte Kommunikation mit externen Komponenten den TLS-Dienst[88](#page-39-1) nutzen;
- die erwartete Rolle (TLS-Dienst Parameter roleToMatch) im Zertifikat der Gegenseite spezifizieren[89](#page-39-2) (siehe [Tabelle 20](#page-39-0));

| Kommunikationspartner                      | Durch FM spezifizierte<br>Rollen-OID |
|--------------------------------------------|--------------------------------------|
| ePA Zugangsgateway des Versicherten (ZGdV) | oid_epa_authn90                      |
| ePA-Autorisierungskomponente               | oid_epa_authz91                      |
| ePA-Dokumentenverwaltung                   | oid_epa_dvw92                        |
| Schlüsselgenerierungsdienst                | oid_sgd93                            |

<span id="page-39-0"></span>Tabelle 20: Parameter für die Zertifikatsprüfung an TLS-Dienst

• eine Operation mit Fehlercode abbrechen, falls der Verbindungsaufbau scheitert[94](#page-39-7);

#### 3.2.3.8 Prüfaspekt (9): Nutzung der Basisfunktionalität und Security Guidance des Fachmoduls

O.Conformance Das Fachmodul MUSS

- ausschließlich auf CC-zertifizierte Schnittstellen und für das Fachmodul freigegebene Basisfunktionalität des Konnektors zugreifen;
- sämtliche Auflagen der Security Guidance des Konnektors einhalten;

O.Konnektor Das Fachmodul MUSS für die Erbringung von Sicherheitsleistungen CCzertifizierte Basisfunktionalitäten des Konnektors verwenden:

- Verschlüsselungsdienst[95](#page-39-8);
- Namensdienst[96](#page-39-9);
- Zugriffsberechtigungsdienst[97](#page-39-10);
- Kartendienst[98](#page-39-11);
- TLS-Dienst[99](#page-39-12);
- Zeitdienst[100](#page-39-13);
- Schlüsselableitung und Nachrichtensicherung mit SGD[101](#page-39-14);
- <span id="page-39-1"></span>88 A\_15535 - FM ePA: Übergreifende Anforderung - Verwendung des TLS-Dienstes des Konnektors (informativ) [gemSpec\_SGD] A\_17889 - HTTPS-Schnittstelle SGD

<span id="page-39-2"></span>*Der TLS-Dienst prüft implizit, dass das Zertifikat der Gegenseite das Profil C.FD.TLS-S erfüllt [gemSpec\_Kon#TIP1−A\_4720].* 

- 89 A\_18012 FM ePA: Schlüsselableitung- TLS mit Zertifikats- und Rollenprüfung
- <span id="page-39-3"></span>90 A\_14930 - FM ePA: Authentisierung mit eGK - TLS mit Zertifikats- und Rollenprüfung
- <span id="page-39-4"></span>91 A\_14223 - FM ePA: Autorisierung - Verbindung mit Zertifikats- und Rollenprüfung
- <span id="page-39-5"></span>92 A\_15532 - FM ePA: Dokumentenverwaltung - TLS mit Zertifikats- und Rollenprüfung 93 A\_18012 - FM ePA: Schlüsselableitung- TLS mit Zertifikats- und Rollenprüfung
- <span id="page-39-6"></span>A\_18011 - FM ePA: Schlüsselableitung - TLS-Verbindung zu SGD 1 und 2 aufbauen
- <span id="page-39-7"></span>94 A\_17948 - FM ePA: Authentisierung mit eGK - TLS-Verbindung - Fehler
- <span id="page-39-8"></span>95 A\_14748 - FM ePA: Übergreifende Anforderung - Verwendung des Verschlüsselungsdienstes
- <span id="page-39-9"></span>96 A\_15135 - FM ePA: Übergreifende Anforderung - Verwendung des Namensdienstes
- <span id="page-39-10"></span>97 A\_15136 - FM ePA: Übergreifende Anforderung - Verwendung des Zugriffsberechtigungsdienstes
- <span id="page-39-11"></span>98 A\_15194 - FM ePA: Übergreifende Anforderung - Verwendung des Kartendienstes
- <span id="page-39-12"></span>99 A\_15535 - FM ePA: Übergreifende Anforderung - Verwendung des TLS-Dienstes des Konnektors
- <span id="page-39-13"></span>100 A\_15677 - FM ePA: Übergreifende Anforderung - Verwendung des Zeitdienstes des Konnektors
- <span id="page-39-14"></span>101 A\_18165 - FM ePA: Übergreifende Anforderung - Verwendung der Basisfunktionalität des Konnektors zur Kommunikation mit einem SGD
- Zertifikatsdienstes[102](#page-40-0);
- Signaturdienst[103](#page-40-1);
- Kommunikation mit der VAU[104](#page-40-2); **Anwendungshinweis**: Die Basisfunktionalität prüft das Zertifikatsprofil C.FD.VAU und die Rolle oid\_epa\_vau. Weiter forciert die se spätestens nach 24h eine Neuaushandlung des Sitzungsschlüssels[105](#page-40-3) . • Schlüsselerzeugung[106](#page-40-4)

Das Fachmodul DARF solche Funktionalität NICHT selbst realisieren, die über die in [Tabelle 17](#page-33-0) genannten Schnittstellen erreichbar ist.

OE.Konnektor Die Basisfunktionalität des Konnektors gemäß [gemProdT\_Kon#Tab 7][107](#page-40-5) hat eine erfolgreiche Common Criteria Zertifizierung durchlaufen.

#### 3.2.3.9 Prüfaspekt (10): Versionierung

OE.Versioning Hersteller von Konnektor oder Fachmodul erläutert, wie der Administrator die Version des Fachmoduls ermitteln kann. Der sichere Betrieb wird an die Versionsprüfung des Fachmoduls gegenüber dem TR-Zertifikat gebunden.

## 3.3 Rationale

| SPD                            | Sicherheitsziel                              | Rationale                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|--------------------------------|----------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| T.Residual<br>OSP.Privacy      | O.ClearSession<br>O.Privacy                  | Die Aktensession wird zeitlich begrenzt bis zum Entfernen<br>der eGK oder nach erreichen des Timeouts<br>zwischengespeichert. Das Fachmodul schließt dann die<br>Verbindung zur VAU, beendet die AuthenticationAssertion<br>und löscht die Daten sicher (O.ClearSession).<br>Assets werden baldmöglichst gelöscht. Spätestens wenn die<br>Gültigkeit einer AuthenticationAssertion abläuft (darf<br>übergreifend zu Aktensessions benutzt werden), löscht das<br>Fachmodul diese. Das Fachmodul speichert und<br>protokolliert Assets prinzipiell nicht (O.Privacy). |
| OSP.Conformance<br>A.Konnektor | O.Conformance<br>O.Konnektor<br>OE.Konnektor | Die konforme Integration eines Fachmoduls in den<br>Konnektor stellt sicher, dass nur dokumentierte, CC<br>zertifizierte Schnittstellen zugegriffen werden und die<br>Security Guidance erfüllt (O.Conformance, OE.Konnektor).                                                                                                                                                                                                                                                                                                                                       |

<span id="page-40-0"></span>102 A\_15891 - FM ePA: Übergreifende Anforderung - Verwendung des Zertifikatsdienstes

<span id="page-40-1"></span>103 A\_15892 - FM ePA: Übergreifende Anforderung - Verwendung des Signaturdienstes

<span id="page-40-2"></span>104 A\_15894 - FM ePA: Übergreifende Anforderung - Verwendung der Basisfunktionalität des Konnektors zur Kommunikation mit derVAU bei Schlüsselaushandlung

A\_15895 - FM ePA: Übergreifende Anforderung - Verwendung der Basisfunktionalität des Konnektors zur Kommunikation mit der VAU bei Schlüsselableitung

<span id="page-40-3"></span>105 [gemSpec\_Krypt] A\_15549 - FM ePA: Kommunikation zwischen FM ePA und VAU

<span id="page-40-5"></span><span id="page-40-4"></span>106 A\_15867 - FM ePA: Übergreifende Anforderung - Verwendung der Basisfunktionalität des Konnektors zur Schlüsselerzeugung 107 u.a. A\_18165 - FM ePA: Übergreifende Anforderung - Verwendung der Basisfunktionalität des Konnektors zur Kommunikation mit einem SGD

[gemSpec\_Kon] A\_17225 - Aufbau einer sicheren Verbindung zur Vertrauenswürdige Ausführungsumgebung (VAU)

| SPD                                     | Sicherheitsziel            | Rationale                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |  |  |  |
|-----------------------------------------|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|--|
|                                         | OE.Versioning              | Sicherheitsleistungen erbringt das Fachmodul alleine durch<br>Basisfunktionen des Konnektors (O.Konnektor).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |  |  |  |
|                                         |                            | Die CC-Zertifizierung des Konnektors umfasst die in<br>[gemProdT_Kon#Tab 7] erfassten Basisfunktionalitäten<br>(OE.Konnektor).                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |  |  |  |
|                                         |                            | Die Security Guidance des Konnektors informiert den<br>Betreiber, wie die Version des Fachmoduls zu prüfen ist<br>(OE.Versioning).                                                                                                                                                                                                                                                                                                                                                                                                                                                              |  |  |  |
|                                         | O.PHR.KeyGen               | Sicheres Schlüsselmaterial wird durch die zertifizierte<br>Basisfunktionalität des Konnektors erzeugt und nicht im<br>Fachmodul nachbearbeitet (O.PHR.KeyGen).                                                                                                                                                                                                                                                                                                                                                                                                                                  |  |  |  |
| T.Asset                                 | O.PHR.Flow                 | Die Weitergabe von Informationen ist nur gemäß der<br>Angaben aus der Whitelist zulässig. Bestimmte Assets<br>erfordern eine zusätzliche Verschlüsselung auf<br>Anwendungsschicht (O.PHR.Flow).                                                                                                                                                                                                                                                                                                                                                                                                 |  |  |  |
|                                         | O.MultiTenancy             | Die im Fachmodul verarbeiteten Informationen werden<br>strikt anhand von ( Telematik ID, Record Identifier ) bzw.<br>( Versicherten ID, Record Identifier ) getrennt. Eine<br>Wiederverwendung darüber hinaus wird ausgeschlossen<br>(O.MultiTenancy).                                                                                                                                                                                                                                                                                                                                          |  |  |  |
|                                         | Restrisko VAU              | Die VAU kann nur einmalig an eine AuthorizationAssertion<br>gebunden werden, wodurch es innerhalb einer VAU nicht zu<br>einer Vermischung kommen kann. Der Kanalauf-/abbau zur<br>VAU wird in der CC-Zertifizierung untersucht. Die VAU<br>unterliegt einer Sicherheitsbegutachtung, die sicherstellt dass<br>Informationen nur beabsichtigt und an das berechtigte<br>Fachmodul abfließen (Restrisiko).                                                                                                                                                                                        |  |  |  |
|                                         | Restrisiko<br>Primärsystem | Das Primärsystem liefert Metadaten und Dokumente an das<br>Fachmodul. Aufgabe des Fachmoduls ist es, die Inhalte der<br>Dokumente vor der VAU mittels Verschlüsselung zu<br>verbergen (O.PHR.Flow). Leitet das Primärsystem<br>vertrauliche Informationen innerhalb von Metadaten an das<br>Fachmodul, werden diese im Klartext an die VAU übermittelt.                                                                                                                                                                                                                                         |  |  |  |
| T.LEI.Auth<br>T.Asset<br>OSP.LEI.Permit | O.PHR.Permission           | Das Fachmodul veranlasst, dass bei der C2C Authentication<br>zwischen SM-B und eGK stets eine gegenseitige Prüfung<br>erfolgt, die SM-B im Konnektor also die Authentizität der eGK<br>validiert. Fehler führen zum Abbruch und werden an das<br>aufrufende System zurückgemeldet. Vor dem Durchführen<br>einer RequestFacilityAuthorization erfragt das Fachmodul die<br>Berechtigung über die PIN-Eingabe des Karteninhabers am<br>eH-KT. Für die Erstellung einer Adhoc Berechtigung eines<br>LEI kreiert das Fachmodul eine Base Policy für die<br>Dokumentenverwaltung (O.PHR.Permission). |  |  |  |
|                                         | O.PHR.AuthLEI              | Vor unbefugten Zugriffen durch eine LEI schützt die                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |  |  |  |

| SPD                               | Sicherheitsziel            | Rationale                                                                                                                                                                                                                                                                                                                                                                                                                        |
|-----------------------------------|----------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                   |                            | Prüfung der X.509 Zertifikatseigenschaften der SM-B sowie<br>die der Zugriffsberechtigung über das Informationsmodell<br>des Konnektors. Die Prüfung wird durch das FM angestoßen<br>(O.PHR.AuthLEI), die Entscheidung erfolgt teils durch die<br>Basisfunktionalität und teils durch die Komponente<br>Autorisierung.                                                                                                           |
| T.eGK.Auth                        | O.PHR.AuthEGK              | Das Fachmodul prüft vor jeder Verwendung der<br>Patientenakte durch den Versicherten / Vertreter den<br>Sperrstatus des eGK Zertifikats. Das Fachmodul fordert<br>einen exklusiven Zugriff auf die eGK an (O.PHR.AuthEGK).                                                                                                                                                                                                       |
| OSP.eGK.Generation                | O.PHR.KeyUse               | Vor der Nutzung importierter symmetrischer Schlüssel wird<br>die Länge des Schlüsselcontainers auf Plausibilität geprüft.<br>Das Fachmodul schützt Akten-/Kontextschlüssel, indem<br>dieser nur mit AES/GCM mit frischen IVs genutzt wird. Das<br>Fachmodul berücksichtigt abhängig von der Generation der<br>eGK/SM-B RSA/EC-basiertes Schlüsselmaterial und steuert<br>den Verschlüsselungsdienst entsprechend (O.PHR.KeyUse). |
| OSP.PHRTransform                  | O.PHR.Transform            | Das Fachmodul lässt IHE-Dokumente verschlüsseln und<br>hinterlegt den Dokumentenschlüssel verschlüsselt mit dem<br>Aktenschlüssel. <xenc:EncryptedData> wird dann in der<br>Komponente Dokumentensystem persistiert und beim<br>Abruf wieder entschlüsselt (O.PHR.Transform).                                                                                                                                                    |
| OSP.Protocol                      | O.Protocol<br>OE.SecureUse | Das Fachmodul nutzt den Protokollierungsdienst der<br>Basisfunktionalität. Sicherheitsrelevante Ereignisse werden<br>in [gemSpec_FM_ePA] vorgegeben (O.Protocol). Darüber<br>hinausgehende Sicherheitsereignisse werden in der Security<br>Guidance definiert (OE.SecureUse).                                                                                                                                                    |
| T.eGK.ExploitIF<br>OSP.StaticCode | O.RobustIF                 | Die eGK könnte für Angriffe gegen das Fachmodul oder<br>gegen eingesetzte Fremdbibliotheken genutzt werden. Die<br>Schnittstelle zur eGK wird als potentielles Einfallstor für<br>Buffer Overflows betrachtet. Die TR-Evaluation<br>berücksichtigt Ergebnisse von statischen Code Analyse um<br>prinzipielle Risiken an der eGK-Schnittstelle auszuschließen<br>(O.RobustIF).                                                    |
| OSP.ServiceIF                     | O.ServiceIF                | Webdienste jenseits der Spezifikation darf das Fachmodul<br>nicht anbieten. Das Fachmodul besitzt keine Schnittstellen<br>zu anderen Fachmodulen (O.ServiceIF).                                                                                                                                                                                                                                                                  |
| OSP.KeyTransform                  | O.SGD.Transform            | Berechtigtenschlüssel bezieht die Basisfunktionalität von<br>den Schlüsselgenerierungsdiensten. Das Fachmodul nutzt<br>die Basisfunktionalität um Akten-/Kontextschlüssel im<br>Zwiebelschalenprinzip zu sichern, bevor es verschlüsselte<br>Daten an die Komponente Autorisierung übermittelt<br>(O.SGD.Transform).                                                                                                             |
| T.Eavesdropping                   | O.TLS                      | Das Fachmodul spezifiziert von einem Verbindungsaufbau                                                                                                                                                                                                                                                                                                                                                                           |

| SPD       | Sicherheitsziel | Rationale                                                                                                                                                                                                                                                                                                            |
|-----------|-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|           |                 | zu TLS-basierten Fachdiensten Anforderungen an<br>Zertifikatsprofil und OID Rolle des Gegenübers. Stellt der<br>TLS-Dienst des Konnektors beim Verbindungsaufbau fest, dass<br>diese nicht erfüllt sind, bricht es die Verbindung ab und das<br>Fachmodul meldet einen Fehler an das Primärsystem<br>zurück (O.TLS). |
|           | O.Konnektor     | Das Fachmodul nutzt die Basisfunktionalität für den<br>Verbindungsaufbau zur VAU. Diese stellt sicher, dass das<br>Zertifikatsprofil und Rolle der VAU korrekt sind. Das<br>Fachmodul nutzt die Basisfunktionalität für die Abwicklung<br>der Schlüsselableitung (O.Konnektor).                                      |
| A.FairUse | Restrisiko      | Der Konnektor wird beim Leistungserbringer in einer<br>gesicherten Umgebung betrieben, was ebenfalls für die<br>Fachdienste gilt. Daher sind Angriffe aus der LEI Umgebung<br>und den Fachdiensten als Restrisiko zu betrachten.                                                                                     |

Tabelle 21: Rationale SPD-Sicherheitsziele des Fachmoduls und der Umgebung, sowie Restrisiken

## <span id="page-43-0"></span>3.3.1 Berücksichtigung typischer Webservice-Schwachstellen

Angelehnt an die OWASP Top 10 [OWASP:2017] MUSS die TR-Prüfung typische Schwachstellen von Webservices berücksichtigen. [Tabelle 22](#page-45-0) stellt die Prüfaktivitäten für die Top 10 bezogen auf das Fachmodul ePA dar.

| OSWASP ID                        | Einordnung für die Begutachtung<br>des Fachmodul ePA                                                                                                                                                                                                                                                                                                                                                   |             | Abdeckung mittels Sicherheitsziele und<br>verbleibende Restrisiken                                                                                                                                                        |
|----------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| A1:2017-Injection                | PHRService und<br>PHRManagementService besitzen<br>eine WSDL Beschreibung, die vom<br>aufrufenden System eingehalten<br>wird. Das Primärsystem ist<br>vertrauenswürdig und die<br>Nachricht wird vom Konnektor und<br>dessen Betriebsumgebung gesichert.                                                                                                                                               | •<br>•<br>• | Fehlerbehandlung bei von der eGK<br>importierten Daten (O.RobustIF)<br>SOAP-Nachrichten vom Primärsystem<br>enthalten keine Angriffe (Restrisiko)<br>IHE-Anfragen und -Responses enthalten<br>keine Angriffe (Restrisiko) |
| A2:2017-Broken<br>Authentication | Das Fachmodul erstellt die<br>AuthenticationAssertion bei LEI<br>Anmeldung, prüft deren<br>Vollständigkeit.<br>Der Aufruf des Signaturdienstes<br>wird durch Prüfungen in der<br>Komponente Autorisierung<br>sichergestellt.<br>Greift die Operation auf eine eGK<br>zu, stellt das Fachmodul zuvor eine<br>gegenseitige C2C Authentication<br>mit dem SM-B sicher und fordert<br>eine PIN-Eingabe an. | •<br>•<br>• | Erstellung AuthenticationAssertion für LEI<br>(O.PHR.AuthLEI)<br>Authentisierung des eGK Karteninhabers<br>(O.InsurantAuth)<br>exklusiver Zugriff auf eGK (O.InsurantAuth)                                                |

| OSWASP ID                              | Einordnung für die Begutachtung<br>des Fachmodul ePA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                       | Abdeckung mittels Sicherheitsziele und<br>verbleibende Restrisiken                                                                                                                                                                                                                                             |
|----------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| A3:2017-Sensitive Data<br>Exposure     | Detailliert in [gemSpec_FM_ePA]<br>gefordert. Es ist sicherzustellen, dass                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                       | Verbot der Protokollierung von Assets<br>(O.Privacy)                                                                                                                                                                                                                                                           |
|                                        | Daten nicht über nicht-spezifizierte<br>Schnittstellen abfließen können.<br>Das Fachmodul kontrolliert den<br>Informationsfluss der Assets.                                                                                                                                                                                                                                                                                                                                                                                                                   | •                     | Verbot der Persistierung von Assets<br>(O.Privacy)                                                                                                                                                                                                                                                             |
|                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | •                     | Löschen inaktiver Aktensessions<br>(O.ClearSession)                                                                                                                                                                                                                                                            |
|                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                       | Frühestmögliches Löschen von<br>Dokumentenschlüsseln und anderen Assets<br>nach Nutzung (O.Privacy)                                                                                                                                                                                                            |
|                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | •                     | Abwesenheit von nicht-spezifizierten<br>Schnittstellen (O.ServiceIF)                                                                                                                                                                                                                                           |
|                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | •                     | Informationsflusskontrolle (O.PHR.Flow)                                                                                                                                                                                                                                                                        |
| A4:2017-XML External<br>Entities (XXE) | Über die eGK Schnittstellen des<br>Fachmoduls werden keine XML<br>basierten Daten ausgewertet<br>(Zertifikate liegen im ASN.1 Format<br>vor). Andere Schnittstellen werden<br>als vertrauenswürdig betrachtet.<br>Daher sind keine Maßnahmen<br>durch das Fachmodul als notwendig<br>erachtet.                                                                                                                                                                                                                                                                | -                     |                                                                                                                                                                                                                                                                                                                |
| A5:2017-Broken Access<br>Control       | Das Fachmodul muss sicherstellen,<br>dass alle diesbezügliche Prüfungen<br>durch den Konnektor über die<br>Parametrisierung von Aufrufen der<br>Basisdienste und Basisfunktionalität<br>erfolgen können.<br>Bevor das Primärsystem das<br>Fachmodul anspricht, hat es zuvor<br>mit dem Konnektor das genutzte<br>SM-B freigeschaltet.                                                                                                                                                                                                                         | •<br>•                | Zugriffskontrolle eines LEI mittels Aufruf<br>des Zugriffsberechtigungsdienstes<br>(O.PHR.AuthLEI)<br>Zugriffskontrolle auf eGK mittels<br>Validierung der PIN.CH (O.PHR.Permission)                                                                                                                           |
| A6:2017-Security<br>Misconfiguration   | Das Fachmodul fordert<br>Sicherheitsleistungen an, die durch<br>die Basisdienste und<br>Basisfunktionalitäten des<br>Konnektors erbracht werden. Die<br>korrekte Ausführung wird über die<br>Parametrisierung und die<br>Auswertung von Rückgabewerten<br>erreicht.<br>Eine fehlerhafte Konfiguration soll<br>auch durch die strikte Trennung der<br>Aktensession sichergestellt werden.<br>Mögliche Fehler der Konfiguration<br>können über das<br>fachmodulspezifische<br>Sicherheitsprotokoll im Konnektor<br>Protokollierungsdienst aufgedeckt<br>werden. | •<br>•<br>•<br>•<br>• | Zertifikats-/Rollen-Prüfung für TLS<br>Verbindungen (O.TLS)<br>Sichere Verbindung zu VAU und SGD mit<br>Zertifikats-/Rollen-Prüfung (O.Konnektor)<br>Prüfung auf Schlüssellänge importierter<br>AES-Schlüssel (O.PHR.KeyUse)<br>Trennung der Aktensessions<br>(O.MultiTenancy)<br>Protokollierung (O.Protocol) |

| OSWASP ID                                                 | Einordnung für die Begutachtung<br>des Fachmodul ePA                                                                                                                                                                                                                                                                                                            | Abdeckung mittels Sicherheitsziele und<br>verbleibende Restrisiken                                                                                                                                                                |
|-----------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                                           | Beispiele: Beidseitige<br>Authentisierung während C2C108<br>und Rollenprüfung109                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                   |
| A7:2017-Cross-Site<br>Scripting (XSS)                     | Das Fachmodul wird nicht per<br>Browser angesprochen, daher ist<br>diese Klasse von<br>Implementierungsschwächen nicht<br>relevant.                                                                                                                                                                                                                             | -                                                                                                                                                                                                                                 |
| A8:2017-Insecure<br>Deserialization                       | Die Protokolle sind wohldefiniert.<br>AuthenticationAssertion und<br>AuthorizationAssertion werden<br>nicht durch einen Parser des<br>Fachmoduls untersucht, und das<br>Fachmodul ist nicht für die<br>Abwesenheit von Angriffsvektoren<br>verantwortlich.<br>Nachrichten von Primärsystem und<br>anderen Komponenten werden als<br>vertrauenswürdig angesehen. | •<br>Die Komponenten senden lediglich valide<br>SOAP Nachrichten (Restrisiko)<br>•<br>IHE-Requests und -Reponses enthalten keine<br>Angriffe (Restrisiko)<br>•<br>Deserialisierung für den Transportkanal zur<br>VAU (Restrisiko) |
| A9:2017-Using<br>Components with<br>Known Vulnerabilities | Das Fachmodul greift für die<br>Erbringung von<br>Sicherheitsleistungen auf CC<br>zertifizierte Basisfunktionalitäten<br>des Konnektors zu. Die TR-Prüfung<br>erfasst, ob darüber hinaus<br>verwundbare Bibliotheken genutzt<br>werden.                                                                                                                         | •<br>Nutzung von CC-zertifizierter<br>Basisfunktionalität des Konnektors<br>(OE.Konnektor)<br>•<br>Schutz vor Ausnutzung von Schwachstellen<br>in Fremdbibliotheken (O.RobustIF)                                                  |
| A10:2017-Insufficient<br>Logging & Monitoring             | Die Spezifikation definiert<br>sicherheitsrelevante Ereignisse<br>anhand ErrorType = Security in<br>[gemSpec_<br>FM_ePA#Tab_FM_ePA_011].<br>Können durch die Implementierung<br>des Fachmoduls weitere<br>Sicherheitsereignisse auftreten, sind<br>diese vom Hersteller in der Security<br>Guidance offenzulegen.                                               | •<br>Protokollierung von Sicherheitsereignissen<br>im Protokollierungsdienst (O.Protocol)<br>•<br>Definition von sicherheitsrelevanten<br>Fehlern über die Spezifikation hinaus in der<br>Security Guidance (OE.SecureUse)        |

<span id="page-45-0"></span>Tabelle 22: Rationale OWASP-Sicherheitsziele des Fachmoduls sowie der Umgebung

# 3.4 Prüfschritte

Die Prüfung nach TR MUSS mit Einsicht in den Quelltext des Fachmoduls durchgeführt werden. Dies ermöglicht den Evaluator und Zertifizierer, die Erfüllung geforderter Eigenschaften anhand seines Einblicks in die konkrete Implementierung zu belegen bzw. zu prüfen. Dazu benennt der Evaluator im Prüfbericht die relevanten Ausschnitte aus dem Quelltext (mit Referenz und geeignetem Zitat) im Prüfbericht. Der Hersteller stellt den Quelltext für die Prüfung in der Prüfstelle zur Verfügung.

<span id="page-45-2"></span><span id="page-45-1"></span>108 A\_15215 - FM ePA: Übergreifende Anforderung - Prüfung von Authentizität und Echtheit der beteiligten Smartcards (C2C) 109 A\_14223 - FM ePA: Autorisierung - Verbindung mit Zertifikats- und Rollenprüfung

Die Analyse des Quelltextes MUSS mitberücksichtigen, welche Vorbedingungen erfüllt sein müssen, damit der Prüfgegenstand sich in der vorgeschriebenen Weise verhält, und der Evaluator MUSS deren Plausibilität bewerten. Der Hersteller unterstützt dies, indem er – beispielsweise im Quelltext oder einem zugelieferten Dokument – begründet, in welchen Ausnahmefällen bestimmte Schritte einer Implementierung des Sicherheitsmechanismus nicht eingefordert werden.

Zulässig zur TR-Prüfung sind ebenfalls automatisierte Testfälle, sofern der Evaluator ein gutes Verständnis zur Mächtigkeit des Tools und der Testfälle besitzt und sie durch eine manuelle Analyse ergänzt werden. Die Anlagen eines TR-Prüfberichtes MÜSSEN darlegen, wie die korrekte Verhaltensweise der Implementierung ermittelt wurde: beispielsweise durch Protokollmitschnitte, Nachrichten an die Fachdienst-Komponenten, die VAU oder die Beschreibung von internen Zustandsänderungen.

Der Evaluator definiert die Prüfschritte selbstständig mit dem Ziel der Abdeckung der Test-Charakteristika in Abschnitt [3.4.2](#page-47-0) für die in Abschnitt [3.2](#page-30-1) definierten Prüfaufgaben.

## 3.4.1 Protokollierung der Prüfergebnisse

Die TR-Prüfung orientiert sich an den Test-Charakteristika (TC) im folgenden Abschnitt. Der Hersteller kann dazu Aussagen bereitstellen, in denen er die betreffende Umsetzung skizziert und eine Referenz auf die jeweilige Implementierung (Identifikation des Funktionsmoduls im Quelltext mit Zeilennummer) angibt. Bei komplexen TC stellt der Hersteller eine umfassende Liste der Vorkommen, etwa der Umgang mit sensitiven Daten in ePA-TR-Privacy-\*. Abhängig von der umgesetzten Prüftiefe unterstützen diese Herstelleraussagen die TR-Prüfung des Evaluators. Tabelle [23](#page-46-0) legt dar, welche Prüfschritte mindestens für die jeweilige Prüftiefen gefordert sind.

Anmerkung: Leitgedanke bei der Klassifikation der Testcharakteristika ist, dass sicherheitsrelevante Testfälle alleine durch eine Herstellererklärung belegt werden dürfen, sofern sie bereits im Rahmen der funktionalen gematik Spezifikationstests des TOE validiert worden sind.

| Prüftiefe | Mindestanforderungen an die Prüfung                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |  |  |  |
|-----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|--|
| Check     | Der Evaluator validiert (englisch check, entsprechend dem Begriff in der Common<br>Criteria Evaluation Methodology) die vom Hersteller beschriebene Maßnahme im<br>Hinblick auf Ihre Wirksamkeit und räumt bestehende Zweifel (Plausibilitätsprüfung)<br>aus, ob die Sicherheitsproblematik umfassend durch die beschriebene Maßnahme<br>verhindert wird. Die Validierung KANN weitergehende Schritte umfassen, wie z.B.<br>eine Quelltextanalyse, falls der Evaluator diese für eine umfassende Einschätzung<br>benötigt.   |  |  |  |
| Examine   | Der Evaluator untersucht (englisch examine, entsprechend dem Begriff in der<br>Common Criteria Evaluation Methodology) die betreffende Test-Charakteristik. Der<br>Evaluator MUSS in seiner Prüfung über die Mindestanforderungen für "Check"<br>hinausgehen: in der Regel wird dies durch umfassende Quelltextanalyse der<br>relevanten Implementierungsanteile geschehen. Die Unterstützung durch den<br>Hersteller kann genutzt werden. "Examine" erfordert jedoch eine eigenständige<br>Beurteilung durch den Evaluator. |  |  |  |

#### <span id="page-46-0"></span>Tabelle 23: Definition der Prüftiefen

Aus den Prüftiefen folgt auch der Einsatz von Quelltextanalyse bei der Begutachtung. Bei "Check" wählt der Evaluator aus, wie hoch die Abdeckung der Analyse für seine Einschätzung notwendig ist. Für "Examine" MUSS der TR-Prüfer erläutern, inwiefern sämtliche relevante Codezeilen in Betracht gezogen wurden. Besitzt beispielsweise eine Funktion keinen Zugriff auf sensitive Daten, könnte diese aus der Betrachtung von ePA-TR-Privacy-\* ausgeschlossen werden.

Der Evaluator MUSS für jede Test-Charakteristik darstellen, wie er sein Prüfurteil begründet.

Der Prüfbericht soll die Test-Charakteristiken in der nummerierten Abfolge aufführen.

| Verdict      | Notwendige Angaben                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |  |  |
|--------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|
| PASS         | Der Evaluator erläutert sein Verständnis, warum die Hersteller-Implementierung das<br>geforderte Sicherheitsziel erfüllt. Der Prüfbericht führt die durchgeführten<br>Prüfschritte sowie das Prüfergebnis aus.                                                                                                                                                                                                                                                                                                                             |  |  |
| INCONCLUSIVE | Der Prüfbericht spezifiziert/referenziert die fehlenden oder inkonsistenten<br>Informationen, damit der Hersteller die Nicht-Konformität zu dem betreffenden<br>Aspekt des Sicherheitsziel beseitigen kann.                                                                                                                                                                                                                                                                                                                                |  |  |
| FAIL         | Das geprüfte Fachmodul verfehlt das betreffende Sicherheitsziel. Der Evaluator SOLL<br>dokumentieren, inwiefern Angriffe durch Sicherheitsmaßnahmen in der Umgebung<br>des TOE (z.B. operative Maßnahmen) verhindert werden. Die Erwartung der TR ist,<br>dass die Sicherheitsziele durch den TOE selbst erbracht werden. Auch die Abweichung<br>von Vorgaben (ePA-TR-robustIF-deprecated) oder unzureichende Maßnahmen (ePA<br>TR-RobustIF-Parser) können dazu führen. Ein FAIL gefährdet grundsätzlich die TR<br>Zertifizierung des TOE. |  |  |

Jedes Test-Charakteristikum soll der Evaluator abschließend in einem Verdict zusammenfassen:

Tabelle 24: Definition der Verdicts

#### <span id="page-47-0"></span>3.4.2 Test-Charakteristiken

Die Test-Charakteristiken in [Tabelle 25](#page-55-0) brechen die Sicherheitsziele in elementare Prüfschritte auf. Der Evaluator SOLL über die einzelnen Prüfschritte hinaus sicherstellen, dass das betreffende Sicherheitsziel bzw. der jeweilige Prüfaspekt aus Abschnitt [3.2](#page-30-1) insgesamt erfüllt wird. Dies umfasst möglicherweise weitere, hier nicht aufgeführte Test-Charakteristika.

| # | Test-Charakteristika<br>ID                         | Kurzfassung<br>Prüfaspekt110           | Prüftiefe | Bemerkungen, Referenz                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|---|----------------------------------------------------|----------------------------------------|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|   | Prüfaspekt (1): Build                              |                                        |           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 1 | ePA-TR-Build                                       | Übereinstimmung<br>Fachmodul/Quelltext | Examine   | Der Hersteller bietet dem Evaluator einen<br>Weg an, die Übereinstimmung zwischen<br>ausführbarem Fachmodul und Quelltext<br>zu prüfen.<br>1) Der Evaluator kann dies beispielsweise<br>prüfen, in dem er das Binary bzw.<br>Bytecode selbst in der<br>Entwicklungsumgebung erstellt und mit<br>dem ausgelieferten Fachmodul vergleicht.<br>2) Alternativ kann der Evaluator beim<br>Hersteller den Build Prozess<br>protokollieren, hierbei sind die Quelltexte<br>sowie die Binärdatei/Bytecode mit<br>kryptographischen Mitteln (z.B. SHA-2) zu<br>identifizieren. Der Evaluator prüft damit,<br>ob die ihm vorliegenden Quelltexte damit<br>übereinstimmen. |
|   | Prüfaspekt (2): Abwesenheit anderer Schnittstellen |                                        |           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|   | O.ServiceIF                                        |                                        |           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 2 | ePA-TR-serviceIF-                                  | Die öffentlich                         | Examine   | Prüfung u.a. anhand der WSDL Vorgaben                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |

<span id="page-47-1"></span>110 Abgeleitet aus dem Sicherheitsziel der linken Spalte

| # | Test-Charakteristika<br>ID                                        | Kurzfassung<br>Prüfaspekt                                                        | Prüftiefe | Bemerkungen, Referenz                                                                                                                                                                                                                                                                                                                                                                     |
|---|-------------------------------------------------------------------|----------------------------------------------------------------------------------|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|   | unspecIF                                                          | bereitgestellte SOAP<br>Schnittstelle stimmt<br>mit [gemSpec_<br>FM_ePA] überein |           |                                                                                                                                                                                                                                                                                                                                                                                           |
| 3 | ePA-TR-serviceIF<br>undocumented                                  | Undocumented<br>Functions                                                        | Examine   | Der Hersteller erläutert, wie der SOAP<br>Responder im Konnektor eingerichtet<br>wird.<br>Der Evaluator stellt sicher, dass im<br>Fachmodul keine undokumentierten<br>Services und Funktionen und Update<br>Funktionalität existierten.                                                                                                                                                   |
| 4 | ePA-TR-serviceIF<br>interFM                                       | Keine Interaktion mit<br>anderen Fachmodulen                                     | Check     | Mögliche Interaktionen schließen<br>jeglichen Datenaustausch, etwa über<br>gemeinsame Ressourcen im Filesystem,<br>mit ein. Die Herstellererklärung stellt dar,<br>wie einer Interaktion vorgebeugt wird.                                                                                                                                                                                 |
|   | Prüfaspekt (3): korrekte Funktionalität der Schnittstelle zur eGK |                                                                                  |           |                                                                                                                                                                                                                                                                                                                                                                                           |
|   | O.RobustIF                                                        |                                                                                  |           |                                                                                                                                                                                                                                                                                                                                                                                           |
| 5 | ePA-TR-robustIF-Static                                            | Static Code Analysis                                                             | Check     | Der Hersteller führt eine statische Source<br>Code Analyse durch. Grundannahme für<br>die Evaluation ist eine durchgängig hohe<br>Codequalität (einschließlich der<br>eingesetzten Fremdbibliotheken).                                                                                                                                                                                    |
| 6 | ePA-TR-robustIF-lib                                               | Eingesetzte<br>Fremdbibliotheken                                                 | Examine   | Die Herstellererklärung stellt dar, welche<br>Bibliotheken eingesetzt werden und<br>inwiefern diese über die Schnittstellen des<br>Fachmoduls erreichbar sind.<br>Der Evaluator stellt die Vollständigkeit der<br>Liste sicher.                                                                                                                                                           |
| 7 | ePA-TR-robustIF<br>hardening                                      | Härtung                                                                          | Examine   | Die Herstellererklärung erläutert wie Code<br>der Input von Außen verarbeitet<br>(einschließlich Fremdbibliotheken) und<br>die Ausnutzbarkeit potentieller<br>Schwachstellen ausräumt. Dabei werden<br>die Ergebnisse der statischen Code Analyse<br>berücksichtigt. U.a. wird der eingesetzte<br>XML Parser und dessen Einsatz /<br>Konfiguration durch das Fachmodul<br>berücksichtigt. |
| 8 | ePA-TR-robustIF<br>deprecated                                     | Überholte Versionen                                                              | Check     | Die Herstellererklärung stellt dar, welche<br>Codebasis für Fremdbibliotheken<br>verwendet wird, einschließlich deren<br>Versionierung.                                                                                                                                                                                                                                                   |
| 9 | ePA-TR-RobustIF<br>ParseEGK                                       | Robustheit der<br>Schnittstellen                                                 | Examine   | Beim Import von der eGK: Schutz vor<br>Angriffen, z.B. Buffer Overflow und keine<br>Ausnutzbarkeit beim Interpretieren von<br>Daten. Hierbei werden Ergebnisse der<br>statischen Code Analyse hinzugezogen.                                                                                                                                                                               |

|    | Prüfaspekt (4): Protokollierung      |                                                                                                       |         |                                                            |  |                                                                                                                                                                                                                                                                                                                         |  |
|----|--------------------------------------|-------------------------------------------------------------------------------------------------------|---------|------------------------------------------------------------|--|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
|    | O.Protocol                           |                                                                                                       |         |                                                            |  |                                                                                                                                                                                                                                                                                                                         |  |
| 10 | ePA-TR-protocol-Entry                | Protokollierungs<br>funktion für<br>sicherheitsrelevante<br>Ereignisse                                |         | Check                                                      |  | Wie stellt das Fachmodul<br>Protokollierungseinträge zusammen?                                                                                                                                                                                                                                                          |  |
| 11 | ePA-TR-protocol<br>SecEvent          | Alle auftretenden<br>Sicherheitsereignisse<br>des Fachmoduls<br>werden protokolliert                  |         | Examine                                                    |  | Herstellererklärung erläutert Abdeckung<br>aller möglichen Sicherheitsereignisse.<br>[gemSpec_FM_ePA#Tab_FM_ePA_011] mit<br>ErrorType = Security                                                                                                                                                                        |  |
|    | OE.SecureUse                         |                                                                                                       |         |                                                            |  |                                                                                                                                                                                                                                                                                                                         |  |
| 12 | ePA-TR-protocol-Spec                 | Security Guidance<br>beschreibt Meldungen<br>des Fachmoduls im<br>Sicherheitsprotokoll<br>vollständig |         | Examine                                                    |  | Die Security Guidance skizziert, wodurch<br>die betreffenden Meldungen im<br>Sicherheitsprotokoll entstehen. Die<br>Herstellererklärung setzt Referenzen in<br>den Quelltext, wo Fehlerzustände<br>erkannt / gemeldet werden. Der Evaluator<br>prüft die Plausibilität und Vollständigkeit<br>der beschriebenen Fehler. |  |
| 13 | ePA-TR-protocol<br>SeccurityNote     | Nachverfolgung von<br>Fehlerfällen                                                                    |         | Check                                                      |  | Der Evaluator ergänzt anhand der<br>möglichen Meldungen die Teststrategie.                                                                                                                                                                                                                                              |  |
|    | Prüfaspekt (5): Schutz der Assets    |                                                                                                       |         |                                                            |  |                                                                                                                                                                                                                                                                                                                         |  |
|    | O.ClearSession                       |                                                                                                       |         |                                                            |  |                                                                                                                                                                                                                                                                                                                         |  |
| 14 | ePA-TR-ClearSession<br>removal       | Das Fachmodul<br>erkennt, dass die<br>eGK der<br>Aktensession<br>entfernt wurde                       |         | Check                                                      |  | TUC_KON_256<br>mit topic = "CARD/REMOVED"                                                                                                                                                                                                                                                                               |  |
| 15 | ePA-TR-ClearSession<br>timeout       | Das Fachmodul<br>erkennt, das eine<br>Aktensession für 20<br>Minuten inaktiv<br>war.                  | Examine |                                                            |  | Herstellererläuterung stellt dar, wodurch<br>Clear aufgerufen wird, einbezogen u.a.<br>TUC_KON_351 "Liefere Systemzeit"                                                                                                                                                                                                 |  |
| 16 | ePA-TR-ClearSession<br>VAU           | Beenden der VAU                                                                                       |         | I_Document_Management_Connect<br>Check<br>::CloseContext() |  |                                                                                                                                                                                                                                                                                                                         |  |
| 17 | ePA-TR-ClearSession<br>Autorisierung | AuthenticationAsser<br>tion Token<br>terminieren                                                      |         | Check                                                      |  | AuthInsurantService::LogoutToken()                                                                                                                                                                                                                                                                                      |  |
| 18 | ePA-TR-ClearSession<br>Residual      | Löschen aller<br>sensiblen Assets, die<br>zu einer<br>Aktensession<br>gehören                         |         | Examine                                                    |  | Herstellererklärung zum Vorgehen<br>u.a. Cache der Aktensession                                                                                                                                                                                                                                                         |  |
|    | O.MultiTenancy                       |                                                                                                       |         |                                                            |  |                                                                                                                                                                                                                                                                                                                         |  |

|    | Prüfaspekt (5): Schutz der Assets           |                                                                                                                                                           |         |                                                                                                                                                                                                                           |  |
|----|---------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| 19 | ePA-TR-MultiTenancy<br>sourcing             | Bezug von<br>Schlüsselmaterial<br>aus der<br>Komponente<br>Autorisierung sind<br>strikt getrennt                                                          | Examine | nach Tupel ( Versicherten-ID, Record<br>Identifier ) bzw. ( Telematik-ID, Record<br>Identifier)                                                                                                                           |  |
| 20 | ePA-TR-MultiTenancy<br>permissions          | Berechtigungen in<br>der VAU sind<br>ausschließlich der<br>betreffenen<br>Gruppe111<br>zugänglich                                                         | Examine | Der Hersteller erläutert die Trennung bzw.<br>unter welchen Bedingungen Aktensessions<br>wiederverwendet werden können;<br>u.a. Trennung zwischen Aktensessions, die<br>initial über eine eGK bzw. SM-B erzeugt<br>wurden |  |
| 21 | ePA-TR-MultiTenancy<br>key                  | Schlüssel in einer<br>Aktensession sind<br>ausschließlich der<br>Gruppe112<br>zugänglich, für die<br>diese<br>Berechtigtenschlüss<br>el abgeleitet wurden | Examine | Akten-/Kontextschlüssel                                                                                                                                                                                                   |  |
| 22 | ePA-TR-MultiTenancy<br>reuse                | Wiederverwendung<br>en von<br>Informationen aus<br>einer Aktensession<br>wird vorgebeugt,<br>falls nicht explizit<br>zulässig                             | Examine | Trennung anhand Tupel ( Versicherten-ID,<br>Record Identifier ) bzw. ( Telematik-ID,<br>Record Identifier)<br>Umfasst u.a. AuthenticationAssertion,<br>AuthorizationAssertion und Handle des VAU<br>Kanals                |  |
|    | O.Privacy                                   |                                                                                                                                                           |         |                                                                                                                                                                                                                           |  |
| 23 | ePA-TR-privacy-expiry                       | Erkennen, wann<br>eine<br>AuthenticationAsser<br>tion abgelaufen ist                                                                                      | Check   | Herstellererklärung zum Vorgehen                                                                                                                                                                                          |  |
| 24 | ePA-TR-privacy-RIP                          | Löschen<br>zwischengespeicher<br>ter Daten                                                                                                                | Examine | u.a. AuthenticationAssertion<br>Der Hersteller stellt den gewählten Zeitpunkt<br>bzw. Auslöser der Löschung dar.<br>Der Evaluator bestätigt anhand Tabelle 8, dass<br>Assets frühestmöglich gelöscht werden.              |  |
| 25 | ePA-TR-privacy<br>Persistent                | Keine persistente<br>Speicherung von<br>Assets durch das<br>Fachmodul                                                                                     | Examine | Alle persistenten Speicheroperationen des<br>Fachmoduls müssen betrachtet werden.                                                                                                                                         |  |
| 26 | ePA-TR-privacy-Protocol                     | Protokollierte Daten<br>enthalten keine<br>Assets                                                                                                         | Examine | Anhand der Herstellererklärung prüft der<br>Evaluator nach, dass Assets nicht protokolliert<br>werden.                                                                                                                    |  |
|    | Prüfaspekt (6): verschlüsselte Datenhaltung |                                                                                                                                                           |         |                                                                                                                                                                                                                           |  |
|    | O.PHR.KeyGen                                |                                                                                                                                                           |         |                                                                                                                                                                                                                           |  |

<span id="page-50-0"></span>111 Als Gruppen sind hier bezeichnet: die/der Versicherte/r, Gruppe der Vertreter, Gruppen von Leistungserbringern anhand ihrer Telematik-ID

<span id="page-50-1"></span>112 Als Gruppen sind hier bezeichnet: die/der Versicherte/r, Gruppe der Vertreter, Gruppen von Leistungserbringern anhand ihrer Telematik-ID

|    | Prüfaspekt (6): verschlüsselte Datenhaltung |                                                                                                         |         |                                                                                                                                                                                                                                                                  |  |
|----|---------------------------------------------|---------------------------------------------------------------------------------------------------------|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| 27 | ePA-TR-PHR-KeyGen<br>rnd                    | Bezug von<br>Zufallszahlen                                                                              | Check   | Interne Schnittstelle zur<br>Basisfunktionalität und teilweise Nutzung<br>von TUC_KON_075                                                                                                                                                                        |  |
| 28 | EPA-TR-PHR-KeyGen<br>rndPostprocessing      | Das Fachmodul führt<br>keine Nachbearbeitung<br>durch                                                   | Examine | Der Evaluator stellt sicher, dass die vom<br>Konnektor bereit gestellte Entropie in<br>reiner Form für die Schlüsselerzeugung<br>genutzt wird.                                                                                                                   |  |
| 29 | ePA-TR-PHR-KeyGen<br>doc                    | Dokumentenschlüssel                                                                                     | Check   | PutDocument()<br>256 Bit<br>(ähnlich ePA-TR-PHR-transform-Put-doc)                                                                                                                                                                                               |  |
| 30 | ePA-TR-PHR-KeyGen<br>doc                    | Aktenschlüssel                                                                                          | Check   | ActivateAccount()<br>256 Bit                                                                                                                                                                                                                                     |  |
| 31 | ePA-TR-PHR-KeyGen<br>doc                    | Kontextschlüssel                                                                                        | Check   | ActivateAccount()<br>256 Bit                                                                                                                                                                                                                                     |  |
|    | O.PHR.KeyUse                                |                                                                                                         |         |                                                                                                                                                                                                                                                                  |  |
| 32 | ePA-TR-PHR-KeyUse<br>length                 | Plausiblitätsprüfung<br>der Länge, ggf. Abbruch                                                         | Examine | <epa:EncryptedKeyContainer><br>u.a. während der Dekodierung von<br>Hexadezimaldarstellung                                                                                                                                                                        |  |
| 33 | ePA-TR-PHR-KeyUse-IV                        | Die Akten- /<br>Kontextschlüssel<br>werden nur mit<br>AES/GCM und<br>zufälligem IV<br>verwendet         | Examine | Die Herstellererklärung stellt dar, wie die<br>Verwendung des Aktenschlüssels mit<br>anderen Algorithmen und ohne frischen<br>IV vorgebeugt wird.                                                                                                                |  |
| 34 | ePA-TR-PHR-KeyUse<br>GenSelect              | Auslesen der Smartcard<br>Generation und<br>Auswahl des<br>Berechtigten-/Authenti<br>sierungsschlüssels | Check   | Herstellererklärung, wie die<br>Schlüsselauswahl anhand der Generation<br>der SM-B Karte durchgeführt wird.                                                                                                                                                      |  |
|    | O.PHR.Transform                             |                                                                                                         |         |                                                                                                                                                                                                                                                                  |  |
| 35 | ePA-TR-PHR-transform<br>basefunc            | Nutzung der<br>Basisfunktionalität für<br>alle kryptographischen<br>Operationen                         | Check   | Herstellererklärung zu den Operationen<br>Dokument verschlüsseln,<br>Dokumentenschlüssel verschlüsseln<br>(TUC_KON_075) sowie<br>Dokumentenschlüssel entschlüsseln,<br>Dokument entschlüsseln (TUC_KON_076)                                                      |  |
| 36 | ePA-TR-PHR-transform<br>put-XML             | XML-Struktur<br><epa:EncryptedData>ba<br>uen                                                            | Examine | [gemSpec_DM_ePA#2.4]                                                                                                                                                                                                                                             |  |
|    | O.SGD.Transform                             |                                                                                                         |         |                                                                                                                                                                                                                                                                  |  |
| 37 | ePA-TR-SGD-transform<br>noparsing           | Kein Parsing von<br>Associated Data                                                                     | Check   | Parsing der Associated Data würde eine<br>potentielle Schwachstelle darstellen, es ist<br>fachlich aber nicht notwendig.<br>Herstellererklärung stellt dar, dass die<br>Associated Data nur als ganzes genutzt<br>werden oder wie Missbrauch abgewendet<br>wird. |  |

|    | Prüfaspekt (6): verschlüsselte Datenhaltung   |                                                                                          |         |                                                                                                                                                                                            |  |
|----|-----------------------------------------------|------------------------------------------------------------------------------------------|---------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| 38 | ePA-TR-SGD-transform<br>initialrule           | Associated Data<br>rollenbezogen erstellen                                               | Examine | [gemSpec_SGD_ePA#2.4, 2.6, 2.8]                                                                                                                                                            |  |
| 39 | ePA-TR-SGD-transform<br>onion                 | Akten-/<br>Kontextschlüssel im<br>Zwiebelschalenprinzip<br>verschlüsseln                 | Check   | TUC_KON_075                                                                                                                                                                                |  |
| 40 | ePA-TR-SGD-transform<br>EncryptedKeyContainer | Nur gesicherte Anteile<br>werden übermittelt                                             | Examine | <ePA:EncryptedKeyContainer><br>I_Authorization_Management::putAuthorizationKe<br>y()                                                                                                       |  |
|    | Prüfaspekt (7): Berechtigungsmanagement       |                                                                                          |         |                                                                                                                                                                                            |  |
|    | O.PHR.AuthEGK                                 |                                                                                          |         |                                                                                                                                                                                            |  |
| 41 | ePA-TR-PHR<br>AuthInsurant-mutual             | gegenseitige<br>Authentizitätsprüfung<br>erwirken                                        | Examine | TUC_KON_005 "Card-to-Card<br>authentisieren" mit authmode = gegenseitig                                                                                                                    |  |
| 42 | ePA-TR-PHR<br>AuthInsurant<br>validateCert    | Zugehörigkeit zur TI<br>festzustellen                                                    | Check   | Resultat der Basisfunktionalität auswerten                                                                                                                                                 |  |
| 43 | ePA-TR-PHR<br>AuthInsurant-exclusive          | Jeweils exklusive<br>Nutzung der eGK                                                     | Examine | TUC_KON_023<br>Notwendig für Operationen ActivateAccount<br>und RequestFacilityAuthorization                                                                                               |  |
|    | O.PHR.AuthLEI                                 |                                                                                          |         |                                                                                                                                                                                            |  |
| 44 | ePA-TR-PHR-AuthLEI<br>infomodel               | Berechtigung des<br>Primärsystems im<br>Informationsmodell<br>des Konnektors<br>abfragen | Check   | Aufruf von TUC_KON_000                                                                                                                                                                     |  |
| 45 | ePA-TR-PHR-AuthLEI<br>ProfessionOID           | Zulässige<br>ProfessionOID prüfen                                                        | Check   | Notwendigerweise vor weiteren<br>Operationen prüfen                                                                                                                                        |  |
| 46 | ePA-TR-PHR-AuthLEI<br>createToken             | Erstellung des SAML2<br>Tokens für die<br>AuthenticationAssertio<br>n eines SM-B         | Examine | u.a. Telematik-ID und Record Identifier<br>einfügen                                                                                                                                        |  |
|    | O.PHR.Permission                              |                                                                                          |         |                                                                                                                                                                                            |  |
| 47 | ePA-TR-PHR<br>Permission-PIN.CH               | PIN.CH wird verifiziert                                                                  | Check   | TUC_KON_012<br>Es darf keine andere PIN verifiziert<br>werden.                                                                                                                             |  |
| 48 | ePA-TR-PHR<br>Permission-putError             | Verhalten, nachdem<br>Schlüssel von<br>Komponente<br>Autorisierung<br>abgelehnt wurde    | Examine | I_Authorization::putAuthorizationKey()<br>FM muss beiu Fehler die Erstellung einer<br>neuen Berechtigung zurückabwickeln, d.h.<br>VAU-Berechtigung und abgeleitete<br>Schlüssel verwerfen. |  |

| 49 | ePA-TR-PHR<br>Permission-orgID             | Einsetzen der<br>Telematik-ID in die<br>Base Policy                                                                                                                | Examine | Hersteller erläutert Konzept zur<br>Mandantenfähigkeit des FM/Konnektors;<br>InstanceIdentifier "1.2.276.0.76.4.188"<br>urn:gematik:subject:organization-id<br>Telematik-ID wird dem Aufrufkontext<br>entnommen                                                                                                             |
|----|--------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 50 | ePA-TR-PHR<br>Permission-attrib            | Einsetzen des Namens<br>der LEI, des<br>unveränderlichen Teils<br>der KVNR, sowie vom<br>PS definiertem<br>Enddatum,<br>Zugriffsberechtigung in<br>die Base Policy | Check   | Name der LEI kann dem SM-B Zertifikat<br>entnommen werden<br>urn:oasis:names:tc:xspa:1.0:subject:organization<br>urn:ihe:iti:ser:2016:patient-id<br>Datum gemäß ISO 8601:2004<br>Aufrufparameter AuthorizationConfiguration                                                                                                 |
| 51 | ePA-TR-PHR<br>Permission-confuse           | Fachmodul richtet die<br>richtige Patientenakte<br>ein                                                                                                             | Examine | Die Herstellererklärung stellt dar, wie das<br>Fachmodul sicherstellt das die erzeugte<br>Base Policy mit Mandant, Aktensession<br>und dem Transportkanal in die VAU<br>zusammenpasst.                                                                                                                                      |
|    | Prüfaspekt (8): Informationsflusskontrolle |                                                                                                                                                                    |         |                                                                                                                                                                                                                                                                                                                             |
|    | O.PHR.Flow                                 |                                                                                                                                                                    |         |                                                                                                                                                                                                                                                                                                                             |
| 52 | ePA-TR-PHR-Flow-Clear                      | Weitergabe<br>unverschlüsselter<br>Assets                                                                                                                          | Check   | entsprechend Tabelle 19                                                                                                                                                                                                                                                                                                     |
| 53 | ePA-TR-PHR-Flow<br>Crypted                 | Weitergabe<br>verschlüsselter Assets                                                                                                                               | Examine | u.a. Abbruch bei Fehlern bei der<br>Verschlüsselung                                                                                                                                                                                                                                                                         |
| 54 | ePA-TR-PHR-Flow-Deny                       | Verbot anderer Exporte                                                                                                                                             | Examine | Der Hersteller erklärt, wie sonstige<br>Informationsweitergabe unterbunden<br>wird.<br>Der Evaluator prüft, ob die<br>Implementierung des Fachmoduls die<br>Assets hinreichend schützt. Evaluator<br>bestätigt, dass Schlüssel nicht an das<br>Primärsystem und Klartext-Dokumente<br>nicht an Fachdienste gelangen können. |
| 55 | ePA-TR-PHR-Flow-Deny                       | Verbot anderer<br>Operationen                                                                                                                                      | Check   | Der Hersteller erklärt, dass ausschließlich<br>zulässige Operationen vom Fachmodul<br>angeboten werden. Hierfür erkennt das<br>FM andere Operationen und weist diese<br>ab.                                                                                                                                                 |
|    | O.TLS                                      |                                                                                                                                                                    |         |                                                                                                                                                                                                                                                                                                                             |
| 56 | ePA-TR-TLS-Com<br>general                  | TLS-Dienst                                                                                                                                                         | Examine | Der Hersteller skizziert das<br>Verbindungsmanagement unter Nutzung<br>des TLS-Dienst                                                                                                                                                                                                                                       |
| 57 | ePA-TR-TLS-Com-roles                       | FM setzt erwartete<br>Rolle abhängig von<br>Fachdienst<br>Komponente                                                                                               | Check   | OID gemäß Tabelle 20<br>Übergabe der zu prüfenden Rolle an den<br>TLS-Dienst (roleToMatch)                                                                                                                                                                                                                                  |

|    | Prüfaspekt (8): Informationsflusskontrolle                                           |                                                                              |         |                                                                                                                                                                                                                   |  |  |
|----|--------------------------------------------------------------------------------------|------------------------------------------------------------------------------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|
| 58 | ePA-TR-TLS-Com-error                                                                 | Behandlung von<br>Fehlern im TLS<br>Verbindungsaufbau                        | Check   | u.a. Übergabe passender Fehlercodes                                                                                                                                                                               |  |  |
|    | Prüfaspekt (9): Nutzung der Basisfunktionalität und Security Guidance des Konnektors |                                                                              |         |                                                                                                                                                                                                                   |  |  |
|    | O.Conformance                                                                        |                                                                              |         |                                                                                                                                                                                                                   |  |  |
| 59 | ePA-TR<br>Conformance-Interface                                                      | Ausschließlich Nutzung<br>zertifizierter<br>Schnittstellen des<br>Konnektors | Examine | Zu prüfen sind alle Aufrufe von<br>Basisfunktionalitäten; Abgleich mit den<br>Angaben in der Konnektor Security<br>Guidance                                                                                       |  |  |
| 60 | ePA-TR-Conformance<br>COMP                                                           | Prüfung der Konnektor<br>Composite<br>Requirements                           | Examine | Der Hersteller erläutert, wie die<br>Composition Requirements der<br>Konnektor Security Guidance erfüllt<br>wurden.<br>Der Evaluator stellt sicher, dass diese<br>Auflagen durch das Fachmodul erfüllt<br>werden. |  |  |
|    | O.Konnektor                                                                          |                                                                              |         |                                                                                                                                                                                                                   |  |  |
| 61 | ePA-TR-Konnektor<br>Verschlüsselung                                                  | An allen relevanten<br>Stellen wird die                                      | Check   | Verschlüsselungsdienst                                                                                                                                                                                            |  |  |
| 62 | ePA-TR-Konnektor<br>Name                                                             | Basisfunktionalität<br>über die in der<br>Konnektor Security                 | Check   | Namensdienst                                                                                                                                                                                                      |  |  |
| 63 | ePA-TR-Konnektor<br>Zugriffsberechtigung                                             | Guidance113<br>dokumentierte                                                 | Check   | Zugriffsberechtigungsdienst                                                                                                                                                                                       |  |  |
| 64 | ePA-TR-Konnektor-Karte                                                               | Schnittstelle<br>aufgerufen; korrekte                                        | Check   | Kartendienst                                                                                                                                                                                                      |  |  |
| 65 | ePA-TR-Konnektor-TLS                                                                 | Auswertung von                                                               | Examine | TLS-Dienst                                                                                                                                                                                                        |  |  |
| 66 | ePA-TR-Konnektor-Zeit                                                                | sicherheitsrelevanter<br>Rückgabewerten                                      | Check   | Zeitdienst                                                                                                                                                                                                        |  |  |
| 67 | ePA-TR-Konnektor-SGD                                                                 |                                                                              | Examine | Schlüsselableitung und<br>Nachrichtensicherung mit SGD                                                                                                                                                            |  |  |
| 68 | ePA-TR-Konnektor<br>Zertifikat                                                       |                                                                              | Check   | Zertifikatsdienst                                                                                                                                                                                                 |  |  |
| 69 | ePA-TR-Konnektor<br>Signatur                                                         |                                                                              | Check   | Signaturdienst                                                                                                                                                                                                    |  |  |
| 70 | ePA-TR-Konnektor-VAU                                                                 |                                                                              | Examine | Client für leichtgewichtige<br>Sicherungsschicht in die VAU                                                                                                                                                       |  |  |
| 71 | ePA-TR-Konnektor<br>Protokoll                                                        |                                                                              | Check   | Protokollierungsdienst                                                                                                                                                                                            |  |  |
| 72 | EPA-TR-Konnektor<br>Systeminfo                                                       |                                                                              | Check   | Systeminformationsdienst                                                                                                                                                                                          |  |  |
| 73 | ePA-TR-Konnektor<br>Kartenterminal                                                   |                                                                              | Check   | Kartenterminaldienst                                                                                                                                                                                              |  |  |
|    | OE.Konnektor                                                                         |                                                                              |         |                                                                                                                                                                                                                   |  |  |
| 74 | ePA-TR-Konnektor<br>base                                                             | Basisfunktionalität                                                          | Check   | Alle durch das Fachmodul genutzten<br>Basisfunktionalitäten sind CC-zertifiziert                                                                                                                                  |  |  |

<span id="page-54-0"></span>113 Es wird dabei die Fassung des Konnektor Security Guidance verwendet, die auch Grundlage der Common Criteria Zertifizierung ist.

|    |                                |                                                                                                                                                                     |         | und ihre Nutzung erfolgt konform zur<br>Konnektor Security Guidance.<br>Vgl. Tabelle 17                                                                                                                  |  |
|----|--------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| 75 | ePA-TR-Konnektor<br>erode      | Umgehen des<br>Konnektors                                                                                                                                           | Examine | Der Hersteller stellt dar, das die<br>Basisfunktionalität wie die in Tabelle 20<br>aufgeführten Schnittstellen nicht vom<br>Fachmodul umgangen werden.                                                   |  |
|    | Prüfaspekt (10): Versionierung |                                                                                                                                                                     |         |                                                                                                                                                                                                          |  |
|    | OE.Versioning                  |                                                                                                                                                                     |         |                                                                                                                                                                                                          |  |
| 76 | ePA-TR-Versioning<br>determine | Aus der Konnektor<br>Security Guidance geht<br>hervor, dass das<br>Fachmodul und seine<br>Versionierung im<br>Konnektor<br>Lebenszyklus mit<br>berücksichtigt wird. | Check   | Dokumentation z.B. im Konnektor zur<br>Identifikation der Versionen von<br>Konnektor und Fachmodul.<br>Der Evaluator validiert, dass die<br>Versionsprüfung in dieser Weise<br>durchgeführt werden kann. |  |
| 77 | ePA-TR-Versioning<br>check     | Abgleich der<br>Fachmodulversion vor<br>Einsatz notwendig                                                                                                           | Examine | Security Guidance des Fachmoduls enthält<br>Anleitung für den Administrator, die den<br>Abgleich mit den Angaben im TR<br>Zertifikat vorschreibt                                                         |  |

<span id="page-55-0"></span>Tabelle 25: Test Charakteristika für das Fachmodul ePA

# <span id="page-56-0"></span>4 TR-Prüfbericht

# 4.1 Verfahrensschritte

Die Durchführung von Zertifzierungsverfahren für Fachmodule ePA erfolgt auf Antrag gemäß dem BSI-Schema zur Zertifzierung von Produkten nach Technischen Richtlinien. Das Verfahren ist im Dokument "Anforderungen für Antragsteller zur Zertifzierung von Produkten nach Technischen Richtlinien, TR-Produkte" festgelegt. Die jeweils aktuell gütlige Fassung dieses Dokuments wird auf der Internetsetie des BSI veröffentlicht:

[https://www.bsi.bund.de/DE/Themen/ZertifizierungundAnerkennung/Produktzertifizierung/](https://www.bsi.bund.de/DE/Themen/ZertifizierungundAnerkennung/Produktzertifizierung/Produktzertifizierung_node.html) [Produktzertifizierung\\_node.html](https://www.bsi.bund.de/DE/Themen/ZertifizierungundAnerkennung/Produktzertifizierung/Produktzertifizierung_node.html)

Zusätzliche Anforderungen für Zertifzierungsverfahren von Fachmodulen ePA sind:

- Bei der Durchführung von Zertifzierungsverfahren nach BSI-TR-03156 kann bei einem von BSI festgestellten Bedarf die gematik inhaltlich eingebunden werden. Vom Antragsteller ist diesbezüglich im Rahmen der Antragstgellung eine Einverstädniserklärung zu unterzeichnen. Eine entsprechende Vorlage ist auf der Internetseite des BSI veröffentlicht: [https://www.bsi.bund.de/DE/Themen/ZertifizierungundAnerkennung/Produktzertifizierung/](https://www.bsi.bund.de/DE/Themen/ZertifizierungundAnerkennung/Produktzertifizierung/ZertifizierungnachTR/Antraege_Kontakt/antraege_kontakt_node.html) [ZertifizierungnachTR/Antraege\\_Kontakt/antraege\\_kontakt\\_node.html.](https://www.bsi.bund.de/DE/Themen/ZertifizierungundAnerkennung/Produktzertifizierung/ZertifizierungnachTR/Antraege_Kontakt/antraege_kontakt_node.html)
- Dem Zertifizierungsantrag ist ein Verweis auf das führende gematik Zulassungsverfahren beizulegen.
- Die von der Prüfstelle für die Konformitätsprüfung eines Fachmoduls ePA geplanten Prüfschritte/- Aktivitäten sind mit dem BSI vor deren Durchführung abzustimmen.

## 4.2 Prüfaussagen

Der TR-Prüfbericht gliedert sich in

- Prüfaspekte nach Abschnitt [3.2,](#page-30-1) hierin fasst der Evaluator die Ergebnisse aus den Sicherheitszielen und Prüfschritten zu Verdicts zusammen. Die TR-Prüfung bewertet letztlich, inwiefern die in der Security Problem Definition (Abschnitt [2.4\)](#page-27-0) aufgeführten Szenarien durch die Implementierung hinreichend behandelt werden;
- Sicherheitsziele nach Abschnitt [3.2](#page-30-1) mit den Prüfschritten nach Abschnitt [3.4.2](#page-47-0);
- ein umfassendes Urteil zu den in der OWASP:2017 adressierten Bedrohungen (Abschnitt [3.3.1\)](#page-43-0).

Final bewertet der Evaluator in einem einzigen Verdict, ob das untersuchte Fachmodul die Prüfungen bestanden hat.

Die Prüfergebnisse mit Anlagen werden dem BSI zur Prüfung und Zertifizierung übermittelt.

## 4.3 Konfiguration

Der TR-Prüfbericht MUSS die begutachtete Version des Fachmoduls identifizieren sowie die Fachmodul Security Guidance, weitere Handbücher und gegebenenfalls genutzte Komponenten außerhalb des Fachmoduls. Weiter identifiziert der Prüfbericht den Konnektor, der zur Prüfung vorlag (anhand eindeutiger Versionierung).

Die TR-Zertifizierung betrifft alleine den Betrieb des Fachmoduls in der untersuchten Version des Konnektors. Der Einsatz des Fachmoduls mit einer abweichenden Version des Konnektors ist mit dem BSI abzustimmen. Bei Änderungen an den Schnittstellen zwischen FM und Konnektor ist der Umfang der TR-Prüfung vorab mit dem BSI abzustimmen.

# <span id="page-57-0"></span>Literaturverzeichnis

|                                | Stand R3.1.1 (Stand 28.06.2019)                                                                                                                                                                                                                                                         |  |
|--------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| [AIS20V1]                      | Funktionalitätsklassen und Evaluationsmethodologie für deterministische<br>Zufallszahlengeneratoren, Version 1.0, 02.12.1999                                                                                                                                                            |  |
| [RNGEV]                        | Evaluation of random number generators, Version 0.10                                                                                                                                                                                                                                    |  |
| [KS2011]                       | W. Killmann, W. Schindler, "A proposal for: Functionality classes for random number<br>generators", Version 2.0, September 18, 2011                                                                                                                                                     |  |
| [gemGlossar]                   | Glossar der Telematikinfrastruktur, Einführung der Gesundheitskarte, v4.0.0,<br>10.10.2014                                                                                                                                                                                              |  |
| [gemILF_PS_ePA]                | Implementierungsleitfaden Primärsysteme, Elektronische Patientenakte (ePA),<br>Elektronische Gesundheitskarte und Telematikinfrastruktur, Version 1.2.0, rev<br>127142, 28.06.2019, gematik Gesellschaft für Telematikanwendungen der<br>Gesundheitskarte mbH                           |  |
| [gemProdT_Kon]                 | Produkttypsteckbrief Konnektor, Produkttyp v4.2.0-0, Version 1.0.0, rev 128527,<br>28.06.2019, gematik Gesellschaft für Telematikanwendungen der Gesundheitskarte<br>mbH                                                                                                                |  |
| [gemSpec_DM_ePA]               | Datenmodell ePA, Elektronische Gesundheitskarte und Telematikinfrastruktur,<br>Version 1.2.0, rev 127084, 28.06.2019, gematik Gesellschaft für<br>Telematikanwendungen der Gesundheitskarte mbH                                                                                         |  |
| [gemSpec_Dokumentenverwaltung] | Spezifikation ePA-Dokumentenverwaltung, Elektronische<br>Gesundheitskarte und Telematikinfrastruktur, Version 1.2.0, rev 127085, 28.06.2019,<br>gematik Gesellschaft für Telematikanwendungen der Gesundheitskarte mbH                                                                  |  |
| [gemSpec_FM_ePA]               | Spezifikation Fachmodul ePA, Elektronische Gesundheitskarte und<br>Telematikinfrastruktur, Version 1.2.0, rev 127100, 28.06.2019, gematik Gesellschaft für<br>Telematikanwendungen der Gesundheitskarte mbH                                                                             |  |
| [gemSpec_Kon]                  | Einführung der Gesundheitskarte: Konnektorspezifikation, Version 5.7.0, Rev 127129,<br>28.06.2019, gematik Gesellschaft für Telematikanwendungen der Gesundheitskarte<br>mbH                                                                                                            |  |
| [gemSpec_Krypt]                | Verwendung kryptographischer Algorithmen in der Telematikinfrasturktur,<br>Übergreifende Spezifiaktion, Elektronische Gesundheitskarte und<br>Telematikinfrastruktur, Version 2.14.0, rev 127061, 28.06.2019, gematik Gesellschaft<br>für Telematikanwendungen der Gesundheitskarte mbH |  |
| [gemSpec_OID]                  | Festlegung von OIDs, Spezifikation, Elektronische Gesundheitskarte und<br>Telematikinfrastruktur, Version 3.5.0 rev 127071, 28.06.2019, gematik Gesellschaft für<br>Telematikanwendungen der Gesundheitskarte mbH                                                                       |  |
| [gemSpec_SGD_ePA]              | Spezifikation Schlüsselgenerierungsdienst ePA, v1.1.0, rev 127091, 28.06.2019, gematik<br>Gesellschaft für Telematikanwendungen der Gesundheitskarte mbH                                                                                                                                |  |
| [gemSpec_Zugangsgateway_Vers]  | Spezifikation Zugangsgateway des Versicherten ePA, Elektronische<br>Gesundheitskarte und Telematikinfrastruktur, Version 1.2.0, rev 127122, 28.06.2019,<br>gematik Gesellschaft für Telematikanwendungen der Gesundheitskarte mbH                                                       |  |
| [gemSysL_ePA]                  | Systemspezifisches Konzept ePA, Elektronische Gesundheitskarte und<br>Telematikinfrastruktur, Version 1.2.0, rev 128216, 28.06.2019, gematik Gesellschaft für<br>Telematikanwendungen der Gesundheitskarte mbH                                                                          |  |
| [OWASP:2017]                   | OWASP 2017 Top 10, retrieved from https://www.owasp.org/index.php/Top_10-<br>2017_Top_10, 27.03.2018, The OWASP Foundation                                                                                                                                                              |  |

| [OWASP-XXE]  | XML External Entity (XXE) Prevention Cheat Sheet, retrieved from<br>https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Prevention_Cheat_S<br>heet, 03.12.2018, The OWASP Foundation                                           |
|--------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [PP-0098]    | Anforderungen an den Konnektor, Schutzprofil 2, BSI-CC-PP-0098-2018, 17.09.2018,<br>Bundesamt für Sicherheit in der Informationstechnik                                                                                              |
| [TR-03116-1] | Telematikinfrastruktur, Kryptographische Vorgaben für Projekte der<br>Bundesregierung, Technische Richtlinie 03116, Teil 1, Dokument ID TR-03116-1,<br>Version 3.20, 21.09.2018, Bundesamt für Sicherheit in der Informationstechnik |

# <span id="page-59-0"></span>Stichwortverzeichnis

| Aktensession                                            | Im Fachmodul zwischengespeicherte Informationen, die über<br>mehreren IHE-Requests/-Responses bestehende Interaktion aufrecht<br>erhalten werden darf.<br>Ob eine Aktensession zwischen verschiedenen Berechtigten geteilt<br>werden darf, entscheidet das Fachmodul (vgl. Abschnitt 2.3.1). Dazu<br>werden Aktensessions anhand der Versicherten-ID der eGK bzw.<br>Telematik-ID des SM-B strikt separiert. |
|---------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Aktenschlüssel                                          | Dokumentenschlüssel werden mit dem Aktenschlüssel verschlüsselt.<br>Der Aktenschlüssel darf in der Aktensessions zwischengespeichert<br>werden.                                                                                                                                                                                                                                                              |
| Asset                                                   | Informationen, die durch das Fachmodul verarbeitet werden und die<br>einen Schutzbedarf (bps. Vertraulichkeit, Integrität) besitzen                                                                                                                                                                                                                                                                          |
| Associated Data (AD)                                    | Im Kontext AEAD: authentisierte, nicht verschlüsselte Daten                                                                                                                                                                                                                                                                                                                                                  |
|                                                         | Im Kontext SGD: die Associated Data enthalten Berechtigten- und<br>Aktenkontospezifische Angaben die zur Schlüsselableitung notwendig<br>sind                                                                                                                                                                                                                                                                |
| Authenticated Encryption with<br>Associated Data (AEAD) | Allgemein: Kategorie von Blockmodi, die sowohl Authentizität als auch<br>Vertraulichkeit umfassen. Während die Authentizität die gesamten<br>Daten einschließt, kann die Vertraulichkeit nur für einen begrenzten<br>Teil genutzt werden.                                                                                                                                                                    |
|                                                         | In der Basisfunktionalität eingesetzt mit AES/GCM 256 in<br>TUC_KON_075/076                                                                                                                                                                                                                                                                                                                                  |
| AuthenticationAssertion                                 | Für Versichertern/Vertreter: Enthält u.a Record Identifier, KVNR,<br>Signatur der Komponente ePA Zugangsgateway des Versicherten                                                                                                                                                                                                                                                                             |
|                                                         | für LEI: Enthält u.a. Record Identifier, TelematikID, Signatur durch SM<br>B                                                                                                                                                                                                                                                                                                                                 |
|                                                         | [gemSpec_Authentisierung_Vers]                                                                                                                                                                                                                                                                                                                                                                               |
| AuthorizationAssertion                                  | Berechtigung auf eine Patientenakte zuzugreifen; signiert durch<br>Komponente Autorisierung                                                                                                                                                                                                                                                                                                                  |
|                                                         | [gemSpec_Autorisierung]                                                                                                                                                                                                                                                                                                                                                                                      |
| <AuthorizationKey>                                      | Berechtigten- und Akten-spezifischer Datensatz, der die verschlüsselten<br>Akten- und Kontextschlüssel enthält.                                                                                                                                                                                                                                                                                              |
| BasePolicy                                              | Das Regelwerk für die VAU besteht aus der BasePolicy und der<br>PermissionPolicy. Die BasePolicy identifiziert Aktenkonto, zugreifende<br>Partei sowie Art und Dauer der Zugriffsberechtigung.                                                                                                                                                                                                               |
| Basisdienst des Konnektors                              | Hier: dem Fachdienst zugängliche Schnittstellen gemäß [gemSpec_Kon]                                                                                                                                                                                                                                                                                                                                          |
| Basisfunktionalität des                                 | umfasst die Basisdienste sowie weitere Aufgaben gemäß                                                                                                                                                                                                                                                                                                                                                        |

| Konnektors                           | [gemProdT_Kon#Tab 7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|--------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Berechtigtenschlüssel                | Für jeden <AuthorizationKey> werden zwei Berechtigtenschlüssel von<br>SGD1 und SGD2 zur Entschlüsselung genutzt. Das Fachmodul ruft<br>einen Berechtigtenschlüssel vom SGD ab, wobei sich die<br>Aufrufparameter zwischen initialer und wiederkehrender<br>Schlüsselableitung unterscheiden.                                                                                                                                                                                                       |
| CardSession                          | Kartensitzung                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Deserialisierung, sichere            | Ein Transportkanal stellt einen Bitdatenstrom dar. Um hierüber<br>struktruierte Daten zu übertragen, ist eine Serialisierung /<br>Deserialisierung notwendig, etwa um Header- und Bodydaten<br>voneinander zu trennen. Als sicher wird diese betrachtet, falls durch<br>den Datenstrom in keinem Fall die Deserialisierung gestört werden<br>kann. Es handelt sich dabei um eine Eigenschaft des Protokolls. Ein<br>Positivbeispiel sind Base64-kodierte Datenfelder.                              |
| Dokumentenschlüssel                  | Das Fachmodul nutzt den Dokumentenschlüssel, um das Dokument zu<br>ver-/entschlüsseln. Der Dokumentenschlüssel wird seinerseits mit dem<br>Aktenschlüssel verschlüsselt und gemeinsam mit dem Dokument im<br>Aktensystem abgelegt.                                                                                                                                                                                                                                                                 |
| eHealth-Kartenterminal (eH-KT)       | ein separat mit dem Konnektor verbundenes Terminal über die der<br>Versicherte Anzeigen erhält, seine eGK einführt und eine PIN-Eingabe<br>vornehmen kann                                                                                                                                                                                                                                                                                                                                          |
| Hersteller                           | hier: Anbieter des Fachmoduls                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Herstellererklärung                  | Schriftlich niedergelegte Aussagen des Herstellers zur Erfüllung der<br>Testcharakteristiken nach Abschnitt 3.4.2. Der Evaluator kann sich in<br>der Prüfung "check" auf die Aussagen der Herstellererklärung beziehen.                                                                                                                                                                                                                                                                            |
| IHE                                  | hier: die Spezifikationen des Integrating the Healthcare Enterprise<br>Comittee                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Kanal, gesicherter                   | Transportkanal mit gegenseitiger Authentifzierung der<br>Kommunikationsteilnehmer und Verschlüsselung                                                                                                                                                                                                                                                                                                                                                                                              |
| KeyDerivationRequest                 | Eine ASN.1-Sequenz von Parametern für die Schlüsselableitung u.a. die<br>Zeichenkette "KeyDerivation" und die Associated Data enthält. Für die<br>initiale Schlüsselableitung erzeugt die Basisfunktionalität dies aus<br>Parametern des Fachmoduls. Für die wiederkehrende<br>Schlüsselableitung werden die Associated Data aus dem<br>Schlüsselspeicher genutzt. Der KeyDerivationRequest unterscheidet<br>sich für SGD1/2, da die Associated Data unterschiedlich von SGD1/2<br>gesetzt werden. |
| Kontextschlüssel                     | Der Kontextschlüssel wird in der VAU für die Verschlüsselung der<br>Patientenakte (IHE-Dokumente und Metadaten) verwendet. Der<br>Kontextschlüssel darf in der Aktensessions zwischengespeichert<br>werden.                                                                                                                                                                                                                                                                                        |
| Krankenversichertennummer<br>(KVNR), | Im Kontext des FM ePA wird als KVNR nur der unveränderliche Teil<br>bezeichnet, die den Versicherten eindeutig bezeichnet. Vgl. auch<br>RecordIdentifier.                                                                                                                                                                                                                                                                                                                                          |

| auch: Versicherten-ID                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|----------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Leistungserbringerinstitution<br>(LEI) | Erbringt eine Leistung im Auftrag der GKV                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Primärsystem                           | Ein System in der LEI-Umgebung mit Zugriff auf den Konnektor und<br>das Fachmodul                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Privacy                                | Konzept zum Datenschutz u.a. Schutz medizinischer und persönlicher<br>Daten; hier: die Dokumente der Patientenakte weisen höchsten<br>Schutzbedarf auf                                                                                                                                                                                                                                                                                                                                                                 |
| Protokoll                              | Die Protokollierung von Informationen und Fehlermeldung durch das<br>FM ePA im Protokollierungsdienst des Konnektors                                                                                                                                                                                                                                                                                                                                                                                                   |
| Residual Data                          | nach einen Funktionsablauf verbleibende Daten; sofern es sich um<br>Assets handelt, sollen diese aktiv gelöscht werden, z.B. durch<br>Überschreiben                                                                                                                                                                                                                                                                                                                                                                    |
| RecordIdentifier                       | Kennzeichen einer Patientenakte, enthält den unveränderlichen Teil<br>der KVNR. Eine eindeutige Referenz auf die Patientenakte benötigt<br>auch eine HomeCommunityID                                                                                                                                                                                                                                                                                                                                                   |
| Schlüsselableitung                     | Konzept für den Schutz des <AuthorizationKey>, wobei aus einem<br>Masterkey und den Associated Data ein individueller Schlüssel für<br>einen Berechtigten und eine Patientenakte abgeleitet wird. Den Prozeß<br>der Schlüsselableitung stößt die Basisfunktionalität im SGD-HSM an,<br>indem es im KeyDerivationRequest die jeweiligen Associated Data<br>übermittelt. Das Fachmodul erhält darauf den Berechtigtenschlüssel<br>SGD1 bzw. SGD2 mit denen der <epa:EncryptedKeyContainer><br>entschlüsselt werden kann. |
| Schlüsselableitung, initial            | Bei der initialen Schlüsselableitung sendet das Fachmodul nur<br>Information abhängig von der zugreifenden Rolle an das SGD-HSM                                                                                                                                                                                                                                                                                                                                                                                        |
| Schlüsselableitung,<br>wiederkehrend   | Bei der wiederkehrenden Schlüsselableitung bezieht das Fachmodul die<br>Associated Data 1 / 2 aus dem <AuthorizationKey>.                                                                                                                                                                                                                                                                                                                                                                                              |
| Schlüsselmaterial                      | hier eingesetzt als Oberbegriff für die verschlüsselten<br>Kontext-/Aktenschlüssel                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Schlüsselgenerierungsdienst<br>(SGD)   | Zwei HSM-basierte Dienste über die das Fachmodul Aktenbezogene<br>Berechtigtenschlüssel erhält                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Security Guidance                      | Anforderungen an den sicheren Betrieb des Konnektors oder eines<br>Fachmoduls                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Security Problem Definition<br>(SPD)   | Begriff aus der Common Criteria [CCPART1], Anhang A.6; Formuliert<br>trennscharf, vor welchen Bedrohungen der TOE schützen soll, welche<br>Annahmen dem TOE zugrunde liegen und welche Organisatorischen<br>Maßnahmen der TOE umsetzten soll                                                                                                                                                                                                                                                                           |

| Telematik-ID                              | Identifikationsmerkmal eines Telematik Teilnehmers; im Kontext FM<br>ePA: identifiziert die Leistungserbringerinstitution                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Telematikinfrastruktur (TI)               | Internes Netz für Abwicklung von Geschäftsprozessen der Telematik;<br>abstrakt auch umfassender Begriff für alle an der Telematik Funktion<br>beteiligten Geräte und Prozesse                                                                                                                                                                                                                                                                                                                                                                                      |
| Test-Charakteristik (TC)                  | ein Testfall, der einen einzelnen Aspekt einer Sicherheitsfunktion oder<br>Sicherheitsaspekt nachweist                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 'Transform'                               | Das Fachmodul führt eine Transformation von IHE-Anfragen durch.<br>Dies umfasst die Umkodierung (diese besitzen unterschiedliche Codes<br>zwischen Primärsystem und Fachmodul sowie Fachmodul und<br>Aktensystem) und die Verschlüsselung (vgl. Abschnitt 2.1.1).                                                                                                                                                                                                                                                                                                  |
| Transport Layer Security (TLS)            | Standard für die verschlüsselte, authentisierte Client-Server<br>Kommunikation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Transportsicherung zur VAU                | Der Konnektor realisiert eine leichtgewichtige Sicherungsschicht auf<br>Anwendungsebene gemäß [gemSpec_Krypt#6]. Dies umfasst den<br>Schutz der Vertraulichkeit, Integrität, Authentizität, vor Replay<br>Angriffen sowie Rollen- und Zertifikatsprüfung. Das Fachmodul nutzt<br>diese Sicherungsschicht vergleichbar mit TLS-Verbindungen über<br>Aufrufe der Basisfunktionalität.                                                                                                                                                                                |
| Verdict                                   | Prüfergebnis: PASS   INCONCLUSIVE   FAIL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Verschlüsselung                           | Die Verschlüsselung kryptographischer Schlüssel dient der<br>Gewaltenteilung: der Schlüsselspeicher enthält zwar Schlüsselmaterial,<br>kann dies jedoch nicht missbrauchen, da es in überschlüsselter Form<br>gespeichert ist. Der Dokumentenspeicher enthält<br>Dokumentenschlüssel, kann diese jedoch nicht nutzen, da sie in<br>überschlüsselter Form vorliegen. Der Berechtigtenschlüssel liegt nur in<br>einer SM-B oder eGK vor und wird nicht exportiert. Das Fachmodul<br>hält die entschlüsselten Assets während es für die Bearbeitung<br>notwendig ist. |
| Versicherten-ID                           | Siehe KVNR                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Vertrauenswürdige<br>Ablaufumgebung (VAU) | VAUs werden von der Komponente Dokumentenverwaltung betrieben<br>und eine VAU verwaltet die Metadaten und Dokumente einer<br>Patientienakte.                                                                                                                                                                                                                                                                                                                                                                                                                       |
| XML External Entities (XXE)               | Ein typische Schwachstelle von XML Protokollparsern, bei der ein<br>Angreifer an der Importschnittstelle die Sematik über die vorgesehenen<br>Möglichkeiten hinaus bösartig verändern kann [OWASP-XXE]                                                                                                                                                                                                                                                                                                                                                             |
| Zufallszahlengenerator                    | ein Baustein, der Zufallszahlen einer nachgewiesenen Güte bereitstellt;<br>das vom BSI betriebene Common Criteria Schema beschreibt deren<br>Prüfung in [AIS20V1], [KS2011] und [RNGEV]. Im Kontext des<br>Fachmoduls ePA werden Zufallszahlen über Basisfunktionalität des<br>Konnektors bezogen                                                                                                                                                                                                                                                                  |

| Zugangsgateway des<br>Versicherten (ZGdV) | (im Kontext FM ePA:) zuständig für die Authentisierung des<br>Versicherten gegenüber den Komponenten des Aktensystems<br>[gemSpec_Zugangsgateway_Vers] |
|-------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|
|-------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|

# <span id="page-64-0"></span>Abkürzungsverzeichnis

| AD    | Associated Data                                             |
|-------|-------------------------------------------------------------|
| AEAD  | Authenticated Encryption with Associated Data Schema Schema |
| CC    | Common Criteria                                             |
| ECIES | Elliptic Curve Integrated Encryption Scheme                 |
| eH-KT | eHealth-Kartenterminal                                      |
| eGK   | Elektronische Gesundheitskarte                              |
| FM    | Fachmodul                                                   |
| FdV   | Frontend des Versicherten                                   |
| GKV   | Gesetzliche Krankenversicherung                             |
| ePA   | Elektronische Patientenakte                                 |
| IHE   | Initiative 'Integrating the Healthcare Enterprise'          |
| KVNR  | Krankenversichertennummer                                   |
| LEI   | Leistungserbringerinstitution                               |
| PP    | Schutzprofil / eng. Protection Profile                      |
| SM-B  | Security Module Typ B [gemGlossar]                          |
| SPD   | Security Problem Definition                                 |
| TC    | Test Charakteristika                                        |
| TI    | Telematikinfrastruktur                                      |
| TLS   | Transport Layer Security                                    |
| TOE   | Target of Evaluation                                        |
| VAU   | Vertrauenswürdige Ausführungsumgebung                       |
| XEE   | XML External Entities                                       |
| ZGdV  | Zugangsgateway des Versicherten                             |